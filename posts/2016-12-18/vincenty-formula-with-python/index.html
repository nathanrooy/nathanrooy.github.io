<!doctype html><html lang=en><head><meta charset=utf-8><title>Nathan Rooy</title>
<meta content="Nathan Rooy" name=author><meta content="en" name=language><meta content="width=device-width,minimum-scale=1" name=viewport><meta content="nathan.fun" property="og:site_name"><meta content="nathan.fun" property="twitter:domain"><meta content="article" property="og:type"><meta content="https://nathan.fun/posts/2016-12-18/vincenty-formula-with-python/" property="og:url"><meta content="https://nathan.fun/posts/2016-12-18/vincenty-formula-with-python/" name=twitter:url><meta content="Nathan A. Rooy" name=copyright><meta content="summary_large_image" name=twitter:card><meta content="python,vincenty,geospatial analysis" name=keywords><meta content="Calculate the Distance Between Two GPS Points with Python (Vincenty’s Inverse Formula)" name=twitter:title><meta content="Calculate the Distance Between Two GPS Points with Python (Vincenty’s Inverse Formula)" property="og:title"><meta content="Vincenty's inverse formula provides an accurate method for calcualting the distance between two latitude/longitude pairs. Learn how to implement your own with Python" name=description><meta content="Vincenty's inverse formula provides an accurate method for calcualting the distance between two latitude/longitude pairs. Learn how to implement your own with Python" name=twitter:description><meta content="Vincenty's inverse formula provides an accurate method for calcualting the distance between two latitude/longitude pairs. Learn how to implement your own with Python" property="og:description"><meta content="https://nathan.fun/posts/2016-12-18/vincenty-formula-with-python/about/about.jpg" name=twitter:image><meta content="https://nathan.fun/posts/2016-12-18/vincenty-formula-with-python/about/about.jpg" property="og:image"><meta content="https://nathan.fun/posts/2016-12-18/vincenty-formula-with-python/about/about.jpg" name=thumbnail><link href=https://nathan.fun/index.xml rel=alternate type=application/rss+xml title="Nathan Rooy"><link href=/favicon/favicon.png rel=icon type=image/png><link href=/fonts/figtree-v1-latin-regular.woff2 rel=preload as=font type=font/woff2 crossorigin><link href=https://nathan.fun/posts/2016-12-18/vincenty-formula-with-python/ rel=canonical><link rel=blogroll type=text/xml href=https://raw.githubusercontent.com/nathanrooy/feedly-opml-archiver/refs/heads/main/feedly.opml><script defer data-domain=nathan.fun src=https://plausible.io/js/script.tagged-events.js></script><style>:root{--main-text-color:#222;--main-text-weight:400;--text-bold:600;--font-family:"Figtree", sans-serif;--background-light:#F5F5F5;--link-text-color:#0955b5;--dark-text-color:#999}html{font-size:16px}body{-webkit-font-smoothing:antialiased;font-family:var(--font-family);color:var(--main-text-color);font-weight:var(--main-text-weight)}.wrapper{max-width:660px;margin:6rem auto 0;padding:1rem}a{text-decoration:none;color:var(--link-text-color)}a:hover{text-decoration:underline}a:visited{color:var(--link-text-color)}::selection{background:#fff9c4;text-shadow:none}img{margin:1.5em auto;max-width:100%;display:block}a img{border:none}@font-face{font-family:Figtree;font-style:normal;font-weight:400;font-display:swap;src:url(/fonts/figtree-v1-latin-regular.eot);src:local(''),url(/fonts/figtree-v1-latin-regular.eot?#iefix)format('embedded-opentype'),url(/fonts/figtree-v1-latin-regular.woff2)format('woff2'),url(/fonts/figtree-v1-latin-regular.woff)format('woff'),url(/fonts/figtree-v1-latin-regular.ttf)format('truetype'),url(/fonts/figtree-v1-latin-regular.svg#Figtree)format('svg')}@font-face{font-family:Figtree;font-style:normal;font-weight:600;font-display:swap;src:url(/fonts/figtree-v1-latin-600.eot);src:local(''),url(/fonts/figtree-v1-latin-600.eot?#iefix)format('embedded-opentype'),url(/fonts/figtree-v1-latin-600.woff2)format('woff2'),url(/fonts/figtree-v1-latin-600.woff)format('woff'),url(/fonts/figtree-v1-latin-600.ttf)format('truetype'),url(/fonts/figtree-v1-latin-600.svg#Figtree)format('svg')}.home-page ul a{color:var(--main-text-color)}.home-page .post-ul{list-style-type:none;padding-left:0;line-height:1.6em;margin-top:0}.home-page .post-li{overflow:hidden;margin-bottom:.3rem}.home-page .post-li-title{font-size:1.2rem;width:95%;text-overflow:ellipsis;white-space:nowrap;overflow:hidden;float:left}.home-page .post-li-date{padding-bottom:1em;color:var(--dark-text-color)}@media only screen and (max-width:750px){.wrapper{margin-top:2.5rem;margin-left:0}.home-page .post-ul{line-height:1.5em;margin-top:.2rem;padding-left:0}}.math-block{margin-top:2rem;margin-bottom:2rem}mtext{position:absolute;right:0}.inline-svg-equation{text-align:center;margin:1.5em auto;max-width:100%;display:block}ul.flat{margin:0;padding:0}ul.flat li{display:inline-block;list-style:none;margin-left:0}.post-header h1{font-weight:var(--main-text-weight);font-size:2.3rem;color:var(--main-text-color);line-height:2.64rem}.post ul li{margin-bottom:10px}.post ul li p{display:inline}.post .post-header{margin-bottom:2.5rem}.post .post-header .title{margin:0}.post hr{margin:4rem 0;height:1px;border:none;color:var(--main-text-color);background-color:var(--main-text-color)}.highlighter-rouge{position:relative;font-size:.75rem;color:var(--main-text-color);border:1px solid;border-color:#e6e6e6;border-radius:3px;background-color:var(--background-light);padding:.1rem .2rem}.figcaption{font-size:.8rem;padding-bottom:1rem}.markdown{padding-bottom:8rem}.markdown ol li{padding-bottom:.75em}.markdown p{font-size:1rem;margin:0 0 1rem;line-height:1.7rem;letter-spacing:.01rem;word-spacing:.025rem}.markdown blockquote{background-color:var(--background-light);border-left:10px solid;border-color:#2dad60;padding:1.5rem;margin:0 0 1rem;line-height:1.5rem;font-size:15px}h2{font-size:1.2rem;font-weight:var(--text-bold);margin-bottom:.3em}*+h2{padding-top:2rem}.markdown .ul-style-b li{margin-bottom:.5rem;font-size:16px}.TLDR{font-size:1.1rem;line-height:1.7rem;letter-spacing:.02rem}table{width:100%;font-size:14px;letter-spacing:-.01em;border-collapse:collapse;margin-bottom:2em;margin-top:2em;line-height:1.2rem}table th{text-align:left}table thead{border-bottom:1px solid var(--main-text-color);line-height:1.4em}figure{margin:0;text-align:center}ul{padding-left:15px;list-style:disc inside}.highlight pre{padding:20px;background-color:transparent!important;overflow:auto;word-wrap:normal;white-space:pre}.highlight{background:0 0;background-color:var(--background-light)}@media only screen and (min-width:751px){#burger{padding-left:2rem;padding-top:2rem}}@media only screen and (max-width:750px){#burger{padding-left:1rem;padding-top:1rem}}#burger{font-family:var(--font-family);font-weight:400;color:#a9a9a9;font-size:1.5rem}#burger a{display:inline-block;padding-right:.8rem}#burger label{cursor:pointer}#burger label:hover{color:var(--main-text-color)}#nav-icons{padding-left:.8rem}#nav-icons svg{max-height:20px;margin-bottom:-.05rem;color:var(--main-text-color)}#l1-val{position:relative;top:-.12rem}#l2-val{position:relative;top:-.2rem;padding-left:.1rem;padding-right:.1rem}#burger-cbox{display:none}#label-1{display:inline-block}#label-2{display:none}#burger-cbox:not(:checked)~#nav-icons{display:none}#burger-cbox:checked~#nav-icons{display:inline-block}#burger-cbox:checked~#label-1{display:none}#burger-cbox:checked~#label-2{display:inline-block;color:var(--main-text-color)}</style><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/katex.min.css integrity=sha384-nB0miv6/jRmo5UMMR1wu3Gz6NLsoTkbqJghGIsx//Rlm+ZU03BU6SQNC66uf4l5+ crossorigin=anonymous></head><body><div class=header><nav><div id=burger><input type=checkbox id=burger-cbox>
<label id=label-1 for=burger-cbox><span>[</span><span id=l1-val>+</span><span>]</span>
</label><label id=label-2 for=burger-cbox><span>[</span><span id=l2-val>x</span><span>]</span></label><div id=nav-icons><a class="plausible-event-name=burger+home" aria-label=Home style=padding-right:.7rem href=/><svg id="home-icon" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="feather feather-home"><path d="M3 9l9-7 9 7v11a2 2 0 01-2 2H5a2 2 0 01-2-2z"/><polyline points="9 22 9 12 15 12 15 22"/></svg></a>
<a class="plausible-event-name=burger+reading" aria-label=Reading href=/reading><svg width="24" height="24" viewBox="0 0 23.809855 18.892912" id="svg5"><defs id="defs2"/><g id="layer1" transform="translate(-6.352941,-30.26865)"><g id="g39" transform="matrix(0.26458333,0,0,0.26458333,5.0300244,26.48677)"><path class="st0" d="m92.22 22.9v59C74.24 76.35 61.26 78.85 54.73 81.04 59.2 76.64 68.54 70.55 84.16 74.14l1.69.39V21.42c2.17.29 4.3.77 6.37 1.48z" id="path11"/><path class="st0" d="M45.24 81.04C38.73 78.85 25.74 76.35 7.77 81.9v-59c2.06-.71 4.2-1.19 6.37-1.48v53.11l1.68-.39c15.61-3.58 24.96 2.5 29.42 6.9z" id="path13"/><polygon points="48.86,85.63 48.82,85.58 48.91,85.63" id="polygon15"/><polygon points="51.17,85.58 51.13,85.63 50,85.63 51.09,85.62" id="polygon17"/><path d="m94.09 20.63c-2.68-1-5.45-1.65-8.24-2.02v-2.94l-1.08-.24c-17.8-4.09-28.32 3.81-32.9 8.68-.81.87-1.44 1.63-1.88 2.22C49.54 25.74 48.91 24.98 48.1 24.11c-4.58-4.87-15.11-12.76-32.9-8.68l-1.07.24v2.94c-2.8.38-5.57 1.02-8.24 2.02L5 20.97V85.7l1.81-.61c13.49-4.49 24.13-4.16 30.68-3.08 7.09 1.15 11.05 3.4 11.09 3.42l.23.14.09.06H50l1.09-.01.08-.05.23-.14c.05-.02 4-2.27 11.09-3.42 6.55-1.08 17.19-1.41 30.68 3.08l1.82.61V20.97zM7.78 81.89v-59c2.06-.71 4.2-1.19 6.37-1.48v53.11l1.68-.39c15.61-3.58 24.95 2.5 29.42 6.9-6.52-2.18-19.5-4.68-37.47.86zm40.76-1.3c-4.19-4.66-14.29-12.83-31.63-9.5v-53.2c11.11-2.28 18.93.38 24.02 3.66 2.6 1.68 4.48 3.52 5.71 4.95 1.14 1.32 1.73 2.28 1.82 2.43l.08.15zm2.76.17V29.34l.24-.4c.09-.16.68-1.12 1.82-2.44 1.23-1.43 3.11-3.27 5.71-4.94 5.08-3.29 12.91-5.95 24.02-3.67v53.2C65.54 67.72 55.4 76.13 51.3 80.76zm40.92 1.13C74.24 76.34 61.26 78.84 54.73 81.03 59.2 76.63 68.54 70.54 84.16 74.13l1.69.39v-53.1c2.16.29 4.3.77 6.37 1.48z" id="path19"/></g></g><style id="style9">.st0{fill:none}</style></svg>
</a><a class="plausible-event-name=burger+nycbike" aria-label="NYC Bike Exploring" style=margin-left:.4rem href=/bike-exploring/nyc><svg viewBox="0 0 91.5 52.5" width="32" height="24"><g transform="matrix(-1,0,0,1,95.8,-23.9)"><path d="m78 40.6c-3.8.0-7.3 1.2-10.2 3.2l-7.4-9.4 2.9-8.5H67c.6.0 1-.4 1-1s-.4-1-1-1H54.8c-.6.0-1 .4-1 1s.4 1 1 1h6.3l-2.3 6.7c-.2-.2-.4-.3-.7-.3H32l2.2-6.4h5.7c.6.0 1-.4 1-1s-.4-1-1-1h-6.4c-.4.0-.8.3-.9.7l-5.7 16.8c-1.5-.4-3.1-.7-4.8-.7-9.8.0-17.8 8-17.8 17.8s8 17.8 17.8 17.8 17.8-8 17.8-17.8c0-7.5-4.6-13.9-11.2-16.5l2.6-7.6 19 24.4c.1.3.3.6.6.7.1.0.2.1.3.1h.1 8.9c.5 9.4 8.3 16.8 17.8 16.8 9.8.0 17.8-8 17.8-17.8s-8-18-17.8-18zM37.8 58.4c0 8.7-7.1 15.8-15.8 15.8S6.2 67.1 6.2 58.4 13.3 42.6 22 42.6c1.4.0 2.8.2 4.1.6L21 58.1c-.2.5.1 1.1.6 1.3.1.0.2.1.3.1.4.0.8-.3.9-.7l5.1-14.9c5.9 2.2 9.9 7.9 9.9 14.5zm29.7-11.8L76 57.4H62.2c.3-4.3 2.2-8.1 5.3-10.8zm-16.7 9.6-17.1-22h24l.4.5zm1.8 1.2 7.1-20.8 6.6 8.4c-3.5 3.1-5.7 7.4-6 12.4zM78 74.2c-8.4.0-15.2-6.6-15.8-14.8H78c.4.0.7-.2.9-.6.2-.3.1-.8-.1-1.1L69 45.4c2.5-1.8 5.6-2.8 8.9-2.8 8.7.0 15.8 7.1 15.8 15.8s-7 15.8-15.7 15.8z"/></g></svg></a>
<a class="plausible-event-name=burger+about" aria-label=About href=/about><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="feather feather-user" id="about-icon"><path d="M20 21v-2a4 4 0 00-4-4H8a4 4 0 00-4 4v2"/><circle cx="12" cy="7" r="4"/></svg>
</a><a class="plausible-event-name=burger+rss" aria-label=RSS href=/index.xml><svg width="24" height="24" viewBox="0 0 30 24" fill="none" stroke="#444" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="feather feather-rss" id="rss-icon"><path d="M4 11a9 9 0 019 9"/><path d="M4 4a16 16 0 0116 16"/><circle cx="5" cy="19" r="1"/></svg></a></div></div></nav></div><div class="wrapper post"><div class=post-header><h1 class=title>Calculate the Distance Between Two GPS Points with Python (Vincenty’s Inverse Formula)</h1></div><p class=TLDR><strong>TL;DR</strong> - Vincenty's inverse formula provides an accurate method for calcualting the distance between two latitude/longitude pairs. Learn how to implement your own with Python.</p><hr><div class=markdown><p>Recently the work I have been doing requires a higher degree of accuracy than which the <a target=_blank href=http://localhost:4000/posts/2016-09-07/haversine-with-python/>haversine method</a> I was using could provide. This prompted me to implement a Python version of the <a target=_blank href="https://en.wikipedia.org/wiki/Vincenty's_formulae">Vincenty&rsquo;s inverse formula</a>. Unlike the <a target=_blank href=https://en.wikipedia.org/wiki/Haversine_formula>Haversine</a> method (which I posted about previously) of directly calculating the <a target=_blank href=https://en.wikipedia.org/wiki/Great-circle_distance>great-circle distance</a> between two points on a perfectly spherical Earth, Vincenty&rsquo;s formulae is an iterative method which more realistically assumes Earth as an <a target=_blank href=https://en.wikipedia.org/wiki/Spheroid>oblate spheroid</a>.</p><p>Before proceeding further, several values need to be defined:</p><table style=width:100%><col width=40%><col width=60%><thead><tr><th><strong>Variable</strong></th><th><strong>Definition</strong></th></tr></thead><tbody><tr><td><p><span class=katex><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>a</mi><mo>=</mo><mn>6378137.0</mn></mrow><annotation encoding="application/x-tex"> a = 6378137.0 </annotation></semantics></math></span></p></td><td>length of semi-major axis of the ellipsoid aka radius of the equator in meters (<a target=_blank href=https://en.wikipedia.org/wiki/World_Geodetic_System>WGS-84</a>)</td></tr><tr><td><p><span class=katex><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>f</mi><mo>=</mo><mn>1</mn><mi mathvariant="normal">/</mi><mn>298.257223563</mn></mrow><annotation encoding="application/x-tex"> f = 1 / 298.257223563 </annotation></semantics></math></span></td><td><a target=_blank href=https://en.wikipedia.org/wiki/Flattening>flattening</a> of the ellipsoid (<a target=_blank href=https://en.wikipedia.org/wiki/World_Geodetic_System>WGS-84</a>)</td></tr><tr><td></p><p><span class=katex><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>b</mi><mo>=</mo><mrow><mo fence="true">(</mo><mn>1</mn><mo>−</mo><mi>f</mi><mo fence="true">)</mo></mrow><mi>a</mi></mrow><annotation encoding="application/x-tex"> b = \left ( 1 - f \right ) a </annotation></semantics></math></span></td><td>length of semi-minor axis of the ellipsoid (radius at the poles, 6356752.314245 meters in <a target=_blank href=https://en.wikipedia.org/wiki/World_Geodetic_System>WGS-84</a>)</td></tr><tr><td><span class=katex><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>ϕ</mi><mn>1</mn></msub><mo separator="true">,</mo><msub><mi>ϕ</mi><mn>2</mn></msub></mrow><annotation encoding="application/x-tex"> \phi_1, \phi_2 </annotation></semantics></math></span></td><td>latitude of the points</td></tr><tr><td><span class=katex><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>U</mi><mn>1</mn></msub><mo>=</mo><mi>arctan</mi><mo>⁡</mo><mrow><mo fence="true">[</mo><mrow><mo fence="true">(</mo><mn>1</mn><mo>−</mo><mi>f</mi><mo fence="true">)</mo></mrow><mi>tan</mi><mo>⁡</mo><msub><mi>ϕ</mi><mn>1</mn></msub><mo fence="true">]</mo></mrow></mrow><annotation encoding="application/x-tex"> U_1 = \arctan \left [ \left ( 1 - f \right ) \tan \phi_1 \right ] </annotation></semantics></math></span></td><td>reduced latitude (latitude on the auxiliary sphere)</td></tr><tr><td><span class=katex><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>U</mi><mn>2</mn></msub><mo>=</mo><mi>arctan</mi><mo>⁡</mo><mrow><mo fence="true">[</mo><mrow><mo fence="true">(</mo><mn>1</mn><mo>−</mo><mi>f</mi><mo fence="true">)</mo></mrow><mi>tan</mi><mo>⁡</mo><msub><mi>ϕ</mi><mn>2</mn></msub><mo fence="true">]</mo></mrow></mrow><annotation encoding="application/x-tex"> U_2 = \arctan \left [ \left ( 1 - f \right ) \tan \phi_2 \right ] </annotation></semantics></math></span></td><td>reduced latitude (latitude on the auxiliary sphere)</td></tr><tr><td><span class=katex><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>L</mi><mo>=</mo><msub><mi>L</mi><mn>2</mn></msub><mo>−</mo><msub><mi>L</mi><mn>1</mn></msub></mrow><annotation encoding="application/x-tex"> L = L_2 - L_1 </annotation></semantics></math></span></td><td>difference in longitude of two points</td></tr><tr><td><span class=katex><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>λ</mi><mn>1</mn></msub><mo separator="true">,</mo><msub><mi>λ</mi><mn>2</mn></msub></mrow><annotation encoding="application/x-tex"> \lambda_1, \lambda_2 </annotation></semantics></math></span></td><td>longitude of the points on the auxiliary sphere</td></tr><tr><td><span class=katex><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>α</mi><mn>1</mn></msub><mo separator="true">,</mo><msub><mi>α</mi><mn>2</mn></msub></mrow><annotation encoding="application/x-tex"> \alpha_1, \alpha_2 </annotation></semantics></math></span></td><td>forward azimuths at the points</td></tr><tr><td><span class=katex><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>α</mi></mrow><annotation encoding="application/x-tex"> \alpha </annotation></semantics></math></span></td><td>azimuth at the equator</td></tr><tr><td><span class=katex><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>s</mi></mrow><annotation encoding="application/x-tex"> s </annotation></semantics></math></span></td><td>ellipsoidal distance between the two points</td></tr><tr><td><span class=katex><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>σ</mi></mrow><annotation encoding="application/x-tex"> \sigma </annotation></semantics></math></span></td><td>arc length between points on the auxiliary sphere</td></tr></p></tbody></table><p>Using the values defined above, and the eight equations below, the process of iterating towards a solution can begin. Starting with the first equation on top, sequentially progress towards the last equation at the bottom where the output is <math><mi>λ</mi></math>. Once through the first iteration, simply use this newly calculated value of <math><mi>λ</mi></math> and dump it back into the first equation and repeat the process. The end game here is to minimize the value of <math><mi>λ</mi></math>.</p><div class=math-block><span class=katex><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mi>sin</mi><mo>⁡</mo><mi>σ</mi><mo>=</mo><msqrt><mrow><mo stretchy="false">(</mo><mi>cos</mi><mo>⁡</mo><msub><mi>U</mi><mn>2</mn></msub><mi>sin</mi><mo>⁡</mo><mi>λ</mi><msup><mo stretchy="false">)</mo><mn>2</mn></msup><mo>+</mo><mo stretchy="false">(</mo><mi>cos</mi><mo>⁡</mo><msub><mi>U</mi><mn>1</mn></msub><mi>sin</mi><mo>⁡</mo><msub><mi>U</mi><mn>2</mn></msub><mo>−</mo><mi>sin</mi><mo>⁡</mo><msub><mi>U</mi><mn>1</mn></msub><mi>cos</mi><mo>⁡</mo><msub><mi>U</mi><mn>2</mn></msub><mi>cos</mi><mo>⁡</mo><mi>λ</mi><msup><mo stretchy="false">)</mo><mn>2</mn></msup></mrow></msqrt></mrow><annotation encoding="application/x-tex"> \sin \sigma = \sqrt{(\cos U_2 \sin\lambda)^2 + (\cos U_1 \sin U_2 - \sin U_1 \cos U_2 \cos\lambda)^2}</annotation></semantics></math></span></div><div class=math-block><span class=katex><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mi>cos</mi><mo>⁡</mo><mi>σ</mi><mo>=</mo><mi>sin</mi><mo>⁡</mo><msub><mi>U</mi><mn>1</mn></msub><mi>sin</mi><mo>⁡</mo><msub><mi>U</mi><mn>2</mn></msub><mo>+</mo><mi>cos</mi><mo>⁡</mo><msub><mi>U</mi><mn>1</mn></msub><mi>cos</mi><mo>⁡</mo><msub><mi>U</mi><mn>2</mn></msub><mi>cos</mi><mo>⁡</mo><mi>λ</mi></mrow><annotation encoding="application/x-tex"> \cos \sigma = \sin U_1 \sin U_2 + \cos U_1 \cos U_2 \cos \lambda </annotation></semantics></math></span></div><div class=math-block><span class=katex><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mi>σ</mi><mo>=</mo><mi>arctan</mi><mo>⁡</mo><mfrac><mrow><mi>sin</mi><mo>⁡</mo><mi>σ</mi></mrow><mrow><mi>cos</mi><mo>⁡</mo><mi>σ</mi></mrow></mfrac></mrow><annotation encoding="application/x-tex"> \sigma = \arctan \frac{\sin \sigma}{\cos \sigma} </annotation></semantics></math></span></div><div class=math-block><span class=katex><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mi>sin</mi><mo>⁡</mo><mi>α</mi><mo>=</mo><mfrac><mrow><mi>cos</mi><mo>⁡</mo><msub><mi>U</mi><mn>1</mn></msub><mi>cos</mi><mo>⁡</mo><msub><mi>U</mi><mn>2</mn></msub><mi>sin</mi><mo>⁡</mo><mi>λ</mi></mrow><mrow><mi>sin</mi><mo>⁡</mo><mi>σ</mi></mrow></mfrac></mrow><annotation encoding="application/x-tex"> \sin \alpha = \frac{ \cos U_1 \cos U_2 \sin \lambda }{ \sin \sigma }</annotation></semantics></math></span></div><div class=math-block><span class=katex><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><msup><mrow><mi>cos</mi><mo>⁡</mo></mrow><mn>2</mn></msup><mi>α</mi><mo>=</mo><mn>1</mn><mo>−</mo><msup><mrow><mi>sin</mi><mo>⁡</mo></mrow><mn>2</mn></msup><mi>α</mi></mrow><annotation encoding="application/x-tex"> \cos^2 \alpha = 1 - \sin^2 \alpha </annotation></semantics></math></span></div><div class=math-block><span class=katex><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mi>cos</mi><mo>⁡</mo><mrow><mo fence="true">(</mo><mn>2</mn><msub><mi>σ</mi><mi>m</mi></msub><mo fence="true">)</mo></mrow><mo>=</mo><mi>cos</mi><mo>⁡</mo><mi>σ</mi><mo>−</mo><mfrac><mrow><mn>2</mn><mi>sin</mi><mo>⁡</mo><msub><mi>U</mi><mn>1</mn></msub><mi>s</mi><mi>i</mi><mi>n</mi><msub><mi>U</mi><mn>2</mn></msub></mrow><mrow><msup><mrow><mi>cos</mi><mo>⁡</mo></mrow><mn>2</mn></msup><mi>α</mi></mrow></mfrac></mrow><annotation encoding="application/x-tex"> \cos \left( 2 \sigma_m \right) = \cos \sigma - \frac{2 \sin U_1 sin U_2 }{ \cos^2 \alpha }</annotation></semantics></math></span></div><div class=math-block><span class=katex><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mi>C</mi><mo>=</mo><mfrac><mi>f</mi><mn>16</mn></mfrac><msup><mrow><mi>cos</mi><mo>⁡</mo></mrow><mn>2</mn></msup><mi>α</mi><mrow><mo fence="true">[</mo><mn>4</mn><mo>+</mo><mi>f</mi><mrow><mo fence="true">(</mo><mn>4</mn><mo>−</mo><mn>3</mn><msup><mrow><mi>cos</mi><mo>⁡</mo></mrow><mn>2</mn></msup><mi>α</mi><mo fence="true">)</mo></mrow><mo fence="true">]</mo></mrow></mrow><annotation encoding="application/x-tex"> C = \frac{f}{16} \cos^2 \alpha \left[ 4 + f \left( 4 - 3 \cos^2 \alpha \right) \right]</annotation></semantics></math></span></div><div class=math-block><span class=katex><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mi>λ</mi><mo>=</mo><mi>L</mi><mo>+</mo><mo stretchy="false">(</mo><mn>1</mn><mo>−</mo><mi>C</mi><mo stretchy="false">)</mo><mi>f</mi><mi>sin</mi><mo>⁡</mo><mi>α</mi><mrow><mo fence="true">{</mo><mi>σ</mi><mo>+</mo><mi>C</mi><mi>sin</mi><mo>⁡</mo><mi>σ</mi><mrow><mo fence="true">[</mo><mi>cos</mi><mo>⁡</mo><mrow><mo fence="true">(</mo><mn>2</mn><msub><mi>σ</mi><mi>m</mi></msub><mo fence="true">)</mo></mrow><mo>+</mo><mi>C</mi><mi>cos</mi><mo>⁡</mo><mi>σ</mi><mrow><mo fence="true">(</mo><mo>−</mo><mn>1</mn><mo>+</mo><mn>2</mn><msup><mrow><mi>cos</mi><mo>⁡</mo></mrow><mn>2</mn></msup><mrow><mo fence="true">(</mo><mn>2</mn><msub><mi>σ</mi><mi>m</mi></msub><mo fence="true">)</mo></mrow><mo fence="true">)</mo></mrow><mo fence="true">]</mo></mrow><mo fence="true">}</mo></mrow></mrow><annotation encoding="application/x-tex"> \lambda = L + (1 - C) f \sin \alpha \left \{ \sigma + C \sin \sigma \left [ \cos \left ( 2 \sigma_m  \right) + C \cos \sigma \left ( -1 + 2\cos^2 \left ( 2 \sigma_m \right ) \right ) \right ] \right \} </annotation></semantics></math></span></div><p>When the difference between the current value of <math><mi>λ</mi></math> and the value of <math><mi>λ</mi></math> from the previous iteration is less than the convergence tolerance, we can move on to the final stage (a convergence tolerance of 10e-12 translates to an accuracy of approximately 0.06mm).</p><div class=math-block><span class=katex><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><msup><mi>u</mi><mn>2</mn></msup><mo>=</mo><msup><mrow><mi>cos</mi><mo>⁡</mo></mrow><mn>2</mn></msup><mi>α</mi><mfrac><mrow><msup><mi>a</mi><mn>2</mn></msup><mo>−</mo><msup><mi>b</mi><mn>2</mn></msup></mrow><msup><mi>b</mi><mn>2</mn></msup></mfrac></mrow><annotation encoding="application/x-tex"> u^2 = \cos^2 \alpha \frac{a^2 - b^2}{b^2} </annotation></semantics></math></span></div><div class=math-block><span class=katex><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mi>A</mi><mo>=</mo><mn>1</mn><mo>+</mo><mfrac><msup><mi>u</mi><mn>2</mn></msup><mn>16384</mn></mfrac><mrow><mo fence="true">{</mo><mn>4096</mn><mo>+</mo><msup><mi>u</mi><mn>2</mn></msup><mrow><mo fence="true">[</mo><mo>−</mo><mn>768</mn><mo>+</mo><msup><mi>u</mi><mn>2</mn></msup><mrow><mo fence="true">(</mo><mn>320</mn><mo>−</mo><mn>175</mn><msup><mi>u</mi><mn>2</mn></msup><mo fence="true">)</mo></mrow><mo fence="true">]</mo></mrow><mo fence="true">}</mo></mrow></mrow><annotation encoding="application/x-tex"> A = 1 + \frac{u^2}{16384} \left \{ 4096 + u^2 \left [ -768 + u^2 \left ( 320 - 175 u^2 \right ) \right ] \right \} </annotation></semantics></math></span></div><div class=math-block><span class=katex><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mi>B</mi><mo>=</mo><mfrac><msup><mi>u</mi><mn>2</mn></msup><mn>1024</mn></mfrac><mrow><mo fence="true">{</mo><mn>256</mn><mo>+</mo><msup><mi>u</mi><mn>2</mn></msup><mrow><mo fence="true">[</mo><mo>−</mo><mn>128</mn><mo>+</mo><msup><mi>u</mi><mn>2</mn></msup><mrow><mo fence="true">(</mo><mn>74</mn><mo>−</mo><mn>47</mn><msup><mi>u</mi><mn>2</mn></msup><mo fence="true">)</mo></mrow><mo fence="true">]</mo></mrow><mo fence="true">}</mo></mrow></mrow><annotation encoding="application/x-tex"> B = \frac{u^2}{1024} \left \{ 256 + u^2 \left [ -128 + u^2 \left ( 74 - 47 u^2 \right ) \right ] \right \} </annotation></semantics></math></span></div><div class=math-block><span class=katex><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mi mathvariant="normal">Δ</mi><mi>σ</mi><mo>=</mo><mi>B</mi><mi>sin</mi><mo>⁡</mo><mi>σ</mi><mrow><mo fence="true">{</mo><mi>cos</mi><mo>⁡</mo><mrow><mo fence="true">(</mo><mn>2</mn><msub><mi>σ</mi><mi>m</mi></msub><mo fence="true">)</mo></mrow><mo>+</mo><mfrac><mn>1</mn><mn>4</mn></mfrac><mi>B</mi><mrow><mo fence="true">[</mo><mi>cos</mi><mo>⁡</mo><mi>σ</mi><mrow><mo fence="true">(</mo><mo>−</mo><mn>1</mn><mo>+</mo><mn>2</mn><msup><mrow><mi>cos</mi><mo>⁡</mo></mrow><mn>2</mn></msup><mrow><mo fence="true">(</mo><mn>2</mn><msub><mi>σ</mi><mi>m</mi></msub><mo fence="true">)</mo></mrow><mo fence="true">)</mo></mrow><mo>−</mo><mfrac><mn>1</mn><mn>6</mn></mfrac><mi>B</mi><mi>cos</mi><mo>⁡</mo><mrow><mo fence="true">(</mo><mn>2</mn><msub><mi>σ</mi><mi>m</mi></msub><mo fence="true">)</mo></mrow><mrow><mo fence="true">(</mo><mo>−</mo><mn>3</mn><mo>+</mo><mn>4</mn><msup><mrow><mi>sin</mi><mo>⁡</mo></mrow><mn>2</mn></msup><mi>σ</mi><mo fence="true">)</mo></mrow><mrow><mo fence="true">(</mo><mo>−</mo><mn>3</mn><mo>+</mo><mn>4</mn><msup><mrow><mi>cos</mi><mo>⁡</mo></mrow><mn>2</mn></msup><mrow><mo fence="true">(</mo><mn>2</mn><msub><mi>σ</mi><mi>m</mi></msub><mo fence="true">)</mo></mrow><mo fence="true">)</mo></mrow><mo fence="true">]</mo></mrow><mo fence="true">}</mo></mrow></mrow><annotation encoding="application/x-tex"> \Delta \sigma = B \sin \sigma \left \{ \cos \left ( 2 \sigma_m \right ) + \frac{1}{4} B \left [ \cos \sigma \left ( -1 + 2 \cos^2 \left ( 2 \sigma_m \right ) \right ) - \frac{1}{6} B \cos \left ( 2 \sigma_m \right ) \left ( -3 + 4 \sin^2 \sigma \right ) \left ( -3 + 4 \cos^2 \left ( 2 \sigma_m \right ) \right ) \right ] \right \} </annotation></semantics></math></span></div><div class=math-block><span class=katex><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mi>s</mi><mo>=</mo><mi>b</mi><mi>A</mi><mrow><mo fence="true">(</mo><mi>σ</mi><mo>−</mo><mi mathvariant="normal">Δ</mi><mi>σ</mi><mo fence="true">)</mo></mrow></mrow><annotation encoding="application/x-tex"> s = b A \left ( \sigma - \Delta \sigma \right ) </annotation></semantics></math></span></div><div class=math-block><span class=katex><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><msub><mi>α</mi><mn>1</mn></msub><mo>=</mo><mi>arctan</mi><mo>⁡</mo><mrow><mo fence="true">(</mo><mfrac><mrow><mi>cos</mi><mo>⁡</mo><msub><mi>U</mi><mn>2</mn></msub><mi>sin</mi><mo>⁡</mo><mi>λ</mi></mrow><mrow><mi>cos</mi><mo>⁡</mo><msub><mi>U</mi><mn>1</mn></msub><mi>sin</mi><mo>⁡</mo><msub><mi>U</mi><mn>2</mn></msub><mo>−</mo><mi>sin</mi><mo>⁡</mo><msub><mi>U</mi><mn>1</mn></msub><mi>cos</mi><mo>⁡</mo><msub><mi>U</mi><mn>2</mn></msub><mi>cos</mi><mo>⁡</mo><mi>λ</mi></mrow></mfrac><mo fence="true">)</mo></mrow></mrow><annotation encoding="application/x-tex"> \alpha_1 = \arctan \left ( \frac{ \cos U_2 \sin \lambda }{ \cos U_1 \sin U_2 - \sin U_1 \cos U_2 \cos \lambda } \right ) </annotation></semantics></math></span></div><div class=math-block><span class=katex><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><msub><mi>α</mi><mn>2</mn></msub><mo>=</mo><mi>arctan</mi><mo>⁡</mo><mrow><mo fence="true">(</mo><mfrac><mrow><mi>cos</mi><mo>⁡</mo><msub><mi>U</mi><mn>1</mn></msub><mi>sin</mi><mo>⁡</mo><mi>λ</mi></mrow><mrow><mo>−</mo><mi>sin</mi><mo>⁡</mo><msub><mi>U</mi><mn>1</mn></msub><mi>cos</mi><mo>⁡</mo><msub><mi>U</mi><mn>2</mn></msub><mo>+</mo><mi>cos</mi><mo>⁡</mo><msub><mi>U</mi><mn>1</mn></msub><mi>sin</mi><mo>⁡</mo><msub><mi>U</mi><mn>2</mn></msub><mi>cos</mi><mo>⁡</mo><mi>λ</mi></mrow></mfrac><mo fence="true">)</mo></mrow></mrow><annotation encoding="application/x-tex"> \alpha_2 = \arctan \left ( \frac{ \cos U_1 \sin \lambda }{ - \sin U_1 \cos U_2 + \cos U_1 \sin U_2 \cos \lambda } \right ) </annotation></semantics></math></span></div><p>Below is the Python implementation of the above equations. Note, I included a maximum number of iterations (maxIter=200).</p><div class=highlight><pre tabindex=0 style=background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-py data-lang=py><span style=display:flex><span><span style=color:#09f;font-style:italic>#------------------------------------------------------------------------------+</span>
</span></span><span style=display:flex><span><span style=color:#09f;font-style:italic>#</span>
</span></span><span style=display:flex><span><span style=color:#09f;font-style:italic>#   Nathan A. Rooy</span>
</span></span><span style=display:flex><span><span style=color:#09f;font-style:italic>#   2016-SEP-30</span>
</span></span><span style=display:flex><span><span style=color:#09f;font-style:italic>#   Solve the inverse Vincenty&#39;s formulae</span>
</span></span><span style=display:flex><span><span style=color:#09f;font-style:italic>#   https://en.wikipedia.org/wiki/Vincenty%27s_formulae</span>
</span></span><span style=display:flex><span><span style=color:#09f;font-style:italic>#</span>
</span></span><span style=display:flex><span><span style=color:#09f;font-style:italic>#------------------------------------------------------------------------------+</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#09f;font-style:italic>#--- IMPORT DEPENDENCIES ------------------------------------------------------+</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#069;font-weight:700>from</span> <span style=color:#0cf;font-weight:700>__future__</span> <span style=color:#069;font-weight:700>import</span> division
</span></span><span style=display:flex><span><span style=color:#069;font-weight:700>from</span> <span style=color:#0cf;font-weight:700>math</span> <span style=color:#069;font-weight:700>import</span> atan
</span></span><span style=display:flex><span><span style=color:#069;font-weight:700>from</span> <span style=color:#0cf;font-weight:700>math</span> <span style=color:#069;font-weight:700>import</span> atan2
</span></span><span style=display:flex><span><span style=color:#069;font-weight:700>from</span> <span style=color:#0cf;font-weight:700>math</span> <span style=color:#069;font-weight:700>import</span> cos
</span></span><span style=display:flex><span><span style=color:#069;font-weight:700>from</span> <span style=color:#0cf;font-weight:700>math</span> <span style=color:#069;font-weight:700>import</span> radians
</span></span><span style=display:flex><span><span style=color:#069;font-weight:700>from</span> <span style=color:#0cf;font-weight:700>math</span> <span style=color:#069;font-weight:700>import</span> sin
</span></span><span style=display:flex><span><span style=color:#069;font-weight:700>from</span> <span style=color:#0cf;font-weight:700>math</span> <span style=color:#069;font-weight:700>import</span> sqrt
</span></span><span style=display:flex><span><span style=color:#069;font-weight:700>from</span> <span style=color:#0cf;font-weight:700>math</span> <span style=color:#069;font-weight:700>import</span> tan
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#09f;font-style:italic>#--- MAIN ---------------------------------------------------------------------+</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#069;font-weight:700>class</span> <span style=color:#0a8;font-weight:700>vincenty_inverse</span>:
</span></span><span style=display:flex><span>    <span style=color:#069;font-weight:700>def</span> __init__(self,coord1,coord2,maxIter<span style=color:#555>=</span><span style=color:#f60>200</span>,tol<span style=color:#555>=</span><span style=color:#f60>10</span><span style=color:#555>**-</span><span style=color:#f60>12</span>):
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#09f;font-style:italic>#--- CONSTANTS ------------------------------------+</span>
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>        a<span style=color:#555>=</span><span style=color:#f60>6378137.0</span>                             <span style=color:#09f;font-style:italic># radius at equator in meters (WGS-84)</span>
</span></span><span style=display:flex><span>        f<span style=color:#555>=</span><span style=color:#f60>1</span><span style=color:#555>/</span><span style=color:#f60>298.257223563</span>                       <span style=color:#09f;font-style:italic># flattening of the ellipsoid (WGS-84)</span>
</span></span><span style=display:flex><span>        b<span style=color:#555>=</span>(<span style=color:#f60>1</span><span style=color:#555>-</span>f)<span style=color:#555>*</span>a
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        phi_1,L_1,<span style=color:#555>=</span>coord1                       <span style=color:#09f;font-style:italic># (lat=L_?,lon=phi_?)</span>
</span></span><span style=display:flex><span>        phi_2,L_2,<span style=color:#555>=</span>coord2                  
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        u_1<span style=color:#555>=</span>atan((<span style=color:#f60>1</span><span style=color:#555>-</span>f)<span style=color:#555>*</span>tan(radians(phi_1)))
</span></span><span style=display:flex><span>        u_2<span style=color:#555>=</span>atan((<span style=color:#f60>1</span><span style=color:#555>-</span>f)<span style=color:#555>*</span>tan(radians(phi_2)))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        L<span style=color:#555>=</span>radians(L_2<span style=color:#555>-</span>L_1)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        Lambda<span style=color:#555>=</span>L                                <span style=color:#09f;font-style:italic># set initial value of lambda to L</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        sin_u1<span style=color:#555>=</span>sin(u_1)
</span></span><span style=display:flex><span>        cos_u1<span style=color:#555>=</span>cos(u_1)
</span></span><span style=display:flex><span>        sin_u2<span style=color:#555>=</span>sin(u_2)
</span></span><span style=display:flex><span>        cos_u2<span style=color:#555>=</span>cos(u_2)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#09f;font-style:italic>#--- BEGIN ITERATIONS -----------------------------+</span>
</span></span><span style=display:flex><span>        self<span style=color:#555>.</span>iters<span style=color:#555>=</span><span style=color:#f60>0</span>
</span></span><span style=display:flex><span>        <span style=color:#069;font-weight:700>for</span> i <span style=color:#000;font-weight:700>in</span> <span style=color:#366>range</span>(<span style=color:#f60>0</span>,maxIter):
</span></span><span style=display:flex><span>            self<span style=color:#555>.</span>iters<span style=color:#555>+=</span><span style=color:#f60>1</span>
</span></span><span style=display:flex><span>            
</span></span><span style=display:flex><span>            cos_lambda<span style=color:#555>=</span>cos(Lambda)
</span></span><span style=display:flex><span>            sin_lambda<span style=color:#555>=</span>sin(Lambda)
</span></span><span style=display:flex><span>            sin_sigma<span style=color:#555>=</span>sqrt((cos_u2<span style=color:#555>*</span>sin(Lambda))<span style=color:#555>**</span><span style=color:#f60>2</span><span style=color:#555>+</span>(cos_u1<span style=color:#555>*</span>sin_u2<span style=color:#555>-</span>sin_u1<span style=color:#555>*</span>cos_u2<span style=color:#555>*</span>cos_lambda)<span style=color:#555>**</span><span style=color:#f60>2</span>)
</span></span><span style=display:flex><span>            cos_sigma<span style=color:#555>=</span>sin_u1<span style=color:#555>*</span>sin_u2<span style=color:#555>+</span>cos_u1<span style=color:#555>*</span>cos_u2<span style=color:#555>*</span>cos_lambda
</span></span><span style=display:flex><span>            sigma<span style=color:#555>=</span>atan2(sin_sigma,cos_sigma)
</span></span><span style=display:flex><span>            sin_alpha<span style=color:#555>=</span>(cos_u1<span style=color:#555>*</span>cos_u2<span style=color:#555>*</span>sin_lambda)<span style=color:#555>/</span>sin_sigma
</span></span><span style=display:flex><span>            cos_sq_alpha<span style=color:#555>=</span><span style=color:#f60>1</span><span style=color:#555>-</span>sin_alpha<span style=color:#555>**</span><span style=color:#f60>2</span>
</span></span><span style=display:flex><span>            cos2_sigma_m<span style=color:#555>=</span>cos_sigma<span style=color:#555>-</span>((<span style=color:#f60>2</span><span style=color:#555>*</span>sin_u1<span style=color:#555>*</span>sin_u2)<span style=color:#555>/</span>cos_sq_alpha)
</span></span><span style=display:flex><span>            C<span style=color:#555>=</span>(f<span style=color:#555>/</span><span style=color:#f60>16</span>)<span style=color:#555>*</span>cos_sq_alpha<span style=color:#555>*</span>(<span style=color:#f60>4</span><span style=color:#555>+</span>f<span style=color:#555>*</span>(<span style=color:#f60>4</span><span style=color:#555>-</span><span style=color:#f60>3</span><span style=color:#555>*</span>cos_sq_alpha))
</span></span><span style=display:flex><span>            Lambda_prev<span style=color:#555>=</span>Lambda
</span></span><span style=display:flex><span>            Lambda<span style=color:#555>=</span>L<span style=color:#555>+</span>(<span style=color:#f60>1</span><span style=color:#555>-</span>C)<span style=color:#555>*</span>f<span style=color:#555>*</span>sin_alpha<span style=color:#555>*</span>(sigma<span style=color:#555>+</span>C<span style=color:#555>*</span>sin_sigma<span style=color:#555>*</span>(cos2_sigma_m<span style=color:#555>+</span>C<span style=color:#555>*</span>cos_sigma<span style=color:#555>*</span>(<span style=color:#555>-</span><span style=color:#f60>1</span><span style=color:#555>+</span><span style=color:#f60>2</span><span style=color:#555>*</span>cos2_sigma_m<span style=color:#555>**</span><span style=color:#f60>2</span>)))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>            <span style=color:#09f;font-style:italic># successful convergence</span>
</span></span><span style=display:flex><span>            diff<span style=color:#555>=</span><span style=color:#366>abs</span>(Lambda_prev<span style=color:#555>-</span>Lambda)
</span></span><span style=display:flex><span>            <span style=color:#069;font-weight:700>if</span> diff<span style=color:#555>&lt;=</span>tol:
</span></span><span style=display:flex><span>                <span style=color:#069;font-weight:700>break</span>
</span></span><span style=display:flex><span>            
</span></span><span style=display:flex><span>        u_sq<span style=color:#555>=</span>cos_sq_alpha<span style=color:#555>*</span>((a<span style=color:#555>**</span><span style=color:#f60>2</span><span style=color:#555>-</span>b<span style=color:#555>**</span><span style=color:#f60>2</span>)<span style=color:#555>/</span>b<span style=color:#555>**</span><span style=color:#f60>2</span>)
</span></span><span style=display:flex><span>        A<span style=color:#555>=</span><span style=color:#f60>1</span><span style=color:#555>+</span>(u_sq<span style=color:#555>/</span><span style=color:#f60>16384</span>)<span style=color:#555>*</span>(<span style=color:#f60>4096</span><span style=color:#555>+</span>u_sq<span style=color:#555>*</span>(<span style=color:#555>-</span><span style=color:#f60>768</span><span style=color:#555>+</span>u_sq<span style=color:#555>*</span>(<span style=color:#f60>320</span><span style=color:#555>-</span><span style=color:#f60>175</span><span style=color:#555>*</span>u_sq)))
</span></span><span style=display:flex><span>        B<span style=color:#555>=</span>(u_sq<span style=color:#555>/</span><span style=color:#f60>1024</span>)<span style=color:#555>*</span>(<span style=color:#f60>256</span><span style=color:#555>+</span>u_sq<span style=color:#555>*</span>(<span style=color:#555>-</span><span style=color:#f60>128</span><span style=color:#555>+</span>u_sq<span style=color:#555>*</span>(<span style=color:#f60>74</span><span style=color:#555>-</span><span style=color:#f60>47</span><span style=color:#555>*</span>u_sq)))
</span></span><span style=display:flex><span>        delta_sig<span style=color:#555>=</span>B<span style=color:#555>*</span>sin_sigma<span style=color:#555>*</span>(cos2_sigma_m<span style=color:#555>+</span><span style=color:#f60>0.25</span><span style=color:#555>*</span>B<span style=color:#555>*</span>(cos_sigma<span style=color:#555>*</span>(<span style=color:#555>-</span><span style=color:#f60>1</span><span style=color:#555>+</span><span style=color:#f60>2</span><span style=color:#555>*</span>cos2_sigma_m<span style=color:#555>**</span><span style=color:#f60>2</span>)<span style=color:#555>-</span>(<span style=color:#f60>1</span><span style=color:#555>/</span><span style=color:#f60>6</span>)<span style=color:#555>*</span>B<span style=color:#555>*</span>cos2_sigma_m<span style=color:#555>*</span>(<span style=color:#555>-</span><span style=color:#f60>3</span><span style=color:#555>+</span><span style=color:#f60>4</span><span style=color:#555>*</span>sin_sigma<span style=color:#555>**</span><span style=color:#f60>2</span>)<span style=color:#555>*</span>(<span style=color:#555>-</span><span style=color:#f60>3</span><span style=color:#555>+</span><span style=color:#f60>4</span><span style=color:#555>*</span>cos2_sigma_m<span style=color:#555>**</span><span style=color:#f60>2</span>)))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        self<span style=color:#555>.</span>m<span style=color:#555>=</span>b<span style=color:#555>*</span>A<span style=color:#555>*</span>(sigma<span style=color:#555>-</span>delta_sig)                 <span style=color:#09f;font-style:italic># output distance in meters     </span>
</span></span><span style=display:flex><span>        <span style=color:#09f;font-style:italic>#self.km=self.meters/1000                    # output distance in kilometers</span>
</span></span><span style=display:flex><span>        <span style=color:#09f;font-style:italic>#self.mm=self.meters*1000                    # output distance in millimeters</span>
</span></span><span style=display:flex><span>        <span style=color:#09f;font-style:italic>#self.miles=self.meters*0.000621371          # output distance in miles</span>
</span></span><span style=display:flex><span>        <span style=color:#09f;font-style:italic>#self.n_miles=self.miles*(6080.20/5280)      # output distance in nautical miles</span>
</span></span><span style=display:flex><span>        <span style=color:#09f;font-style:italic>#self.ft=self.miles*5280                     # output distance in feet</span>
</span></span><span style=display:flex><span>        <span style=color:#09f;font-style:italic>#self.inches=self.feet*12                    # output distance in inches</span>
</span></span><span style=display:flex><span>        <span style=color:#09f;font-style:italic>#self.yards=self.feet/3                      # output distance in yards</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#069;font-weight:700>if</span> __name__ <span style=color:#555>==</span> <span style=color:#c30>&#34;__vincenty_inverse__&#34;</span>:
</span></span><span style=display:flex><span>    main()
</span></span></code></pre></div><p>Example usage:</p><div class=highlight><pre tabindex=0 style=background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-py data-lang=py><span style=display:flex><span><span style=color:#555>&gt;&gt;&gt;</span> <span style=color:#069;font-weight:700>from</span> <span style=color:#0cf;font-weight:700>vincenty</span> <span style=color:#069;font-weight:700>import</span> vincenty_inverse
</span></span><span style=display:flex><span><span style=color:#555>&gt;&gt;&gt;</span> vincenty_inverse([<span style=color:#f60>39.152501</span>,<span style=color:#555>-</span><span style=color:#f60>84.412977</span>],[<span style=color:#f60>39.152505</span>,<span style=color:#555>-</span><span style=color:#f60>84.412946</span>])<span style=color:#555>.</span>m
</span></span><span style=display:flex><span><span style=color:#f60>2.7161912585815897</span>
</span></span></code></pre></div><p>And that&rsquo;s it! Not too difficult right? The final code can be found on my GitHub (<a target=_blank href=https://github.com/nathanrooy/spatial-analysis/blob/master/vincenty-2016-09-22.py>here</a>).</p></div></div></body></html>