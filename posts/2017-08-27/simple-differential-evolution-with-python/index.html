<!doctype html><html lang=en><head><meta charset=utf-8><title>Nathan Rooy</title>
<meta content="Nathan Rooy" name=author><meta content="en" name=language><meta content="width=device-width,minimum-scale=1" name=viewport><meta content="nathan.fun" property="og:site_name"><meta content="nathan.fun" property="twitter:domain"><meta content="article" property="og:type"><meta content="https://nathan.fun/posts/2017-08-27/simple-differential-evolution-with-python/" property="og:url"><meta content="https://nathan.fun/posts/2017-08-27/simple-differential-evolution-with-python/" name=twitter:url><meta content="Nathan A. Rooy" name=copyright><meta content="summary_large_image" name=twitter:card><meta content="evolutionary optimization,python" name=keywords><meta content="Differential Evolution Optimization from Scratch with Python" name=twitter:title><meta content="Differential Evolution Optimization from Scratch with Python" property="og:title"><meta content="Learn the fundimentals of differential evolution and implement it in Python." name=description><meta content="Learn the fundimentals of differential evolution and implement it in Python." name=twitter:description><meta content="Learn the fundimentals of differential evolution and implement it in Python." property="og:description"><meta content="https://nathan.fun/posts/2017-08-27/simple-differential-evolution-with-python/about/about.jpg" name=twitter:image><meta content="https://nathan.fun/posts/2017-08-27/simple-differential-evolution-with-python/about/about.jpg" property="og:image"><meta content="https://nathan.fun/posts/2017-08-27/simple-differential-evolution-with-python/about/about.jpg" name=thumbnail><link href=https://nathan.fun/index.xml rel=alternate type=application/rss+xml title="Nathan Rooy"><link href=/favicon/favicon.png rel=icon type=image/png><link href=/fonts/figtree-v1-latin-regular.woff2 rel=preload as=font type=font/woff2 crossorigin><link href=https://nathan.fun/posts/2017-08-27/simple-differential-evolution-with-python/ rel=canonical><link rel=blogroll type=text/xml href=https://raw.githubusercontent.com/nathanrooy/feedly-opml-archiver/refs/heads/main/feedly.opml><script defer data-domain=nathan.fun src=https://plausible.io/js/script.tagged-events.js></script><style>:root{--main-text-color:#222;--main-text-weight:400;--text-bold:600;--font-family:"Figtree", sans-serif;--background-light:#F5F5F5;--link-text-color:#0955b5;--dark-text-color:#999}html{font-size:16px}body{-webkit-font-smoothing:antialiased;font-family:var(--font-family);color:var(--main-text-color);font-weight:var(--main-text-weight)}.wrapper{max-width:660px;margin:6rem auto 0;padding:1rem}a{text-decoration:none;color:var(--link-text-color)}a:hover{text-decoration:underline}a:visited{color:var(--link-text-color)}::selection{background:#fff9c4;text-shadow:none}img{margin:1.5em auto;max-width:100%;display:block}a img{border:none}@font-face{font-family:Figtree;font-style:normal;font-weight:400;font-display:swap;src:url(/fonts/figtree-v1-latin-regular.eot);src:local(''),url(/fonts/figtree-v1-latin-regular.eot?#iefix)format('embedded-opentype'),url(/fonts/figtree-v1-latin-regular.woff2)format('woff2'),url(/fonts/figtree-v1-latin-regular.woff)format('woff'),url(/fonts/figtree-v1-latin-regular.ttf)format('truetype'),url(/fonts/figtree-v1-latin-regular.svg#Figtree)format('svg')}@font-face{font-family:Figtree;font-style:normal;font-weight:600;font-display:swap;src:url(/fonts/figtree-v1-latin-600.eot);src:local(''),url(/fonts/figtree-v1-latin-600.eot?#iefix)format('embedded-opentype'),url(/fonts/figtree-v1-latin-600.woff2)format('woff2'),url(/fonts/figtree-v1-latin-600.woff)format('woff'),url(/fonts/figtree-v1-latin-600.ttf)format('truetype'),url(/fonts/figtree-v1-latin-600.svg#Figtree)format('svg')}.home-page ul a{color:var(--main-text-color)}.home-page .post-ul{list-style-type:none;padding-left:0;line-height:1.6em;margin-top:0}.home-page .post-li{overflow:hidden;margin-bottom:.3rem}.home-page .post-li-title{font-size:1.2rem;width:95%;text-overflow:ellipsis;white-space:nowrap;overflow:hidden;float:left}.home-page .post-li-date{padding-bottom:1em;color:var(--dark-text-color)}@media only screen and (max-width:750px){.wrapper{margin-top:2.5rem;margin-left:0}.home-page .post-ul{line-height:1.5em;margin-top:.2rem;padding-left:0}}.math-block{margin-top:2rem;margin-bottom:2rem}mtext{position:absolute;right:0}.inline-svg-equation{text-align:center;margin:1.5em auto;max-width:100%;display:block}ul.flat{margin:0;padding:0}ul.flat li{display:inline-block;list-style:none;margin-left:0}.post-header h1{font-weight:var(--main-text-weight);font-size:2.3rem;color:var(--main-text-color);line-height:2.64rem}.post ul li{margin-bottom:10px}.post ul li p{display:inline}.post .post-header{margin-bottom:2.5rem}.post .post-header .title{margin:0}.post hr{margin:4rem 0;height:1px;border:none;color:var(--main-text-color);background-color:var(--main-text-color)}.highlighter-rouge{position:relative;font-size:.75rem;color:var(--main-text-color);border:1px solid;border-color:#e6e6e6;border-radius:3px;background-color:var(--background-light);padding:.1rem .2rem}.figcaption{font-size:.8rem;padding-bottom:1rem}.markdown{padding-bottom:8rem}.markdown ol li{padding-bottom:.75em}.markdown p{font-size:1rem;margin:0 0 1rem;line-height:1.7rem;letter-spacing:.01rem;word-spacing:.025rem}.markdown blockquote{background-color:var(--background-light);border-left:10px solid;border-color:#2dad60;padding:1.5rem;margin:0 0 1rem;line-height:1.5rem;font-size:15px}h2{font-size:1.2rem;font-weight:var(--text-bold);margin-bottom:.3em}*+h2{padding-top:2rem}.markdown .ul-style-b li{margin-bottom:.5rem;font-size:16px}.TLDR{font-size:1.1rem;line-height:1.7rem;letter-spacing:.02rem}table{width:100%;font-size:14px;letter-spacing:-.01em;border-collapse:collapse;margin-bottom:2em;margin-top:2em;line-height:1.2rem}table th{text-align:left}table thead{border-bottom:1px solid var(--main-text-color);line-height:1.4em}figure{margin:0;text-align:center}ul{padding-left:15px;list-style:disc inside}.highlight pre{padding:20px;background-color:transparent!important;overflow:auto;word-wrap:normal;white-space:pre}.highlight{background:0 0;background-color:var(--background-light)}@media only screen and (min-width:751px){#burger{padding-left:2rem;padding-top:2rem}}@media only screen and (max-width:750px){#burger{padding-left:1rem;padding-top:1rem}}#burger{font-family:var(--font-family);font-weight:400;color:#a9a9a9;font-size:1.5rem}#burger a{display:inline-block;padding-right:.8rem}#burger label{cursor:pointer}#burger label:hover{color:var(--main-text-color)}#nav-icons{padding-left:.8rem}#nav-icons svg{max-height:20px;margin-bottom:-.05rem;color:var(--main-text-color)}#l1-val{position:relative;top:-.12rem}#l2-val{position:relative;top:-.2rem;padding-left:.1rem;padding-right:.1rem}#burger-cbox{display:none}#label-1{display:inline-block}#label-2{display:none}#burger-cbox:not(:checked)~#nav-icons{display:none}#burger-cbox:checked~#nav-icons{display:inline-block}#burger-cbox:checked~#label-1{display:none}#burger-cbox:checked~#label-2{display:inline-block;color:var(--main-text-color)}</style></head><body><div class=header><nav><div id=burger><input type=checkbox id=burger-cbox>
<label id=label-1 for=burger-cbox><span>[</span><span id=l1-val>+</span><span>]</span>
</label><label id=label-2 for=burger-cbox><span>[</span><span id=l2-val>x</span><span>]</span></label><div id=nav-icons><a class="plausible-event-name=burger+home" aria-label=Home style=padding-right:.7rem href=/><svg id="home-icon" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="feather feather-home"><path d="M3 9l9-7 9 7v11a2 2 0 01-2 2H5a2 2 0 01-2-2z"/><polyline points="9 22 9 12 15 12 15 22"/></svg></a>
<a class="plausible-event-name=burger+reading" aria-label=Reading href=/reading><svg width="24" height="24" viewBox="0 0 23.809855 18.892912" id="svg5"><defs id="defs2"/><g id="layer1" transform="translate(-6.352941,-30.26865)"><g id="g39" transform="matrix(0.26458333,0,0,0.26458333,5.0300244,26.48677)"><path class="st0" d="m92.22 22.9v59C74.24 76.35 61.26 78.85 54.73 81.04 59.2 76.64 68.54 70.55 84.16 74.14l1.69.39V21.42c2.17.29 4.3.77 6.37 1.48z" id="path11"/><path class="st0" d="M45.24 81.04C38.73 78.85 25.74 76.35 7.77 81.9v-59c2.06-.71 4.2-1.19 6.37-1.48v53.11l1.68-.39c15.61-3.58 24.96 2.5 29.42 6.9z" id="path13"/><polygon points="48.86,85.63 48.82,85.58 48.91,85.63" id="polygon15"/><polygon points="51.17,85.58 51.13,85.63 50,85.63 51.09,85.62" id="polygon17"/><path d="m94.09 20.63c-2.68-1-5.45-1.65-8.24-2.02v-2.94l-1.08-.24c-17.8-4.09-28.32 3.81-32.9 8.68-.81.87-1.44 1.63-1.88 2.22C49.54 25.74 48.91 24.98 48.1 24.11c-4.58-4.87-15.11-12.76-32.9-8.68l-1.07.24v2.94c-2.8.38-5.57 1.02-8.24 2.02L5 20.97V85.7l1.81-.61c13.49-4.49 24.13-4.16 30.68-3.08 7.09 1.15 11.05 3.4 11.09 3.42l.23.14.09.06H50l1.09-.01.08-.05.23-.14c.05-.02 4-2.27 11.09-3.42 6.55-1.08 17.19-1.41 30.68 3.08l1.82.61V20.97zM7.78 81.89v-59c2.06-.71 4.2-1.19 6.37-1.48v53.11l1.68-.39c15.61-3.58 24.95 2.5 29.42 6.9-6.52-2.18-19.5-4.68-37.47.86zm40.76-1.3c-4.19-4.66-14.29-12.83-31.63-9.5v-53.2c11.11-2.28 18.93.38 24.02 3.66 2.6 1.68 4.48 3.52 5.71 4.95 1.14 1.32 1.73 2.28 1.82 2.43l.08.15zm2.76.17V29.34l.24-.4c.09-.16.68-1.12 1.82-2.44 1.23-1.43 3.11-3.27 5.71-4.94 5.08-3.29 12.91-5.95 24.02-3.67v53.2C65.54 67.72 55.4 76.13 51.3 80.76zm40.92 1.13C74.24 76.34 61.26 78.84 54.73 81.03 59.2 76.63 68.54 70.54 84.16 74.13l1.69.39v-53.1c2.16.29 4.3.77 6.37 1.48z" id="path19"/></g></g><style id="style9">.st0{fill:none}</style></svg>
</a><a class="plausible-event-name=burger+nycbike" aria-label="NYC Bike Exploring" style=margin-left:.4rem href=/bike-exploring/nyc><svg viewBox="0 0 91.5 52.5" width="32" height="24"><g transform="matrix(-1,0,0,1,95.8,-23.9)"><path d="m78 40.6c-3.8.0-7.3 1.2-10.2 3.2l-7.4-9.4 2.9-8.5H67c.6.0 1-.4 1-1s-.4-1-1-1H54.8c-.6.0-1 .4-1 1s.4 1 1 1h6.3l-2.3 6.7c-.2-.2-.4-.3-.7-.3H32l2.2-6.4h5.7c.6.0 1-.4 1-1s-.4-1-1-1h-6.4c-.4.0-.8.3-.9.7l-5.7 16.8c-1.5-.4-3.1-.7-4.8-.7-9.8.0-17.8 8-17.8 17.8s8 17.8 17.8 17.8 17.8-8 17.8-17.8c0-7.5-4.6-13.9-11.2-16.5l2.6-7.6 19 24.4c.1.3.3.6.6.7.1.0.2.1.3.1h.1 8.9c.5 9.4 8.3 16.8 17.8 16.8 9.8.0 17.8-8 17.8-17.8s-8-18-17.8-18zM37.8 58.4c0 8.7-7.1 15.8-15.8 15.8S6.2 67.1 6.2 58.4 13.3 42.6 22 42.6c1.4.0 2.8.2 4.1.6L21 58.1c-.2.5.1 1.1.6 1.3.1.0.2.1.3.1.4.0.8-.3.9-.7l5.1-14.9c5.9 2.2 9.9 7.9 9.9 14.5zm29.7-11.8L76 57.4H62.2c.3-4.3 2.2-8.1 5.3-10.8zm-16.7 9.6-17.1-22h24l.4.5zm1.8 1.2 7.1-20.8 6.6 8.4c-3.5 3.1-5.7 7.4-6 12.4zM78 74.2c-8.4.0-15.2-6.6-15.8-14.8H78c.4.0.7-.2.9-.6.2-.3.1-.8-.1-1.1L69 45.4c2.5-1.8 5.6-2.8 8.9-2.8 8.7.0 15.8 7.1 15.8 15.8s-7 15.8-15.7 15.8z"/></g></svg></a>
<a class="plausible-event-name=burger+about" aria-label=About href=/about><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="feather feather-user" id="about-icon"><path d="M20 21v-2a4 4 0 00-4-4H8a4 4 0 00-4 4v2"/><circle cx="12" cy="7" r="4"/></svg>
</a><a class="plausible-event-name=burger+rss" aria-label=RSS href=/index.xml><svg width="24" height="24" viewBox="0 0 30 24" fill="none" stroke="#444" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="feather feather-rss" id="rss-icon"><path d="M4 11a9 9 0 019 9"/><path d="M4 4a16 16 0 0116 16"/><circle cx="5" cy="19" r="1"/></svg></a></div></div></nav></div><div class="wrapper post"><div class=post-header><h1 class=title>Differential Evolution Optimization from Scratch with Python</h1></div><hr><div class=markdown><p>Besides <a target=blank href=https://en.wikipedia.org/wiki/Particle_swarm_optimization>particle swarm optimization</a> (PSO) which I touched on <a target=_blank href=https://nathanrooy.github.io/posts/2016-08-17/simple-particle-swarm-optimization-with-python/>previously</a>, <a target=blank href=https://en.wikipedia.org/wiki/Differential_evolution>differential evolution</a> (DE) is one of my go-to favorites. Just like PSO, differential evolution falls within the <a target=blank href=https://en.wikipedia.org/wiki/Evolutionary_algorithm>evolutionary algorithms</a> (EA) family. Differential evolution is very similar to <a target=blank>genetic algorithms</a> (GA) which are based on the principles of evolutionary biology such as mutation, crossover, and selection. The downside of genetic algorithms is that at their core, they are based on a bit level information structure. Because of this, GAs excel at combinatorial optimization problems such as the <a target=blank href=https://en.wikipedia.org/wiki/Travelling_salesman_problem>traveling salesman problem</a>. The downside is that GAs don&rsquo;t natively support real valued (float values) cost functions. Sure, genetic algorithms can be modified to support float values, but in my experience it just isn&rsquo;t worth it. This is where differential evolution comes it. Differential evolution is basically a genetic algorithm that natively supports float value based cost functions. In this tutorial, I hope to teach you the fundamentals of differential evolution and implement a bare bones version in <a target=_blank href=https://www.python.org/>Python</a>.</p><p>The basic structure of differential evolution can be summed up below:</p><pre><code>1) Initialize a random population of individuals throughout the search space.
2) while iter &lt;= max num of generations
    3) cycle through each individual in the population
        3.A) perform mutation
        3.B) perform recombination (&quot;crossover&quot; in GA lingo)
        3.C) perform selection
    4) if stopping criterion has been met:
            exit and return best individual
        else:
            iter = iter + 1
            go back to step #3
</code></pre><p>So let&rsquo;s go through each step while implementing it in Python. Before we can get to step one, we need to construct the main function which will contain the bulk of the code:</p><div class=highlight><pre tabindex=0 style=background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-py data-lang=py><span style=display:flex><span><span style=color:#069;font-weight:700>def</span> <span style=color:#c0f>main</span>():
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#069;font-weight:700>return</span> best_individual
</span></span></code></pre></div><p>Simple, let&rsquo;s move to step one. Given a list of tuples representing the search space bounds for each input variable <i>x<sub>n</sub></i> such that:</p><div class=math-block><span class=katex><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mi>b</mi><mi>o</mi><mi>u</mi><mi>n</mi><mi>d</mi><mi>s</mi><mo>=</mo><mo stretchy="false">[</mo><mo stretchy="false">(</mo><msub><mi>x</mi><msub><mn>1</mn><mrow><mi>m</mi><mi>i</mi><mi>n</mi></mrow></msub></msub><mo separator="true">,</mo><msub><mi>x</mi><msub><mn>1</mn><mrow><mi>m</mi><mi>a</mi><mi>x</mi></mrow></msub></msub><mo stretchy="false">)</mo><mo separator="true">,</mo><mo stretchy="false">(</mo><msub><mi>x</mi><msub><mn>2</mn><mrow><mi>m</mi><mi>i</mi><mi>n</mi></mrow></msub></msub><mo separator="true">,</mo><msub><mi>x</mi><msub><mn>2</mn><mrow><mi>m</mi><mi>a</mi><mi>x</mi></mrow></msub></msub><mo stretchy="false">)</mo><mo separator="true">,</mo><mi mathvariant="normal">.</mi><mi mathvariant="normal">.</mi><mo separator="true">,</mo><mo stretchy="false">(</mo><msub><mi>x</mi><msub><mi>n</mi><mrow><mi>m</mi><mi>i</mi><mi>n</mi></mrow></msub></msub><mo separator="true">,</mo><msub><mi>x</mi><msub><mi>n</mi><mrow><mi>m</mi><mi>a</mi><mi>x</mi></mrow></msub></msub><mo stretchy="false">)</mo><mo stretchy="false">]</mo></mrow><annotation encoding="application/x-tex"> bounds = [(x_{1_{min}}, x_{1_{max}}),(x_{2_{min}},x_{2_{max}}),..,(x_{n_{min}},x_{n_{max}})] </annotation></semantics></math></span></div><p>Initializing a population of size (popsize) given user specified bounds:</p><div class=highlight><pre tabindex=0 style=background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-py data-lang=py><span style=display:flex><span><span style=color:#069;font-weight:700>import</span> <span style=color:#0cf;font-weight:700>random</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#069;font-weight:700>def</span> <span style=color:#c0f>main</span>(bounds, popsize):
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#09f;font-style:italic>#--- INITIALIZE A POPULATION (step #1) ----------------+</span>
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    population <span style=color:#555>=</span> []
</span></span><span style=display:flex><span>    <span style=color:#069;font-weight:700>for</span> i <span style=color:#000;font-weight:700>in</span> <span style=color:#366>range</span>(<span style=color:#f60>0</span>,popsize):
</span></span><span style=display:flex><span>        indv <span style=color:#555>=</span> []
</span></span><span style=display:flex><span>        <span style=color:#069;font-weight:700>for</span> j <span style=color:#000;font-weight:700>in</span> <span style=color:#366>range</span>(<span style=color:#366>len</span>(bounds)):
</span></span><span style=display:flex><span>            indv<span style=color:#555>.</span>append(random<span style=color:#555>.</span>uniform(bounds[j][<span style=color:#f60>0</span>],bounds[j][<span style=color:#f60>1</span>]))
</span></span><span style=display:flex><span>        population<span style=color:#555>.</span>append(indv)
</span></span><span style=display:flex><span>            
</span></span><span style=display:flex><span>    <span style=color:#069;font-weight:700>return</span> best_individual
</span></span></code></pre></div><p>It would be prudent to note at this point that the term <i>individual</i> which is simply just a one-dimensional list, or array of values will be used interchangeably with the term <i>vector</i>, since they are essentially the same exact thing. Within the Python code, this may take the form of <i>vec</i> or just simply <i>v</i>.</p><p>Next, we need to begin the main loop of the algorithm represented by step #2, while we&rsquo;re at it, we&rsquo;ll knock out step #3A. There exists many different flavors of mutation for differential evolution but we&rsquo;re going to stick with the simplest for now. In this version of mutation, we need to select three individuals <i>x<sub>1</sub></i>, <i>x<sub>2</sub></i>, and <i>x<sub>3</sub></i> from the current generation that are both unique to themselves, but also unique to the currently selected individual that we&rsquo;re mutating. From here we subtract individuals <i>x<sub>2</sub></i> and <i>x<sub>3</sub></i> from each other, and multiply the difference by the user controlled mutation factor <i>F</i> which ranges from [0,2]. This is then added to the individual <i>x<sub>1</sub></i> which forms the new individual <i>v</i> or what&rsquo;s called the donor. Below is the equation form of this mutation scheme.</p><div class=math-block><span class=katex><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mi>v</mi><mo>=</mo><msub><mi>x</mi><mn>1</mn></msub><mo>+</mo><mi>F</mi><mo stretchy="false">(</mo><msub><mi>x</mi><mn>2</mn></msub><mo>âˆ’</mo><msub><mi>x</mi><mn>3</mn></msub><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex"> v = x_1 + F(x_2 - x_3) </annotation></semantics></math></span></div><p>One thing we need be aware of at this point is the possibility of this new donor vector existing outside of the bounds specified at initialization. Because of this, we need to create a separate function that checks and corrects for this. In the event that one of these rogue points are found, we&rsquo;ll simply move it to the nearest boundary whether it&rsquo;s the minimum or maximum. In the code, this new function will be called <i>ensure_bounds</i>. Implementing all this into our code looks like this:</p><div class=highlight><pre tabindex=0 style=background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-py data-lang=py><span style=display:flex><span><span style=color:#069;font-weight:700>import</span> <span style=color:#0cf;font-weight:700>random</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#069;font-weight:700>def</span> <span style=color:#c0f>ensure_bounds</span>(vec, bounds):
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    vec_new <span style=color:#555>=</span> []
</span></span><span style=display:flex><span>    <span style=color:#09f;font-style:italic># cycle through each variable in vector </span>
</span></span><span style=display:flex><span>    <span style=color:#069;font-weight:700>for</span> i <span style=color:#000;font-weight:700>in</span> <span style=color:#366>range</span>(<span style=color:#366>len</span>(vec)):
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#09f;font-style:italic># variable exceedes the minimum boundary</span>
</span></span><span style=display:flex><span>        <span style=color:#069;font-weight:700>if</span> vec[i] <span style=color:#555>&lt;</span> bounds[i][<span style=color:#f60>0</span>]:
</span></span><span style=display:flex><span>            vec_new<span style=color:#555>.</span>append(bounds[i][<span style=color:#f60>0</span>])
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#09f;font-style:italic># variable exceedes the maximum boundary</span>
</span></span><span style=display:flex><span>        <span style=color:#069;font-weight:700>if</span> vec[i] <span style=color:#555>&gt;</span> bounds[i][<span style=color:#f60>1</span>]:
</span></span><span style=display:flex><span>            vec_new<span style=color:#555>.</span>append(bounds[i][<span style=color:#f60>1</span>])
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#09f;font-style:italic># the variable is fine</span>
</span></span><span style=display:flex><span>        <span style=color:#069;font-weight:700>if</span> bounds[i][<span style=color:#f60>0</span>] <span style=color:#555>&lt;=</span> vec[i] <span style=color:#555>&lt;=</span> bounds[i][<span style=color:#f60>1</span>]:
</span></span><span style=display:flex><span>            vec_new<span style=color:#555>.</span>append(vec[i])
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>    <span style=color:#069;font-weight:700>return</span> vec_new
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#069;font-weight:700>def</span> <span style=color:#c0f>main</span>(bounds, popsize, mutate, maxiter):
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#09f;font-style:italic>#--- INITIALIZE A POPULATION (step #1) ----------------+</span>
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    population <span style=color:#555>=</span> []
</span></span><span style=display:flex><span>    <span style=color:#069;font-weight:700>for</span> i <span style=color:#000;font-weight:700>in</span> <span style=color:#366>range</span>(<span style=color:#f60>0</span>,popsize):
</span></span><span style=display:flex><span>        indv <span style=color:#555>=</span> []
</span></span><span style=display:flex><span>        <span style=color:#069;font-weight:700>for</span> j <span style=color:#000;font-weight:700>in</span> <span style=color:#366>range</span>(<span style=color:#366>len</span>(bounds)):
</span></span><span style=display:flex><span>            indv<span style=color:#555>.</span>append(random<span style=color:#555>.</span>uniform(bounds[j][<span style=color:#f60>0</span>],bounds[j][<span style=color:#f60>1</span>]))
</span></span><span style=display:flex><span>        population<span style=color:#555>.</span>append(indv)
</span></span><span style=display:flex><span>            
</span></span><span style=display:flex><span>    <span style=color:#09f;font-style:italic>#--- SOLVE --------------------------------------------+</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#09f;font-style:italic># cycle through each generation (step #2)</span>
</span></span><span style=display:flex><span>    <span style=color:#069;font-weight:700>for</span> i <span style=color:#000;font-weight:700>in</span> <span style=color:#366>range</span>(<span style=color:#f60>1</span>,maxiter<span style=color:#555>+</span><span style=color:#f60>1</span>):
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>        <span style=color:#09f;font-style:italic># cycle through each individual in the population (step #3)</span>
</span></span><span style=display:flex><span>        <span style=color:#069;font-weight:700>for</span> j <span style=color:#000;font-weight:700>in</span> <span style=color:#366>range</span>(<span style=color:#f60>0</span>, popsize):
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>            <span style=color:#09f;font-style:italic>#--- MUTATION (step #3.A) ---------------------+</span>
</span></span><span style=display:flex><span>            
</span></span><span style=display:flex><span>            <span style=color:#09f;font-style:italic># select three random vector index positions [0, popsize), not including current vector (j)</span>
</span></span><span style=display:flex><span>            canidates <span style=color:#555>=</span> <span style=color:#366>range</span>(<span style=color:#f60>0</span>,popsize)
</span></span><span style=display:flex><span>            canidates<span style=color:#555>.</span>remove(j)
</span></span><span style=display:flex><span>            random_index <span style=color:#555>=</span> random<span style=color:#555>.</span>sample(canidates, <span style=color:#f60>3</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>            x_1 <span style=color:#555>=</span> population[random_index[<span style=color:#f60>0</span>]]
</span></span><span style=display:flex><span>            x_2 <span style=color:#555>=</span> population[random_index[<span style=color:#f60>1</span>]]
</span></span><span style=display:flex><span>            x_3 <span style=color:#555>=</span> population[random_index[<span style=color:#f60>2</span>]]
</span></span><span style=display:flex><span>            x_t <span style=color:#555>=</span> population[j]     <span style=color:#09f;font-style:italic># target individual</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>            <span style=color:#09f;font-style:italic># subtract x3 from x2, and create a new vector (x_diff)</span>
</span></span><span style=display:flex><span>            x_diff <span style=color:#555>=</span> [x_2_i <span style=color:#555>-</span> x_3_i <span style=color:#069;font-weight:700>for</span> x_2_i, x_3_i <span style=color:#000;font-weight:700>in</span> <span style=color:#366>zip</span>(x_2, x_3)]
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>            <span style=color:#09f;font-style:italic># multiply x_diff by the mutation factor (F) and add to x_1</span>
</span></span><span style=display:flex><span>            v_donor <span style=color:#555>=</span> [x_1_i <span style=color:#555>+</span> mutate <span style=color:#555>*</span> x_diff_i <span style=color:#069;font-weight:700>for</span> x_1_i, x_diff_i <span style=color:#000;font-weight:700>in</span> <span style=color:#366>zip</span>(x_1, x_diff)]
</span></span><span style=display:flex><span>            v_donor <span style=color:#555>=</span> ensure_bounds(v_donor, bounds)
</span></span><span style=display:flex><span>            
</span></span><span style=display:flex><span>    <span style=color:#069;font-weight:700>return</span> best_individual
</span></span></code></pre></div><p>Where <i>maxiter</i> represents the number of generations we want to run the algorithm for and <i>mutate</i> represents the mutation factor <i>F</i>. Next step is recombination or &ldquo;crossover&rdquo; in the language of genetic algorithms. For this, we need to introduce a new user selected value known as the &ldquo;recombination rate&rdquo; (some texts refer to this as the crossover ratio or CR). This recombination rate is a float value that varies between zero and one and determines if recombination occurs. Cycling through each index position in the target vector, we generate a random value between zero and one. If this random value is less than the recombination rate, recombination occurs and we swap out the current variable in our target vector with the corresponding variable in the donor vector. If the randomly generated value is greater than the recombination rate, recombination does not happen and the variable in the target vector is left alone. This new offspring individual is called the <i>trial vector</i>.</p><div class=highlight><pre tabindex=0 style=background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-py data-lang=py><span style=display:flex><span><span style=color:#069;font-weight:700>import</span> <span style=color:#0cf;font-weight:700>random</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#069;font-weight:700>def</span> <span style=color:#c0f>ensure_bounds</span>(vec, bounds):
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    vec_new <span style=color:#555>=</span> []
</span></span><span style=display:flex><span>    <span style=color:#09f;font-style:italic># cycle through each variable in vector </span>
</span></span><span style=display:flex><span>    <span style=color:#069;font-weight:700>for</span> i <span style=color:#000;font-weight:700>in</span> <span style=color:#366>range</span>(<span style=color:#366>len</span>(vec)):
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#09f;font-style:italic># variable exceedes the minimum boundary</span>
</span></span><span style=display:flex><span>        <span style=color:#069;font-weight:700>if</span> vec[i] <span style=color:#555>&lt;</span> bounds[i][<span style=color:#f60>0</span>]:
</span></span><span style=display:flex><span>            vec_new<span style=color:#555>.</span>append(bounds[i][<span style=color:#f60>0</span>])
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#09f;font-style:italic># variable exceedes the maximum boundary</span>
</span></span><span style=display:flex><span>        <span style=color:#069;font-weight:700>if</span> vec[i] <span style=color:#555>&gt;</span> bounds[i][<span style=color:#f60>1</span>]:
</span></span><span style=display:flex><span>            vec_new<span style=color:#555>.</span>append(bounds[i][<span style=color:#f60>1</span>])
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#09f;font-style:italic># the variable is fine</span>
</span></span><span style=display:flex><span>        <span style=color:#069;font-weight:700>if</span> bounds[i][<span style=color:#f60>0</span>] <span style=color:#555>&lt;=</span> vec[i] <span style=color:#555>&lt;=</span> bounds[i][<span style=color:#f60>1</span>]:
</span></span><span style=display:flex><span>            vec_new<span style=color:#555>.</span>append(vec[i])
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>    <span style=color:#069;font-weight:700>return</span> vec_new
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span><span style=color:#069;font-weight:700>def</span> <span style=color:#c0f>main</span>(bounds, popsize, mutate, recombination, maxiter):
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#09f;font-style:italic>#--- INITIALIZE A POPULATION (step #1) ----------------+</span>
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    population <span style=color:#555>=</span> []
</span></span><span style=display:flex><span>    <span style=color:#069;font-weight:700>for</span> i <span style=color:#000;font-weight:700>in</span> <span style=color:#366>range</span>(<span style=color:#f60>0</span>,popsize):
</span></span><span style=display:flex><span>        indv <span style=color:#555>=</span> []
</span></span><span style=display:flex><span>        <span style=color:#069;font-weight:700>for</span> j <span style=color:#000;font-weight:700>in</span> <span style=color:#366>range</span>(<span style=color:#366>len</span>(bounds)):
</span></span><span style=display:flex><span>            indv<span style=color:#555>.</span>append(random<span style=color:#555>.</span>uniform(bounds[j][<span style=color:#f60>0</span>],bounds[j][<span style=color:#f60>1</span>]))
</span></span><span style=display:flex><span>        population<span style=color:#555>.</span>append(indv)
</span></span><span style=display:flex><span>            
</span></span><span style=display:flex><span>    <span style=color:#09f;font-style:italic>#--- SOLVE --------------------------------------------+</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#09f;font-style:italic># cycle through each generation (step #2)</span>
</span></span><span style=display:flex><span>    <span style=color:#069;font-weight:700>for</span> i <span style=color:#000;font-weight:700>in</span> <span style=color:#366>range</span>(<span style=color:#f60>1</span>,maxiter<span style=color:#555>+</span><span style=color:#f60>1</span>):
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>        <span style=color:#09f;font-style:italic># cycle through each individual in the population (step #3)</span>
</span></span><span style=display:flex><span>        <span style=color:#069;font-weight:700>for</span> j <span style=color:#000;font-weight:700>in</span> <span style=color:#366>range</span>(<span style=color:#f60>0</span>, popsize):
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>            <span style=color:#09f;font-style:italic>#--- MUTATION (step #3.A) ---------------------+</span>
</span></span><span style=display:flex><span>            
</span></span><span style=display:flex><span>            <span style=color:#09f;font-style:italic># select three random vector index positions [0, popsize), not including current vector (j)</span>
</span></span><span style=display:flex><span>            canidates <span style=color:#555>=</span> <span style=color:#366>range</span>(<span style=color:#f60>0</span>,popsize)
</span></span><span style=display:flex><span>            canidates<span style=color:#555>.</span>remove(j)
</span></span><span style=display:flex><span>            random_index <span style=color:#555>=</span> random<span style=color:#555>.</span>sample(canidates, <span style=color:#f60>3</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>            x_1 <span style=color:#555>=</span> population[random_index[<span style=color:#f60>0</span>]]
</span></span><span style=display:flex><span>            x_2 <span style=color:#555>=</span> population[random_index[<span style=color:#f60>1</span>]]
</span></span><span style=display:flex><span>            x_3 <span style=color:#555>=</span> population[random_index[<span style=color:#f60>2</span>]]
</span></span><span style=display:flex><span>            x_t <span style=color:#555>=</span> population[j]     <span style=color:#09f;font-style:italic># target individual</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>            <span style=color:#09f;font-style:italic># subtract x3 from x2, and create a new vector (x_diff)</span>
</span></span><span style=display:flex><span>            x_diff <span style=color:#555>=</span> [x_2_i <span style=color:#555>-</span> x_3_i <span style=color:#069;font-weight:700>for</span> x_2_i, x_3_i <span style=color:#000;font-weight:700>in</span> <span style=color:#366>zip</span>(x_2, x_3)]
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>            <span style=color:#09f;font-style:italic># multiply x_diff by the mutation factor (F) and add to x_1</span>
</span></span><span style=display:flex><span>            v_donor <span style=color:#555>=</span> [x_1_i <span style=color:#555>+</span> mutate <span style=color:#555>*</span> x_diff_i <span style=color:#069;font-weight:700>for</span> x_1_i, x_diff_i <span style=color:#000;font-weight:700>in</span> <span style=color:#366>zip</span>(x_1, x_diff)]
</span></span><span style=display:flex><span>            v_donor <span style=color:#555>=</span> ensure_bounds(v_donor, bounds)
</span></span><span style=display:flex><span>            
</span></span><span style=display:flex><span>            <span style=color:#09f;font-style:italic>#--- RECOMBINATION (step #3.B) ----------------+</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>            v_trial <span style=color:#555>=</span> []
</span></span><span style=display:flex><span>            <span style=color:#09f;font-style:italic># cycle through each variable in our target vector</span>
</span></span><span style=display:flex><span>            <span style=color:#069;font-weight:700>for</span> k <span style=color:#000;font-weight:700>in</span> <span style=color:#366>range</span>(<span style=color:#366>len</span>(x_t)):
</span></span><span style=display:flex><span>                crossover <span style=color:#555>=</span> random<span style=color:#555>.</span>random()
</span></span><span style=display:flex><span>                
</span></span><span style=display:flex><span>                <span style=color:#09f;font-style:italic># recombination occurs when crossover &lt;= recombination rate</span>
</span></span><span style=display:flex><span>                <span style=color:#069;font-weight:700>if</span> crossover <span style=color:#555>&lt;=</span> recombination:
</span></span><span style=display:flex><span>                    v_trial<span style=color:#555>.</span>append(v_donor[k])
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>                <span style=color:#09f;font-style:italic># recombination did not occur</span>
</span></span><span style=display:flex><span>                <span style=color:#069;font-weight:700>else</span>:
</span></span><span style=display:flex><span>                    v_trial<span style=color:#555>.</span>append(x_t[k])
</span></span><span style=display:flex><span>            
</span></span><span style=display:flex><span>    <span style=color:#069;font-weight:700>return</span> best_individual
</span></span></code></pre></div><p>The last real step (#3.C) is selection which consists of evaluating our new trial individual <i>v_trial</i> against the currently selected individual (target individual, x_t). We&rsquo;ll go with the easiest selection scheme for this tutorial which means we&rsquo;re using greedy selection. This basically means that if the new trial individual performs better than the currently selected target individual, we delete our target individual from the population and replace it with the trial individual. If the target individual is better, than we leave it alone and move on.</p><div class=highlight><pre tabindex=0 style=background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-py data-lang=py><span style=display:flex><span><span style=color:#069;font-weight:700>import</span> <span style=color:#0cf;font-weight:700>random</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#069;font-weight:700>def</span> <span style=color:#c0f>ensure_bounds</span>(vec, bounds):
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    vec_new <span style=color:#555>=</span> []
</span></span><span style=display:flex><span>    <span style=color:#09f;font-style:italic># cycle through each variable in vector </span>
</span></span><span style=display:flex><span>    <span style=color:#069;font-weight:700>for</span> i <span style=color:#000;font-weight:700>in</span> <span style=color:#366>range</span>(<span style=color:#366>len</span>(vec)):
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#09f;font-style:italic># variable exceedes the minimum boundary</span>
</span></span><span style=display:flex><span>        <span style=color:#069;font-weight:700>if</span> vec[i] <span style=color:#555>&lt;</span> bounds[i][<span style=color:#f60>0</span>]:
</span></span><span style=display:flex><span>            vec_new<span style=color:#555>.</span>append(bounds[i][<span style=color:#f60>0</span>])
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#09f;font-style:italic># variable exceedes the maximum boundary</span>
</span></span><span style=display:flex><span>        <span style=color:#069;font-weight:700>if</span> vec[i] <span style=color:#555>&gt;</span> bounds[i][<span style=color:#f60>1</span>]:
</span></span><span style=display:flex><span>            vec_new<span style=color:#555>.</span>append(bounds[i][<span style=color:#f60>1</span>])
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#09f;font-style:italic># the variable is fine</span>
</span></span><span style=display:flex><span>        <span style=color:#069;font-weight:700>if</span> bounds[i][<span style=color:#f60>0</span>] <span style=color:#555>&lt;=</span> vec[i] <span style=color:#555>&lt;=</span> bounds[i][<span style=color:#f60>1</span>]:
</span></span><span style=display:flex><span>            vec_new<span style=color:#555>.</span>append(vec[i])
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>    <span style=color:#069;font-weight:700>return</span> vec_new
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span><span style=color:#069;font-weight:700>def</span> <span style=color:#c0f>main</span>(bounds, popsize, mutate, recombination, maxiter):
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#09f;font-style:italic>#--- INITIALIZE A POPULATION (step #1) ----------------+</span>
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    population <span style=color:#555>=</span> []
</span></span><span style=display:flex><span>    <span style=color:#069;font-weight:700>for</span> i <span style=color:#000;font-weight:700>in</span> <span style=color:#366>range</span>(<span style=color:#f60>0</span>,popsize):
</span></span><span style=display:flex><span>        indv <span style=color:#555>=</span> []
</span></span><span style=display:flex><span>        <span style=color:#069;font-weight:700>for</span> j <span style=color:#000;font-weight:700>in</span> <span style=color:#366>range</span>(<span style=color:#366>len</span>(bounds)):
</span></span><span style=display:flex><span>            indv<span style=color:#555>.</span>append(random<span style=color:#555>.</span>uniform(bounds[j][<span style=color:#f60>0</span>],bounds[j][<span style=color:#f60>1</span>]))
</span></span><span style=display:flex><span>        population<span style=color:#555>.</span>append(indv)
</span></span><span style=display:flex><span>            
</span></span><span style=display:flex><span>    <span style=color:#09f;font-style:italic>#--- SOLVE --------------------------------------------+</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#09f;font-style:italic># cycle through each generation (step #2)</span>
</span></span><span style=display:flex><span>    <span style=color:#069;font-weight:700>for</span> i <span style=color:#000;font-weight:700>in</span> <span style=color:#366>range</span>(<span style=color:#f60>1</span>,maxiter<span style=color:#555>+</span><span style=color:#f60>1</span>):
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>        <span style=color:#09f;font-style:italic># cycle through each individual in the population (step #3)</span>
</span></span><span style=display:flex><span>        <span style=color:#069;font-weight:700>for</span> j <span style=color:#000;font-weight:700>in</span> <span style=color:#366>range</span>(<span style=color:#f60>0</span>, popsize):
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>            <span style=color:#09f;font-style:italic>#--- MUTATION (step #3.A) ---------------------+</span>
</span></span><span style=display:flex><span>            
</span></span><span style=display:flex><span>            <span style=color:#09f;font-style:italic># select three random vector index positions [0, popsize), not including current vector (j)</span>
</span></span><span style=display:flex><span>            canidates <span style=color:#555>=</span> <span style=color:#366>range</span>(<span style=color:#f60>0</span>,popsize)
</span></span><span style=display:flex><span>            canidates<span style=color:#555>.</span>remove(j)
</span></span><span style=display:flex><span>            random_index <span style=color:#555>=</span> random<span style=color:#555>.</span>sample(canidates, <span style=color:#f60>3</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>            x_1 <span style=color:#555>=</span> population[random_index[<span style=color:#f60>0</span>]]
</span></span><span style=display:flex><span>            x_2 <span style=color:#555>=</span> population[random_index[<span style=color:#f60>1</span>]]
</span></span><span style=display:flex><span>            x_3 <span style=color:#555>=</span> population[random_index[<span style=color:#f60>2</span>]]
</span></span><span style=display:flex><span>            x_t <span style=color:#555>=</span> population[j]     <span style=color:#09f;font-style:italic># target individual</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>            <span style=color:#09f;font-style:italic># subtract x3 from x2, and create a new vector (x_diff)</span>
</span></span><span style=display:flex><span>            x_diff <span style=color:#555>=</span> [x_2_i <span style=color:#555>-</span> x_3_i <span style=color:#069;font-weight:700>for</span> x_2_i, x_3_i <span style=color:#000;font-weight:700>in</span> <span style=color:#366>zip</span>(x_2, x_3)]
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>            <span style=color:#09f;font-style:italic># multiply x_diff by the mutation factor (F) and add to x_1</span>
</span></span><span style=display:flex><span>            v_donor <span style=color:#555>=</span> [x_1_i <span style=color:#555>+</span> mutate <span style=color:#555>*</span> x_diff_i <span style=color:#069;font-weight:700>for</span> x_1_i, x_diff_i <span style=color:#000;font-weight:700>in</span> <span style=color:#366>zip</span>(x_1, x_diff)]
</span></span><span style=display:flex><span>            v_donor <span style=color:#555>=</span> ensure_bounds(v_donor, bounds)
</span></span><span style=display:flex><span>            
</span></span><span style=display:flex><span>            <span style=color:#09f;font-style:italic>#--- RECOMBINATION (step #3.B) ----------------+</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>            v_trial <span style=color:#555>=</span> []
</span></span><span style=display:flex><span>            <span style=color:#09f;font-style:italic># cycle through each variable in our target vector</span>
</span></span><span style=display:flex><span>            <span style=color:#069;font-weight:700>for</span> k <span style=color:#000;font-weight:700>in</span> <span style=color:#366>range</span>(<span style=color:#366>len</span>(x_t)):
</span></span><span style=display:flex><span>                crossover <span style=color:#555>=</span> random<span style=color:#555>.</span>random()
</span></span><span style=display:flex><span>                
</span></span><span style=display:flex><span>                <span style=color:#09f;font-style:italic># recombination occurs when crossover &lt;= recombination rate</span>
</span></span><span style=display:flex><span>                <span style=color:#069;font-weight:700>if</span> crossover <span style=color:#555>&lt;=</span> recombination:
</span></span><span style=display:flex><span>                    v_trial<span style=color:#555>.</span>append(v_donor[k])
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>                <span style=color:#09f;font-style:italic># recombination did not occur</span>
</span></span><span style=display:flex><span>                <span style=color:#069;font-weight:700>else</span>:
</span></span><span style=display:flex><span>                    v_trial<span style=color:#555>.</span>append(x_t[k])
</span></span><span style=display:flex><span>                    
</span></span><span style=display:flex><span>            <span style=color:#09f;font-style:italic>#--- GREEDY SELECTION (step #3.C) -------------+</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>            score_trial  <span style=color:#555>=</span> cost_func(v_trial)
</span></span><span style=display:flex><span>            score_target <span style=color:#555>=</span> cost_func(x_t)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>            <span style=color:#069;font-weight:700>if</span> score_trial <span style=color:#555>&lt;</span> score_target:
</span></span><span style=display:flex><span>                population[j] <span style=color:#555>=</span> v_trial
</span></span><span style=display:flex><span>                gen_scores<span style=color:#555>.</span>append(score_trial)
</span></span><span style=display:flex><span>                <span style=color:#366>print</span> <span style=color:#c30>&#39;   &gt;&#39;</span>,score_trial, v_trial
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>            <span style=color:#069;font-weight:700>else</span>:
</span></span><span style=display:flex><span>                <span style=color:#366>print</span> <span style=color:#c30>&#39;   &gt;&#39;</span>,score_target, x_t
</span></span><span style=display:flex><span>                gen_scores<span style=color:#555>.</span>append(score_target)
</span></span><span style=display:flex><span>                
</span></span><span style=display:flex><span>    <span style=color:#069;font-weight:700>return</span> best_individual
</span></span></code></pre></div><p>You might have noticed that I&rsquo;ve skipped over step #4 which is the stopping criteria. This is again, in the interest of keeping the code as simple as possible. Because of this, the stopping criteria is simply when we have cycled through all the generations specified at initialization. Any number of stopping mechanisms from other optimization routines can be implemented here.</p><p>Putting everything together, adding a few lines for text output, score keeping, and some example cost functions, the final code looks like this (github repository -> <a target=_blank href=https://github.com/nathanrooy/differential-evolution-optimization-with-python/blob/master/DE.py>here</a>):</p><div class=highlight><pre tabindex=0 style=background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-py data-lang=py><span style=display:flex><span><span style=color:#09f;font-style:italic>#------------------------------------------------------------------------------+</span>
</span></span><span style=display:flex><span><span style=color:#09f;font-style:italic>#</span>
</span></span><span style=display:flex><span><span style=color:#09f;font-style:italic>#   Nathan A. Rooy</span>
</span></span><span style=display:flex><span><span style=color:#09f;font-style:italic>#   A simple, bare bones, implementation of differential evolution with Python</span>
</span></span><span style=display:flex><span><span style=color:#09f;font-style:italic>#   August, 2017</span>
</span></span><span style=display:flex><span><span style=color:#09f;font-style:italic>#</span>
</span></span><span style=display:flex><span><span style=color:#09f;font-style:italic>#------------------------------------------------------------------------------+</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#09f;font-style:italic>#--- IMPORT DEPENDENCIES ------------------------------------------------------+</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#069;font-weight:700>import</span> <span style=color:#0cf;font-weight:700>random</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#09f;font-style:italic>#--- EXAMPLE COST FUNCTIONS ---------------------------------------------------+</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#069;font-weight:700>def</span> <span style=color:#c0f>func1</span>(x):
</span></span><span style=display:flex><span>    <span style=color:#09f;font-style:italic># Sphere function, use any bounds, f(0,...,0)=0</span>
</span></span><span style=display:flex><span>    <span style=color:#069;font-weight:700>return</span> <span style=color:#366>sum</span>([x[i]<span style=color:#555>**</span><span style=color:#f60>2</span> <span style=color:#069;font-weight:700>for</span> i <span style=color:#000;font-weight:700>in</span> <span style=color:#366>range</span>(<span style=color:#366>len</span>(x))])
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#069;font-weight:700>def</span> <span style=color:#c0f>func2</span>(x):
</span></span><span style=display:flex><span>    <span style=color:#09f;font-style:italic># Beale&#39;s function, use bounds=[(-4.5, 4.5),(-4.5, 4.5)], f(3,0.5)=0.</span>
</span></span><span style=display:flex><span>    term1 <span style=color:#555>=</span> (<span style=color:#f60>1.500</span> <span style=color:#555>-</span> x[<span style=color:#f60>0</span>] <span style=color:#555>+</span> x[<span style=color:#f60>0</span>]<span style=color:#555>*</span>x[<span style=color:#f60>1</span>])<span style=color:#555>**</span><span style=color:#f60>2</span>
</span></span><span style=display:flex><span>    term2 <span style=color:#555>=</span> (<span style=color:#f60>2.250</span> <span style=color:#555>-</span> x[<span style=color:#f60>0</span>] <span style=color:#555>+</span> x[<span style=color:#f60>0</span>]<span style=color:#555>*</span>x[<span style=color:#f60>1</span>]<span style=color:#555>**</span><span style=color:#f60>2</span>)<span style=color:#555>**</span><span style=color:#f60>2</span>
</span></span><span style=display:flex><span>    term3 <span style=color:#555>=</span> (<span style=color:#f60>2.625</span> <span style=color:#555>-</span> x[<span style=color:#f60>0</span>] <span style=color:#555>+</span> x[<span style=color:#f60>0</span>]<span style=color:#555>*</span>x[<span style=color:#f60>1</span>]<span style=color:#555>**</span><span style=color:#f60>3</span>)<span style=color:#555>**</span><span style=color:#f60>2</span>
</span></span><span style=display:flex><span>    <span style=color:#069;font-weight:700>return</span> term1 <span style=color:#555>+</span> term2 <span style=color:#555>+</span> term3
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#09f;font-style:italic>#--- FUNCTIONS ----------------------------------------------------------------+</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#069;font-weight:700>def</span> <span style=color:#c0f>ensure_bounds</span>(vec, bounds):
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    vec_new <span style=color:#555>=</span> []
</span></span><span style=display:flex><span>    <span style=color:#09f;font-style:italic># cycle through each variable in vector </span>
</span></span><span style=display:flex><span>    <span style=color:#069;font-weight:700>for</span> i <span style=color:#000;font-weight:700>in</span> <span style=color:#366>range</span>(<span style=color:#366>len</span>(vec)):
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#09f;font-style:italic># variable exceedes the minimum boundary</span>
</span></span><span style=display:flex><span>        <span style=color:#069;font-weight:700>if</span> vec[i] <span style=color:#555>&lt;</span> bounds[i][<span style=color:#f60>0</span>]:
</span></span><span style=display:flex><span>            vec_new<span style=color:#555>.</span>append(bounds[i][<span style=color:#f60>0</span>])
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#09f;font-style:italic># variable exceedes the maximum boundary</span>
</span></span><span style=display:flex><span>        <span style=color:#069;font-weight:700>if</span> vec[i] <span style=color:#555>&gt;</span> bounds[i][<span style=color:#f60>1</span>]:
</span></span><span style=display:flex><span>            vec_new<span style=color:#555>.</span>append(bounds[i][<span style=color:#f60>1</span>])
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#09f;font-style:italic># the variable is fine</span>
</span></span><span style=display:flex><span>        <span style=color:#069;font-weight:700>if</span> bounds[i][<span style=color:#f60>0</span>] <span style=color:#555>&lt;=</span> vec[i] <span style=color:#555>&lt;=</span> bounds[i][<span style=color:#f60>1</span>]:
</span></span><span style=display:flex><span>            vec_new<span style=color:#555>.</span>append(vec[i])
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>    <span style=color:#069;font-weight:700>return</span> vec_new
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#09f;font-style:italic>#--- MAIN ---------------------------------------------------------------------+</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#069;font-weight:700>def</span> <span style=color:#c0f>main</span>(cost_func, bounds, popsize, mutate, recombination, maxiter):
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#09f;font-style:italic>#--- INITIALIZE A POPULATION (step #1) ----------------+</span>
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    population <span style=color:#555>=</span> []
</span></span><span style=display:flex><span>    <span style=color:#069;font-weight:700>for</span> i <span style=color:#000;font-weight:700>in</span> <span style=color:#366>range</span>(<span style=color:#f60>0</span>,popsize):
</span></span><span style=display:flex><span>        indv <span style=color:#555>=</span> []
</span></span><span style=display:flex><span>        <span style=color:#069;font-weight:700>for</span> j <span style=color:#000;font-weight:700>in</span> <span style=color:#366>range</span>(<span style=color:#366>len</span>(bounds)):
</span></span><span style=display:flex><span>            indv<span style=color:#555>.</span>append(random<span style=color:#555>.</span>uniform(bounds[j][<span style=color:#f60>0</span>],bounds[j][<span style=color:#f60>1</span>]))
</span></span><span style=display:flex><span>        population<span style=color:#555>.</span>append(indv)
</span></span><span style=display:flex><span>            
</span></span><span style=display:flex><span>    <span style=color:#09f;font-style:italic>#--- SOLVE --------------------------------------------+</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#09f;font-style:italic># cycle through each generation (step #2)</span>
</span></span><span style=display:flex><span>    <span style=color:#069;font-weight:700>for</span> i <span style=color:#000;font-weight:700>in</span> <span style=color:#366>range</span>(<span style=color:#f60>1</span>,maxiter<span style=color:#555>+</span><span style=color:#f60>1</span>):
</span></span><span style=display:flex><span>        <span style=color:#366>print</span> <span style=color:#c30>&#39;GENERATION:&#39;</span>,i
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        gen_scores <span style=color:#555>=</span> [] <span style=color:#09f;font-style:italic># score keeping</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#09f;font-style:italic># cycle through each individual in the population</span>
</span></span><span style=display:flex><span>        <span style=color:#069;font-weight:700>for</span> j <span style=color:#000;font-weight:700>in</span> <span style=color:#366>range</span>(<span style=color:#f60>0</span>, popsize):
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>            <span style=color:#09f;font-style:italic>#--- MUTATION (step #3.A) ---------------------+</span>
</span></span><span style=display:flex><span>            
</span></span><span style=display:flex><span>            <span style=color:#09f;font-style:italic># select three random vector index positions [0, popsize), not including current vector (j)</span>
</span></span><span style=display:flex><span>            canidates <span style=color:#555>=</span> <span style=color:#366>range</span>(<span style=color:#f60>0</span>,popsize)
</span></span><span style=display:flex><span>            canidates<span style=color:#555>.</span>remove(j)
</span></span><span style=display:flex><span>            random_index <span style=color:#555>=</span> random<span style=color:#555>.</span>sample(canidates, <span style=color:#f60>3</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>            x_1 <span style=color:#555>=</span> population[random_index[<span style=color:#f60>0</span>]]
</span></span><span style=display:flex><span>            x_2 <span style=color:#555>=</span> population[random_index[<span style=color:#f60>1</span>]]
</span></span><span style=display:flex><span>            x_3 <span style=color:#555>=</span> population[random_index[<span style=color:#f60>2</span>]]
</span></span><span style=display:flex><span>            x_t <span style=color:#555>=</span> population[j]     <span style=color:#09f;font-style:italic># target individual</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>            <span style=color:#09f;font-style:italic># subtract x3 from x2, and create a new vector (x_diff)</span>
</span></span><span style=display:flex><span>            x_diff <span style=color:#555>=</span> [x_2_i <span style=color:#555>-</span> x_3_i <span style=color:#069;font-weight:700>for</span> x_2_i, x_3_i <span style=color:#000;font-weight:700>in</span> <span style=color:#366>zip</span>(x_2, x_3)]
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>            <span style=color:#09f;font-style:italic># multiply x_diff by the mutation factor (F) and add to x_1</span>
</span></span><span style=display:flex><span>            v_donor <span style=color:#555>=</span> [x_1_i <span style=color:#555>+</span> mutate <span style=color:#555>*</span> x_diff_i <span style=color:#069;font-weight:700>for</span> x_1_i, x_diff_i <span style=color:#000;font-weight:700>in</span> <span style=color:#366>zip</span>(x_1, x_diff)]
</span></span><span style=display:flex><span>            v_donor <span style=color:#555>=</span> ensure_bounds(v_donor, bounds)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>            <span style=color:#09f;font-style:italic>#--- RECOMBINATION (step #3.B) ----------------+</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>            v_trial <span style=color:#555>=</span> []
</span></span><span style=display:flex><span>            <span style=color:#069;font-weight:700>for</span> k <span style=color:#000;font-weight:700>in</span> <span style=color:#366>range</span>(<span style=color:#366>len</span>(x_t)):
</span></span><span style=display:flex><span>                crossover <span style=color:#555>=</span> random<span style=color:#555>.</span>random()
</span></span><span style=display:flex><span>                <span style=color:#069;font-weight:700>if</span> crossover <span style=color:#555>&lt;=</span> recombination:
</span></span><span style=display:flex><span>                    v_trial<span style=color:#555>.</span>append(v_donor[k])
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>                <span style=color:#069;font-weight:700>else</span>:
</span></span><span style=display:flex><span>                    v_trial<span style=color:#555>.</span>append(x_t[k])
</span></span><span style=display:flex><span>                    
</span></span><span style=display:flex><span>            <span style=color:#09f;font-style:italic>#--- GREEDY SELECTION (step #3.C) -------------+</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>            score_trial  <span style=color:#555>=</span> cost_func(v_trial)
</span></span><span style=display:flex><span>            score_target <span style=color:#555>=</span> cost_func(x_t)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>            <span style=color:#069;font-weight:700>if</span> score_trial <span style=color:#555>&lt;</span> score_target:
</span></span><span style=display:flex><span>                population[j] <span style=color:#555>=</span> v_trial
</span></span><span style=display:flex><span>                gen_scores<span style=color:#555>.</span>append(score_trial)
</span></span><span style=display:flex><span>                <span style=color:#366>print</span> <span style=color:#c30>&#39;   &gt;&#39;</span>,score_trial, v_trial
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>            <span style=color:#069;font-weight:700>else</span>:
</span></span><span style=display:flex><span>                <span style=color:#366>print</span> <span style=color:#c30>&#39;   &gt;&#39;</span>,score_target, x_t
</span></span><span style=display:flex><span>                gen_scores<span style=color:#555>.</span>append(score_target)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#09f;font-style:italic>#--- SCORE KEEPING --------------------------------+</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        gen_avg <span style=color:#555>=</span> <span style=color:#366>sum</span>(gen_scores) <span style=color:#555>/</span> popsize                         <span style=color:#09f;font-style:italic># current generation avg. fitness</span>
</span></span><span style=display:flex><span>        gen_best <span style=color:#555>=</span> <span style=color:#366>min</span>(gen_scores)                                  <span style=color:#09f;font-style:italic># fitness of best individual</span>
</span></span><span style=display:flex><span>        gen_sol <span style=color:#555>=</span> population[gen_scores<span style=color:#555>.</span>index(<span style=color:#366>min</span>(gen_scores))]     <span style=color:#09f;font-style:italic># solution of best individual</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#366>print</span> <span style=color:#c30>&#39;      &gt; GENERATION AVERAGE:&#39;</span>,gen_avg
</span></span><span style=display:flex><span>        <span style=color:#366>print</span> <span style=color:#c30>&#39;      &gt; GENERATION BEST:&#39;</span>,gen_best
</span></span><span style=display:flex><span>        <span style=color:#366>print</span> <span style=color:#c30>&#39;         &gt; BEST SOLUTION:&#39;</span>,gen_sol,<span style=color:#c30>&#39;</span><span style=color:#c30;font-weight:700>\n</span><span style=color:#c30>&#39;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#069;font-weight:700>return</span> gen_sol
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#09f;font-style:italic>#--- CONSTANTS ----------------------------------------------------------------+</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>cost_func <span style=color:#555>=</span> func1                   <span style=color:#09f;font-style:italic># Cost function</span>
</span></span><span style=display:flex><span>bounds <span style=color:#555>=</span> [(<span style=color:#555>-</span><span style=color:#f60>1</span>,<span style=color:#f60>1</span>),(<span style=color:#555>-</span><span style=color:#f60>1</span>,<span style=color:#f60>1</span>)]            <span style=color:#09f;font-style:italic># Bounds [(x1_min, x1_max), (x2_min, x2_max),...]</span>
</span></span><span style=display:flex><span>popsize <span style=color:#555>=</span> <span style=color:#f60>10</span>                        <span style=color:#09f;font-style:italic># Population size, must be &gt;= 4</span>
</span></span><span style=display:flex><span>mutate <span style=color:#555>=</span> <span style=color:#f60>0.5</span>                        <span style=color:#09f;font-style:italic># Mutation factor [0,2]</span>
</span></span><span style=display:flex><span>recombination <span style=color:#555>=</span> <span style=color:#f60>0.7</span>                 <span style=color:#09f;font-style:italic># Recombination rate [0,1]</span>
</span></span><span style=display:flex><span>maxiter <span style=color:#555>=</span> <span style=color:#f60>20</span>                        <span style=color:#09f;font-style:italic># Max number of generations (maxiter)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#09f;font-style:italic>#--- RUN ----------------------------------------------------------------------+</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>main(cost_func, bounds, popsize, mutate, recombination, maxiter)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#09f;font-style:italic>#--- END ----------------------------------------------------------------------+</span>
</span></span></code></pre></div><p>That&rsquo;s it! Differential evolution is a very simple evolutionary routine that produces great results when used correctly. I hope this was helpful. Thanks for reading!</p><center style=letter-spacing:1.25em;font-size:1.5em;padding-bottom:.5em;padding-top:.5em>Â·Â·Â·Â·Â·</center><p>Notes:
In step #3, this implementation differs from most DE algorithms in that we cycle through each member of the population, generate a donor vector, then perform selection. In this setup, every member of the population becomes a target vector at some point which means that every individual has the possibility of being replaced. In most DE implementations, the target vector is randomly chosen. In my experience using DE (both in aerodynamic shape optimization, as well as in deep learning applications), I have found that the current implementation works much better. The standard DE implementation might be slightly more stochastic in nature, but whatever&mldr; If, you&rsquo;re interested in the &ldquo;standard&rdquo; DE implementation swap out the lines in the above code with the following:</p><div class=highlight><pre tabindex=0 style=background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-py data-lang=py><span style=display:flex><span><span style=color:#09f;font-style:italic># cycle through each individual in the population</span>
</span></span><span style=display:flex><span><span style=color:#069;font-weight:700>for</span> j <span style=color:#000;font-weight:700>in</span> <span style=color:#366>range</span>(<span style=color:#f60>0</span>, popsize):
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#09f;font-style:italic>#--- MUTATION ---------------------------------+</span>
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#09f;font-style:italic># select four random vector index positions, range = [0, popsize)</span>
</span></span><span style=display:flex><span>    canidates <span style=color:#555>=</span> <span style=color:#366>range</span>(<span style=color:#f60>0</span>,popsize)
</span></span><span style=display:flex><span>    random_index <span style=color:#555>=</span> random<span style=color:#555>.</span>sample(canidates, <span style=color:#f60>4</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    x_1 <span style=color:#555>=</span> population[random_index[<span style=color:#f60>0</span>]]
</span></span><span style=display:flex><span>    x_2 <span style=color:#555>=</span> population[random_index[<span style=color:#f60>1</span>]]
</span></span><span style=display:flex><span>    x_3 <span style=color:#555>=</span> population[random_index[<span style=color:#f60>2</span>]]
</span></span><span style=display:flex><span>    x_t <span style=color:#555>=</span> population[random_index[<span style=color:#f60>3</span>]]
</span></span></code></pre></div></div></div></body></html>