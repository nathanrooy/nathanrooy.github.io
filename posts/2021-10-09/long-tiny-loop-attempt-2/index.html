<!doctype html><html lang=en><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge,chrome=1"><meta name=author content="Nathan Rooy"><meta name=copyright content="Nathan A. Rooy"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=language content="en"><meta http-equiv=content-language content="en-gb"><link rel=icon type=image/png href=/favicon/favicon.png><meta name=google-site-verification content="vQ6uvoBDOPVq7u67m2fO8RWaxcqsoLrLzmR7CzEo-0k"><meta name=msvalidate.01 content="4903EB9C7ABD70347352DCFAEE0751F5"><script defer data-domain=nathanrooy.github.io src=https://plausible.io/js/plausible.js></script><script>window.plausible=window.plausible||function(){(window.plausible.q=window.plausible.q||[]).push(arguments)}</script><meta property="og:title" content="Long Tiny Loop: Attempt #2"><meta property="og:description" content="Brooklyn New York, evolutionary path optimization, and my second Long Tiny Loop attempt!"><meta property="og:locale" content="en_US"><meta property="og:type" content="article"><meta property="og:url" content="https://nathanrooy.github.io/posts/2021-10-09/long-tiny-loop-attempt-2/"><meta property="og:site_name" content="nathanrooy.github.io"><meta property="og:image" content="https://nathanrooy.github.io/posts/2021-10-09/long-tiny-loop-attempt-2/full_compare_622x366_web.jpg"><title>Long Tiny Loop: Attempt #2</title><link rel=canonical href=https://nathanrooy.github.io/posts/2021-10-09/long-tiny-loop-attempt-2/ itemprop=url><base href=https://nathanrooy.github.io/posts/2021-10-09/long-tiny-loop-attempt-2/><meta itemprop=name content="Long Tiny Loop: Attempt #2 | Nathan Rooy"><meta itemprop=description content="Brooklyn New York, evolutionary path optimization, and my second Long Tiny Loop attempt!"><meta itemprop=image content="https://nathanrooy.github.io/posts/2021-10-09/long-tiny-loop-attempt-2/full_compare_622x366_web.jpg"><meta name=description content="Brooklyn New York, evolutionary path optimization, and my second Long Tiny Loop attempt!"><meta name=application-name content="Long Tiny Loop: Attempt #2 | Nathan Rooy"><meta name=keywords content="long tiny loop,longtinyloop,biking,maps,genetic algorithm,evolutionary optimization,computational geometry"><meta name=twitter:card content="nathanrooy.github.io"><meta name=twitter:url content="https://nathanrooy.github.io/posts/2021-10-09/long-tiny-loop-attempt-2/"><meta name=twitter:title content="Long Tiny Loop: Attempt #2 | Nathan Rooy"><meta name=twitter:description content="Brooklyn New York, evolutionary path optimization, and my second Long Tiny Loop attempt!"><meta name=twitter:image content="https://nathanrooy.github.io/posts/2021-10-09/long-tiny-loop-attempt-2/full_compare_622x366_web.jpg"><link rel=alternate type=application/rss+xml href=https://nathanrooy.github.io/index.xml title="Nathan Rooy"><link rel=stylesheet type=text/css media=screen href=https://nathanrooy.github.io/css/normalize.min.02d927c3d7aee93f4557abffff0169f2c90a749e49700a80350d5b3f2911e20a.css><link rel=stylesheet type=text/css media=screen href=https://nathanrooy.github.io/css/main.min.e1d8a261a9154231d0b9345ea2db5d3f8f8794c533c4e814e478e5afaf11b5b4.css></head><body><div class="container wrapper post"><div class=post-header><h1 class=title>Long Tiny Loop: Attempt #2</h1><div class=meta><a href=/>Nathan Rooy</a> | October 9, 2021</div></div><div class=markdown><h2>Introduction</h2><p>Earlier this year, my goal was to get a <a target=_blank href=https://longtinyloop.com/>Long Tiny Loop</a> score 30.0 or greater. I ended up falling short with a 29.75 which really annoyed me. Sooo, I set a new goal of scoring at least 40 by the end of the year. It took three attempts, I got a flat tire, and had to hop a barbed wire&mldr; But I eventually got it.</p><h2>Path Design</h2><p>Based on the design process from my <a target=_blank href=/posts/2021-04-03/long-tiny-loop-attempt-1/>first Long Tiny Loop attempt</a>, I had a general idea of what I wanted to keep and what I wanted to improve for my second attempt. I knew that the <a target=_blank rel="noopener noreferrer" href=https://www.qgis.org/>QGIS</a> Python plugin I had written for my first Long Tiny Loop was great at helping me design paths that were nearly optimal, but I also knew that I wanted to do better than &ldquo;nearly&rdquo; optimal this time.</p><p>Because of the combinatorial nature of this problem, the search space very quickly becomes intractable making any type of full path optimization impossible. To overcome this limitation, I ended up subdividing the search space into a number of smaller regions. For the regions that could be filed with long straight, tightly packed lines I just used my QGIS Python plugin. With the keyboard shortcuts dialed in, I was able to make quick work of these areas. After all, you can&rsquo;t do much better than long, straight, tightly packed lines. But what about the regions that don&rsquo;t support this type of geometry?</p><img src=region_620x438_web.jpg alt="long tiny loop region that needs to be optimized"><p>For these smaller sub-regions in which a clear solution wasn&rsquo;t immediately apparent, I built out a genetic algorithm for finding it. However, before any path optimization could happen, the underlying <a target=_blank rel="noopener noreferrer" href=https://www.openstreetmap.org/>OpenStreetMap</a> network graph needed a little cleaning. Multi-lane roads were merged into single edges, complex intersections were consolidated, and spurious nodes were removed. Below is an example of one such region.</p><img src=simplified_osm_graph_web.svg alt="openstreetmap graph simplification with osmnx"><p>I experimented with a few different optimization approaches before settling on an evolutionary scheme. Because a path in this case is just an ordered list of graph edges, its description (number of parameters) is constantly changing. This is unlike most optimization scenarios in which the number of parameters remains fixed throughout the process (for example: <a target=_blank href=/posts/2016-09-14/airfoil-manipulation-via-bezier-curves-with-python/>airfoil aerodynamic shape optimization</a>). This variability lends itself nicely to a genetic representation. It also helps that implementing evolutionary strategies is pretty easy.</p><p>Like most evolutionary algorithms, there are three main stages: <i>selection</i>, <i>crossover</i>, and <i>mutation</i>. When one sequential pass of these three stages has been completed, a new &ldquo;generation&rdquo; is produced and the process is repeated. After a few thousand generations, usually something useful emerges. Below are some implementation details for the curious:</p><p><strong>Selection</strong> — Within the context of an evolutionary process, we need some way of determining who gets selected to pass on their genetic traits. Given a population of Long Tiny Loop paths (&ldquo;individuals&rdquo;) the length (&ldquo;fitness&rdquo;) of each individual can be determined. At this point, I usually default to the roulette wheel selection criteria for determining crossover pairing which is exactly what I did here. What this means is that paths with a higher fitness (longer length) are proportionally more likely to get selected for breeding. Additionally, 5% of the fittest individuals were carried over into the next generation unchanged (&ldquo;elitism&rdquo;).</p><p><strong>Crossover</strong> — After two paths (&ldquo;parents&rdquo;) have been selected, they must be combined into a new single path (&ldquo;offspring&rdquo;) which will progress forward to the next generation. Because of the high degree of variability between paths, the range of crossover possibilities also varies drastically. Although only one offspring gets created, two parent paths can often generate hundreds of potential solutions. Each one possessing a unique combination of their parents' DNA that has been spliced together in a way that forms a legal Long Tiny Loop path. Below is a fairly typical example of crossover.</p><img src=route_crossover_web.svg alt="evolutionary long tiny loop crossover genetic algorithm"><p><strong>Mutation</strong> — Over the course of evolution, if a population lacks sufficient genetic diversity it is susceptible to collapsing into a few highly fit individuals. To avoid this from happening, a small number of individuals are randomly selected for mutation. The number new offspring which which will incur a mutation is dependent upon the <i>mutation rate</i> and is usually set at around ~5%. In this case, a mutation takes the form of a random perturbation along the path. It can appear as one or more additions, subtractions, or some combination of both. Below are a few mutation examples.</p><figure><img src=route_mutation_web.svg alt="evolutionary long tiny loop mutation genetic algorithm"></figure><p>Once everything had been implemented, I could begin generating an optimal path. The initial population was seeded with 1000 valid Long Tiny Loop paths that were randomly generated. I then evolved this population for 30k generations&mldr;</p><img src=route_evolution_620x302.gif alt="animation of evolutionary path optimization"><p>The whole process didn&rsquo;t take that long, so I ran it a bunch of times while experimenting with different parameter settings. The solution almost always converged to the same result which was reassuring. Below is the convergence history from one of the regions I optimized.</p><img src=evolution_convergence_web.svg alt="evolutionary path optimization"><p>Just for reference, over the course of about five minutes in QGIS I was able to create a path 3602m long. The final optimized path ended up at 3980m yielding an additional 378m (+10.5% improvement).</p><p>After iterating back and forth for a while between my manual work in QGIS and the genetic algorithm I ended up with the final solution seen below. One critical design aspect that I wanted to ensure on my second attempt was having a decent buffer on my &ldquo;expected&rdquo; score. Last time my goal was to get at least a 30.0, so I designed a path that scored a 30.2 thinking that would suffice. Unfortunately, I ended up 0.45 short so I wanted at least a +1.0 margin of safety on my expected score this time. Overall it ended up coming out to roughly 118 miles (190km) with a 41.03 Long Tiny Loop score.</p><img src=full_route_620x443_web.jpg alt="final optimized route"><p>Just for a reference, here is what the new route looks like compared to my first attempt (yellow on left) which was roughly 66 miles long and scored a 29.75 on Long Tiny Loop.</p><img src=full_compare_622x366_web.jpg alt="comparing first long tiny loop path with the new optimized path"><p>Unfortunately, just like my first attempt this one too resides in deep Brooklyn. An area so ugly and full of single occupancy vehicle traffic that it might as well be Jersey.</p><h2>Results</h2><p>As I alluded to earlier, I ran into a few minor setbacks when I went out to actually complete the route. In the end though, I ended up successfully completing it with a score of 40.51 and a total distance of 118.39 miles (190.54km).</p><img src=long_tiny_loop_leaderboard_620x385_web.jpg alt="long tiny loop leaderboard"><p>I like the idea of trying to increase my Long Tiny Loop score by 10 points each year, so I guess 2022 will hopefully see a score of at least 50?</p><p>Thanks for reading!</p><p>- Nathan</p></div><div class=separator><ul class=flat><li><a onclick="plausible('home-icon',{props:{method:'Long Tiny Loop: Attempt #2'}})" href=/><img style=min-width:30px;position:relative;top:5px;width:20px;height:20px src=/icons/home_feather.svg alt="home page icon"></a></li><li><a onclick="plausible('about-icon',{props:{method:'Long Tiny Loop: Attempt #2'}})" href=/about><img style=min-width:30px;position:relative;top:5px;width:20px;height:20px src=/icons/user_feather.svg alt="about page icon"></a></li><li><a onclick="plausible('rss-icon',{props:{method:'Long Tiny Loop: Attempt #2'}})" href=/rss target=_blank><img style=min-width:30px;position:relative;top:5px;width:20px;height:20px src=/icons/rss_feather_black.svg alt="rss page icon"></a></li></ul></div></div><footer><center>&copy; <a href=/about>Nathan A. Rooy</a>.<br>Built with <a target=_blank rel="noopener noreferrer" href=https://gohugo.io/>Hugo</a>.
Powered by <a target=_blank rel="noopener noreferrer" href=http://www.github.com>GitHub</a></center></footer></body></html>