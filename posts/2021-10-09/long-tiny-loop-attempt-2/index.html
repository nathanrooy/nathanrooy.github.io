<!doctype html><html lang=en><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge,chrome=1"><meta name=author content="Nathan Rooy"><meta name=copyright content="Nathan A. Rooy"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=language content="en"><meta http-equiv=content-language content="en-gb"><link rel=icon type=image/png href=/favicon/favicon.png><script defer data-domain=nathanrooy.github.io src=https://plausible.io/js/plausible.js></script><script>window.plausible=window.plausible||function(){(window.plausible.q=window.plausible.q||[]).push(arguments)}</script><meta property="og:title" content="Long Tiny Loop: Attempt #2"><meta property="og:description" content="Brooklyn New York, evolutionary path optimization, and my second Long Tiny Loop attempt!"><meta property="og:locale" content="en_US"><meta property="og:type" content="article"><meta property="og:url" content="https://nathanrooy.github.io/posts/2021-10-09/long-tiny-loop-attempt-2/"><meta property="og:site_name" content="nathanrooy.github.io"><meta property="og:image" content="https://nathanrooy.github.io/posts/2021-10-09/long-tiny-loop-attempt-2/full_compare_622x366_web.jpg"><title>Long Tiny Loop: Attempt #2</title><link rel=canonical href=https://nathanrooy.github.io/posts/2021-10-09/long-tiny-loop-attempt-2/ itemprop=url><base href=https://nathanrooy.github.io/posts/2021-10-09/long-tiny-loop-attempt-2/><meta itemprop=name content="Long Tiny Loop: Attempt #2 | Nathan Rooy"><meta itemprop=description content="Brooklyn New York, evolutionary path optimization, and my second Long Tiny Loop attempt!"><meta itemprop=image content="https://nathanrooy.github.io/posts/2021-10-09/long-tiny-loop-attempt-2/full_compare_622x366_web.jpg"><meta name=description content="Brooklyn New York, evolutionary path optimization, and my second Long Tiny Loop attempt!"><meta name=application-name content="Long Tiny Loop: Attempt #2 | Nathan Rooy"><meta name=keywords content="long tiny loop,longtinyloop,biking,maps,genetic algorithm,routing,evolutionary optimization,evolutionary route optimization"><meta name=twitter:card content="nathanrooy.github.io"><meta name=twitter:url content="https://nathanrooy.github.io/posts/2021-10-09/long-tiny-loop-attempt-2/"><meta name=twitter:title content="Long Tiny Loop: Attempt #2 | Nathan Rooy"><meta name=twitter:description content="Brooklyn New York, evolutionary path optimization, and my second Long Tiny Loop attempt!"><meta name=twitter:image content="https://nathanrooy.github.io/posts/2021-10-09/long-tiny-loop-attempt-2/full_compare_622x366_web.jpg"><link rel=alternate type=application/rss+xml href=https://nathanrooy.github.io/index.xml title="Nathan Rooy"><style>/*!normalize.css v8.0.1 | MIT License | github.com/necolas/normalize.css*/html{line-height:1.15;-webkit-text-size-adjust:100%}body{margin:0}main{display:block}h1{font-size:2em;margin:.67em 0}hr{box-sizing:content-box;height:0;overflow:visible}pre{font-family:monospace,monospace;font-size:1em}a{background-color:initial}abbr[title]{border-bottom:none;text-decoration:underline;text-decoration:underline dotted}b,strong{font-weight:bolder}code,kbd,samp{font-family:monospace,monospace;font-size:1em}small{font-size:80%}sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}img{border-style:none}button,input,optgroup,select,textarea{font-family:inherit;font-size:100%;line-height:1.15;margin:0}button,input{overflow:visible}button,select{text-transform:none}button,[type=button],[type=reset],[type=submit]{-webkit-appearance:button}button::-moz-focus-inner,[type=button]::-moz-focus-inner,[type=reset]::-moz-focus-inner,[type=submit]::-moz-focus-inner{border-style:none;padding:0}button:-moz-focusring,[type=button]:-moz-focusring,[type=reset]:-moz-focusring,[type=submit]:-moz-focusring{outline:1px dotted ButtonText}fieldset{padding:.35em .75em .625em}legend{box-sizing:border-box;color:inherit;display:table;max-width:100%;padding:0;white-space:normal}progress{vertical-align:baseline}textarea{overflow:auto}[type=checkbox],[type=radio]{box-sizing:border-box;padding:0}[type=number]::-webkit-inner-spin-button,[type=number]::-webkit-outer-spin-button{height:auto}[type=search]{-webkit-appearance:textfield;outline-offset:-2px}[type=search]::-webkit-search-decoration{-webkit-appearance:none}::-webkit-file-upload-button{-webkit-appearance:button;font:inherit}details{display:block}summary{display:list-item}template{display:none}[hidden]{display:none}:root{--main-text-color:#222;--main-text-weight:400;--text-bold:600;--font-family:"Figtree", sans-serif}body{-webkit-font-smoothing:antialiased}@font-face{font-family:figtree;font-style:normal;font-weight:400;font-display:swap;src:url(/fonts/figtree-v1-latin-regular.eot);src:local(''),url(/fonts/figtree-v1-latin-regular.eot?#iefix)format('embedded-opentype'),url(/fonts/figtree-v1-latin-regular.woff2)format('woff2'),url(/fonts/figtree-v1-latin-regular.woff)format('woff'),url(/fonts/figtree-v1-latin-regular.ttf)format('truetype'),url(/fonts/figtree-v1-latin-regular.svg#Figtree)format('svg')}@font-face{font-family:figtree;font-style:normal;font-weight:600;font-display:swap;src:url(/fonts/figtree-v1-latin-600.eot);src:local(''),url(/fonts/figtree-v1-latin-600.eot?#iefix)format('embedded-opentype'),url(/fonts/figtree-v1-latin-600.woff2)format('woff2'),url(/fonts/figtree-v1-latin-600.woff)format('woff'),url(/fonts/figtree-v1-latin-600.ttf)format('truetype'),url(/fonts/figtree-v1-latin-600.svg#Figtree)format('svg')}.home-page{font-family:var(--font-family);color:var(--main-text-color);margin-top:0}.home-page ul li{margin-bottom:.3rem}.home-page ul a{color:var(--main-text-color)}.post-li-title{width:95%;text-overflow:ellipsis;white-space:nowrap;overflow:hidden;float:left}.post-li-date{float:left;padding-bottom:1em;font-size:16px;color:#a9a9a9}@media only screen and (min-width:501px){.wrapper{max-width:660px;margin:0 auto;padding:1rem}.container{margin-top:10rem}.post-li-title{font-size:19px}.post-ul{list-style-type:none;padding-left:0;list-style:none;line-height:1.6em;margin-top:0}.post-li{overflow:hidden}}@media only screen and (max-width:950px){.container{margin-top:0}}@media only screen and (max-width:500px){.wrapper{margin:0 auto}.container{margin:2rem 1rem 1rem}.post-ul{list-style-type:none;padding-left:0;list-style:none;line-height:1.5em;margin-top:.2rem}.post-li{overflow:hidden}}.nyc-progress-image{margin-top:-1rem}.strava-grid{padding-top:1rem}.language-python{font-size:.8rem;line-height:0}.highlight{margin-bottom:1rem}.personal-social-media{text-align:center}.personal-social-media a{display:inline-block;padding-left:5px;padding-right:5px}.about h3{margin-top:0;padding-top:0}.about li{margin-bottom:0;padding-bottom:0}.about-ul li{margin-bottom:.5rem}footer{padding-bottom:6rem;font-family:var(--font-family);font-size:.75em;color:#999;margin-top:3rem;line-height:1.2rem}footer a{color:#555;font-weight:var(--main-text-weight)}footer a:hover{text-decoration:underline;color:#555}footer a:visited{color:#555}.footnotes{line-height:1rem;font-size:15px;margin-top:1em}.footnotes hr{display:none}.footnotes li p{line-height:1rem;margin-bottom:0}.footnotes ol{list-style:none;counter-reset:list;padding-left:2.5em;font-size:15px}.footnotes ol>li{list-style:none;position:relative}.footnotes ol>li:before{counter-increment:list;content:"[" counter(list)"] ";position:absolute;left:-2.5em;font-size:15px}ul.flat{margin:0;padding:0}ul.flat li{display:inline-block;list-style:none;margin-left:0}.markdown .post-update{background-color:#f2f2f2;border-left:10px solid;border-color:#e74c3c;padding-top:1.5rem;padding-left:1.5rem;padding-bottom:1.5rem;padding-right:1.5rem;margin-top:1rem;margin-left:0;margin-right:0;margin-bottom:2rem;line-height:1.5rem;font-weight:var(--main-text-weight);font-size:15px}.highlighter-rouge{position:relative;font-size:.75rem;color:var(--main-text-color);border:1px solid;border-color:#e6e6e6;border-radius:3px;background-color:#f2f2f2;padding:.1rem .2rem}.figcaption{font-size:.8rem;padding-bottom:1rem}.markdown .photoset-grid-lightbox{margin-bottom:1rem}.markdown{font-family:var(--font-family);color:var(--main-text-color);padding-bottom:3rem}.markdown ol{font-weight:var(--main-text-weight);font-size:16px;margin-top:0;padding-bottom:0;line-height:1.2rem;padding-right:2em;width:85%;margin-block-end:.25em}.markdown ol li{padding-bottom:.75em}.markdown p{font-weight:var(--main-text-weight);font-size:16px;margin-top:0;margin-bottom:1rem;line-height:1.7rem;letter-spacing:.02rem}.markdown blockquote{background-color:#f2f2f2;border-left:10px solid;border-color:#2dad60;padding-top:1.5rem;padding-left:1.5rem;padding-bottom:1.5rem;padding-right:1.5rem;margin-top:0;margin-left:0;margin-right:0;margin-bottom:1rem;line-height:1.5rem;font-weight:var(--main-text-weight);font-size:15px}.markdown blockquote p{margin-bottom:0}.markdown h2{font-family:figtree;font-size:1.1rem;font-weight:var(--text-bold);margin-bottom:.4em}*+h2{padding-top:2rem}.markdown .ul-style-b li{margin-bottom:.5rem;font-size:16px}.TLDR{font-family:var(--font-family);padding-top:0;margin-top:0;padding-bottom:4rem;margin-bottom:0;font-size:1.1rem;line-height:1.7rem;font-weight:var(--main-text-weight);letter-spacing:.02rem}table{width:100%;font-size:14px;letter-spacing:-.01em;border-collapse:collapse;margin-bottom:2em;margin-top:2em;font-weight:var(--main-text-weight);line-height:1.2rem}table th{text-align:left}table thead{border-bottom:1px solid var(--main-text-color);line-height:1.4em}.post-header h1{font-weight:var(--main-text-weight);font-size:2rem;font-family:var(--font-family);color:var(--main-text-color);line-height:2.4rem}.post ul li{margin-bottom:10px}.post ul li p{display:inline}.post .post-header{margin-bottom:5rem}.post .post-header .title{margin:0}.post .post-header .meta{padding-left:0;margin-top:10px}.post .post-header a{color:#999}.post .post-header a:hover{text-decoration:underline}.post .post-header a:visited{color:#999}.separator{display:flex;align-items:center;text-align:center}.separator::before,.separator::after{content:'';flex:1;border-bottom:1px solid #000}.separator:not(:empty)::before{margin-right:.25em}.separator:not(:empty)::after{margin-left:.25em}a{text-decoration:none;color:#0955b5}a:hover{text-decoration:underline}a:visited{color:#205caa}::selection{background:#fff9c4;text-shadow:none}img{margin:1.5em auto;max-width:100%;display:block}a img{border:none}figure{margin:0;text-align:center}ul{padding-left:15px}ul{list-style:disc inside}.markdown ul li{font-size:15px}.highlight pre{margin-bottom:0;margin-top:0;padding:20px;background-color:initial!important;overflow:auto;word-wrap:normal;white-space:pre}.highlight{background:0 0;background-color:#fafafa}.meta{font-family:var(--font-family);font-size:.8rem;color:#999;margin-bottom:4px}.list .posts .post .meta{margin-bottom:0;margin-left:5px}.markdown .photoset-grid-lightbox{margin-bottom:1rem}table .katex-display{margin-top:.2rem;margin-bottom:.2rem}.post ul li .katex-display{display:inline-block;list-style:none;margin-left:0;margin-bottom:0;line-height:0;padding:0}@media only screen and (min-width:501px){#burger{padding-left:2rem;padding-top:2rem}}@media only screen and (max-width:950px){#burger{padding-left:1rem;padding-top:1rem;padding-bottom:1.5rem}}@media only screen and (max-width:500px){#burger{padding-left:1rem;padding-top:1rem}}#burger{font-family:var(--font-family);font-weight:400;color:#a9a9a9;font-size:1.5rem}#burger a{display:inline-block;padding-right:.5rem;padding-bottom:.3rem;vertical-align:bottom}#burger label{cursor:pointer}#burger label:hover{color:var(--main-text-color)}#nav-icons{padding-left:1rem}#nav-icons img{height:20px;margin:0;padding:0}#l1-val{position:relative;top:-.12rem}#l2-val{position:relative;top:-.2rem;padding-left:.1rem;padding-right:.1rem}#burger-cbox{display:none}#label-1{display:inline-block}#label-2{display:none}#burger-cbox:not(:checked)~#nav-icons{display:none}#burger-cbox:checked~#nav-icons{display:inline-block}#burger-cbox:checked~#label-1{display:none}#burger-cbox:checked~#label-2{display:inline-block;color:var(--main-text-color)}</style></head><body><div class=header><nav role=navigation><div id=burger><input type=checkbox id=burger-cbox autocomplete=off>
<label id=label-1 for=burger-cbox><span>[</span><span id=l1-val>+</span><span>]</span></label>
<label id=label-2 for=burger-cbox><span>[</span><span id=l2-val>x</span><span>]</span></label><div id=nav-icons><a href=/><img src=/icons/home_feather.svg alt="home page icon"></a>
<a href=/reading><img src=/icons/book.svg alt="reading icon"></a>
<a href=/nyc_biking><img src=/icons/bicycle.svg alt="biking page icon"></a>
<a href=/about><img src=/icons/user_feather.svg alt="about page icon"></a>
<a href=/index.xml><img src=/icons/rss_feather_black.svg alt="rss page icon"></a></div></div></nav></div><div class="container wrapper post"><div class=post-header><h1 class=title>Long Tiny Loop: Attempt #2</h1><div class=meta><a href=/>Nathan Rooy</a> | October 9, 2021</div></div><div class=markdown><h2>Introduction</h2><p>Earlier this year, my goal was to get a <a target=_blank rel="noopener noreferrer" href=https://longtinyloop.com/>Long Tiny Loop</a> score 30.0 or greater. I ended up falling short with a 29.75 which really annoyed me. Sooo, I set a new goal of scoring at least 40 by the end of the year. It took three attempts, I got a flat tire, and had to hop a barbed wire fence&mldr; But I eventually got it.</p><h2>Path Design</h2><p>Based on the design process from my <a target=_blank rel="noopener noreferrer" href=/posts/2021-04-03/long-tiny-loop-attempt-1/>first Long Tiny Loop attempt</a>, I had a general idea of what I wanted to keep and what I wanted to improve for my second attempt. I knew that the <a target=_blank rel="noopener noreferrer" href=https://www.qgis.org/>QGIS</a> Python plugin I had written for my first Long Tiny Loop was great at helping me design paths that were nearly optimal, but I also knew that I wanted to do better than &ldquo;nearly&rdquo; optimal this time.</p><p>Because of the combinatorial nature of this problem, the search space very quickly becomes intractable making any type of full path optimization impossible. To overcome this limitation, I ended up subdividing the search space into a number of smaller regions. For the regions that could be filed with long straight, tightly packed lines I just used my QGIS Python plugin. With the keyboard shortcuts dialed in, I was able to make quick work of these areas. After all, you can&rsquo;t do much better than long, straight, tightly packed lines. But what about the regions that don&rsquo;t support this type of geometry?</p><img src=region_620x438_web.jpg alt="long tiny loop region that needs to be optimized"><p>For these smaller sub-regions in which a clear solution wasn&rsquo;t immediately apparent, I built out a genetic algorithm for finding it. However, before any path optimization could happen, the underlying <a target=_blank rel="noopener noreferrer" href=https://www.openstreetmap.org/>OpenStreetMap</a> network graph needed a little cleaning. Multi-lane roads were merged into single edges, complex intersections were consolidated, and spurious nodes were removed. Below is an example of one such region.</p><img src=simplified_osm_graph_web.svg alt="openstreetmap graph simplification with osmnx"><p>I experimented with a few different optimization approaches before settling on an evolutionary scheme. Because a path in this case is just an ordered list of graph edges, its description (number of parameters) is constantly changing. This is unlike most optimization scenarios in which the number of parameters remains fixed throughout the process (for example: <a target=_blank rel="noopener noreferrer" href=/posts/2016-09-14/airfoil-manipulation-via-bezier-curves-with-python/>airfoil aerodynamic shape optimization</a>). This variability lends itself nicely to a genetic representation. It also helps that implementing evolutionary strategies is pretty easy.</p><p>Like most evolutionary algorithms, there are three main stages: <i>selection</i>, <i>crossover</i>, and <i>mutation</i>. When one sequential pass of these three stages has been completed, a new &ldquo;generation&rdquo; is produced and the process is repeated. After a few thousand generations, usually something useful emerges. Below are some implementation details for the curious:</p><p><strong>Selection</strong> — Within the context of an evolutionary process, we need some way of determining who gets selected to pass on their genetic traits. Given a population of Long Tiny Loop paths (&ldquo;individuals&rdquo;) the length (&ldquo;fitness&rdquo;) of each individual can be determined. At this point, I usually default to the roulette wheel selection criteria for determining crossover pairing which is exactly what I did here. What this means is that paths with a higher fitness (longer length) are proportionally more likely to get selected for breeding. Additionally, 5% of the fittest individuals were carried over into the next generation unchanged (&ldquo;elitism&rdquo;).</p><p><strong>Crossover</strong> — After two paths (&ldquo;parents&rdquo;) have been selected, they must be combined into a new single path (&ldquo;offspring&rdquo;) which will progress forward to the next generation. Because of the high degree of variability between paths, the range of crossover possibilities also varies drastically. Although only one offspring gets created, two parent paths can often generate hundreds of potential solutions. Each one possessing a unique combination of their parents' DNA that has been spliced together in a way that forms a valid Long Tiny Loop path. Below is a fairly typical example of crossover.</p><img src=route_crossover_web.svg alt="evolutionary long tiny loop crossover genetic algorithm"><p><strong>Mutation</strong> — Over the course of evolution, if a population lacks sufficient genetic diversity it is susceptible to collapsing into a few highly fit individuals. To avoid this from happening, a small number of individuals are randomly selected for mutation. The number of new offspring which which will incur a mutation is dependent upon the <i>mutation rate</i> and is usually set at around ~5%. In this case, a mutation takes the form of a random perturbation along the path. It can appear as one or more additions, subtractions, or some combination of both. Below are a few mutation examples.</p><figure><img src=route_mutation_web.svg alt="evolutionary long tiny loop mutation genetic algorithm"></figure><p>Once everything had been implemented, I could begin generating an optimal path. The initial population was seeded with 1000 valid Long Tiny Loop paths that were randomly generated. I then evolved this population for 40k generations&mldr;</p><img src=route_evolution_620x302.gif alt="animation of evolutionary path optimization"><p>The whole process didn&rsquo;t take that long, so I ran it a bunch of times while experimenting with different parameter settings. The solution almost always converged to the same result which was reassuring. Below is the convergence history from one of the regions I optimized.</p><img src=evolution_convergence_web.svg alt="evolutionary path optimization"><p>Just for reference, over the course of about five minutes in QGIS I was able to create a path 3772m long. The final optimized path ended up at 4170m yielding an additional 398m (+10.5% improvement).</p><p>After iterating back and forth for a while between my manual work in QGIS and the genetic algorithm I ended up with the final solution seen below. One critical design aspect that I wanted to ensure on my second attempt was having a decent buffer on my &ldquo;expected&rdquo; score. Last time my goal was to get at least a 30.0, so I designed a path that scored a 30.2 thinking that would suffice. Unfortunately, I ended up 0.45 short so I wanted at least a +1.0 margin of safety on my expected score this time. Overall it ended up coming out to roughly 118 miles (190km) with a 41.03 Long Tiny Loop score.</p><img src=full_route_620x443_web.jpg alt="final optimized route"><p>Just for a reference, here is what the new route looks like compared to my first attempt (yellow on left) which was roughly 66 miles long and scored a 29.75 on Long Tiny Loop.</p><img src=full_compare_622x366_web.jpg alt="comparing first long tiny loop path with the new optimized path"><p>Unfortunately, just like my first attempt this one too resides in deep Brooklyn. An area so ugly and full of single occupancy vehicle traffic that it might as well be Jersey.</p><h2>Results</h2><p>As I alluded to earlier, I ran into a few minor setbacks when I went out to actually complete the route. In the end though, I had fun and I ended up successfully completing it with a score of 40.51 and a total distance of 118.39 miles (190.54km).</p><img src=long_tiny_loop_leaderboard_620x385_web.jpg alt="long tiny loop leaderboard"><p>I like the idea of trying to increase my Long Tiny Loop score by 10 points each year, so I guess 2022 will hopefully see a score of at least 50?</p><p>Thanks for reading!</p><p>- Nathan</p></div><div class=separator><ul class=flat><li><a onclick="plausible('home-icon',{props:{method:'Long Tiny Loop: Attempt #2'}})" href=/><img style=min-width:30px;position:relative;top:5px;width:20px;height:20px src=/icons/home_feather.svg alt="home page icon"></a></li><li><a onclick="plausible('about-icon',{props:{method:'Long Tiny Loop: Attempt #2'}})" href=/about><img style=min-width:30px;position:relative;top:5px;width:20px;height:20px src=/icons/user_feather.svg alt="about page icon"></a></li><li><a onclick="plausible('rss-icon',{props:{method:'Long Tiny Loop: Attempt #2'}})" href=/index.xml target=_blank><img style=min-width:30px;position:relative;top:5px;width:20px;height:20px src=/icons/rss_feather_black.svg alt="rss page icon"></a></li></ul></div></div><footer><center>&copy; <a href=/about>Nathan A. Rooy</a>.<br>Built with <a target=_blank rel="noopener noreferrer" href=https://gohugo.io/>Hugo</a>.
Powered by <a target=_blank rel="noopener noreferrer" href=http://www.github.com>GitHub</a></center></footer></body></html>