<!doctype html><html lang=en><head><meta charset=utf-8><title>Nathan Rooy</title>
<meta content="Nathan Rooy" name=author><meta content="en" name=language><meta content="width=device-width,minimum-scale=1" name=viewport><meta content="nathan.fun" property="og:site_name"><meta content="nathan.fun" property="twitter:domain"><meta content="article" property="og:type"><meta content="https://nathan.fun/posts/2021-10-09/long-tiny-loop-attempt-2/" property="og:url"><meta content="https://nathan.fun/posts/2021-10-09/long-tiny-loop-attempt-2/" name=twitter:url><meta content="Nathan A. Rooy" name=copyright><meta content="summary_large_image" name=twitter:card><meta content="long tiny loop,longtinyloop,biking,maps,genetic algorithm,routing,evolutionary optimization,evolutionary route optimization" name=keywords><meta content="Biking 118 non-intersecting miles in Brooklyn" name=twitter:title><meta content="Biking 118 non-intersecting miles in Brooklyn" property="og:title"><meta content="Brooklyn New York, evolutionary path optimization, and my second Long Tiny Loop attempt!" name=description><meta content="Brooklyn New York, evolutionary path optimization, and my second Long Tiny Loop attempt!" name=twitter:description><meta content="Brooklyn New York, evolutionary path optimization, and my second Long Tiny Loop attempt!" property="og:description"><meta content="https://nathan.fun/posts/2021-10-09/long-tiny-loop-attempt-2/full_compare_622x366_web.jpg" name=twitter:image><meta content="https://nathan.fun/posts/2021-10-09/long-tiny-loop-attempt-2/full_compare_622x366_web.jpg" property="og:image"><meta content="https://nathan.fun/posts/2021-10-09/long-tiny-loop-attempt-2/full_compare_622x366_web.jpg" name=thumbnail><link href=https://nathan.fun/index.xml rel=alternate type=application/rss+xml title="Nathan Rooy"><link href=/favicon/favicon.png rel=icon type=image/png><link href=/fonts/figtree-v1-latin-regular.woff2 rel=preload as=font type=font/woff2 crossorigin><link href=https://nathan.fun/posts/2021-10-09/long-tiny-loop-attempt-2/ rel=canonical><link rel=blogroll type=text/xml href=https://raw.githubusercontent.com/nathanrooy/feedly-opml-archiver/refs/heads/main/feedly.opml><script defer data-domain=nathan.fun src=https://plausible.io/js/script.tagged-events.js></script><style>:root{--main-text-color:#222;--main-text-weight:400;--text-bold:600;--font-family:"Figtree", sans-serif;--background-light:#F5F5F5;--link-text-color:#0955b5;--dark-text-color:#999}html{font-size:16px}body{-webkit-font-smoothing:antialiased;font-family:var(--font-family);color:var(--main-text-color);font-weight:var(--main-text-weight)}.wrapper{max-width:660px;margin:6rem auto 0;padding:1rem}a{text-decoration:none;color:var(--link-text-color)}a:hover{text-decoration:underline}a:visited{color:var(--link-text-color)}::selection{background:#fff9c4;text-shadow:none}img{margin:1.5em auto;max-width:100%;display:block}a img{border:none}@font-face{font-family:Figtree;font-style:normal;font-weight:400;font-display:swap;src:url(/fonts/figtree-v1-latin-regular.eot);src:local(''),url(/fonts/figtree-v1-latin-regular.eot?#iefix)format('embedded-opentype'),url(/fonts/figtree-v1-latin-regular.woff2)format('woff2'),url(/fonts/figtree-v1-latin-regular.woff)format('woff'),url(/fonts/figtree-v1-latin-regular.ttf)format('truetype'),url(/fonts/figtree-v1-latin-regular.svg#Figtree)format('svg')}@font-face{font-family:Figtree;font-style:normal;font-weight:600;font-display:swap;src:url(/fonts/figtree-v1-latin-600.eot);src:local(''),url(/fonts/figtree-v1-latin-600.eot?#iefix)format('embedded-opentype'),url(/fonts/figtree-v1-latin-600.woff2)format('woff2'),url(/fonts/figtree-v1-latin-600.woff)format('woff'),url(/fonts/figtree-v1-latin-600.ttf)format('truetype'),url(/fonts/figtree-v1-latin-600.svg#Figtree)format('svg')}.home-page ul a{color:var(--main-text-color)}.home-page .post-ul{list-style-type:none;padding-left:0;line-height:1.6em;margin-top:0}.home-page .post-li{overflow:hidden;margin-bottom:.3rem}.home-page .post-li-title{font-size:1.2rem;width:95%;text-overflow:ellipsis;white-space:nowrap;overflow:hidden;float:left}.home-page .post-li-date{padding-bottom:1em;color:var(--dark-text-color)}@media only screen and (max-width:750px){.wrapper{margin-top:2.5rem;margin-left:0}.home-page .post-ul{line-height:1.5em;margin-top:.2rem;padding-left:0}}.math-block{margin-top:2rem;margin-bottom:2rem}mtext{position:absolute;right:0}.inline-svg-equation{text-align:center;margin:1.5em auto;max-width:100%;display:block}ul.flat{margin:0;padding:0}ul.flat li{display:inline-block;list-style:none;margin-left:0}.post-header h1{font-weight:var(--main-text-weight);font-size:2.3rem;color:var(--main-text-color);line-height:2.64rem}.post ul li{margin-bottom:10px}.post ul li p{display:inline}.post .post-header{margin-bottom:2.5rem}.post .post-header .title{margin:0}.post hr{margin:4rem 0;height:1px;border:none;color:var(--main-text-color);background-color:var(--main-text-color)}.highlighter-rouge{position:relative;font-size:.75rem;color:var(--main-text-color);border:1px solid;border-color:#e6e6e6;border-radius:3px;background-color:var(--background-light);padding:.1rem .2rem}.figcaption{font-size:.8rem;padding-bottom:1rem}.markdown{padding-bottom:8rem}.markdown ol li{padding-bottom:.75em}.markdown p{font-size:1rem;margin:0 0 1rem;line-height:1.7rem;letter-spacing:.01rem;word-spacing:.025rem}.markdown blockquote{background-color:var(--background-light);border-left:10px solid;border-color:#2dad60;padding:1.5rem;margin:0 0 1rem;line-height:1.5rem;font-size:15px}h2{font-size:1.2rem;font-weight:var(--text-bold);margin-bottom:.3em}*+h2{padding-top:2rem}.markdown .ul-style-b li{margin-bottom:.5rem;font-size:16px}.TLDR{font-size:1.1rem;line-height:1.7rem;letter-spacing:.02rem}table{width:100%;font-size:14px;letter-spacing:-.01em;border-collapse:collapse;margin-bottom:2em;margin-top:2em;line-height:1.2rem}table th{text-align:left}table thead{border-bottom:1px solid var(--main-text-color);line-height:1.4em}figure{margin:0;text-align:center}ul{padding-left:15px;list-style:disc inside}.highlight pre{padding:20px;background-color:transparent!important;overflow:auto;word-wrap:normal;white-space:pre}.highlight{background:0 0;background-color:var(--background-light)}@media only screen and (min-width:751px){#burger{padding-left:2rem;padding-top:2rem}}@media only screen and (max-width:750px){#burger{padding-left:1rem;padding-top:1rem}}#burger{font-family:var(--font-family);font-weight:400;color:#a9a9a9;font-size:1.5rem}#burger a{display:inline-block;padding-right:.8rem}#burger label{cursor:pointer}#burger label:hover{color:var(--main-text-color)}#nav-icons{padding-left:.8rem}#nav-icons svg{max-height:20px;margin-bottom:-.05rem;color:var(--main-text-color)}#l1-val{position:relative;top:-.12rem}#l2-val{position:relative;top:-.2rem;padding-left:.1rem;padding-right:.1rem}#burger-cbox{display:none}#label-1{display:inline-block}#label-2{display:none}#burger-cbox:not(:checked)~#nav-icons{display:none}#burger-cbox:checked~#nav-icons{display:inline-block}#burger-cbox:checked~#label-1{display:none}#burger-cbox:checked~#label-2{display:inline-block;color:var(--main-text-color)}</style></head><body><div class=header><nav><div id=burger><input type=checkbox id=burger-cbox>
<label id=label-1 for=burger-cbox><span>[</span><span id=l1-val>+</span><span>]</span>
</label><label id=label-2 for=burger-cbox><span>[</span><span id=l2-val>x</span><span>]</span></label><div id=nav-icons><a class="plausible-event-name=burger+home" aria-label=Home style=padding-right:.7rem href=/><svg id="home-icon" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="feather feather-home"><path d="M3 9l9-7 9 7v11a2 2 0 01-2 2H5a2 2 0 01-2-2z"/><polyline points="9 22 9 12 15 12 15 22"/></svg></a>
<a class="plausible-event-name=burger+reading" aria-label=Reading href=/reading><svg width="24" height="24" viewBox="0 0 23.809855 18.892912" id="svg5"><defs id="defs2"/><g id="layer1" transform="translate(-6.352941,-30.26865)"><g id="g39" transform="matrix(0.26458333,0,0,0.26458333,5.0300244,26.48677)"><path class="st0" d="m92.22 22.9v59C74.24 76.35 61.26 78.85 54.73 81.04 59.2 76.64 68.54 70.55 84.16 74.14l1.69.39V21.42c2.17.29 4.3.77 6.37 1.48z" id="path11"/><path class="st0" d="M45.24 81.04C38.73 78.85 25.74 76.35 7.77 81.9v-59c2.06-.71 4.2-1.19 6.37-1.48v53.11l1.68-.39c15.61-3.58 24.96 2.5 29.42 6.9z" id="path13"/><polygon points="48.86,85.63 48.82,85.58 48.91,85.63" id="polygon15"/><polygon points="51.17,85.58 51.13,85.63 50,85.63 51.09,85.62" id="polygon17"/><path d="m94.09 20.63c-2.68-1-5.45-1.65-8.24-2.02v-2.94l-1.08-.24c-17.8-4.09-28.32 3.81-32.9 8.68-.81.87-1.44 1.63-1.88 2.22C49.54 25.74 48.91 24.98 48.1 24.11c-4.58-4.87-15.11-12.76-32.9-8.68l-1.07.24v2.94c-2.8.38-5.57 1.02-8.24 2.02L5 20.97V85.7l1.81-.61c13.49-4.49 24.13-4.16 30.68-3.08 7.09 1.15 11.05 3.4 11.09 3.42l.23.14.09.06H50l1.09-.01.08-.05.23-.14c.05-.02 4-2.27 11.09-3.42 6.55-1.08 17.19-1.41 30.68 3.08l1.82.61V20.97zM7.78 81.89v-59c2.06-.71 4.2-1.19 6.37-1.48v53.11l1.68-.39c15.61-3.58 24.95 2.5 29.42 6.9-6.52-2.18-19.5-4.68-37.47.86zm40.76-1.3c-4.19-4.66-14.29-12.83-31.63-9.5v-53.2c11.11-2.28 18.93.38 24.02 3.66 2.6 1.68 4.48 3.52 5.71 4.95 1.14 1.32 1.73 2.28 1.82 2.43l.08.15zm2.76.17V29.34l.24-.4c.09-.16.68-1.12 1.82-2.44 1.23-1.43 3.11-3.27 5.71-4.94 5.08-3.29 12.91-5.95 24.02-3.67v53.2C65.54 67.72 55.4 76.13 51.3 80.76zm40.92 1.13C74.24 76.34 61.26 78.84 54.73 81.03 59.2 76.63 68.54 70.54 84.16 74.13l1.69.39v-53.1c2.16.29 4.3.77 6.37 1.48z" id="path19"/></g></g><style id="style9">.st0{fill:none}</style></svg>
</a><a class="plausible-event-name=burger+nycbike" aria-label="NYC Bike Exploring" style=margin-left:.4rem href=/bike-exploring/nyc><svg viewBox="0 0 91.5 52.5" width="32" height="24"><g transform="matrix(-1,0,0,1,95.8,-23.9)"><path d="m78 40.6c-3.8.0-7.3 1.2-10.2 3.2l-7.4-9.4 2.9-8.5H67c.6.0 1-.4 1-1s-.4-1-1-1H54.8c-.6.0-1 .4-1 1s.4 1 1 1h6.3l-2.3 6.7c-.2-.2-.4-.3-.7-.3H32l2.2-6.4h5.7c.6.0 1-.4 1-1s-.4-1-1-1h-6.4c-.4.0-.8.3-.9.7l-5.7 16.8c-1.5-.4-3.1-.7-4.8-.7-9.8.0-17.8 8-17.8 17.8s8 17.8 17.8 17.8 17.8-8 17.8-17.8c0-7.5-4.6-13.9-11.2-16.5l2.6-7.6 19 24.4c.1.3.3.6.6.7.1.0.2.1.3.1h.1 8.9c.5 9.4 8.3 16.8 17.8 16.8 9.8.0 17.8-8 17.8-17.8s-8-18-17.8-18zM37.8 58.4c0 8.7-7.1 15.8-15.8 15.8S6.2 67.1 6.2 58.4 13.3 42.6 22 42.6c1.4.0 2.8.2 4.1.6L21 58.1c-.2.5.1 1.1.6 1.3.1.0.2.1.3.1.4.0.8-.3.9-.7l5.1-14.9c5.9 2.2 9.9 7.9 9.9 14.5zm29.7-11.8L76 57.4H62.2c.3-4.3 2.2-8.1 5.3-10.8zm-16.7 9.6-17.1-22h24l.4.5zm1.8 1.2 7.1-20.8 6.6 8.4c-3.5 3.1-5.7 7.4-6 12.4zM78 74.2c-8.4.0-15.2-6.6-15.8-14.8H78c.4.0.7-.2.9-.6.2-.3.1-.8-.1-1.1L69 45.4c2.5-1.8 5.6-2.8 8.9-2.8 8.7.0 15.8 7.1 15.8 15.8s-7 15.8-15.7 15.8z"/></g></svg></a>
<a class="plausible-event-name=burger+about" aria-label=About href=/about><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="feather feather-user" id="about-icon"><path d="M20 21v-2a4 4 0 00-4-4H8a4 4 0 00-4 4v2"/><circle cx="12" cy="7" r="4"/></svg>
</a><a class="plausible-event-name=burger+rss" aria-label=RSS href=/index.xml><svg width="24" height="24" viewBox="0 0 30 24" fill="none" stroke="#444" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="feather feather-rss" id="rss-icon"><path d="M4 11a9 9 0 019 9"/><path d="M4 4a16 16 0 0116 16"/><circle cx="5" cy="19" r="1"/></svg></a></div></div></nav></div><div class="wrapper post"><div class=post-header><h1 class=title>Biking 118 non-intersecting miles in Brooklyn</h1></div><p class=TLDR><strong>TL;DR</strong> - Long Tiny Loop #2</p><hr><div class=markdown><h2>Introduction</h2><p>Earlier this year, my goal was to get a <a href=https://longtinyloop.com/>Long Tiny Loop</a> of score 30.0 or greater. I ended up falling short with a 29.75 which really annoyed me. Sooo, I set a new goal of scoring at least 40 by the end of the year. It took three attempts, I got a flat tire, and had to hop a barbed wire fence&mldr; But I eventually got it.</p><h2>Path Design</h2><p>Based on the design process from my <a href=/posts/2021-04-03/long-tiny-loop-attempt-1/>first Long Tiny Loop attempt</a>, I had a general idea of what I wanted to keep and what I wanted to improve for my second attempt. I knew that the <a href=https://www.qgis.org/>QGIS</a> Python plugin I had written for my first Long Tiny Loop was great at helping me design paths that were nearly optimal, but I also knew that I wanted to do better than &ldquo;nearly&rdquo; optimal this time.</p><p>Because of the combinatorial nature of this problem, the search space very quickly becomes intractable making any type of full path optimization impossible. To overcome this limitation, I ended up subdividing the search space into a number of smaller regions. For the regions that could be filed with long straight, tightly packed lines I just used my QGIS Python plugin. With the keyboard shortcuts dialed in, I was able to make quick work of these areas. After all, you can&rsquo;t do much better than long, straight, tightly packed lines. But what about the regions that don&rsquo;t support this type of geometry?</p><img src=region_620x438_web.jpg alt="long tiny loop region that needs to be optimized"><p>For these smaller sub-regions in which a clear solution wasn&rsquo;t immediately apparent, I built out a genetic algorithm for finding it. However, before any path optimization could happen, the underlying <a href=https://www.openstreetmap.org/>OpenStreetMap</a> network graph needed a little cleaning. Multi-lane roads were merged into single edges, complex intersections were consolidated, and spurious nodes were removed. Below is an example of one such region.</p><img src=simplified_osm_graph_web.svg alt="openstreetmap graph simplification with osmnx"><p>I experimented with a few different optimization approaches before settling on an evolutionary scheme. Because a path in this case is just an ordered list of graph edges, its description (number of parameters) is constantly changing. This is unlike most optimization scenarios in which the number of parameters remains fixed throughout the process (for example: <a href=/posts/2016-09-14/airfoil-manipulation-via-bezier-curves-with-python/>airfoil aerodynamic shape optimization</a>). This variability lends itself nicely to a genetic representation. It also helps that implementing evolutionary strategies is pretty easy.</p><p>Like most evolutionary algorithms, there are three main stages: <i>selection</i>, <i>crossover</i>, and <i>mutation</i>. When one sequential pass of these three stages has been completed, a new &ldquo;generation&rdquo; is produced and the process is repeated. After a few thousand generations, usually something useful emerges. Below are some implementation details for the curious:</p><p><strong>Selection</strong> — Within the context of an evolutionary process, we need some way of determining who gets selected to pass on their genetic traits. Given a population of Long Tiny Loop paths (&ldquo;individuals&rdquo;) the length (&ldquo;fitness&rdquo;) of each individual can be determined. At this point, I usually default to the roulette wheel selection criteria for determining crossover pairing which is exactly what I did here. What this means is that paths with a higher fitness (longer length) are proportionally more likely to get selected for breeding. Additionally, 5% of the fittest individuals were carried over into the next generation unchanged (&ldquo;elitism&rdquo;).</p><p><strong>Crossover</strong> — After two paths (&ldquo;parents&rdquo;) have been selected, they must be combined into a new single path (&ldquo;offspring&rdquo;) which will progress forward to the next generation. Because of the high degree of variability between paths, the range of crossover possibilities also varies drastically. Although only one offspring gets created, two parent paths can often generate hundreds of potential solutions. Each one possessing a unique combination of their parents&rsquo; DNA that has been spliced together in a way that forms a valid Long Tiny Loop path. Below is a fairly typical example of crossover.</p><img src=route_crossover_web.svg alt="evolutionary long tiny loop crossover genetic algorithm"><p><strong>Mutation</strong> — Over the course of evolution, if a population lacks sufficient genetic diversity it is susceptible to collapsing into a few highly fit individuals. To avoid this from happening, a small number of individuals are randomly selected for mutation. The number of new offspring which which will incur a mutation is dependent upon the <i>mutation rate</i> and is usually set at around ~5%. In this case, a mutation takes the form of a random perturbation along the path. It can appear as one or more additions, subtractions, or some combination of both. Below are a few mutation examples.</p><figure><img src=route_mutation_web.svg alt="evolutionary long tiny loop mutation genetic algorithm"></figure><p>Once everything had been implemented, I could begin generating an optimal path. The initial population was seeded with 1000 valid Long Tiny Loop paths that were randomly generated. I then evolved this population for 40k generations&mldr;</p><img src=route_evolution_620x302.gif alt="animation of evolutionary path optimization"><p>The whole process didn&rsquo;t take that long, so I ran it a bunch of times while experimenting with different parameter settings. The solution almost always converged to the same result which was reassuring. Below is the convergence history from one of the regions I optimized.</p><img src=evolution_convergence_web.svg alt="evolutionary path optimization"><p>Just for reference, over the course of about five minutes in QGIS I was able to create a path 3772m long. The final optimized path ended up at 4170m yielding an additional 398m (+10.5% improvement).</p><p>After iterating back and forth for a while between my manual work in QGIS and the genetic algorithm I ended up with the final solution seen below. One critical design aspect that I wanted to ensure on my second attempt was having a decent buffer on my &ldquo;expected&rdquo; score. Last time my goal was to get at least a 30.0, so I designed a path that scored a 30.2 thinking that would suffice. Unfortunately, I ended up 0.45 short so I wanted at least a +1.0 margin of safety on my expected score this time. Overall it ended up coming out to roughly 118 miles (190km) with a 41.03 Long Tiny Loop score.</p><img src=full_route_620x443_web.jpg alt="final optimized route"><p>Just for a reference, here is what the new route looks like compared to my first attempt (yellow on left) which was roughly 66 miles long and scored a 29.75 on Long Tiny Loop.</p><img src=full_compare_622x366_web.jpg alt="comparing first long tiny loop path with the new optimized path"><p>Unfortunately, just like my first attempt this one too resides in deep Brooklyn. An area so ugly and full of single occupancy vehicle traffic that it might as well be Jersey.</p><h2>Results</h2><p>As I alluded to earlier, I ran into a few minor setbacks when I went out to actually complete the route. In the end though, I had fun and I ended up successfully completing it with a score of 40.51 and a total distance of 118.39 miles (190.54km) [strava activity -> <a href=https://www.strava.com/activities/6054769068>here</a>].</p><img src=long_tiny_loop_leaderboard_620x385_web.jpg alt="long tiny loop leaderboard"><p>I like the idea of trying to increase my Long Tiny Loop score by 10 points each year, so I guess 2022 will hopefully see a score of at least 50?</p><p>Thanks for reading!</p><p>- Nathan</p></div></div></body></html>