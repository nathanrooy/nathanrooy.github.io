<!doctype html><html lang=en><head><meta charset=utf-8><title>Nathan Rooy</title>
<meta content="Nathan Rooy" name=author><meta content="en" name=language><meta content="width=device-width,minimum-scale=1" name=viewport><meta content="nathan.fun" property="og:site_name"><meta content="nathan.fun" property="twitter:domain"><meta content="article" property="og:type"><meta content="https://nathan.fun/posts/2017-11-30/evolving-simple-organisms-using-a-genetic-algorithm-and-deep-learning/" property="og:url"><meta content="https://nathan.fun/posts/2017-11-30/evolving-simple-organisms-using-a-genetic-algorithm-and-deep-learning/" name=twitter:url><meta content="Nathan A. Rooy" name=copyright><meta content="summary_large_image" name=twitter:card><meta content="python,evolutionary optimization,machine learning" name=keywords><meta content="Evolving Simple Organisms using a Genetic Algorithm and Deep Learning from Scratch with Python" name=twitter:title><meta content="Evolving Simple Organisms using a Genetic Algorithm and Deep Learning from Scratch with Python" property="og:title"><meta content="Learn how to evolve a population of simple organisms each containing a unique neural network using a genetic algorithm" name=description><meta content="Learn how to evolve a population of simple organisms each containing a unique neural network using a genetic algorithm" name=twitter:description><meta content="Learn how to evolve a population of simple organisms each containing a unique neural network using a genetic algorithm" property="og:description"><meta content="https://nathan.fun/posts/2017-11-30/evolving-simple-organisms-using-a-genetic-algorithm-and-deep-learning/organism-neural-network.png" name=twitter:image><meta content="https://nathan.fun/posts/2017-11-30/evolving-simple-organisms-using-a-genetic-algorithm-and-deep-learning/organism-neural-network.png" property="og:image"><meta content="https://nathan.fun/posts/2017-11-30/evolving-simple-organisms-using-a-genetic-algorithm-and-deep-learning/organism-neural-network.png" name=thumbnail><link href=https://nathan.fun/index.xml rel=alternate type=application/rss+xml title="Nathan Rooy"><link href=/favicon/favicon.png rel=icon type=image/png><link href=/fonts/figtree-v1-latin-regular.woff2 rel=preload as=font type=font/woff2 crossorigin><link href=https://nathan.fun/posts/2017-11-30/evolving-simple-organisms-using-a-genetic-algorithm-and-deep-learning/ rel=canonical><link rel=blogroll type=text/xml href=https://raw.githubusercontent.com/nathanrooy/feedly-opml-archiver/refs/heads/main/feedly.opml><script defer data-domain=nathan.fun src=https://plausible.io/js/script.tagged-events.js></script><style>:root{--main-text-color:#222;--main-text-weight:400;--text-bold:600;--font-family:"Figtree", sans-serif;--background-light:#F5F5F5;--link-text-color:#0955b5;--dark-text-color:#999}@font-face{font-family:figtree;font-style:normal;font-weight:400;font-display:swap;src:url(/fonts/figtree-v1-latin-regular.eot);src:local(''),url(/fonts/figtree-v1-latin-regular.eot?#iefix)format('embedded-opentype'),url(/fonts/figtree-v1-latin-regular.woff2)format('woff2'),url(/fonts/figtree-v1-latin-regular.woff)format('woff'),url(/fonts/figtree-v1-latin-regular.ttf)format('truetype'),url(/fonts/figtree-v1-latin-regular.svg#Figtree)format('svg')}@font-face{font-family:figtree;font-style:normal;font-weight:600;font-display:swap;src:url(/fonts/figtree-v1-latin-600.eot);src:local(''),url(/fonts/figtree-v1-latin-600.eot?#iefix)format('embedded-opentype'),url(/fonts/figtree-v1-latin-600.woff2)format('woff2'),url(/fonts/figtree-v1-latin-600.woff)format('woff'),url(/fonts/figtree-v1-latin-600.ttf)format('truetype'),url(/fonts/figtree-v1-latin-600.svg#Figtree)format('svg')}body{-webkit-font-smoothing:antialiased;font-family:var(--font-family);color:var(--main-text-color);font-weight:var(--main-text-weight)}.home-page{margin-top:0;padding-bottom:6rem}.home-page ul li{margin-bottom:.3rem}.home-page ul a{color:var(--main-text-color)}.home-page .post-ul{list-style-type:none;padding-left:0;list-style:none;line-height:1.6em;margin-top:0}.wrapper{max-width:660px;margin:0 auto;padding:1rem}.container{margin-top:6rem}.post-li-title{font-size:19px}.post-li{overflow:hidden}@media only screen and (max-width:500px){.container{margin-top:1rem}.post-ul{line-height:1.5em;margin-top:.2rem}}.markdown .footnotes ol{counter-reset:item;padding-left:0;padding-right:0;width:fit-content;color:var(--dark-text-color)}.markdown .footnotes li{display:block;padding-bottom:0}.markdown .footnotes li:before{content:counter(item)". ";counter-increment:item;width:2em;display:inline-block;position:absolute}.markdown .footnotes li p{padding-left:2rem;line-height:1.25rem}.markdown .footnotes li a{color:var(--dark-text-color)}.markdown .footnotes li a:hover{color:var(--main-text-color)}.math-block{margin-top:2rem;margin-bottom:2rem}mtext{position:absolute;right:0}.inline-svg-equation{text-align:center;margin:1.5em auto;max-width:100%;display:block}ul.flat{margin:0;padding:0}ul.flat li{display:inline-block;list-style:none;margin-left:0}.markdown .post-update{background-color:var(--background-light);border-left:10px solid;border-color:#e74c3c;padding:1.5rem;margin:1rem 0 2rem;line-height:1.5rem;font-size:15px}.highlighter-rouge{position:relative;font-size:.75rem;color:var(--main-text-color);border:1px solid;border-color:#e6e6e6;border-radius:3px;background-color:var(--background-light);padding:.1rem .2rem}.figcaption{font-size:.8rem;padding-bottom:1rem}.markdown{padding-bottom:8rem}.markdown ol li{padding-bottom:.75em}.markdown p{font-size:16px;margin:0 0 1rem;line-height:1.7rem;letter-spacing:.01rem;word-spacing:.025rem}.markdown blockquote{background-color:var(--background-light);border-left:10px solid;border-color:#2dad60;padding:1.5rem;margin:0 0 1rem;line-height:1.5rem;font-size:15px}h2{font-size:1.2rem;font-weight:var(--text-bold);margin-bottom:.3em}*+h2{padding-top:2rem}.markdown .ul-style-b li{margin-bottom:.5rem;font-size:16px}.TLDR{font-size:1.1rem;line-height:1.7rem;letter-spacing:.02rem}table{width:100%;font-size:14px;letter-spacing:-.01em;border-collapse:collapse;margin-bottom:2em;margin-top:2em;line-height:1.2rem}table th{text-align:left}table thead{border-bottom:1px solid var(--main-text-color);line-height:1.4em}.post-header h1{font-weight:var(--main-text-weight);font-size:2.3rem;color:var(--main-text-color);line-height:2.64rem}.post ul li{margin-bottom:10px}.post ul li p{display:inline}.post .post-header{margin-bottom:2.5rem}.post .post-header .title{margin:0}.post hr{margin:4rem 0;height:1px;border:none;color:var(--main-text-color);background-color:var(--main-text-color)}a{text-decoration:none;color:var(--link-text-color)}a:hover{text-decoration:underline}a:visited{color:var(--link-text-color)}::selection{background:#fff9c4;text-shadow:none}#map img{margin:0;max-width:100%;display:block}img{margin:1.5em auto;max-width:100%;display:block}a img{border:none}figure{margin:0;text-align:center}ul{padding-left:15px;list-style:disc inside}.highlight pre{padding:20px;background-color:transparent!important;overflow:auto;word-wrap:normal;white-space:pre}.highlight{background:0 0;background-color:var(--background-light)}@media only screen and (min-width:501px){#burger{padding-left:2rem;padding-top:2rem}}@media only screen and (max-width:950px){#burger{padding-left:1rem;padding-top:1rem;padding-bottom:1.5rem}}@media only screen and (max-width:500px){#burger{padding-left:1rem;padding-top:1rem}}#burger{font-family:var(--font-family);font-weight:400;color:#a9a9a9;font-size:1.5rem}#burger a{display:inline-block;padding-right:.8rem}#burger label{cursor:pointer}#burger label:hover{color:var(--main-text-color)}#nav-icons{padding-left:.8rem}#nav-icons svg{max-height:20px;margin-bottom:-.05rem;color:var(--main-text-color)}#l1-val{position:relative;top:-.12rem}#l2-val{position:relative;top:-.2rem;padding-left:.1rem;padding-right:.1rem}#burger-cbox{display:none}#label-1{display:inline-block}#label-2{display:none}#burger-cbox:not(:checked)~#nav-icons{display:none}#burger-cbox:checked~#nav-icons{display:inline-block}#burger-cbox:checked~#label-1{display:none}#burger-cbox:checked~#label-2{display:inline-block;color:var(--main-text-color)}</style><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/katex.min.css integrity=sha384-nB0miv6/jRmo5UMMR1wu3Gz6NLsoTkbqJghGIsx//Rlm+ZU03BU6SQNC66uf4l5+ crossorigin=anonymous></head><body><div class=header><nav><div id=burger><input type=checkbox id=burger-cbox>
<label id=label-1 for=burger-cbox><span>[</span><span id=l1-val>+</span><span>]</span>
</label><label id=label-2 for=burger-cbox><span>[</span><span id=l2-val>x</span><span>]</span></label><div id=nav-icons><a class="plausible-event-name=burger+home" aria-label=Home style=padding-right:.7rem href=/><svg id="home-icon" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="feather feather-home"><path d="M3 9l9-7 9 7v11a2 2 0 01-2 2H5a2 2 0 01-2-2z"/><polyline points="9 22 9 12 15 12 15 22"/></svg></a>
<a class="plausible-event-name=burger+reading" aria-label=Reading href=/reading><svg width="24" height="24" viewBox="0 0 23.809855 18.892912" id="svg5"><defs id="defs2"/><g id="layer1" transform="translate(-6.352941,-30.26865)"><g id="g39" transform="matrix(0.26458333,0,0,0.26458333,5.0300244,26.48677)"><path class="st0" d="m92.22 22.9v59C74.24 76.35 61.26 78.85 54.73 81.04 59.2 76.64 68.54 70.55 84.16 74.14l1.69.39V21.42c2.17.29 4.3.77 6.37 1.48z" id="path11"/><path class="st0" d="M45.24 81.04C38.73 78.85 25.74 76.35 7.77 81.9v-59c2.06-.71 4.2-1.19 6.37-1.48v53.11l1.68-.39c15.61-3.58 24.96 2.5 29.42 6.9z" id="path13"/><polygon points="48.86,85.63 48.82,85.58 48.91,85.63" id="polygon15"/><polygon points="51.17,85.58 51.13,85.63 50,85.63 51.09,85.62" id="polygon17"/><path d="m94.09 20.63c-2.68-1-5.45-1.65-8.24-2.02v-2.94l-1.08-.24c-17.8-4.09-28.32 3.81-32.9 8.68-.81.87-1.44 1.63-1.88 2.22C49.54 25.74 48.91 24.98 48.1 24.11c-4.58-4.87-15.11-12.76-32.9-8.68l-1.07.24v2.94c-2.8.38-5.57 1.02-8.24 2.02L5 20.97V85.7l1.81-.61c13.49-4.49 24.13-4.16 30.68-3.08 7.09 1.15 11.05 3.4 11.09 3.42l.23.14.09.06H50l1.09-.01.08-.05.23-.14c.05-.02 4-2.27 11.09-3.42 6.55-1.08 17.19-1.41 30.68 3.08l1.82.61V20.97zM7.78 81.89v-59c2.06-.71 4.2-1.19 6.37-1.48v53.11l1.68-.39c15.61-3.58 24.95 2.5 29.42 6.9-6.52-2.18-19.5-4.68-37.47.86zm40.76-1.3c-4.19-4.66-14.29-12.83-31.63-9.5v-53.2c11.11-2.28 18.93.38 24.02 3.66 2.6 1.68 4.48 3.52 5.71 4.95 1.14 1.32 1.73 2.28 1.82 2.43l.08.15zm2.76.17V29.34l.24-.4c.09-.16.68-1.12 1.82-2.44 1.23-1.43 3.11-3.27 5.71-4.94 5.08-3.29 12.91-5.95 24.02-3.67v53.2C65.54 67.72 55.4 76.13 51.3 80.76zm40.92 1.13C74.24 76.34 61.26 78.84 54.73 81.03 59.2 76.63 68.54 70.54 84.16 74.13l1.69.39v-53.1c2.16.29 4.3.77 6.37 1.48z" id="path19"/></g></g><style id="style9">.st0{fill:none}</style></svg>
</a><a class="plausible-event-name=burger+nycbike" aria-label="NYC Bike Exploring" style=margin-left:.4rem href=/bike-exploring/nyc><svg viewBox="0 0 91.5 52.5" width="32" height="24" xmlns:cc="http://creativecommons.org/ns#" xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#"><g transform="matrix(-1,0,0,1,95.8,-23.9)"><path d="m78 40.6c-3.8.0-7.3 1.2-10.2 3.2l-7.4-9.4 2.9-8.5H67c.6.0 1-.4 1-1s-.4-1-1-1H54.8c-.6.0-1 .4-1 1s.4 1 1 1h6.3l-2.3 6.7c-.2-.2-.4-.3-.7-.3H32l2.2-6.4h5.7c.6.0 1-.4 1-1s-.4-1-1-1h-6.4c-.4.0-.8.3-.9.7l-5.7 16.8c-1.5-.4-3.1-.7-4.8-.7-9.8.0-17.8 8-17.8 17.8s8 17.8 17.8 17.8 17.8-8 17.8-17.8c0-7.5-4.6-13.9-11.2-16.5l2.6-7.6 19 24.4c.1.3.3.6.6.7.1.0.2.1.3.1h.1 8.9c.5 9.4 8.3 16.8 17.8 16.8 9.8.0 17.8-8 17.8-17.8s-8-18-17.8-18zM37.8 58.4c0 8.7-7.1 15.8-15.8 15.8S6.2 67.1 6.2 58.4 13.3 42.6 22 42.6c1.4.0 2.8.2 4.1.6L21 58.1c-.2.5.1 1.1.6 1.3.1.0.2.1.3.1.4.0.8-.3.9-.7l5.1-14.9c5.9 2.2 9.9 7.9 9.9 14.5zm29.7-11.8L76 57.4H62.2c.3-4.3 2.2-8.1 5.3-10.8zm-16.7 9.6-17.1-22h24l.4.5zm1.8 1.2 7.1-20.8 6.6 8.4c-3.5 3.1-5.7 7.4-6 12.4zM78 74.2c-8.4.0-15.2-6.6-15.8-14.8H78c.4.0.7-.2.9-.6.2-.3.1-.8-.1-1.1L69 45.4c2.5-1.8 5.6-2.8 8.9-2.8 8.7.0 15.8 7.1 15.8 15.8s-7 15.8-15.7 15.8z"/></g></svg>
</a><a class="plausible-event-name=burger+about" aria-label=About href=/about><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="feather feather-user" id="about-icon"><path d="M20 21v-2a4 4 0 00-4-4H8a4 4 0 00-4 4v2"/><circle cx="12" cy="7" r="4"/></svg>
</a><a class="plausible-event-name=burger+rss" aria-label=RSS href=/index.xml><svg width="24" height="24" viewBox="0 0 30 24" fill="none" stroke="#444" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="feather feather-rss" id="rss-icon"><path d="M4 11a9 9 0 019 9"/><path d="M4 4a16 16 0 0116 16"/><circle cx="5" cy="19" r="1"/></svg></a></div></div></nav></div><div class="container wrapper post"><div class=post-header><h1 class=title>Evolving Simple Organisms using a Genetic Algorithm and Deep Learning from Scratch with Python</h1></div><p class=TLDR><strong>TL;DR</strong> - Learn how to evolve a population of simple organisms each containing a unique neural network using a genetic algorithm.</p><hr><div class=markdown><h2>Introduction</h2><p>A few weeks ago I got pretty deep into a late night <a target=_blank href=http://youtube-rabbit-hole.urbanup.com/9025238>YouTube rabbit hole</a>, and somewhere around <a target=_blank href=https://youtu.be/HgWQ-gPIvt4>evolving soft body robots</a>, I came across this video (<a target=_blank href=https://youtu.be/TC5jzw05mNo>here</a>). I&rsquo;m not sure what if it was the peaceful background music or the hypnotizing motion of the dragonflies but I wanted to try and run the simulation on my local computer. After failing to find a GitHub repo for this, I decided to spend a few hours coding my own version in Python. I was pretty happy with the end results so I decided to turn it into a tutorial.</p><p>During this post, well code from scratch a simulation environment that contains organisms that must consume as much as food as possible in order to survive (click <a href=#results>here</a> to see the final results). If these organisms were people, they would be competitive eaters.</p><center><fig><img src=hot-dog-eating-contest.gif></fig></center><h2>Neural Network and Navigation</h2><p>Starting off with the basics, the organisms will be controlled by a simple, fully connected <a target=_blank href=https://en.wikipedia.org/wiki/Artificial_neural_network>neural network</a>. The input for the neural network will be a normalized value ranging from [-1, +1], representing the direction to the nearest food particle. This heading is calculated by taking the direction to the nearest food particle (which ranges from +/- 180 degrees) and dividing it by 180. Below are two navigation examples.</p><center><fig><img alt="organism heading calculation" title="organism heading calculation" src=heading-calculation.png></fig></center><p>Because our single input ranges from [-1, +1] and our desired outputs also range from [-1, +1], the <a target=_blank href=https://en.wikipedia.org/wiki/Hyperbolic_function>tanh</a> will make the ideal <a target=_blank href=https://en.wikipedia.org/wiki/Activation_function>activation function</a>. Below is a diagram of the neural network with its inputs and outputs as well as its hidden layer. There exists many excellent tutorials on neural networks online so I wont go into great detail here. I recommend the following to those that are interested: <a target=_blank href=https://youtu.be/aircAruvnKk>here</a>, <a target=_blank href=https://gormanalysis.com/introduction-to-neural-networks/>here</a>, <a target=_blank href=https://gormanalysis.com/neural-networks-a-worked-example/>here</a>, and <a target=_blank href=http://neuralnetworksanddeeplearning.com/>here</a>.</p><center><fig><img src=organism-neural-network.png></fig></center><p>Since the neural network is nothing more than simple matrix multiplication, it only takes up a few lines of code thanks to <a target=_blank href=http://www.numpy.org/>NumPy</a>. During the evolution process, it&rsquo;s these weights that will be optimized. Lastly, I have set the default number of hidden nodes to five, but this can be increased or decreased to your liking.</p><h2>Organism</h2><p>The organism class is the star of the show here. It contains the neural network, as well as functions for updating its heading, velocity, and position. When an organism is initialized for the first time, its position, heading, velocity, acceleration, and neural network weights are all randomly generated.</p><div class=highlight><pre tabindex=0 style=background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-py data-lang=py><span style=display:flex><span><span style=color:#069;font-weight:700>class</span> <span style=color:#0a8;font-weight:700>organism</span>():
</span></span><span style=display:flex><span>    <span style=color:#069;font-weight:700>def</span> __init__(self, settings, wih<span style=color:#555>=</span><span style=color:#069;font-weight:700>None</span>, who<span style=color:#555>=</span><span style=color:#069;font-weight:700>None</span>, name<span style=color:#555>=</span><span style=color:#069;font-weight:700>None</span>):
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>        self<span style=color:#555>.</span>x <span style=color:#555>=</span> uniform(settings[<span style=color:#c30>&#39;x_min&#39;</span>], settings[<span style=color:#c30>&#39;x_max&#39;</span>])  <span style=color:#09f;font-style:italic># position (x)</span>
</span></span><span style=display:flex><span>        self<span style=color:#555>.</span>y <span style=color:#555>=</span> uniform(settings[<span style=color:#c30>&#39;y_min&#39;</span>], settings[<span style=color:#c30>&#39;y_max&#39;</span>])  <span style=color:#09f;font-style:italic># position (y)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        self<span style=color:#555>.</span>r <span style=color:#555>=</span> uniform(<span style=color:#f60>0</span>,<span style=color:#f60>360</span>)                 <span style=color:#09f;font-style:italic># orientation   [0, 360]</span>
</span></span><span style=display:flex><span>        self<span style=color:#555>.</span>v <span style=color:#555>=</span> uniform(<span style=color:#f60>0</span>,settings[<span style=color:#c30>&#39;v_max&#39;</span>])   <span style=color:#09f;font-style:italic># velocity      [0, v_max]</span>
</span></span><span style=display:flex><span>        self<span style=color:#555>.</span>dv <span style=color:#555>=</span> uniform(<span style=color:#555>-</span>settings[<span style=color:#c30>&#39;dv_max&#39;</span>], settings[<span style=color:#c30>&#39;dv_max&#39;</span>])   <span style=color:#09f;font-style:italic># dv</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        self<span style=color:#555>.</span>d_food <span style=color:#555>=</span> <span style=color:#f60>100</span>   <span style=color:#09f;font-style:italic># distance to nearest food</span>
</span></span><span style=display:flex><span>        self<span style=color:#555>.</span>r_food <span style=color:#555>=</span> <span style=color:#f60>0</span>     <span style=color:#09f;font-style:italic># orientation to nearest food</span>
</span></span><span style=display:flex><span>        self<span style=color:#555>.</span>fitness <span style=color:#555>=</span> <span style=color:#f60>0</span>    <span style=color:#09f;font-style:italic># fitness (food count)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        self<span style=color:#555>.</span>wih <span style=color:#555>=</span> wih
</span></span><span style=display:flex><span>        self<span style=color:#555>.</span>who <span style=color:#555>=</span> who
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        self<span style=color:#555>.</span>name <span style=color:#555>=</span> name
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>    <span style=color:#09f;font-style:italic># NEURAL NETWORK</span>
</span></span><span style=display:flex><span>    <span style=color:#069;font-weight:700>def</span> <span style=color:#c0f>think</span>(self):
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#09f;font-style:italic># SIMPLE MLP</span>
</span></span><span style=display:flex><span>        af <span style=color:#555>=</span> <span style=color:#069;font-weight:700>lambda</span> x: np<span style=color:#555>.</span>tanh(x)               <span style=color:#09f;font-style:italic># activation function</span>
</span></span><span style=display:flex><span>        h1 <span style=color:#555>=</span> af(np<span style=color:#555>.</span>dot(self<span style=color:#555>.</span>wih, self<span style=color:#555>.</span>r_food))  <span style=color:#09f;font-style:italic># hidden layer</span>
</span></span><span style=display:flex><span>        out <span style=color:#555>=</span> af(np<span style=color:#555>.</span>dot(self<span style=color:#555>.</span>who, h1))          <span style=color:#09f;font-style:italic># output layer</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#09f;font-style:italic># UPDATE dv AND dr WITH MLP RESPONSE</span>
</span></span><span style=display:flex><span>        self<span style=color:#555>.</span>nn_dv <span style=color:#555>=</span> <span style=color:#366>float</span>(out[<span style=color:#f60>0</span>])   <span style=color:#09f;font-style:italic># [-1, 1]  (accelerate=1, deaccelerate=-1)</span>
</span></span><span style=display:flex><span>        self<span style=color:#555>.</span>nn_dr <span style=color:#555>=</span> <span style=color:#366>float</span>(out[<span style=color:#f60>1</span>])   <span style=color:#09f;font-style:italic># [-1, 1]  (left=1, right=-1)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>    <span style=color:#09f;font-style:italic># UPDATE HEADING</span>
</span></span><span style=display:flex><span>    <span style=color:#069;font-weight:700>def</span> <span style=color:#c0f>update_r</span>(self, settings):
</span></span><span style=display:flex><span>        self<span style=color:#555>.</span>r <span style=color:#555>+=</span> self<span style=color:#555>.</span>nn_dr <span style=color:#555>*</span> settings[<span style=color:#c30>&#39;dr_max&#39;</span>] <span style=color:#555>*</span> settings[<span style=color:#c30>&#39;dt&#39;</span>]
</span></span><span style=display:flex><span>        self<span style=color:#555>.</span>r <span style=color:#555>=</span> self<span style=color:#555>.</span>r <span style=color:#555>%</span> <span style=color:#f60>360</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>    <span style=color:#09f;font-style:italic># UPDATE VELOCITY</span>
</span></span><span style=display:flex><span>    <span style=color:#069;font-weight:700>def</span> <span style=color:#c0f>update_vel</span>(self, settings):
</span></span><span style=display:flex><span>        self<span style=color:#555>.</span>v <span style=color:#555>+=</span> self<span style=color:#555>.</span>nn_dv <span style=color:#555>*</span> settings[<span style=color:#c30>&#39;dv_max&#39;</span>] <span style=color:#555>*</span> settings[<span style=color:#c30>&#39;dt&#39;</span>]
</span></span><span style=display:flex><span>        <span style=color:#069;font-weight:700>if</span> self<span style=color:#555>.</span>v <span style=color:#555>&lt;</span> <span style=color:#f60>0</span>: self<span style=color:#555>.</span>v <span style=color:#555>=</span> <span style=color:#f60>0</span>
</span></span><span style=display:flex><span>        <span style=color:#069;font-weight:700>if</span> self<span style=color:#555>.</span>v <span style=color:#555>&gt;</span> settings[<span style=color:#c30>&#39;v_max&#39;</span>]: self<span style=color:#555>.</span>v <span style=color:#555>=</span> settings[<span style=color:#c30>&#39;v_max&#39;</span>]
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#09f;font-style:italic># UPDATE POSITION</span>
</span></span><span style=display:flex><span>    <span style=color:#069;font-weight:700>def</span> <span style=color:#c0f>update_pos</span>(self, settings):
</span></span><span style=display:flex><span>        dx <span style=color:#555>=</span> self<span style=color:#555>.</span>v <span style=color:#555>*</span> cos(radians(self<span style=color:#555>.</span>r)) <span style=color:#555>*</span> settings[<span style=color:#c30>&#39;dt&#39;</span>]
</span></span><span style=display:flex><span>        dy <span style=color:#555>=</span> self<span style=color:#555>.</span>v <span style=color:#555>*</span> sin(radians(self<span style=color:#555>.</span>r)) <span style=color:#555>*</span> settings[<span style=color:#c30>&#39;dt&#39;</span>]
</span></span><span style=display:flex><span>        self<span style=color:#555>.</span>x <span style=color:#555>+=</span> dx
</span></span><span style=display:flex><span>        self<span style=color:#555>.</span>y <span style=color:#555>+=</span> dy
</span></span></code></pre></div><h2>Food</h2><p>The only other class we need to create is the food class. This is a simple object that contains an x/y location and an energy value. This energy value will directly impact the organisms fitness. For now, this energy value remains constant and set at one, but it can be randomized or changed to anything if you feel like modifying it to. Additionally, a <i>respawn</i> function is present to regenerate the location of the food particle once it as been consumed by an organism. This keeps the total number of food particles within each simulation time step constant.</p><div class=highlight><pre tabindex=0 style=background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-py data-lang=py><span style=display:flex><span><span style=color:#069;font-weight:700>class</span> <span style=color:#0a8;font-weight:700>food</span>():
</span></span><span style=display:flex><span>    <span style=color:#069;font-weight:700>def</span> __init__(self, settings):
</span></span><span style=display:flex><span>        self<span style=color:#555>.</span>x <span style=color:#555>=</span> uniform(settings[<span style=color:#c30>&#39;x_min&#39;</span>], settings[<span style=color:#c30>&#39;x_max&#39;</span>])
</span></span><span style=display:flex><span>        self<span style=color:#555>.</span>y <span style=color:#555>=</span> uniform(settings[<span style=color:#c30>&#39;y_min&#39;</span>], settings[<span style=color:#c30>&#39;y_max&#39;</span>])
</span></span><span style=display:flex><span>        self<span style=color:#555>.</span>energy <span style=color:#555>=</span> <span style=color:#f60>1</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#069;font-weight:700>def</span> <span style=color:#c0f>respawn</span>(self,settings):
</span></span><span style=display:flex><span>        self<span style=color:#555>.</span>x <span style=color:#555>=</span> uniform(settings[<span style=color:#c30>&#39;x_min&#39;</span>], settings[<span style=color:#c30>&#39;x_max&#39;</span>])
</span></span><span style=display:flex><span>        self<span style=color:#555>.</span>y <span style=color:#555>=</span> uniform(settings[<span style=color:#c30>&#39;y_min&#39;</span>], settings[<span style=color:#c30>&#39;y_max&#39;</span>])
</span></span><span style=display:flex><span>        self<span style=color:#555>.</span>energy <span style=color:#555>=</span> <span style=color:#f60>1</span>
</span></span></code></pre></div><h2>Evolution</h2><p>The organism will be optimized using a <a target=_blank href=https://en.wikipedia.org/wiki/Genetic_algorithm>genetic algorithm</a> (GA) which falls under the larger umbrella of <a target=_blank href=https://en.wikipedia.org/wiki/Evolutionary_algorithm>evolutionaty algorithms</a> (EA). Genetic algorithms work by imitating the natural biological process of evolution by starting off with an initial population, and through <a target=_blank href=https://en.wikipedia.org/wiki/Selection_(genetic_algorithm)>selection</a>, <a target=_blank href=https://en.wikipedia.org/wiki/Crossover_(genetic_algorithm)>crossover</a>, and <a target=_blank href=https://en.wikipedia.org/wiki/Mutation_(genetic_algorithm)>mutation</a> over many generations, an optimal solution emerges. With that said, EAs are not numerically guaranteed to find the global optimum but given proper initial conditions they are exceptionally good at searching through the design space and finding optimal or near optimal solutions. For this tutorial, the EA scheme will be as follows:</p><ul class=ul-style-a style=list-style-type:none><li><p markdown=1><b>Selection</b> - The simplest form of selection is called <i>elitism</i>, this is where the top n% of the current generations fittest individuals are selected and carried over to the next generation.</p></li><li><p markdown=1><b>Crossover</b> - Using the same pool of individuals selected during the elitism step previously, pairs of individuals will be randomly selected as parents and a new offspring will be generated. Because we're dealing with the weights of the neural network, the following equation will be used to crossover traits between the two parents to the resulting offspring:<div class=math-block><span class=katex><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mi>o</mi><mi>f</mi><mi>f</mi><mi>s</mi><mi>p</mi><mi>r</mi><mi>i</mi><mi>n</mi><mi>g</mi><mo>=</mo><mi>p</mi><mi>a</mi><mi>r</mi><mi>e</mi><mi>n</mi><msub><mi>t</mi><mn>1</mn></msub><mo stretchy="false">(</mo><mi>a</mi><mo stretchy="false">)</mo><mo>+</mo><mi>p</mi><mi>a</mi><mi>r</mi><mi>e</mi><mi>n</mi><msub><mi>t</mi><mn>2</mn></msub><mo stretchy="false">(</mo><mn>1</mn><mo>−</mo><mi>a</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex"> offspring=parent_1(a) + parent_2(1-a) </annotation></semantics></math></span></div><p>Where <span class=katex><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>a</mi></mrow><annotation encoding="application/x-tex"> a </annotation></semantics></math></span> is a randomly generated value between zero and one, and <span class=katex><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>p</mi><mi>a</mi><mi>r</mi><mi>e</mi><mi>n</mi><msub><mi>t</mi><mn>1</mn></msub></mrow><annotation encoding="application/x-tex"> parent_1 </annotation></semantics></math></span>, and <span class=katex><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>p</mi><mi>a</mi><mi>r</mi><mi>e</mi><mi>n</mi><msub><mi>t</mi><mn>2</mn></msub></mrow><annotation encoding="application/x-tex"> parent_2 </annotation></semantics></math></span> represent the weights of the neural network. Because there are two matrices that are being blending together (wih and who), the implementation will actually be as follows:</p><div class=math-block><span class=katex><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mi>o</mi><mi>f</mi><mi>f</mi><mi>s</mi><mi>p</mi><mi>r</mi><mi>i</mi><mi>n</mi><mi>g</mi><mi mathvariant="normal">_</mi><mi>w</mi><mi>i</mi><mi>h</mi><mo>=</mo><mi>p</mi><mi>a</mi><mi>r</mi><mi>e</mi><mi>n</mi><mi>t</mi><mi mathvariant="normal">_</mi><mi>w</mi><mi>i</mi><msub><mi>h</mi><mn>1</mn></msub><mo stretchy="false">(</mo><mi>a</mi><mo stretchy="false">)</mo><mo>+</mo><mi>p</mi><mi>a</mi><mi>r</mi><mi>e</mi><mi>n</mi><mi>t</mi><mi mathvariant="normal">_</mi><mi>w</mi><mi>i</mi><msub><mi>h</mi><mn>2</mn></msub><mo stretchy="false">(</mo><mn>1</mn><mo>−</mo><mi>a</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex"> offspring\_wih=parent\_wih_1(a) + parent\_wih_2(1-a) </annotation></semantics></math></span></div><div class=math-block><span class=katex><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mi>o</mi><mi>f</mi><mi>f</mi><mi>s</mi><mi>p</mi><mi>r</mi><mi>i</mi><mi>n</mi><mi>g</mi><mi mathvariant="normal">_</mi><mi>w</mi><mi>h</mi><mi>o</mi><mo>=</mo><mi>p</mi><mi>a</mi><mi>r</mi><mi>e</mi><mi>n</mi><mi>t</mi><mi mathvariant="normal">_</mi><mi>w</mi><mi>h</mi><msub><mi>o</mi><mn>1</mn></msub><mo stretchy="false">(</mo><mi>a</mi><mo stretchy="false">)</mo><mo>+</mo><mi>p</mi><mi>a</mi><mi>r</mi><mi>e</mi><mi>n</mi><mi>t</mi><mi mathvariant="normal">_</mi><mi>w</mi><mi>h</mi><msub><mi>o</mi><mn>2</mn></msub><mo stretchy="false">(</mo><mn>1</mn><mo>−</mo><mi>a</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex"> offspring\_who=parent\_who_1(a) + parent\_who_2(1-a) </annotation></semantics></math></span></div></p></br></li><li><p markdown=1><b>Mutation</b> - Lastly, once the new offspring has been generated, a random number between zero and one will be generated. If this value is below the user initialized mutation threshold, mutation will occur. In the event that mutation does occur, a random weight from one of the two neural network weight matrices will be replaced with a random value that is within +/- 10% of the original value. This will create just a slight variation within the organism that could potentially lead to a fitter organism. The mutation effect is limited to +/- 10% of the original value because we want to avoid causing catastrophic failure within the neural network and potentially paralyzing the organism.</p></li></ul><p>The diagram below shows just how simple this EA scheme is.</p><center><fig><img alt="organism evolution" title="organism evolution" src=organism-evolution.png></fig></center><p>And finally, the codified EA routine can be seen below:</p><div class=highlight><pre tabindex=0 style=background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-py data-lang=py><span style=display:flex><span><span style=color:#069;font-weight:700>def</span> <span style=color:#c0f>evolve</span>(settings, organisms_old, gen):
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    elitism_num <span style=color:#555>=</span> <span style=color:#366>int</span>(floor(settings[<span style=color:#c30>&#39;elitism&#39;</span>] <span style=color:#555>*</span> settings[<span style=color:#c30>&#39;pop_size&#39;</span>]))
</span></span><span style=display:flex><span>    new_orgs <span style=color:#555>=</span> settings[<span style=color:#c30>&#39;pop_size&#39;</span>] <span style=color:#555>-</span> elitism_num
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#09f;font-style:italic>#--- GET STATS FROM CURRENT GENERATION ----------------+</span>
</span></span><span style=display:flex><span>    stats <span style=color:#555>=</span> defaultdict(<span style=color:#366>int</span>)
</span></span><span style=display:flex><span>    <span style=color:#069;font-weight:700>for</span> org <span style=color:#000;font-weight:700>in</span> organisms_old:
</span></span><span style=display:flex><span>        <span style=color:#069;font-weight:700>if</span> org<span style=color:#555>.</span>fitness <span style=color:#555>&gt;</span> stats[<span style=color:#c30>&#39;BEST&#39;</span>] <span style=color:#000;font-weight:700>or</span> stats[<span style=color:#c30>&#39;BEST&#39;</span>] <span style=color:#555>==</span> <span style=color:#f60>0</span>:
</span></span><span style=display:flex><span>            stats[<span style=color:#c30>&#39;BEST&#39;</span>] <span style=color:#555>=</span> org<span style=color:#555>.</span>fitness
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#069;font-weight:700>if</span> org<span style=color:#555>.</span>fitness <span style=color:#555>&lt;</span> stats[<span style=color:#c30>&#39;WORST&#39;</span>] <span style=color:#000;font-weight:700>or</span> stats[<span style=color:#c30>&#39;WORST&#39;</span>] <span style=color:#555>==</span> <span style=color:#f60>0</span>:
</span></span><span style=display:flex><span>            stats[<span style=color:#c30>&#39;WORST&#39;</span>] <span style=color:#555>=</span> org<span style=color:#555>.</span>fitness
</span></span><span style=display:flex><span>            
</span></span><span style=display:flex><span>        stats[<span style=color:#c30>&#39;SUM&#39;</span>] <span style=color:#555>+=</span> org<span style=color:#555>.</span>fitness
</span></span><span style=display:flex><span>        stats[<span style=color:#c30>&#39;COUNT&#39;</span>] <span style=color:#555>+=</span> <span style=color:#f60>1</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    stats[<span style=color:#c30>&#39;AVG&#39;</span>] <span style=color:#555>=</span> stats[<span style=color:#c30>&#39;SUM&#39;</span>] <span style=color:#555>/</span> stats[<span style=color:#c30>&#39;COUNT&#39;</span>]
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#09f;font-style:italic>#--- ELITISM (KEEP BEST PERFORMING ORGANISMS) ---------+</span>
</span></span><span style=display:flex><span>    orgs_sorted <span style=color:#555>=</span> <span style=color:#366>sorted</span>(organisms_old, key<span style=color:#555>=</span>operator<span style=color:#555>.</span>attrgetter(<span style=color:#c30>&#39;fitness&#39;</span>), reverse<span style=color:#555>=</span><span style=color:#069;font-weight:700>True</span>)
</span></span><span style=display:flex><span>    organisms_new <span style=color:#555>=</span> []
</span></span><span style=display:flex><span>    <span style=color:#069;font-weight:700>for</span> i <span style=color:#000;font-weight:700>in</span> <span style=color:#366>range</span>(<span style=color:#f60>0</span>, elitism_num):
</span></span><span style=display:flex><span>        organisms_new<span style=color:#555>.</span>append(organism(settings, wih<span style=color:#555>=</span>orgs_sorted[i]<span style=color:#555>.</span>wih, who<span style=color:#555>=</span>orgs_sorted[i]<span style=color:#555>.</span>who, name<span style=color:#555>=</span>orgs_sorted[i]<span style=color:#555>.</span>name))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#09f;font-style:italic>#--- GENERATE NEW ORGANISMS ---------------------------+</span>
</span></span><span style=display:flex><span>    <span style=color:#069;font-weight:700>for</span> w <span style=color:#000;font-weight:700>in</span> <span style=color:#366>range</span>(<span style=color:#f60>0</span>, new_orgs):
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#09f;font-style:italic># SELECTION (TRUNCATION SELECTION)</span>
</span></span><span style=display:flex><span>        canidates <span style=color:#555>=</span> <span style=color:#366>range</span>(<span style=color:#f60>0</span>, elitism_num)
</span></span><span style=display:flex><span>        random_index <span style=color:#555>=</span> sample(canidates, <span style=color:#f60>2</span>)
</span></span><span style=display:flex><span>        org_1 <span style=color:#555>=</span> orgs_sorted[random_index[<span style=color:#f60>0</span>]]
</span></span><span style=display:flex><span>        org_2 <span style=color:#555>=</span> orgs_sorted[random_index[<span style=color:#f60>1</span>]]
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#09f;font-style:italic># CROSSOVER</span>
</span></span><span style=display:flex><span>        crossover_weight <span style=color:#555>=</span> random()
</span></span><span style=display:flex><span>        wih_new <span style=color:#555>=</span> (crossover_weight <span style=color:#555>*</span> org_1<span style=color:#555>.</span>wih) <span style=color:#555>+</span> ((<span style=color:#f60>1</span> <span style=color:#555>-</span> crossover_weight) <span style=color:#555>*</span> org_2<span style=color:#555>.</span>wih)
</span></span><span style=display:flex><span>        who_new <span style=color:#555>=</span> (crossover_weight <span style=color:#555>*</span> org_1<span style=color:#555>.</span>who) <span style=color:#555>+</span> ((<span style=color:#f60>1</span> <span style=color:#555>-</span> crossover_weight) <span style=color:#555>*</span> org_2<span style=color:#555>.</span>who)
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>        <span style=color:#09f;font-style:italic># MUTATION</span>
</span></span><span style=display:flex><span>        mutate <span style=color:#555>=</span> random()
</span></span><span style=display:flex><span>        <span style=color:#069;font-weight:700>if</span> mutate <span style=color:#555>&lt;=</span> settings[<span style=color:#c30>&#39;mutate&#39;</span>]:
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>            <span style=color:#09f;font-style:italic># PICK WHICH WEIGHT MATRIX TO MUTATE</span>
</span></span><span style=display:flex><span>            mat_pick <span style=color:#555>=</span> randint(<span style=color:#f60>0</span>,<span style=color:#f60>1</span>)     
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>            <span style=color:#09f;font-style:italic># MUTATE: WIH WEIGHTS</span>
</span></span><span style=display:flex><span>            <span style=color:#069;font-weight:700>if</span> mat_pick <span style=color:#555>==</span> <span style=color:#f60>0</span>:
</span></span><span style=display:flex><span>                index_row <span style=color:#555>=</span> randint(<span style=color:#f60>0</span>,settings[<span style=color:#c30>&#39;hnodes&#39;</span>]<span style=color:#555>-</span><span style=color:#f60>1</span>)
</span></span><span style=display:flex><span>                wih_new[index_row] <span style=color:#555>=</span> wih_new[index_row] <span style=color:#555>*</span> uniform(<span style=color:#f60>0.9</span>, <span style=color:#f60>1.1</span>)
</span></span><span style=display:flex><span>                <span style=color:#069;font-weight:700>if</span> wih_new[index_row] <span style=color:#555>&gt;</span>  <span style=color:#f60>1</span>: wih_new[index_row] <span style=color:#555>=</span> <span style=color:#f60>1</span>
</span></span><span style=display:flex><span>                <span style=color:#069;font-weight:700>if</span> wih_new[index_row] <span style=color:#555>&lt;</span> <span style=color:#555>-</span><span style=color:#f60>1</span>: wih_new[index_row] <span style=color:#555>=</span> <span style=color:#555>-</span><span style=color:#f60>1</span>
</span></span><span style=display:flex><span>                
</span></span><span style=display:flex><span>            <span style=color:#09f;font-style:italic># MUTATE: WHO WEIGHTS</span>
</span></span><span style=display:flex><span>            <span style=color:#069;font-weight:700>if</span> mat_pick <span style=color:#555>==</span> <span style=color:#f60>1</span>:
</span></span><span style=display:flex><span>                index_row <span style=color:#555>=</span> randint(<span style=color:#f60>0</span>,settings[<span style=color:#c30>&#39;onodes&#39;</span>]<span style=color:#555>-</span><span style=color:#f60>1</span>)
</span></span><span style=display:flex><span>                index_col <span style=color:#555>=</span> randint(<span style=color:#f60>0</span>,settings[<span style=color:#c30>&#39;hnodes&#39;</span>]<span style=color:#555>-</span><span style=color:#f60>1</span>)
</span></span><span style=display:flex><span>                who_new[index_row][index_col] <span style=color:#555>=</span> who_new[index_row][index_col] <span style=color:#555>*</span> uniform(<span style=color:#f60>0.9</span>, <span style=color:#f60>1.1</span>)
</span></span><span style=display:flex><span>                <span style=color:#069;font-weight:700>if</span> who_new[index_row][index_col] <span style=color:#555>&gt;</span>  <span style=color:#f60>1</span>: who_new[index_row][index_col] <span style=color:#555>=</span> <span style=color:#f60>1</span>
</span></span><span style=display:flex><span>                <span style=color:#069;font-weight:700>if</span> who_new[index_row][index_col] <span style=color:#555>&lt;</span> <span style=color:#555>-</span><span style=color:#f60>1</span>: who_new[index_row][index_col] <span style=color:#555>=</span> <span style=color:#555>-</span><span style=color:#f60>1</span>
</span></span><span style=display:flex><span>                    
</span></span><span style=display:flex><span>        organisms_new<span style=color:#555>.</span>append(organism(settings, wih<span style=color:#555>=</span>wih_new, who<span style=color:#555>=</span>who_new, name<span style=color:#555>=</span><span style=color:#c30>&#39;gen[&#39;</span><span style=color:#555>+</span><span style=color:#366>str</span>(gen)<span style=color:#555>+</span><span style=color:#c30>&#39;]-org[&#39;</span><span style=color:#555>+</span><span style=color:#366>str</span>(w)<span style=color:#555>+</span><span style=color:#c30>&#39;]&#39;</span>))
</span></span><span style=display:flex><span>                
</span></span><span style=display:flex><span>    <span style=color:#069;font-weight:700>return</span> organisms_new, stats
</span></span></code></pre></div><h2>Simulation</h2><p>The last critical piece of coding that&rsquo;s needed is something to actually run the simulation. This <i>simulate</i> function will effectively represent the <a target=_blank href=https://en.wikipedia.org/wiki/Loss_function>cost function</a> for our optimization problem and will be called once every generation. The duration of each simulation is determined by dividing the total simulation time <i>gen_time</i> (in seconds) by the duration of the time step; <i>dt</i>. As an example, if the simulation length is set at 100 seconds, and <i>dt</i> is equal to 1/25th of a second, then there will be a total of 2500 timesteps that need to be simulated. During each time step, several key values will be updated:</p><ul class=ul-style-a style=list-style-type:none><li><p markdown=1><b>Collision detection</b> - Here we are checking for collisions between organisms and food particles. When a collision is detected, that organism will get its fitness function updated and the food particle will respawn at a new random location.</p></li><li><p markdown=1><b>Determine closest food particle</b> - This one is fairly self explanitory. For every organism, the closest food particle must be determined.</p></li><li><p markdown=1><b>Determine direction to nearest food particle</b> - Once the nearest food particle has been determined for each organism, the direction to that particle must be calculated.</p></li><li><p markdown=1><b>Query neural network</b> - Using the updated (and normalized) direction value, the neural network in each organism is quaried.</p></li><li><p markdown=1><b>Update organism</b> - Based on the respone from the neural network, the heading, velocity, and position are all updated.</p></li></ul><p>Below is the simulation function:</p><div class=highlight><pre tabindex=0 style=background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-py data-lang=py><span style=display:flex><span><span style=color:#069;font-weight:700>def</span> <span style=color:#c0f>simulate</span>(settings, organisms, foods, gen):
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    total_time_steps <span style=color:#555>=</span> <span style=color:#366>int</span>(settings[<span style=color:#c30>&#39;gen_time&#39;</span>] <span style=color:#555>/</span> settings[<span style=color:#c30>&#39;dt&#39;</span>])
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#09f;font-style:italic>#--- CYCLE THROUGH EACH TIME STEP ---------------------+</span>
</span></span><span style=display:flex><span>    <span style=color:#069;font-weight:700>for</span> t_step <span style=color:#000;font-weight:700>in</span> <span style=color:#366>range</span>(<span style=color:#f60>0</span>, total_time_steps, <span style=color:#f60>1</span>):
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#09f;font-style:italic># PLOT SIMULATION FRAME</span>
</span></span><span style=display:flex><span>        <span style=color:#09f;font-style:italic>#if gen == settings[&#39;gens&#39;] - 1 and settings[&#39;plot&#39;]==True:</span>
</span></span><span style=display:flex><span>        <span style=color:#069;font-weight:700>if</span> gen<span style=color:#555>==</span><span style=color:#f60>49</span>:
</span></span><span style=display:flex><span>            plot_frame(settings, organisms, foods, gen, t_step)
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#09f;font-style:italic># UPDATE FITNESS FUNCTION</span>
</span></span><span style=display:flex><span>        <span style=color:#069;font-weight:700>for</span> food <span style=color:#000;font-weight:700>in</span> foods:
</span></span><span style=display:flex><span>            <span style=color:#069;font-weight:700>for</span> org <span style=color:#000;font-weight:700>in</span> organisms:
</span></span><span style=display:flex><span>                food_org_dist <span style=color:#555>=</span> dist(org<span style=color:#555>.</span>x, org<span style=color:#555>.</span>y, food<span style=color:#555>.</span>x, food<span style=color:#555>.</span>y)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>                <span style=color:#09f;font-style:italic># UPDATE FITNESS FUNCTION</span>
</span></span><span style=display:flex><span>                <span style=color:#069;font-weight:700>if</span> food_org_dist <span style=color:#555>&lt;=</span> <span style=color:#f60>0.075</span>:
</span></span><span style=display:flex><span>                    org<span style=color:#555>.</span>fitness <span style=color:#555>+=</span> food<span style=color:#555>.</span>energy
</span></span><span style=display:flex><span>                    food<span style=color:#555>.</span>respawn(settings)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>                <span style=color:#09f;font-style:italic># RESET DISTANCE AND HEADING TO NEAREST FOOD SOURCE</span>
</span></span><span style=display:flex><span>                org<span style=color:#555>.</span>d_food <span style=color:#555>=</span> <span style=color:#f60>100</span>
</span></span><span style=display:flex><span>                org<span style=color:#555>.</span>r_food <span style=color:#555>=</span> <span style=color:#f60>0</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#09f;font-style:italic># CALCULATE HEADING TO NEAREST FOOD SOURCE</span>
</span></span><span style=display:flex><span>        <span style=color:#069;font-weight:700>for</span> food <span style=color:#000;font-weight:700>in</span> foods:
</span></span><span style=display:flex><span>            <span style=color:#069;font-weight:700>for</span> org <span style=color:#000;font-weight:700>in</span> organisms:
</span></span><span style=display:flex><span>                
</span></span><span style=display:flex><span>                <span style=color:#09f;font-style:italic># CALCULATE DISTANCE TO SELECTED FOOD PARTICLE</span>
</span></span><span style=display:flex><span>                food_org_dist <span style=color:#555>=</span> dist(org<span style=color:#555>.</span>x, org<span style=color:#555>.</span>y, food<span style=color:#555>.</span>x, food<span style=color:#555>.</span>y)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>                <span style=color:#09f;font-style:italic># DETERMINE IF THIS IS THE CLOSEST FOOD PARTICLE</span>
</span></span><span style=display:flex><span>                <span style=color:#069;font-weight:700>if</span> food_org_dist <span style=color:#555>&lt;</span> org<span style=color:#555>.</span>d_food:
</span></span><span style=display:flex><span>                    org<span style=color:#555>.</span>d_food <span style=color:#555>=</span> food_org_dist
</span></span><span style=display:flex><span>                    org<span style=color:#555>.</span>r_food <span style=color:#555>=</span> calc_heading(org, food)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#09f;font-style:italic># GET ORGANISM RESPONSE</span>
</span></span><span style=display:flex><span>        <span style=color:#069;font-weight:700>for</span> org <span style=color:#000;font-weight:700>in</span> organisms:
</span></span><span style=display:flex><span>            org<span style=color:#555>.</span>think()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#09f;font-style:italic># UPDATE ORGANISMS POSITION AND VELOCITY</span>
</span></span><span style=display:flex><span>        <span style=color:#069;font-weight:700>for</span> org <span style=color:#000;font-weight:700>in</span> organisms:
</span></span><span style=display:flex><span>            org<span style=color:#555>.</span>update_r(settings)
</span></span><span style=display:flex><span>            org<span style=color:#555>.</span>update_vel(settings)
</span></span><span style=display:flex><span>            org<span style=color:#555>.</span>update_pos(settings)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#069;font-weight:700>return</span> organisms
</span></span></code></pre></div><h2>Putting it All Together</h2><p>With all the major components having been created the final code can now be assembled. There are a few smaller functions I neglected to include in the above writeup because they&rsquo;re so simple reading about them would take longer than just reading the code directly. I ended up using <a target=_blank href=https://matplotlib.org/>matplotlib</a> for displaying the simulation. This is far from the most efficient or elligant solution so by default the visualization is turned off. Lastly, pasting the entire code would be a bit redundent at this point so download/fork it from the GitHub repo (<a target=_blank href=https://github.com/nathanrooy/evolving-simple-organisms/blob/master/organism_v1.py>here</a>).</p><h2 id=results>Results</h2><p>When you run the entire code, the output should be something similar to this:</p><center><fig><img src=results.gif></fig></center><p>I hope this was helpful. If anything seems unclear, please let me know. Thanks for reading!</p></div></div></body></html>