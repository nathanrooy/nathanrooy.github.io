<!doctype html><html lang=en><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge,chrome=1"><meta name=author content="Nathan Rooy"><meta name=copyright content="Nathan A. Rooy"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=language content="en"><meta http-equiv=content-language content="en-gb"><link rel=icon type=image/png href=/favicon/favicon.png><meta name=google-site-verification content="vQ6uvoBDOPVq7u67m2fO8RWaxcqsoLrLzmR7CzEo-0k"><meta name=msvalidate.01 content="4903EB9C7ABD70347352DCFAEE0751F5"><script defer data-domain=nathanrooy.github.io src=https://plausible.io/js/plausible.js></script><script>window.plausible=window.plausible||function(){(window.plausible.q=window.plausible.q||[]).push(arguments)}</script><title>A Low Cost Approach to Improving Pedestrian Safety with Deep Learning</title><link rel=canonical href=https://nathanrooy.github.io/posts/2019-02-06/raspberry-pi-deep-learning-traffic-tracker/ itemprop=url><base href=https://nathanrooy.github.io/posts/2019-02-06/raspberry-pi-deep-learning-traffic-tracker/><meta itemprop=name content="A Low Cost Approach to Improving Pedestrian Safety with Deep Learning | Nathan Rooy"><meta itemprop=description content="A Low Cost Approach to Improving Pedestrian Safety with Deep Learning"><meta name=description content="A Low Cost Approach to Improving Pedestrian Safety with Deep Learning"><meta name=application-name content="A Low Cost Approach to Improving Pedestrian Safety with Deep Learning | Nathan Rooy"><meta name=twitter:card content="nathanrooy.github.io"><meta name=twitter:url content="https://nathanrooy.github.io/posts/2019-02-06/raspberry-pi-deep-learning-traffic-tracker/"><meta name=twitter:title content="A Low Cost Approach to Improving Pedestrian Safety with Deep Learning | Nathan Rooy"><meta name=twitter:description content="A Low Cost Approach to Improving Pedestrian Safety with Deep Learning"><meta property="og:title" content="A Low Cost Approach to Improving Pedestrian Safety with Deep Learning"><meta property="og:description" content="A Low Cost Approach to Improving Pedestrian Safety with Deep Learning"><meta property="og:locale" content="en_US"><meta property="og:type" content="article"><meta property="og:url" content="https://nathanrooy.github.io/posts/2019-02-06/raspberry-pi-deep-learning-traffic-tracker/"><meta property="og:site_name" content="nathanrooy.github.io"><meta itemprop=image content="https://nathanrooy.github.io/about/DSC_3706-EDIT-BLOG-TINY.jpg"><meta property="og:image" content="https://nathanrooy.github.io/about/DSC_3706-EDIT-BLOG-TINY.jpg"><meta name=twitter:image content="https://nathanrooy.github.io/about/DSC_3706-EDIT-BLOG-TINY.jpg"><meta name=twitter:image:src content="https://nathanrooy.github.io/about/DSC_3706-EDIT-BLOG-TINY.jpg"><link rel=alternate type=application/rss+xml href=https://nathanrooy.github.io/index.xml title="Nathan Rooy"><link rel=stylesheet type=text/css media=screen href=https://nathanrooy.github.io/css/normalize.min.02d927c3d7aee93f4557abffff0169f2c90a749e49700a80350d5b3f2911e20a.css><link rel=stylesheet type=text/css media=screen href=https://nathanrooy.github.io/css/main.min.28590d77fcf8edfaea8082f132f87af763131ef18bd51aa844bbdcb4f49ba7c6.css></head><body><div class="container wrapper post"><div class=post-header><h1 class=title>A Low Cost Approach to Improving Pedestrian Safety with Deep Learning</h1><div class=meta><a href=/>Nathan Rooy</a> | April 17, 2018</div></div><p class=TLDR><strong>TL;DR</strong> - Using TensorFlow and a Raspberry Pi, I developed a cheap and accurate way of counting both pedestrians and vehicle traffic.</p><div class=markdown><div class=post-title-hr><hr style=width:100%;display:inline-block></div><style>.plot_style line{stroke:grey}.plot_style path{stroke:grey}.plot_style text{fill:grey;font-size:1em;font-family:open sans;font-style:normal;font-weight:300}</style><p class=post-update><b>POST UPDATE</b>: Since posting this, I've received a considerable amount of interest from individuals and local city governments from across the U.S. looking to get a better grasp on pedestrian data. Because of this, I spent some time building out a better algorithm and packaging it for easy use. I'm terrible with names, so for now it's simply "urban mobility tracker". If you can think of a better name, please let me know! Additionally, to generate detections for the urban-mobility-tracker, I performed a full model retraining of MobileNetV1 SSD using data I collected and annotated. I'm calling this new pedestrian/vehicle/bicyclist optimized object detector "PedNet". As time goes on and more people use these two tools, I'm hoping that people will contribute more training data (especially in adverse lighting and weather conditions) so that PedNet can be retrained and improved. Lastly, this new version continues to use TensorFlow but with the addition of the <a target=_blank href=https://coral.ai/products/accelerator/>Coral USB accelerator</a> which leverages Google's TPU technology so now it achieves an update frequency of ~10Hz!!! (old version was ~2Hz)<br><br>GitHub links:<br>• Urban-Mobility-Tracker [<a target=_blank href=https://github.com/nathanrooy/rpi-urban-mobility-tracker>here</a>]<br>• PedNet [<a target=_blank href=https://github.com/nathanrooy/ped-net>here</a>]</p><h2>Introduction</h2><p>As someone who <a target=_blank href=../../2018-01-11/one-year-of-bike-commuting/>bikes to work everyday</a>, I&rsquo;m acutely aware of how important good urban design and planning is and its impact on pedestrian safety as well as the overall well-being of a neighborhood. I&rsquo;m also aware of how difficult it is to convince car dependent, suburban commuters that we need to invest our money into bike lanes and <a target=_blank href=https://en.wikipedia.org/wiki/Curb_extension>curb extensions</a> rather than lane extensions and parking lots. Because of this, I&rsquo;m always a bit bummed when I see unfounded internet shouting matches over why the city should/should not implement bike and pedestrian safety measures. We should let the data decide what happens, not ideology or personal bias. Unfortunately, it&rsquo;s this data that&rsquo;s hard to come by.</p><p>I remember when shortly after the <a target=_blank href=https://www.cincinnati-oh.gov/bikes/news/central-parkway-bikeway/>bike lanes on Central Pkwy</a> were installed, they were looking for volunteers to stand out in the baking sun all day and manually count cyclists as they rode by. This struck me as comically old-fashioned but also a bit sad because this was apparently the only way to get the data at the time. Fast forward almost five years and the situation appears to not have improved much. Below is a picture I took recently of some pneumatic tubes used to count traffic.</p><img alt="pneumatic tube traffic counter" title="pneumatic tube traffic counter" src=pneumatic-tubes.jpg>
<center class=figcaption>Figure 1: Pneumatic tube based traffic counting</center><p>These are great for temporarily counting cars and other large vehicles. Counting bikes, and pedestrians, not so much&mldr; When I rode over them that morning on my bike, I was indistinguishable from a motorcycle. I&rsquo;m an invisible cyclist, so why should the city prioritize this road for a bike lane? Additionally, this setup was in place for less than a day because those tubes are held in place using nails pounded into the road surface and reinforced with a couple strips of Kentucky chrome. Definitely not ideal.</p><center><table style=width:400px><thead><tr><th style=text-align:left;padding-left:1em><strong>System</strong></th><th style=text-align:center><strong>Type</strong></th><th style=text-align:center><strong>Cost</strong></th></tr></thead><tbody><tr><td style=text-align:left;padding-left:1em>SenSource</td><td style=text-align:center>pneumatic</td><td style=text-align:center>$695</td></tr><tr><td style=text-align:left;padding-left:1em>RoadPod</td><td style=text-align:center>pneumatic</td><td style=text-align:center>$1,150</td></tr><tr><td style=text-align:left;padding-left:1em>JAMAR TRAX I Plus</td><td style=text-align:center>pneumatic</td><td style=text-align:center>$2,600</td></tr><tr><td style=text-align:left;padding-left:1em>Wavetronix SmartSensor HD</td><td style=text-align:center>radar</td><td style=text-align:center>$6,700</td></tr><tr><td style=text-align:left;padding-left:1em>Miovision Technologies VCU</td><td style=text-align:center>video</td><td style=text-align:center>$3,700</td></tr></tbody></table></center><center class=figcaption>Table 1: Selection of traffic counting systems</center><p>Although other counting systems exist, they tend to be overly expensive, invasive, and unable to simultaneously count both pedestrians and vehicle traffic.<sup id=fnref:1><a href=#fn:1 class=footnote-ref role=doc-noteref>1</a></sup> Cincinnati is full of bikers, I see them every day. But if they&rsquo;re not being counted, we&rsquo;ll never be able to overcome the suburban bias in Cincinnati&rsquo;s urban design and planning. With a better counting system in place we can get the necessary data to make informed decisions that reflect reality, resulting in a fairer and more equitable city. If only there was a low-cost, non-invasive solution that could passively count all types of traffic simultaneously in any weather condition 24/7/365 and seamlessly push that information to the cloud on a minute by minute basis&mldr;</p><h2>My Solution</h2><p>After thinking about this for a while, I decided that I could probably do a better job than what currently exists. Given that low-cost and high accuracy are my two primary goals, I went with a <a target=_blank href=https://en.wikipedia.org/wiki/Raspberry_Pi>Raspberry Pi Zero</a> which is the smallest/cheapest of the Raspberry Pi models with the 8-megapixel v2 NoIR (infrared) camera and a rechargeable usb battery pack. Since my system is vision based it needs a clear line of sight to the street but also somehow remain hidden from people who might tamper with it. Given these two contradictory constraints of being hidden yet visible, I went with a stealth approach. This was accomplished by buying a plastic weatherproof electrical box and cutting a hole on the front for the camera. The camera hole was sealed with a clear lens filter. Lastly, I mounted six stupidly strong <a target=_blank href=https://en.wikipedia.org/wiki/Neodymium_magnet>neodymium magnets</a> on the back so I could attach it to street lights, sign posts, etc.</p><img alt="deep learning raspberry pi traffic tracker" title="deep learning raspberry pi traffic tracker" src=traffic-tracker-close-up.jpg>
<center class=figcaption>Figure 2: My deep learning, raspberry pi based traffic tracker</center><p>To actually count pedestrians and vehicle traffic I built out a <a target=_blank href=https://en.wikipedia.org/wiki/Convolutional_neural_network>convolutional neural network</a> (CNN) with a secondary region proposal network (R-CNN) using <a target=_blank href=https://www.tensorflow.org/>TensorFlow</a> and <a target=_blank href=https://www.python.org/>Python</a>. This allows for both the detection and localization of objects within the frame. Actual object tracking was accomplished using a light weight temporal clustering scheme using <a target=_blank href=http://www.numpy.org/>NumPy</a> and <a target=_blank href=http://scikit-learn.org>scikit-learn</a>. For a more in-depth look, click [<a href=#technical-notes>here</a>] to read the technical notes section.</p><img alt="deep learning raspberry pi traffic tracker in the wild" title="deep learning raspberry pi traffic tracker in the wild" src=in-the-field-03.jpg>
<center class=figcaption>Figure 3: Hidden in plain sight - my baby out in the wild!</center><p>After a week or so of casual coding I had a finished system. Given that the tracking algorithm is built on top of open-source software, the only costs associated with this system arise from the hardware side.</p><center><table style=width:250px><thead><tr><th style=text-align:left;padding-left:1em><strong>Item</strong></th><th style=text-align:center;padding-right:.5em><strong>Cost</strong></th></tr></thead><tbody><tr><td style=text-align:left;padding-left:1em>Raspberry Pi Zero</td><td style=text-align:center;padding-right:.5em>$10</td></tr><tr><td style=text-align:left;padding-left:1em>Plastic electrical box</td><td style=text-align:center;padding-right:.5em>$14</td></tr><tr><td style=text-align:left;padding-left:1em>Magnets</td><td style=text-align:center;padding-right:.5em>$18</td></tr><tr><td style=text-align:left;padding-left:1em>128GB usb storage</td><td style=text-align:center;padding-right:.5em>$28</td></tr><tr><td style=text-align:left;padding-left:1em>USB Battery pack</td><td style=text-align:center;padding-right:.5em>$40</td></tr><tr><td style=text-align:right><strong>Total</strong></td><td style=text-align:center;color:red;padding-right:.5em><strong>$110</strong></td></tr></tbody></table></center><center class=figcaption>Table 2: Cost breakdown of my Raspberry Pi based system</center><p>As an example of what all this looks like in action, below is a gif showing the tracking algorithm when it was placed at random spots throughout Cincinnati.</p><img alt="deep learning raspberry pi traffic tracker in the wild" title="deep learning raspberry pi traffic tracker in the wild" src=traffic-tracker.gif>
<center class=figcaption>Figure 4: Tracking traffic</center><h2>Results</h2><p>To test my system out, I placed it at few areas throughout the city. I started out by leaving it out in the field for 24 hours at a time. After I got comfortable with its performance I extended that duration to a full week (usually Sunday night to Sunday night).</p><img src=central-pkwy-location-90.jpg>
<center class=figcaption>Figure 5: Central Pkwy location</center><p>As an example of the data that this system produces, below are the results for when it was placed on the Colerain Ave. bridge right as it passes over Central Pkwy during August 23, 2018.</p><div id=plot_3></div><center class=figcaption>Figure 6: Vehicle counts on Central Pkwy</center><p>Because the system generates a time stamp for each object as it passes over an imaginary “start/finish”, I binned all these data points into five-minute blocks. Additionally, even though vehicle traffic can be further broken down by vehicle type, it was easier to just group all vehicles into a single class. Above in figure 6, we can see the influx of southbound commuters coming into the city during the morning rush as well as when they leave in the evening rush headed north. Vehicle traffic peaked at 88 northbound vehicles per five minutes around 5:20pm. The day ended up with a total of 6982 southbound and 7092 northbound vehicles travelling on this particular segment of Central Pkwy.</p><div id=plot_1></div><center class=figcaption>Figure 7: Bicycle counts on Central Pkwy</center><p>Because the frequency of bicycle and pedestrian traffic was so much smaller relative to vehicle traffic, it was easier to display this data from a cumulative perspective. Above in figure 7, the bicycle count on Central Pkwy can be seen. Even with the cumulative form, we can see a large amount of growth during the southbound morning rush into the city, but compared to vehicle traffic, the evening bicycle rush is more diffused. Total bicycle traffic for the day capped out at 56 and 57 for the northbound and southbound directions respectively.</p><div id=plot_2></div><center class=figcaption>Figure 8: Pedestrian counts on Central Pkwy</center><p>Lastly, the pedestrian traffic can be seen above in figure 8. Unlike both vehicle and bicycle traffic, pedestrian traffic on Central Pkwy doesn’t have large spikes during the morning / evening rushes. Instead, pedestrian traffic is diffused fairly evenly throughout the entire day.</p><script src=https://d3js.org/d3.v4.min.js></script><script>var margin={top:50,right:20,bottom:30,left:25},width=650-margin.left-margin.right,height=300-margin.top-margin.bottom,parseTime=d3.timeParse("%Y-%m-%d %H:%M:%S"),x=d3.scaleTime().range([0,width]),y=d3.scaleLinear().range([height,0]),svg_1=d3.select("#plot_1").append("svg").attr("width",width+margin.left+margin.right).attr("height",height+margin.top+margin.bottom).append("g").attr("transform","translate("+margin.left+","+margin.top+")"),valueline1=d3.line().curve(d3.curveStepBefore).x(function(a){return x(a.TIME)}).y(function(a){return y(a.BIKE_S_CUM)}),valueline2=d3.line().curve(d3.curveStepBefore).x(function(a){return x(a.TIME)}).y(function(a){return y(a.BIKE_N_CUM)}),svg_2,valueline3,valueline4,svg_3,valueline5,valueline6;d3.csv("counts_b.csv",function(b,a){if(b)throw b;a.forEach(function(a){a.TIME=parseTime(a.TIME),a.BIKE_N_CUM=+a.BIKE_N_CUM,a.BIKE_S_CUM=+a.BIKE_S_CUM}),x.domain(d3.extent(a,function(a){return a.TIME})),y.domain([0,60]),svg_1.append("path").data([a]).attr("class","line").attr("d",valueline1).style('fill','none').style('stroke',d3.rgb(3,120,177)),svg_1.append("path").data([a]).attr("class","line").attr("d",valueline2).style('fill','none').style('stroke',d3.rgb(247,127,15)),svg_1.append("g").attr("class","plot_style").attr("transform","translate(0,"+height+")").call(d3.axisBottom(x)).selectAll("text").attr("y",'1em').attr("x",'-0.25em').style("text-anchor","start"),svg_1.append("g").attr("class","plot_style").call(d3.axisLeft(y)),svg_1.append("text").attr("transform","rotate(-90)").attr("y",5).attr("x",0).attr("dy","1em").style("text-anchor","end").attr('font-family','Open Sans').style("font-size","0.8em").style("fill","grey").text("Total number of bicycles"),svg_1.append("text").attr("x",width/2).attr("y",-(margin.top/2)).attr("text-anchor","middle").style('font-family','Open Sans').style("font-size","1em").style("fill","grey").text("Cumulative Bicycle Counts"),svg_1.append("rect").attr("x",width-100).attr("y",height-50-9-16).attr("width",18).attr("height",9).style('opacity',.8).style('fill',d3.rgb(247,127,15)),svg_1.append("text").attr("x",width-78).attr("y",height-50-16).attr('font-family','Open Sans').style("font-size","0.8em").style("text-anchor","start").style('fill','grey').text("Northbound"),svg_1.append("rect").attr("x",width-100).attr("y",height-50-9).attr("width",18).attr("height",9).style('opacity',.9).style('fill',d3.rgb(3,120,177)),svg_1.append("text").attr("x",width-78).attr("y",height-50).attr('font-family','Open Sans').style("font-size","0.8em").style("text-anchor","start").style('fill','grey').text("Southbound")}),svg_2=d3.select("#plot_2").append("svg").attr("width",width+margin.left+margin.right).attr("height",height+margin.top+margin.bottom).append("g").attr("transform","translate("+margin.left+","+margin.top+")"),valueline3=d3.line().curve(d3.curveStepBefore).x(function(a){return x(a.TIME)}).y(function(a){return y(a.PED_S_CUM)}),valueline4=d3.line().curve(d3.curveStepBefore).x(function(a){return x(a.TIME)}).y(function(a){return y(a.PED_N_CUM)}),d3.csv("counts_p.csv",function(b,a){if(b)throw b;a.forEach(function(a){a.TIME=parseTime(a.TIME),a.PED_N_CUM=+a.PED_N_CUM,a.PED_S_CUM=+a.PED_S_CUM}),x.domain(d3.extent(a,function(a){return a.TIME})),y.domain([0,65]),svg_2.append("path").data([a]).attr("class","line").attr("d",valueline3).style('fill','none').style('stroke',d3.rgb(3,120,177)),svg_2.append("path").data([a]).attr("class","line").attr("d",valueline4).style('fill','none').style('stroke',d3.rgb(247,127,15)),svg_2.append("g").attr("class","plot_style").attr("transform","translate(0,"+height+")").call(d3.axisBottom(x)).selectAll("text").attr("y",'1em').attr("x",'-0.25em').style("text-anchor","start"),svg_2.append("g").attr("class","plot_style").call(d3.axisLeft(y)),svg_2.append("text").attr("transform","rotate(-90)").attr("y",5).attr("x",0).attr("dy","1em").style("text-anchor","end").attr('font-family','Open Sans').style("font-size","0.8em").style("fill","grey").text("Total number of pedestrians"),svg_2.append("text").attr("x",width/2).attr("y",-(margin.top/2)).attr("text-anchor","middle").style('font-family','Open Sans').style("font-size","1em").style("fill","grey").text("Cumulative Pedestrian Counts"),svg_2.append("rect").attr("x",width-100).attr("y",height-50-9-16).attr("width",18).attr("height",9).style('opacity',.8).style('fill',d3.rgb(247,127,15)),svg_2.append("text").attr("x",width-78).attr("y",height-50-16).attr('font-family','Open Sans').style("font-size","0.8em").style("text-anchor","start").style('fill','grey').text("Northbound"),svg_2.append("rect").attr("x",width-100).attr("y",height-50-9).attr("width",18).attr("height",9).style('opacity',.9).style('fill',d3.rgb(3,120,177)),svg_2.append("text").attr("x",width-78).attr("y",height-50).attr('font-family','Open Sans').style("font-size","0.8em").style("text-anchor","start").style('fill','grey').text("Southbound")}),svg_3=d3.select("#plot_3").append("svg").attr("width",width+margin.left+margin.right).attr("height",height+margin.top+margin.bottom).append("g").attr("transform","translate("+margin.left+","+margin.top+")"),valueline5=d3.line().x(function(a){return x(a.TIME)}).y(function(a){return y(a.VEH_S)}),valueline6=d3.line().x(function(a){return x(a.TIME)}).y(function(a){return y(a.VEH_N)}),d3.csv("counts_v.csv",function(b,a){if(b)throw b;a.forEach(function(a){a.TIME=parseTime(a.TIME),a.VEH_S=+a.VEH_S,a.VEH_N=+a.VEH_N}),x.domain(d3.extent(a,function(a){return a.TIME})),y.domain([0,100]),svg_3.append("path").data([a]).attr("class","line").attr("d",valueline5).style('fill','none').style('stroke',d3.rgb(3,120,177)),svg_3.append("path").data([a]).attr("class","line").attr("d",valueline6).style('fill','none').style('stroke',d3.rgb(247,127,15)),svg_3.append("g").attr("class","plot_style").attr("transform","translate(0,"+height+")").call(d3.axisBottom(x)).selectAll("text").attr("y",'1em').attr("x",'-0.25em').style("text-anchor","start"),svg_3.append("g").attr("class","plot_style").call(d3.axisLeft(y)),svg_3.append("text").attr("transform","rotate(-90)").attr("y",5).attr("x",0).attr("dy","1em").style("text-anchor","end").attr('font-family','Open Sans').style("font-size","0.8em").style("fill","grey").text("Vehicles per five minutes"),svg_3.append("text").attr("x",width/2).attr("y",-(margin.top/2)).attr("text-anchor","middle").style('font-family','Open Sans').style("font-size","1em").style("fill","grey").text("Vehicles per Five Minutes"),svg_3.append("rect").attr("x",width-100).attr("y",height-50-9-16-100).attr("width",18).attr("height",9).style('opacity',.8).style('fill',d3.rgb(247,127,15)),svg_3.append("text").attr("x",width-78).attr("y",height-50-16-100).attr('font-family','Open Sans').style("font-size","0.8em").style("text-anchor","start").style('fill','grey').text("Northbound"),svg_3.append("rect").attr("x",width-100).attr("y",height-50-9-100).attr("width",18).attr("height",9).style('opacity',.9).style('fill',d3.rgb(3,120,177)),svg_3.append("text").attr("x",width-78).attr("y",height-50-100).attr('font-family','Open Sans').style("font-size","0.8em").style("text-anchor","start").style('fill','grey').text("Southbound")})</script><h2 id=learnings>Learnings and Future Improvements</h2><p>Over the span of this project I was able to fully test the limits of this first prototype and came away with a few key points.</p><p><strong id=algo-improvements>Algorithm Improvements</strong> — Although the current two-part solution works, it is far from elegant and definitely not the most efficient solution. I am actively building out several new deep learning based solutions that combine the detection, localization, and tracking into a single operation within <a target=_blank href=https://www.tensorflow.org/mobile/tflite/>TensorFlow Lite</a> using a MobileNets<sup id=fnref:2><a href=#fn:2 class=footnote-ref role=doc-noteref>2</a></sup> style framework. My hope is that these new versions will improve performance during heavy occlusion or low light while reducing computational overhead. In theory, if this were ever implemented with permission from a city (and thus solar-powered), I could potentially use something more energy intensive such as an NVIDIA Jetson or similar IoT board. The combination of the increased horsepower, and reduced computational load would hopefully allow for a frame rate closer to 10Hz rather than the current 2Hz.</p><p><strong>Energy Storage and Connectivity</strong> — Because I was flying under the radar during this project, I was limited in two areas; energy consumption and connectivity. Ideally I would have paired the 30,000mAh battery pack with a solar panel mounted on top. The solar panel would then power the Raspberry Pi and charge the battery pack during the day, while the battery pack alone would power it during the night and through overcast days.</p><p>The issue of connectivity would become the next obstacle in long-term deployment. As it currently stands, I use a 128GB usb memory card to store all the trajectory data. I could have paid for a Raspberry Pi cellular data plan, but I completely expected my prototype to get stolen. Given the ideal situation of being able to connect to an ethernet line, indefinite deployment becomes an actual possibility.</p><p><strong>Camera Placement</strong> — After a little trial and error, I discovered that the best position is ideally high over the center of the street with at least 100 yards of visibility. The hundred yards requirement was function of the slow frame rate of 2Hz. Presumably if I had faster hardware, I could increase the frame rate and reduce the required field of view. The elevation requirement is important because it reduces the occlusion, especially when there are multiple lanes of traffic. Lastly, I always tried to position the camera in a loosely northward facing direction and in close proximity to a street light. This allowed me to count traffic at night but also reduce the chances of incurring any glare or direct sun light which could wash out the images during the day.</p><p><strong>Thermal Management</strong> — The current version relies on passive cooling because weather sealing had the highest priority. Because of this limitation, I conservatively placed it in areas that were always shaded. This prevented me from measuring several road segments I was interested in but also forced me to get creative for others. If this were ever implemented with permission from a city, I would definitely build in a solar-powered fan for reducing mid-day heat buildup.</p><h2>Conclusion</h2><p>Overall I was really happy with the final results and I learned a lot about deploying a self-contained system into the wild. It would be nice to let this system harvest data for an extended period of time so that long-term trends could be accurately measured. With a system like this, a measurable impact of bike infrastructure investment could be generated. It could also provide the underlying data needed to justify new infrastructure proposals.</p><img alt="deep learning raspberry pi traffic tracker in the wild" title="deep learning raspberry pi traffic tracker in the wild" src=VineSt-2018-07-25-17-34-59-25.jpg>
<center class=figcaption>Figure 9: Me taking a picture of a Raspberry Pi taking a picture of me</center><p>Cincinnati government/department of transportation get at me. I want to help!</p><h2 id=technical-notes>Technical Notes</h2><p>Within this section, I&rsquo;ll cover the technical details in-depth. There are only a couple key components to my system, mainly the algorithm, training data, and hardware.</p><p><strong>Data</strong> — Using <a target=_blank href=https://github.com/tzutalin/labelImg>labelImg</a><sup id=fnref:3><a href=#fn:3 class=footnote-ref role=doc-noteref>3</a></sup>, I manually annotated examples of each class. This was fairly time-consuming, but it gave me good chuck of time to catchup on podcasts so it really wasn&rsquo;t too bad. I could have been substituted this manual data annotation with existing datasets such as the <a target=_blank href=http://www.vision.caltech.edu/Image_Datasets/CaltechPedestrians/>Caltech Pedestrian Detection Benchmark</a> or one of the <a terget=_blank href=http://www.gavrila.net/Datasets/Daimler_Pedestrian_Benchmark_D/daimler_pedestrian_benchmark_d.html>Daimler Pedestrian Benchmark Data Sets</a> but one of my primary goals with this project was to start at zero and finish with a solid working solution. I was also concerned with the discrepancy of training on full color data but operating with the infrared data coming from the v2 NoIR image sensor. Lastly, I was also curious as to whether my dataset could help overcome some known shortcomings in regards to Faster R-CNN.<sup id=fnref:4><a href=#fn:4 class=footnote-ref role=doc-noteref>4</a></sup><sup>,</sup><sup id=fnref:5><a href=#fn:5 class=footnote-ref role=doc-noteref>5</a></sup> Below are the results from my manual annotation. Note that images are captured and analyzed at 1280x720 resolution.</p><center><table style=width:250px><thead><tr><th style=text-align:left;padding-left:1em><strong>Label</strong></th><th style=text-align:center;padding-right:.5em><strong>Annotations (#)</strong></th></tr></thead><tbody><tr><td style=text-align:left;padding-left:1em>Pedestrians</td><td style=text-align:center;padding-right:.5em>59</td></tr><tr><td style=text-align:left;padding-left:1em>Bicycles</td><td style=text-align:center;padding-right:.5em>259</td></tr><tr><td style=text-align:left;padding-left:1em>Cars</td><td style=text-align:center;padding-right:.5em>593</td></tr><tr><td style=text-align:left;padding-left:1em>SUVs</td><td style=text-align:center;padding-right:.5em>217</td></tr><tr><td style=text-align:left;padding-left:1em>Pickup Trucks</td><td style=text-align:center;padding-right:.5em>137</td></tr><tr><td style=text-align:left;padding-left:1em>Trucks</td><td style=text-align:center;padding-right:.5em>229</td></tr><tr><td style=text-align:left;padding-left:1em><strong>All annotations</strong></td><td style=text-align:center;padding-right:.5em><strong>1494</strong></td></tr></tbody></table></center><center class=figcaption>Table 3: Manual annotations (based off 529 images)</center><p><strong>Machine Learning</strong> — There are two primary parts to the tracking algorithm. The first is the <a target=_blank href=https://en.wikipedia.org/wiki/Deep_learning>deep learning</a> based object detection and localization. For this I utilized a TensorFlow based implementation of Faster R-CNN<sup id=fnref:6><a href=#fn:6 class=footnote-ref role=doc-noteref>6</a></sup>, which is the new and improved version of Fast R-CNN<sup id=fnref:7><a href=#fn:7 class=footnote-ref role=doc-noteref>7</a></sup>, which is the new and improved version of R-CNN<sup id=fnref:8><a href=#fn:8 class=footnote-ref role=doc-noteref>8</a></sup>. This particular implementation of Faster R-CNN was built on top of Res-Net101<sup id=fnref:9><a href=#fn:9 class=footnote-ref role=doc-noteref>9</a></sup> which had been trained on the COCO<sup id=fnref:10><a href=#fn:10 class=footnote-ref role=doc-noteref>10</a></sup> data set. I could have went with a faster single shot detection (SSD) framework such as YOLO/YOLOv3<sup id=fnref:11><a href=#fn:11 class=footnote-ref role=doc-noteref>11</a></sup>, but I was more concerned with positional accuracy<sup id=fnref:12><a href=#fn:12 class=footnote-ref role=doc-noteref>12</a></sup> because at the time my secondary goal was to measure vehicle/pedestrian speed. Training was carried out using the GeForce GTX 1050 GPU on my laptop which ended up taking roughly three hours.</p><p>The second component is the tracking aspect of the algorithm. Once the objects in the current time frame have been detected and localized, they are clustered using <a target=_blank href=means_clustering>k-means</a> over a time window of three frames. At an image capture rate of 2Hz, this translates to one second. This worked decently well for this initial prototype, but definitely has its limitations. I touch on several ways in which this can be improved [<a href=#algo-improvements>here</a>]. Below I made a general flow chart depicting the tracking process.</p><img alt="temporal clustering" title="temporal clustering" src=clustering.jpg>
<center class=figcaption>Figure 10: Tracking system</center><p><strong>Hardware</strong> — This initial version uses the v2 Pi NoIR 8-megapixel/1080p30 (Sony IMX219 sensor) camera paired with the Raspberry Pi Zero. The lack of computing power resulted in the tracking algorithm unable to exceed a frame rate of 2Hz. All of this was powered by a 30,000mAh USB battery pack. In hindsight, I should have probably just gotten the Raspberry Pi 3 B+ with some kind of small industrial battery pack.</p><h2>References</h2><section class=footnotes role=doc-endnotes><hr><ol><li id=fn:1 role=doc-endnote><p><a target=_blank href=https://miovision.com/wp-content/uploads/Accuracy_Comparison_of_Non_Intrusive_Automated_Traffic_Volume_Counting_Equipment_Alb-1.pdf><i>Accuracy Comparison of Non‐Intrusive, Automated Traffic Volume Counting Equipment</i></a>. (October 2009) <a href=#fnref:1 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li><li id=fn:2 role=doc-endnote><p>A. G. Howard, M. Zhu, B. Chen, D. Kalenichenko, W. Wang, T. Weyand, M. Andreetto, H. Adam, <a target=_blank href=https://arxiv.org/abs/1704.04861><i>MobileNets: Efficient Convolutional Neural Networks for Mobile Vision Applications</i></a>. (Submitted on 17 April 2017) <a href=#fnref:2 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li><li id=fn:3 role=doc-endnote><p>TzuTa Lin, <i>LabelImg</i>, <a target=_blank href=https://github.com/tzutalin/labelImg><a href=https://github.com/tzutalin/labelImg>https://github.com/tzutalin/labelImg</a></a>. (2015) <a href=#fnref:3 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li><li id=fn:4 role=doc-endnote><p>L. Zhang, L. Lin, X. Liang, K. He, <a target=_blankl href=https://arxiv.org/abs/1607.07032><i>Is Faster R-CNN Doing Well for Pedestrian Detection?</i></a>. (Submitted on 24 July 2016) <a href=#fnref:4 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li><li id=fn:5 role=doc-endnote><p>C. Eggert, S. Brehm, A. Winschel, D. Zecha and R. Lienhart, <a target=_blank href=https://ieeexplore.ieee.org/document/8019550/><i>A Closer Look: Small Object Detection in Faster R-CNN</i></a>. 2017 IEEE International Conference on Multimedia and Expo (ICME), Hong Kong, 2017, pp. 421-426. <a href=#fnref:5 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li><li id=fn:6 role=doc-endnote><p>S. Ren, K. He, R. Girshick, J. Sun, <a target=_blank href=https://arxiv.org/abs/1506.01497><i>Faster R-CNN: Towards Real-Time Object Detection with Region Proposal Networks</i></a>. (Submitted on 4 June 2015) -> GitHub [<a target=_blank href=https://github.com/ShaoqingRen/faster_rcnn>here</a>] <a href=#fnref:6 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li><li id=fn:7 role=doc-endnote><p>R. Girshick, <a target=_blank href=https://arxiv.org/abs/1504.08083><i>Fast R-CNN</i></a>. (Submitted on 30 April 2015) -> GitHub [<a target=_blank href=https://github.com/rbgirshick/fast-rcnn>here</a>] <a href=#fnref:7 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li><li id=fn:8 role=doc-endnote><p>R. Girshick, J. Donahue, T. Darrell, J. Malik, <a target=_blank href=https://arxiv.org/abs/1311.2524><i>Rich feature hierarchies for accurate object detection and semantic segmentation</i></a>. (Submitted on 11 November 2013) -> GitHub [<a target=_blank href=https://github.com/rbgirshick/rcnn>here</a>] <a href=#fnref:8 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li><li id=fn:9 role=doc-endnote><p>K. He, X. Zhang, S. Ren, J. Sun, <a target=_blank href=https://arxiv.org/abs/1512.03385><i>Deep Residual Learning for Image Recognition</i></a>. Submitted on 10 December 2015) -> GitHub <a target=_blank href=https://github.com/KaimingHe/deep-residual-networks>here</a>] <a href=#fnref:9 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li><li id=fn:10 role=doc-endnote><p>T. Lin, M. Maire, S. Belongie, L. Bourdev, R. Girshick, J. Hays, P. Perona, D. Ramanan, C. L. Zitnick, P. Dollár, <a target=_blank href=https://arxiv.org/abs/1405.0312><i>Microsoft COCO: Common Objects in Context</i></a>. (Submitted on 1 May 2014) -> Data link [<a target=_blank href=http://cocodataset.org>here</a>] <a href=#fnref:10 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li><li id=fn:11 role=doc-endnote><p>J. Redmon, A. Farhadi, <a target=_blank href=https://arxiv.org/abs/1804.02767><i>YOLOv3: An Incremental Improvement</i></a>. (Submitted on 8 April 2018) <a href=#fnref:11 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li><li id=fn:12 role=doc-endnote><p>J. Huang, V. Rathod, C. Sun, M. Zhu, A. Korattikara, A. Fathi, I. Fischer, Z. Wojna, Y. Song, S. Guadarrama, K. Murphy, <a target=_blank href=https://arxiv.org/abs/1611.10012><i>Speed/accuracy trade-offs for modern convolutional object detectors</i></a>. (Submitted on 30 November 2016) <a href=#fnref:12 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li></ol></section></div><div class=separator><ul class=flat><li><a onclick="plausible('home-icon',{props:{method:'A Low Cost Approach to Improving Pedestrian Safety with Deep Learning'}})" href=/><img style=min-width:30px;position:relative;top:5px;width:20px;height:20px src=/icons/home_feather.svg alt="home page icon"></a></li><li><a onclick="plausible('about-icon',{props:{method:'A Low Cost Approach to Improving Pedestrian Safety with Deep Learning'}})" href=/about><img style=min-width:30px;position:relative;top:5px;width:20px;height:20px src=/icons/user_feather.svg alt="about page icon"></a></li><li><a onclick="plausible('rss-icon',{props:{method:'A Low Cost Approach to Improving Pedestrian Safety with Deep Learning'}})" href=/rss target=_blank><img style=min-width:30px;position:relative;top:5px;width:20px;height:20px src=/icons/rss_feather_black.svg alt="rss page icon"></a></li></ul></div></div><div class=footer><center>&copy; <a href=/about>Nathan A. Rooy</a>.<br>Built with <a target=_blank rel="noopener noreferrer" href=https://gohugo.io/>Hugo</a>.
Powered by <a target=_blank rel="noopener noreferrer" href=http://www.github.com>GitHub</a></center></div></body></html>