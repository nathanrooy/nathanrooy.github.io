<!doctype html><html lang=en><head><meta charset=utf-8><title>Nathan Rooy</title><meta content="Nathan Rooy" name=author><meta content="en" name=language><meta content="width=device-width,minimum-scale=1" name=viewport><meta content="nathanrooy.github.io" property="og:site_name"><meta content="article" property="og:type"><meta content="https://nathanrooy.github.io/posts/2023-04-12/visual-book-recommender/" property="og:url"><meta content="https://nathanrooy.github.io/posts/2023-04-12/visual-book-recommender/" name=twitter:url><meta content="Nathan A. Rooy" name=copyright><meta content="summary_large_image" name=twitter:card><meta content="book recommendations,deep learning,contrastive learning,contrastive loss,latent space,tsne" name=keywords><meta content="A visual book recommender" name=twitter:title><meta content="A visual book recommender" property="og:title"><meta content="I built a a visual book recommender based on 100M book reviews" name=description><meta content="I built a a visual book recommender based on 100M book reviews" name=twitter:description><meta content="I built a a visual book recommender based on 100M book reviews" property="og:description"><meta content="https://nathanrooy.github.io/posts/2023-04-12/visual-book-recommender/imgs-web/og-img-1200x630.jpg" name=twitter:image><meta content="https://nathanrooy.github.io/posts/2023-04-12/visual-book-recommender/imgs-web/og-img-1200x630.jpg" property="og:image"><link href=https://nathanrooy.github.io/index.xml rel=alternate type=application/rss+xml title="Nathan Rooy"><link href=/favicon/favicon.png rel=icon type=image/png><link href=/fonts/figtree-v1-latin-regular.woff2 rel=preload as=font type=font/woff2 crossorigin><link href=https://nathanrooy.github.io/posts/2023-04-12/visual-book-recommender/ rel=canonical><script defer data-domain=nathanrooy.github.io src=https://plausible.io/js/script.tagged-events.js></script><style>/*!normalize.css v8.0.1 | MIT License | github.com/necolas/normalize.css*/html{line-height:1.15;-webkit-text-size-adjust:100%}body{margin:0}main{display:block}h1{font-size:2em;margin:.67em 0}hr{box-sizing:content-box;height:0;overflow:visible}pre{font-family:monospace,monospace;font-size:1em}a{background-color:initial}abbr[title]{border-bottom:none;text-decoration:underline;text-decoration:underline dotted}b,strong{font-weight:bolder}code,kbd,samp{font-family:monospace,monospace;font-size:1em}small{font-size:80%}sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}img{border-style:none}button,input,optgroup,select,textarea{font-family:inherit;font-size:100%;line-height:1.15;margin:0}button,input{overflow:visible}button,select{text-transform:none}button,[type=button],[type=reset],[type=submit]{-webkit-appearance:button}button::-moz-focus-inner,[type=button]::-moz-focus-inner,[type=reset]::-moz-focus-inner,[type=submit]::-moz-focus-inner{border-style:none;padding:0}button:-moz-focusring,[type=button]:-moz-focusring,[type=reset]:-moz-focusring,[type=submit]:-moz-focusring{outline:1px dotted ButtonText}fieldset{padding:.35em .75em .625em}legend{box-sizing:border-box;color:inherit;display:table;max-width:100%;padding:0;white-space:normal}progress{vertical-align:baseline}textarea{overflow:auto}[type=checkbox],[type=radio]{box-sizing:border-box;padding:0}[type=number]::-webkit-inner-spin-button,[type=number]::-webkit-outer-spin-button{height:auto}[type=search]{-webkit-appearance:textfield;outline-offset:-2px}[type=search]::-webkit-search-decoration{-webkit-appearance:none}::-webkit-file-upload-button{-webkit-appearance:button;font:inherit}details{display:block}summary{display:list-item}template{display:none}[hidden]{display:none}:root{--main-text-color:#222;--main-text-weight:400;--text-bold:600;--font-family:"Figtree", sans-serif;--background-light:#F5F5F5}body{-webkit-font-smoothing:antialiased}@font-face{font-family:figtree;font-style:normal;font-weight:400;font-display:swap;src:url(/fonts/figtree-v1-latin-regular.eot);src:local(''),url(/fonts/figtree-v1-latin-regular.eot?#iefix)format('embedded-opentype'),url(/fonts/figtree-v1-latin-regular.woff2)format('woff2'),url(/fonts/figtree-v1-latin-regular.woff)format('woff'),url(/fonts/figtree-v1-latin-regular.ttf)format('truetype'),url(/fonts/figtree-v1-latin-regular.svg#Figtree)format('svg')}@font-face{font-family:figtree;font-style:normal;font-weight:600;font-display:swap;src:url(/fonts/figtree-v1-latin-600.eot);src:local(''),url(/fonts/figtree-v1-latin-600.eot?#iefix)format('embedded-opentype'),url(/fonts/figtree-v1-latin-600.woff2)format('woff2'),url(/fonts/figtree-v1-latin-600.woff)format('woff'),url(/fonts/figtree-v1-latin-600.ttf)format('truetype'),url(/fonts/figtree-v1-latin-600.svg#Figtree)format('svg')}.home-page{font-family:var(--font-family);color:var(--main-text-color);margin-top:0;padding-bottom:6rem}.home-page ul li{margin-bottom:.3rem}.home-page ul a{color:var(--main-text-color)}.post-li-title{width:95%;text-overflow:ellipsis;white-space:nowrap;overflow:hidden;float:left}.post-li-date{float:left;padding-bottom:1em;font-size:16px;color:#a9a9a9}@media only screen and (min-width:501px){.wrapper{max-width:660px;margin:0 auto;padding:1rem}.container{margin-top:6rem}.post-li-title{font-size:19px}.post-ul{list-style-type:none;padding-left:0;list-style:none;line-height:1.6em;margin-top:0}.post-li{overflow:hidden}}@media only screen and (max-width:950px){.container{margin-top:0}}@media only screen and (max-width:500px){.wrapper{margin:0 auto}.container{margin:2rem 1rem 1rem}.post-ul{list-style-type:none;padding-left:0;list-style:none;line-height:1.5em;margin-top:.2rem}.post-li{overflow:hidden}}.nyc-progress-image{margin-top:-1rem}.strava-grid{padding-top:1rem}.language-python{font-size:.8rem;line-height:0}.highlight{margin-bottom:1rem}.markdown .footnotes hr{margin-top:4rem;margin-bottom:4rem;height:1px;border:none;color:var(--main-text-color);background-color:var(--main-text-color)}.markdown .footnotes ol{counter-reset:item;padding-left:0;padding-right:0;width:fit-content;color:#757575}.markdown .footnotes li{display:block;padding-bottom:0}.markdown .footnotes li:before{content:counter(item)". ";counter-increment:item;width:2em;display:inline-block;position:absolute}.markdown .footnotes li p{padding-left:2rem;line-height:1.25rem}.markdown .footnotes li a{color:#757575}.markdown .footnotes li a:hover{color:var(--main-text-color)}ul.flat{margin:0;padding:0}ul.flat li{display:inline-block;list-style:none;margin-left:0}.markdown .post-update{background-color:var(--background-light);border-left:10px solid;border-color:#e74c3c;padding-top:1.5rem;padding-left:1.5rem;padding-bottom:1.5rem;padding-right:1.5rem;margin-top:1rem;margin-left:0;margin-right:0;margin-bottom:2rem;line-height:1.5rem;font-weight:var(--main-text-weight);font-size:15px}.highlighter-rouge{position:relative;font-size:.75rem;color:var(--main-text-color);border:1px solid;border-color:#e6e6e6;border-radius:3px;background-color:#f2f2f2;padding:.1rem .2rem}.figcaption{font-size:.8rem;padding-bottom:1rem}.markdown .photoset-grid-lightbox{margin-bottom:1rem}.markdown{font-family:var(--font-family);color:var(--main-text-color);padding-bottom:8rem}.markdown ol{font-weight:var(--main-text-weight);font-size:16px;margin-top:0;padding-bottom:0;line-height:1.2rem;padding-right:2em;width:85%;margin-block-end:.25em}.markdown ol li{padding-bottom:.75em}.markdown p{font-weight:var(--main-text-weight);font-size:16px;margin-top:0;margin-bottom:1rem;line-height:1.7rem;letter-spacing:.02rem}.markdown blockquote{background-color:#f2f2f2;border-left:10px solid;border-color:#2dad60;padding-top:1.5rem;padding-left:1.5rem;padding-bottom:1.5rem;padding-right:1.5rem;margin-top:0;margin-left:0;margin-right:0;margin-bottom:1rem;line-height:1.5rem;font-weight:var(--main-text-weight);font-size:15px}.markdown blockquote p{margin-bottom:0}.markdown h2{font-family:figtree;font-size:1.2rem;font-weight:var(--text-bold);margin-bottom:.3em}*+h2{padding-top:2rem}.markdown .ul-style-b li{margin-bottom:.5rem;font-size:16px}.TLDR{font-family:var(--font-family);padding-top:0;margin-top:0;margin-bottom:0;font-size:1.1rem;line-height:1.7rem;font-weight:var(--main-text-weight);letter-spacing:.02rem}table{width:100%;font-size:14px;letter-spacing:-.01em;border-collapse:collapse;margin-bottom:2em;margin-top:2em;font-weight:var(--main-text-weight);line-height:1.2rem}table th{text-align:left}table thead{border-bottom:1px solid var(--main-text-color);line-height:1.4em}.post-header h1{font-weight:var(--main-text-weight);font-size:2.3rem;font-family:var(--font-family);color:var(--main-text-color);line-height:2.64rem}.post ul li{margin-bottom:10px}.post ul li p{display:inline}.post .post-header{margin-bottom:2.5rem}.post .post-header .title{margin:0}.post .post-header .meta{padding-left:0;margin-top:10px}.post .post-header a{color:#999}.post .post-header a:hover{text-decoration:underline}.post .post-header a:visited{color:#999}.post hr{margin-top:4rem;margin-bottom:4rem;height:1px;border:none;color:var(--main-text-color);background-color:var(--main-text-color)}a{text-decoration:none;color:#0955b5}a:hover{text-decoration:underline}a:visited{color:#205caa}::selection{background:#fff9c4;text-shadow:none}#map img{margin:0;max-width:100%;display:block}img{margin:1.5em auto;max-width:100%;display:block}a img{border:none}figure{margin:0;text-align:center}ul{padding-left:15px}ul{list-style:disc inside}.markdown ul li{font-size:15px}.highlight pre{margin-bottom:0;margin-top:0;padding:20px;background-color:initial!important;overflow:auto;word-wrap:normal;white-space:pre}.highlight{background:0 0;background-color:#fafafa}.meta{font-family:var(--font-family);font-size:.8rem;color:#999;margin-bottom:4px}.list .posts .post .meta{margin-bottom:0;margin-left:5px}.markdown .photoset-grid-lightbox{margin-bottom:1rem}table .katex-display{margin-top:.2rem;margin-bottom:.2rem}.post ul li .katex-display{display:inline-block;list-style:none;margin-left:0;margin-bottom:0;line-height:0;padding:0}@media only screen and (min-width:501px){#burger{padding-left:2rem;padding-top:2rem}}@media only screen and (max-width:950px){#burger{padding-left:1rem;padding-top:1rem;padding-bottom:1.5rem}}@media only screen and (max-width:500px){#burger{padding-left:1rem;padding-top:1rem}}#burger{font-family:var(--font-family);font-weight:400;color:#a9a9a9;font-size:1.5rem}#burger a{display:inline-block;padding-right:.8rem}#burger label{cursor:pointer}#burger label:hover{color:var(--main-text-color)}#nav-icons{padding-left:.8rem}#nav-icons svg{max-height:20px;margin-bottom:-.05rem;color:var(--main-text-color)}#l1-val{position:relative;top:-.12rem}#l2-val{position:relative;top:-.2rem;padding-left:.1rem;padding-right:.1rem}#burger-cbox{display:none}#label-1{display:inline-block}#label-2{display:none}#burger-cbox:not(:checked)~#nav-icons{display:none}#burger-cbox:checked~#nav-icons{display:inline-block}#burger-cbox:checked~#label-1{display:none}#burger-cbox:checked~#label-2{display:inline-block;color:var(--main-text-color)}</style></head><body><div class=header><nav role=navigation><div id=burger><input type=checkbox id=burger-cbox autocomplete=off>
<label id=label-1 for=burger-cbox><span>[</span><span id=l1-val>+</span><span>]</span></label>
<label id=label-2 for=burger-cbox><span>[</span><span id=l2-val>x</span><span>]</span></label><div id=nav-icons><a class="plausible-event-name=burger+home" aria-label=Home href=/><svg xmlns="http://www.w3.org/2000/svg" id="home-icon" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="feather feather-home"><path d="M3 9l9-7 9 7v11a2 2 0 01-2 2H5a2 2 0 01-2-2z"/><polyline points="9 22 9 12 15 12 15 22"/></svg></a><a class="plausible-event-name=burger+reading" aria-label=Reading href=/reading><svg width="24" height="24" viewBox="0 0 23.809855 18.892912" id="svg5" inkscape:version="1.1 (c4e8f9e, 2021-05-24)" sodipodi:docname="book.svg" xmlns:inkscape="http://www.inkscape.org/namespaces/inkscape" xmlns:sodipodi="http://sodipodi.sourceforge.net/DTD/sodipodi-0.dtd" xmlns="http://www.w3.org/2000/svg" xmlns:svg="http://www.w3.org/2000/svg"><sodipodi:namedview id="namedview7" pagecolor="#ffffff" bordercolor="#666666" borderopacity="1" inkscape:pageshadow="2" inkscape:pageopacity="0" inkscape:pagecheckerboard="0" inkscape:document-units="mm" showgrid="false" fit-margin-top="0" fit-margin-left="0" fit-margin-right="0" fit-margin-bottom="0" inkscape:zoom=".69130191" inkscape:cx="77.39021" inkscape:cy="446.98271" inkscape:window-width="1920" inkscape:window-height="1011" inkscape:window-x="0" inkscape:window-y="0" inkscape:window-maximized="1" inkscape:current-layer="g39"/><defs id="defs2"/><g inkscape:label="Layer 1" inkscape:groupmode="layer" id="layer1" transform="translate(-6.352941,-30.26865)"><g id="g39" transform="matrix(0.26458333,0,0,0.26458333,5.0300244,26.48677)"><path class="st0" d="m92.22 22.9v59C74.24 76.35 61.26 78.85 54.73 81.04 59.2 76.64 68.54 70.55 84.16 74.14l1.69.39V21.42c2.17.29 4.3.77 6.37 1.48z" id="path11"/><path class="st0" d="M45.24 81.04C38.73 78.85 25.74 76.35 7.77 81.9v-59c2.06-.71 4.2-1.19 6.37-1.48v53.11l1.68-.39c15.61-3.58 24.96 2.5 29.42 6.9z" id="path13"/><polygon points="48.86,85.63 48.82,85.58 48.91,85.63" id="polygon15"/><polygon points="51.17,85.58 51.13,85.63 50,85.63 51.09,85.62" id="polygon17"/><path d="m94.09 20.63c-2.68-1-5.45-1.65-8.24-2.02v-2.94l-1.08-.24c-17.8-4.09-28.32 3.81-32.9 8.68-.81.87-1.44 1.63-1.88 2.22C49.54 25.74 48.91 24.98 48.1 24.11c-4.58-4.87-15.11-12.76-32.9-8.68l-1.07.24v2.94c-2.8.38-5.57 1.02-8.24 2.02L5 20.97V85.7l1.81-.61c13.49-4.49 24.13-4.16 30.68-3.08 7.09 1.15 11.05 3.4 11.09 3.42l.23.14.09.06H50l1.09-.01.08-.05.23-.14c.05-.02 4-2.27 11.09-3.42 6.55-1.08 17.19-1.41 30.68 3.08l1.82.61V20.97zM7.78 81.89v-59c2.06-.71 4.2-1.19 6.37-1.48v53.11l1.68-.39c15.61-3.58 24.95 2.5 29.42 6.9-6.52-2.18-19.5-4.68-37.47.86zm40.76-1.3c-4.19-4.66-14.29-12.83-31.63-9.5v-53.2c11.11-2.28 18.93.38 24.02 3.66 2.6 1.68 4.48 3.52 5.71 4.95 1.14 1.32 1.73 2.28 1.82 2.43l.08.15zm2.76.17V29.34l.24-.4c.09-.16.68-1.12 1.82-2.44 1.23-1.43 3.11-3.27 5.71-4.94 5.08-3.29 12.91-5.95 24.02-3.67v53.2C65.54 67.72 55.4 76.13 51.3 80.76zm40.92 1.13C74.24 76.34 61.26 78.84 54.73 81.03 59.2 76.63 68.54 70.54 84.16 74.13l1.69.39v-53.1c2.16.29 4.3.77 6.37 1.48z" id="path19"/></g></g><style id="style9">.st0{fill:none}</style></svg></a><a class="plausible-event-name=burger+nycbike" aria-label="NYC Bike Exploring" href=/nyc_biking><svg viewBox="0 0 91.5 52.5" width="32" height="24" xmlns="http://www.w3.org/2000/svg" xmlns:cc="http://creativecommons.org/ns#" xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#"><g transform="matrix(-1,0,0,1,95.8,-23.9)"><path d="m78 40.6c-3.8.0-7.3 1.2-10.2 3.2l-7.4-9.4 2.9-8.5H67c.6.0 1-.4 1-1s-.4-1-1-1H54.8c-.6.0-1 .4-1 1s.4 1 1 1h6.3l-2.3 6.7c-.2-.2-.4-.3-.7-.3H32l2.2-6.4h5.7c.6.0 1-.4 1-1s-.4-1-1-1h-6.4c-.4.0-.8.3-.9.7l-5.7 16.8c-1.5-.4-3.1-.7-4.8-.7-9.8.0-17.8 8-17.8 17.8s8 17.8 17.8 17.8 17.8-8 17.8-17.8c0-7.5-4.6-13.9-11.2-16.5l2.6-7.6 19 24.4c.1.3.3.6.6.7.1.0.2.1.3.1h.1 8.9c.5 9.4 8.3 16.8 17.8 16.8 9.8.0 17.8-8 17.8-17.8s-8-18-17.8-18zM37.8 58.4c0 8.7-7.1 15.8-15.8 15.8S6.2 67.1 6.2 58.4 13.3 42.6 22 42.6c1.4.0 2.8.2 4.1.6L21 58.1c-.2.5.1 1.1.6 1.3.1.0.2.1.3.1.4.0.8-.3.9-.7l5.1-14.9c5.9 2.2 9.9 7.9 9.9 14.5zm29.7-11.8L76 57.4H62.2c.3-4.3 2.2-8.1 5.3-10.8zm-16.7 9.6-17.1-22h24l.4.5zm1.8 1.2 7.1-20.8 6.6 8.4c-3.5 3.1-5.7 7.4-6 12.4zM78 74.2c-8.4.0-15.2-6.6-15.8-14.8H78c.4.0.7-.2.9-.6.2-.3.1-.8-.1-1.1L69 45.4c2.5-1.8 5.6-2.8 8.9-2.8 8.7.0 15.8 7.1 15.8 15.8s-7 15.8-15.7 15.8z"/></g></svg></a><a class="plausible-event-name=burger+about" aria-label=About href=/about><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="feather feather-user" id="about-icon"><path d="M20 21v-2a4 4 0 00-4-4H8a4 4 0 00-4 4v2"/><circle cx="12" cy="7" r="4"/></svg></a><a class="plausible-event-name=burger+rss" aria-label=RSS href=/index.xml><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 30 24" fill="none" stroke="#444" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="feather feather-rss" id="rss-icon"><path d="M4 11a9 9 0 019 9"/><path d="M4 4a16 16 0 0116 16"/><circle cx="5" cy="19" r="1"/></svg></a></div></div></nav></div><div class="container wrapper post"><div class=post-header><h1 class=title style=color:red>**DRAFT** A visual book recommender</h1></div><hr><div class=markdown><h2>Introduction</h2><p>I have this long running conjecture that used book stores are superior to commercial book outlets (including Amazon) for discovering books. One of the reasons for this I think has less to do with a skewed explore/exploit strategy, and more to do with the way exploratory suggestions are sourced. I think financial pressure skews exploratory search suggestions towards oversampling newer books rather than older adjacent books. I get that though; oversampling newer books is a simple way to help combat the rich getting richer trap. The problem is that I&rsquo;m biased against new books; I think they&rsquo;re mostly noise. Used books stores on the other hand are curated by humans for other humans (who probably live nearby). If I ask for a book that&rsquo;s like &ldquo;x&rdquo; they&rsquo;re not going to point me to the newer version of &ldquo;x&rdquo;, they&rsquo;re going to show me books &ldquo;y&rdquo; and &ldquo;z&rdquo;. There are additional reasons that go beyond just oversampling newer books which I&rsquo;ll touch on later. I&rsquo;ll also admit that all the supporting evidence I have is completely anecdotal, but still, when I want a new book I don&rsquo;t pull out my phone, I walk down the street to the used book store.</p><h2>First attempt</h2><p>I&rsquo;ve been casually thinking about how a book recommender could reflect the used book store experience for a while now. This first attempt is still a bit rough around the edges, but I think it captures some of what I&rsquo;m after. It initially started out as roughly 100M book reviews that were then distilled into basic reading preferences. I then rode the Pareto frontier between latent representation and model accuracy for about a month before I landed on what you see below. Enjoy! (make sure to go click the full screen button)</p><div id=map style=background-color:#000><input id=search-button type=image src=search.svg alt="book search icon" onclick=reveal_search() style=z-index:1000;position:absolute;background-color:#fff;width:22px;height:22px;top:130px;left:12px;border-radius:2px;padding:4px><div id=search-box style=z-index:1000;position:absolute;left:50px;top:130px;display:none><input id=search type=text placeholder=Search... size=40><ul id=suggestions style=display:none;margin-left:7px></ul></div></div><h2>Genre clusters</h2><p>I think one of the key drivers fueling the high discovery rate at used book stores has to do with the layout. All of my favorite used book stores are located in old buildings that have lots of nooks and crannies. It’s this fractal approach to book layout that I think encourages exploration into areas you wouldn&rsquo;t explicitly seek out otherwise. This &ldquo;nooks and crannies&rdquo; feeling was a major attribute I was trying to recreate with this first iteration.</p><p>Below, you’ll find a selection of the most common genres. Each book and its assigned genre are represented once as a single point. Keep in mind that the model has absolutely no understanding of authors, genres, book descriptions, vocabulary, or plot lines. It simply knows which books people liked more than others. Clusters with sharp, well defined borders represent communities of readers who largely stick to that particular genre. Large clusters with more diffused boundaries indicate a more diverse readership (humor appeals to a wider audience than horses).</p><img id=genre-img class=img-with-border src=imgs-web/genre-clusters/comics.png alt="book genre scatter plot"><div id=genre-container><div class=genre-block id=adventure onclick="change_img('adventure')">Adventure</div><div class=genre-block id=african-american onclick="change_img('african-american')">African-american</div><div class=genre-block id=aliens onclick="change_img('aliens')">Aliens</div><div class=genre-block id=alternate-history onclick="change_img('alternate-history')">Alternate-history</div><div class=genre-block id=amish onclick="change_img('amish')">Amish</div><div class=genre-block id=angels onclick="change_img('angels')">Angels</div><div class=genre-block id=art onclick="change_img('art')">Art</div><div class=genre-block id=bdsm onclick="change_img('bdsm')">Bdsm</div><div class=genre-block id=biography onclick="change_img('biography')">Biography</div><div class=genre-block id=buddhism onclick="change_img('buddhism')">Buddhism</div><div class=genre-block id=business onclick="change_img('business')">Business</div><div class=genre-block id=chick-lit onclick="change_img('chick-lit')">Chick-lit</div><div class=genre-block id=childrens onclick="change_img('childrens')">Childrens</div><div class=genre-block id=christian onclick="change_img('christian')">Christian</div><div class=genre-block id=christian-fiction onclick="change_img('christian-fiction')">Christian-fiction</div><div class=genre-block id=christmas onclick="change_img('christmas')">Christmas</div><div class=genre-block id=classics onclick="change_img('classics')">Classics</div><div class=genre-block id=comics onclick="change_img('comics')">Comics</div><div class=genre-block id=cookbooks onclick="change_img('cookbooks')">Cookbooks</div><div class=genre-block id=crime onclick="change_img('crime')">Crime</div><div class=genre-block id=dark onclick="change_img('dark')">Dark</div><div class=genre-block id=dystopia onclick="change_img('dystopia')">Dystopia</div><div class=genre-block id=economics onclick="change_img('economics')">Economics</div><div class=genre-block id=erotica onclick="change_img('erotica')">Erotica</div><div class=genre-block id=fantasy onclick="change_img('fantasy')">Fantasy</div><div class=genre-block id=fiction onclick="change_img('fiction')">Fiction</div><div class=genre-block id=finance onclick="change_img('finance')">Finance</div><div class=genre-block id=graphic-novels onclick="change_img('graphic-novels')">Graphic-novels</div><div class=genre-block id=health onclick="change_img('health')">Health</div><div class=genre-block id=historical-fiction onclick="change_img('historical-fiction')">Historical-fiction</div><div class=genre-block id=historical-romance onclick="change_img('historical-romance')">Historical-romance</div><div class=genre-block id=history onclick="change_img('history')">History</div><div class=genre-block id=horror onclick="change_img('horror')">Horror</div><div class=genre-block id=horses onclick="change_img('horses')">Horses</div><div class=genre-block id=humor onclick="change_img('humor')">Humor</div><div class=genre-block id=leadership onclick="change_img('leadership')">Leadership</div><div class=genre-block id=m-m-romance onclick="change_img('m-m-romance')">M-m-romance</div><div class=genre-block id=manga onclick="change_img('manga')">Manga</div><div class=genre-block id=marriage onclick="change_img('marriage')">Marriage</div><div class=genre-block id=memoir onclick="change_img('memoir')">Memoir</div><div class=genre-block id=middle-grade onclick="change_img('middle-grade')">Middle-grade</div><div class=genre-block id=music onclick="change_img('music')">Music</div><div class=genre-block id=mystery onclick="change_img('mystery')">Mystery</div><div class=genre-block id=new-adult onclick="change_img('new-adult')">New-adult</div><div class=genre-block id=non-fiction onclick="change_img('non-fiction')">Non-fiction</div><div class=genre-block id=novels onclick="change_img('novels')">Novels</div><div class=genre-block id=paranormal-romance onclick="change_img('paranormal-romance')">Paranormal-romance</div><div class=genre-block id=paranormal onclick="change_img('paranormal')">Paranormal</div><div class=genre-block id=philosophy onclick="change_img('philosophy')">Philosophy</div><div class=genre-block id=picture-books onclick="change_img('picture-books')">Picture-books</div><div class=genre-block id=plays onclick="change_img('plays')">Plays</div><div class=genre-block id=poetry onclick="change_img('poetry')">Poetry</div><div class=genre-block id=programming onclick="change_img('programming')">Programming</div><div class=genre-block id=psychology onclick="change_img('psychology')">Psychology</div><div class=genre-block id=realistic-fiction onclick="change_img('realistic-fiction')">Realistic-fiction</div><div class=genre-block id=reverse-harem onclick="change_img('reverse-harem')">Reverse-harem</div><div class=genre-block id=romance onclick="change_img('romance')">Romance</div><div class=genre-block id=romanian-literature onclick="change_img('romanian-literature')">Romanian-literature</div><div class=genre-block id=romantic-suspense onclick="change_img('romantic-suspense')">Romantic-suspense</div><div class=genre-block id=russia onclick="change_img('russia')">Russian</div><div class=genre-block id=science-fiction onclick="change_img('science-fiction')">Science-fiction</div><div class=genre-block id=science onclick="change_img('science')">Science</div><div class=genre-block id=self-help onclick="change_img('self-help')">Self-help</div><div class=genre-block id=shapeshifters onclick="change_img('shapeshifters')">Shapeshifters</div><div class=genre-block id=spirituality onclick="change_img('spirituality')">Spirituality</div><div class=genre-block id=sports-romance onclick="change_img('sports-romance')">Sports-romance</div><div class=genre-block id=sports onclick="change_img('sports')">Sports</div><div class=genre-block id=star-wars onclick="change_img('star-wars')">Star-wars</div><div class=genre-block id=steampunk onclick="change_img('steampunk')">Steampunk</div><div class=genre-block id=theology onclick="change_img('theology')">Theology</div><div class=genre-block id=thriller onclick="change_img('thriller')">Thriller</div><div class=genre-block id=time-travel onclick="change_img('time-travel')">Time-travel</div><div class=genre-block id=true-crime onclick="change_img('true-crime')">True-crime</div><div class=genre-block id=turkish-literature onclick="change_img('turkish-literature')">Turkish-literature</div><div class=genre-block id=urban-fantasy onclick="change_img('urban-fantasy')">Urban-fantasy</div><div class=genre-block id=vampires onclick="change_img('vampires')">Vampires</div><div class=genre-block id=westerns onclick="change_img('westerns')">Westerns</div><div class=genre-block id=witchcraft onclick="change_img('witchcraft')">Witchcraft</div><div class=genre-block id=young-adult onclick="change_img('young-adult')">Young-adult</div><div class=genre-block id=zombies onclick="change_img('zombies')">Zombies</div></div><p>In most clustering situations, crisp, well defined borders are the desired outcome. Points which fall outside of these boundaries are usually seen as a nuisance (customer segmentation amiright?). In this particular situation though, the points which fall between multiple clusters actually represent something rather special. They&rsquo;re books that capture multiple readerships!</p><h2>Technical details</h2><p>A few years ago, I scraped a little over 100M book reviews spread across 505k unique users and 6.97M books. In order to reduce the potential influence of spam reviews I took the following measures:</p><ul><li>Only include books with 100 reviews or more.</li><li>Only include reviews which came from users who had at least 10 reviews.</li><li>Only include users who had reviews spread across a minimum time window of 6 months.</li></ul><p>After filtering, the total review count dropped down to 26.8M across 396k users and 59k books. Since many of these books were in fact just different editions of the same book, they were consolidated into their canonical version represented by the edition with the most reviews. This brought the final count to 51,847 books.</p><p>The model itself is just a basic siamese network with a contrastive loss. I had initially implemented a <a href=https://en.wikipedia.org/wiki/Triplet_loss>triplet loss</a> which yielded good model performance but the embeddings lacked the aesthetic qualities I was after. After some tinkering, I ended up simplifying it down to the pairwise contrastive loss you see below:</p><img class=svg-equation src=imgs-web/contrastive_loss.svg alt="contrastive loss"><p>We can clearly see that this loss contains two distinct forces trying to overcome each other. If we establish <em>d</em> as the euclidean distance between the latent representations of two books <em>x<sub>i</sub></em> and <em>x<sub>j</sub></em>, then y=0 represents two books in close proximity with each other while y=1 are two books further apart. With the bounds established, the forces become apparent.</p><img class=svg-equation src=imgs-web/push_and_pull.svg alt="push and pull forces in contrastive loss"><p>With these two competing forces shuffling books around, the next question becomes: <em>how do we want to define similarity?</em> I actually tested about a dozen different strategies and ended up using the <a href=https://en.wikipedia.org/wiki/Pointwise_mutual_information>pointwise mutual information</a> shared between books.</p><img class=svg-equation src=imgs-web/pmi.svg alt="formula for determining the pointwise mutual information between two books"><p>High PMI scores are produced when the joint probability of liking two books <em>a</em> and <em>b</em> exceeds the expected probability of liking those same two books assuming independence. Now it&rsquo;s just a matter of computing these distributions, but in order to do so we now need to define <em>like</em> and <em>dislike</em>&mldr; Well I hate to disappoint:</p><img class=svg-equation src=imgs-web/pmi_frequency.svg alt="pointwise mutual information frequency"><p>Not only was this the very first thing I tried, and after testing maybe twenty variants (this includes model training too!) it was still producing the best embeddings. I know, what a letdown&mldr; Now the original question of <em>similarity</em> can be resolved with the following:</p><img class=svg-equation src=imgs-web/y_true.svg alt="ground truth assumption"><p>With everything defined, the filtered 26.8M reviews were expanded into just over 300M pair-wise training rows. Each book was represented by a one-hot encoded array (1x51847) and compressed into a 64D latent space by the model. To further accentuate the clusters, instead of running through each training row per epoch, I sampled rows proportional to the combined (book a + book b) review count frequency. After model training, the 64D book vectors were further compressed down to 2D via t-SNE. The output of which can be seen below.</p><img src=imgs-web/tsne.png loading=lazy alt="book vector latent embeddings t-sne output"><p>Because t-SNE doesn&rsquo;t care about overlapping points I needed a way to both remove the overlap and add some padding around the book covers. The script I wrote to accomplish this iteratively moves the book covers while also producing animations that are oddly satisfying&mldr;</p><img class=img-with-border src=imgs-web/book-displacement.gif loading=lazy alt="iterative book cover movement animation"><h2 id=thoughts-on-v20>Thoughts on v2.0</h2><p>My favorite books fall within the intersection of engineering and adventure. Not &ldquo;engineering&rdquo; as a subject, but rather from the <em>perspective</em> of the engineers. My favorite book of all time, Skunkworks by Ben Rich captures this beautifully. The fact that Skunkworks hasn&rsquo;t been made into a movie in the style of the <em>The Big Short</em> blows my mind. Anyway, books like Apollo (Charles Murray & Catherine Cox), The Descent (Brad Matsen), The Fastest Men on Earth (Paul Clifton), and The First Crossing of the Polar Sea (Roald Amundsen) are other great books in this area. But since aerospace engineering doesn&rsquo;t have a whole lot of overlap with deep sea exploration, I never get served these recommendations online. Thank goodness for <a href=https://www.ohiobookstore.net/>The Ohio Book Store</a>!</p><p>Anyway, I&rsquo;ve been experimenting with the idea of long tail book recommendations and fuzzy vectors and the initial results have me really excited. I just want more serendipitous book suggestions!</p><div id=footer-v2><center><p style=word-spacing:.3rem><a class="plausible-event-name=footer+home" href=/>Home</a> |
<a class="plausible-event-name=footer+about" href=/about>About</a> |
<a class="plausible-event-name=footer+rss" href=/index.xml>RSS</a></p></center></div><script>const change_img=b=>{x=document.getElementById("genre-img"),x.src="imgs-web/genre-clusters/"+b+'.png';var a=document.getElementById("genre-container").querySelectorAll('div');for(let c=0;c<a.length;c++)a[c].id==b?a[c].style.backgroundColor='red':a[c].style.backgroundColor=''};change_img("comics")</script><style>.book-desc p{font-size:.9rem;line-height:1.2rem}#map{width:100%;height:450px}#footer-v2{padding-top:10rem}#footer-v2 a{color:var(--main-text-color)}.markdown{padding-bottom:4rem}.img-with-border{border-style:solid;border-width:1px;border-color:#000}.genre-block{text-align:left;padding-left:.5rem;padding-right:.5rem;padding-top:.2rem;padding-bottom:.2rem;cursor:pointer;display:inline-block;border-radius:5px}.genre-block:hover{background-color:lightgrey}#genre-container{text-align:center;display:inline-block;width:100%;margin-bottom:1rem}.leaflet-container{max-width:100%;max-height:100%;background:#000}#search{font-size:1rem;margin-bottom:.25rem;height:24px;margin-left:6px}#suggestions{width:370px;max-height:300px;background-color:#fff;margin-left:0;padding-left:1rem;list-style-type:none;list-style-position:inside;padding-top:.75rem;padding-bottom:.75rem;max-height:200px;overflow-y:auto}#suggestions li{cursor:pointer;overflow:hidden;white-space:nowrap;text-overflow:ellipsis;display:block;max-height:200px;overflow-y:auto;margin-bottom:0}#suggestions li:hover{background-color:lightgrey}</style><link href=/js/leaflet/1.9.3/leaflet.css rel=stylesheet><link href=/js/leaflet-fullscreen/1.0.2/leaflet.fullscreen.css rel=stylesheet><script src=/js/leaflet/1.9.3/leaflet.js></script><script src=/js/leaflet-fullscreen/1.0.2/Leaflet.fullscreen.min.js></script><script src=uFuzzy.iife.min.js></script><script src=visual-book-recs.js></script></div></div></body></html>