<!doctype html><html lang=en><head><meta charset=utf-8><title>Nathan Rooy</title>
<meta content="Nathan Rooy" name=author><meta content="en" name=language><meta content="width=device-width,minimum-scale=1" name=viewport><meta content="nathan.fun" property="og:site_name"><meta content="nathan.fun" property="twitter:domain"><meta content="article" property="og:type"><meta content="https://nathan.fun/posts/2019-11-27/georeferencing-historical-maps-of-cincinnati/" property="og:url"><meta content="https://nathan.fun/posts/2019-11-27/georeferencing-historical-maps-of-cincinnati/" name=twitter:url><meta content="Nathan A. Rooy" name=copyright><meta content="summary_large_image" name=twitter:card><meta content="Cincinnati,QGIS,Python,Leaflet" name=keywords><meta content="Visualizing One Hundred Years of Cincinnati Maps" name=twitter:title><meta content="Visualizing One Hundred Years of Cincinnati Maps" property="og:title"><meta content="Georeferencing historical maps of Cincinnati" name=description><meta content="Georeferencing historical maps of Cincinnati" name=twitter:description><meta content="Georeferencing historical maps of Cincinnati" property="og:description"><meta content="https://nathan.fun/posts/2019-11-27/georeferencing-historical-maps-of-cincinnati/initial-compare.jpg" name=twitter:image><meta content="https://nathan.fun/posts/2019-11-27/georeferencing-historical-maps-of-cincinnati/initial-compare.jpg" property="og:image"><meta content="https://nathan.fun/posts/2019-11-27/georeferencing-historical-maps-of-cincinnati/initial-compare.jpg" name=thumbnail><link href=https://nathan.fun/index.xml rel=alternate type=application/rss+xml title="Nathan Rooy"><link href=/favicon/favicon.png rel=icon type=image/png><link href=/fonts/figtree-v1-latin-regular.woff2 rel=preload as=font type=font/woff2 crossorigin><link href=https://nathan.fun/posts/2019-11-27/georeferencing-historical-maps-of-cincinnati/ rel=canonical><link rel=blogroll type=text/xml href=https://raw.githubusercontent.com/nathanrooy/feedly-opml-archiver/refs/heads/main/feedly.opml><script defer data-domain=nathan.fun src=https://plausible.io/js/script.tagged-events.js></script><style>:root{--main-text-color:#222;--main-text-weight:400;--text-bold:600;--font-family:"Figtree", sans-serif;--background-light:#F5F5F5;--link-text-color:#0955b5;--dark-text-color:#999}html{font-size:16px}body{-webkit-font-smoothing:antialiased;font-family:var(--font-family);color:var(--main-text-color);font-weight:var(--main-text-weight)}.wrapper{max-width:660px;margin:6rem auto 0;padding:1rem}a{text-decoration:none;color:var(--link-text-color)}a:hover{text-decoration:underline}a:visited{color:var(--link-text-color)}::selection{background:#fff9c4;text-shadow:none}img{margin:1.5em auto;max-width:100%;display:block}a img{border:none}@font-face{font-family:Figtree;font-style:normal;font-weight:400;font-display:swap;src:url(/fonts/figtree-v1-latin-regular.eot);src:local(''),url(/fonts/figtree-v1-latin-regular.eot?#iefix)format('embedded-opentype'),url(/fonts/figtree-v1-latin-regular.woff2)format('woff2'),url(/fonts/figtree-v1-latin-regular.woff)format('woff'),url(/fonts/figtree-v1-latin-regular.ttf)format('truetype'),url(/fonts/figtree-v1-latin-regular.svg#Figtree)format('svg')}@font-face{font-family:Figtree;font-style:normal;font-weight:600;font-display:swap;src:url(/fonts/figtree-v1-latin-600.eot);src:local(''),url(/fonts/figtree-v1-latin-600.eot?#iefix)format('embedded-opentype'),url(/fonts/figtree-v1-latin-600.woff2)format('woff2'),url(/fonts/figtree-v1-latin-600.woff)format('woff'),url(/fonts/figtree-v1-latin-600.ttf)format('truetype'),url(/fonts/figtree-v1-latin-600.svg#Figtree)format('svg')}.home-page ul a{color:var(--main-text-color)}.home-page .post-ul{list-style-type:none;padding-left:0;line-height:1.6em;margin-top:0}.home-page .post-li{overflow:hidden;margin-bottom:.3rem}.home-page .post-li-title{font-size:1.2rem;width:95%;text-overflow:ellipsis;white-space:nowrap;overflow:hidden;float:left}.home-page .post-li-date{padding-bottom:1em;color:var(--dark-text-color)}@media only screen and (max-width:750px){.wrapper{margin-top:2.5rem;margin-left:0}.home-page .post-ul{line-height:1.5em;margin-top:.2rem;padding-left:0}}.math-block{margin-top:2rem;margin-bottom:2rem}mtext{position:absolute;right:0}.inline-svg-equation{text-align:center;margin:1.5em auto;max-width:100%;display:block}ul.flat{margin:0;padding:0}ul.flat li{display:inline-block;list-style:none;margin-left:0}.post-header h1{font-weight:var(--main-text-weight);font-size:2.3rem;color:var(--main-text-color);line-height:2.64rem}.post ul li{margin-bottom:10px}.post ul li p{display:inline}.post .post-header{margin-bottom:2.5rem}.post .post-header .title{margin:0}.post hr{margin:4rem 0;height:1px;border:none;color:var(--main-text-color);background-color:var(--main-text-color)}.markdown .post-update{background-color:var(--background-light);border-left:10px solid;border-color:#e74c3c;padding:1.5rem;margin:1rem 0 2rem;line-height:1.5rem;font-size:15px}.highlighter-rouge{position:relative;font-size:.75rem;color:var(--main-text-color);border:1px solid;border-color:#e6e6e6;border-radius:3px;background-color:var(--background-light);padding:.1rem .2rem}.figcaption{font-size:.8rem;padding-bottom:1rem}.markdown{padding-bottom:8rem}.markdown ol li{padding-bottom:.75em}.markdown p{font-size:1rem;margin:0 0 1rem;line-height:1.7rem;letter-spacing:.01rem;word-spacing:.025rem}.markdown blockquote{background-color:var(--background-light);border-left:10px solid;border-color:#2dad60;padding:1.5rem;margin:0 0 1rem;line-height:1.5rem;font-size:15px}.markdown .footnotes ol{counter-reset:item;padding-left:0;padding-right:0;width:fit-content;color:var(--dark-text-color)}.markdown .footnotes li{display:block;padding-bottom:0}.markdown .footnotes li::before{content:counter(item)". ";counter-increment:item;width:2em;display:inline-block;position:absolute}.markdown .footnotes li p{padding-left:2rem;line-height:1.25rem}.markdown .footnotes li a{color:var(--dark-text-color)}.markdown .footnotes li a:hover{color:var(--main-text-color)}h2{font-size:1.2rem;font-weight:var(--text-bold);margin-bottom:.3em}*+h2{padding-top:2rem}.markdown .ul-style-b li{margin-bottom:.5rem;font-size:16px}.TLDR{font-size:1.1rem;line-height:1.7rem;letter-spacing:.02rem}table{width:100%;font-size:14px;letter-spacing:-.01em;border-collapse:collapse;margin-bottom:2em;margin-top:2em;line-height:1.2rem}table th{text-align:left}table thead{border-bottom:1px solid var(--main-text-color);line-height:1.4em}#map img{margin:0;max-width:100%;display:block}figure{margin:0;text-align:center}ul{padding-left:15px;list-style:disc inside}.highlight pre{padding:20px;background-color:transparent!important;overflow:auto;word-wrap:normal;white-space:pre}.highlight{background:0 0;background-color:var(--background-light)}@media only screen and (min-width:751px){#burger{padding-left:2rem;padding-top:2rem}}@media only screen and (max-width:750px){#burger{padding-left:1rem;padding-top:1rem}}#burger{font-family:var(--font-family);font-weight:400;color:#a9a9a9;font-size:1.5rem}#burger a{display:inline-block;padding-right:.8rem}#burger label{cursor:pointer}#burger label:hover{color:var(--main-text-color)}#nav-icons{padding-left:.8rem}#nav-icons svg{max-height:20px;margin-bottom:-.05rem;color:var(--main-text-color)}#l1-val{position:relative;top:-.12rem}#l2-val{position:relative;top:-.2rem;padding-left:.1rem;padding-right:.1rem}#burger-cbox{display:none}#label-1{display:inline-block}#label-2{display:none}#burger-cbox:not(:checked)~#nav-icons{display:none}#burger-cbox:checked~#nav-icons{display:inline-block}#burger-cbox:checked~#label-1{display:none}#burger-cbox:checked~#label-2{display:inline-block;color:var(--main-text-color)}</style><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/katex.min.css integrity=sha384-nB0miv6/jRmo5UMMR1wu3Gz6NLsoTkbqJghGIsx//Rlm+ZU03BU6SQNC66uf4l5+ crossorigin=anonymous></head><body><div class=header><nav><div id=burger><input type=checkbox id=burger-cbox>
<label id=label-1 for=burger-cbox><span>[</span><span id=l1-val>+</span><span>]</span>
</label><label id=label-2 for=burger-cbox><span>[</span><span id=l2-val>x</span><span>]</span></label><div id=nav-icons><a class="plausible-event-name=burger+home" aria-label=Home style=padding-right:.7rem href=/><svg id="home-icon" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="feather feather-home"><path d="M3 9l9-7 9 7v11a2 2 0 01-2 2H5a2 2 0 01-2-2z"/><polyline points="9 22 9 12 15 12 15 22"/></svg></a>
<a class="plausible-event-name=burger+reading" aria-label=Reading href=/reading><svg width="24" height="24" viewBox="0 0 23.809855 18.892912" id="svg5"><defs id="defs2"/><g id="layer1" transform="translate(-6.352941,-30.26865)"><g id="g39" transform="matrix(0.26458333,0,0,0.26458333,5.0300244,26.48677)"><path class="st0" d="m92.22 22.9v59C74.24 76.35 61.26 78.85 54.73 81.04 59.2 76.64 68.54 70.55 84.16 74.14l1.69.39V21.42c2.17.29 4.3.77 6.37 1.48z" id="path11"/><path class="st0" d="M45.24 81.04C38.73 78.85 25.74 76.35 7.77 81.9v-59c2.06-.71 4.2-1.19 6.37-1.48v53.11l1.68-.39c15.61-3.58 24.96 2.5 29.42 6.9z" id="path13"/><polygon points="48.86,85.63 48.82,85.58 48.91,85.63" id="polygon15"/><polygon points="51.17,85.58 51.13,85.63 50,85.63 51.09,85.62" id="polygon17"/><path d="m94.09 20.63c-2.68-1-5.45-1.65-8.24-2.02v-2.94l-1.08-.24c-17.8-4.09-28.32 3.81-32.9 8.68-.81.87-1.44 1.63-1.88 2.22C49.54 25.74 48.91 24.98 48.1 24.11c-4.58-4.87-15.11-12.76-32.9-8.68l-1.07.24v2.94c-2.8.38-5.57 1.02-8.24 2.02L5 20.97V85.7l1.81-.61c13.49-4.49 24.13-4.16 30.68-3.08 7.09 1.15 11.05 3.4 11.09 3.42l.23.14.09.06H50l1.09-.01.08-.05.23-.14c.05-.02 4-2.27 11.09-3.42 6.55-1.08 17.19-1.41 30.68 3.08l1.82.61V20.97zM7.78 81.89v-59c2.06-.71 4.2-1.19 6.37-1.48v53.11l1.68-.39c15.61-3.58 24.95 2.5 29.42 6.9-6.52-2.18-19.5-4.68-37.47.86zm40.76-1.3c-4.19-4.66-14.29-12.83-31.63-9.5v-53.2c11.11-2.28 18.93.38 24.02 3.66 2.6 1.68 4.48 3.52 5.71 4.95 1.14 1.32 1.73 2.28 1.82 2.43l.08.15zm2.76.17V29.34l.24-.4c.09-.16.68-1.12 1.82-2.44 1.23-1.43 3.11-3.27 5.71-4.94 5.08-3.29 12.91-5.95 24.02-3.67v53.2C65.54 67.72 55.4 76.13 51.3 80.76zm40.92 1.13C74.24 76.34 61.26 78.84 54.73 81.03 59.2 76.63 68.54 70.54 84.16 74.13l1.69.39v-53.1c2.16.29 4.3.77 6.37 1.48z" id="path19"/></g></g><style id="style9">.st0{fill:none}</style></svg>
</a><a class="plausible-event-name=burger+nycbike" aria-label="NYC Bike Exploring" style=margin-left:.4rem href=/bike-exploring/nyc><svg viewBox="0 0 91.5 52.5" width="32" height="24" xmlns:cc="http://creativecommons.org/ns#" xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#"><g transform="matrix(-1,0,0,1,95.8,-23.9)"><path d="m78 40.6c-3.8.0-7.3 1.2-10.2 3.2l-7.4-9.4 2.9-8.5H67c.6.0 1-.4 1-1s-.4-1-1-1H54.8c-.6.0-1 .4-1 1s.4 1 1 1h6.3l-2.3 6.7c-.2-.2-.4-.3-.7-.3H32l2.2-6.4h5.7c.6.0 1-.4 1-1s-.4-1-1-1h-6.4c-.4.0-.8.3-.9.7l-5.7 16.8c-1.5-.4-3.1-.7-4.8-.7-9.8.0-17.8 8-17.8 17.8s8 17.8 17.8 17.8 17.8-8 17.8-17.8c0-7.5-4.6-13.9-11.2-16.5l2.6-7.6 19 24.4c.1.3.3.6.6.7.1.0.2.1.3.1h.1 8.9c.5 9.4 8.3 16.8 17.8 16.8 9.8.0 17.8-8 17.8-17.8s-8-18-17.8-18zM37.8 58.4c0 8.7-7.1 15.8-15.8 15.8S6.2 67.1 6.2 58.4 13.3 42.6 22 42.6c1.4.0 2.8.2 4.1.6L21 58.1c-.2.5.1 1.1.6 1.3.1.0.2.1.3.1.4.0.8-.3.9-.7l5.1-14.9c5.9 2.2 9.9 7.9 9.9 14.5zm29.7-11.8L76 57.4H62.2c.3-4.3 2.2-8.1 5.3-10.8zm-16.7 9.6-17.1-22h24l.4.5zm1.8 1.2 7.1-20.8 6.6 8.4c-3.5 3.1-5.7 7.4-6 12.4zM78 74.2c-8.4.0-15.2-6.6-15.8-14.8H78c.4.0.7-.2.9-.6.2-.3.1-.8-.1-1.1L69 45.4c2.5-1.8 5.6-2.8 8.9-2.8 8.7.0 15.8 7.1 15.8 15.8s-7 15.8-15.7 15.8z"/></g></svg>
</a><a class="plausible-event-name=burger+about" aria-label=About href=/about><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="feather feather-user" id="about-icon"><path d="M20 21v-2a4 4 0 00-4-4H8a4 4 0 00-4 4v2"/><circle cx="12" cy="7" r="4"/></svg>
</a><a class="plausible-event-name=burger+rss" aria-label=RSS href=/index.xml><svg width="24" height="24" viewBox="0 0 30 24" fill="none" stroke="#444" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="feather feather-rss" id="rss-icon"><path d="M4 11a9 9 0 019 9"/><path d="M4 4a16 16 0 0116 16"/><circle cx="5" cy="19" r="1"/></svg></a></div></div></nav></div><div class="wrapper post"><div class=post-header><h1 class=title>Visualizing One Hundred Years of Cincinnati Maps</h1></div><hr><div class=markdown><h2>Introduction</h2><link href=jquery-ui.min.css rel=stylesheet><script src=jquery.min.js></script><script src=jquery-ui.min.js></script><script src=jquery.ui.touch-punch.min.js></script><script src=leaflet_v1.3.1.js></script><link href=leaflet_v1.3.1.css rel=stylesheet><script src=/js/leaflet-side-by-side/2.2.0/leaflet-side-by-side.min.js></script><link href=/js/leaflet-fullscreen/1.0.2/leaflet.fullscreen.css rel=stylesheet><script src=/js/leaflet-fullscreen/1.0.2/Leaflet.fullscreen.min.js></script><script src=/js/leaflet-hash/leaflet-hash.js></script><script src=post.js></script><p>A while back, someone posted on the Cincinanti subreddit an interesting mapping artifact. I didn&rsquo;t know the answer to the question, but it got me thinking about what else has changed over time in Cincinnati in regards to maps and names? Luckly the <a target=_blank href=https://digital.cincinnatilibrary.org/>Cincinnati Public Library Digital Archives</a> has a wealth of information on just this topic.</p><p style=background-color:var(--background-light);padding-top:2rem;padding-bottom:2rem><img style=height:500px;margin-top:0;margin-bottom:0 src=Screenshot_20180831-123158.png alt="cincinnati reddit mapping mystery"></p><p>I ended up downloading about a dozen maps ranging from as early as 1815 to as recent as 1900. I then <a target=_blank href=https://en.wikipedia.org/wiki/Georeferencing>georeferenced</a> these maps against a single modern map using known commonalites such as prominant intersections and landmarks. This standardization process, although a bit tedious, results in a final product which allows for a true apples to apples comparison. At this point, the maps can be stacked on top of each other and visualized. Below is the end result of this (make sure to go fullscreen!). For more on the technical details, see the <a href=#methodology>methodology section</a> below.</p><p class=post-update style=margin:0;margin-bottom:1.3rem;padding:1em><b>Note</b>: On mobile devices, the <a target=_blank href=https://github.com/digidem/leaflet-side-by-side>side-by-side</a> plugin I'm using with <a target=_blank href=https://github.com/Leaflet/Leaflet>Leaflet</a> seems to work best when both thumbs are used to navigate/zoom rather than just one...</p><div id=map><div id=date_slider_container title="Change year"><div id=date_slider></div><div id=selected_year></div></div></div><h2>Final Thoughts</h2><p>After a few weeks of georeferencing these maps, I noticed a few noteworthy observations, the first of which was the gradual development of <a target=_blank href=https://en.wikipedia.org/wiki/Washington_Park_(Cincinnati,_Ohio)>Washington Park</a> and surrounding areas. Back when Cincinnati was just a small town, the decision was made to build a cemetery on the northern most edge of the city. At the time, this land would have represented the boundary between civilization and untamed wilderness. Fast forward almost two hundred years and the city has not only expanded out far beyond these initial cemeteries, but they have become the focal point of present day downtown! Today, only a few headstones remain while the rest has been replaced with grass, a dog park and <a target=_blank href=https://en.wikipedia.org/wiki/Cincinnati_Music_Hall>Music Hall</a>.</p><img src=washington-park.jpg alt="historical changes of washington park cincinnati"><p>Another interesting observation centers around <a target=_blank href=https://en.wikipedia.org/wiki/Burnet_Woods>Burnet Woods</a> and the University of Cincinnati. I knew that UC was founded in 1819, however I never knew that the land it was built on was taken from Burnet Woods. It appears that the UC‚Äôs campus has shaved off nearly half of the original Burnet Woods.</p><img src=burnet_woods_3way_with_dates.png alt="historical changes of burnet woods cincinnati"><p>Lastly, and most importantly is the tragic renaming of Zig Zag Avenue to Fairview Avenue sometime between 1898 and today. For starters, Zig Zag Ave is the name every other street wish it had. Seriously, not even <a target=_blank href=https://en.wikipedia.org/wiki/Lombard_Street_(San_Francisco)>Lombard St.</a> is good enough for a name like that. Fairview Ave is the kind of thoughtless generic street name that belongs out in suburbia, not Clifton. What kind of monster thought this was a good idea?</p><img src=zig-zag-ave.jpg alt="zig zag ave cincinnati ohio"><p>Hopefully this can serve as a useful tool for anyone doing historical research or maybe just a fun way to explore this great city. If anyone stumbles across some high resolution maps, feel free to reach out and I can add them.</p><p>Thanks for reading, and bring back Zig Zag Ave!</p><h2>Acknowledgements</h2><p>Special thanks to Diane at the Cincinnati Public Library for going above and beyond with helping me aquire the high resolution version of these maps. üôå</p><h2 id=methodology>Methodology</h2><p>First step in turning the old map scans which come in the form of <a target=_blank href=https://en.wikipedia.org/wiki/Raster_graphics>raster</a> image data into something usefull is to standardize them somehow. Since I had no idea what <a target=_blank href=https://en.wikipedia.org/wiki/Geodetic_datum>datum</a> or <a target=_blank href=https://en.wikipedia.org/wiki/Spatial_reference_system>coordiante reference system</a> (CRS) they were originally created around I couldn‚Äôt do a direct transormation. This meant I had to put them through a round of <a target=_blank href=https://en.wikipedia.org/wiki/Georeferencing>georeferencing</a> which is basically just the cartographers version of <a target=_blank href=https://en.wikipedia.org/wiki/Image_registration>image registration</a>. Since my end game was to present these maps over the internet, I knew that the final CRS would need to be the <a targrt=_blank href=https://en.wikipedia.org/wiki/Web_Mercator_projection>web Mercator projection</a> aka EPSG:3857 which is based on the <a target=_blank href=https://en.wikipedia.org/wiki/World_Geodetic_System>WGS 84</a> datum. This is the same system that most web mapping applications such as Google Maps, <a target=_blank href=https://en.wikipedia.org/wiki/OpenStreetMap>OpenStreetMaps</a>, and Bing Maps use.</p><p>With the CRS sorted out, all that was left was to calculate the required transformation which would take take the scanned raster map images and translate them to web Mercator coordinates. This was accomplished through the use of <a target=_blank href=https://en.wikipedia.org/wiki/Thin_plate_spline>thin plate splines</a> (TPS), delaunay triangulation, and <a target=_blank href=https://en.wikipedia.org/wiki/Bicubic_interpolation>bicubic interpolation</a>.</p><p>As the name implies, TPS refers to the imaginary situation in which a thin sheet of metal is undergoing a series of bending operations. The goal with TPS is to maximize the smoothness (or minimize total bending energy) of the final metal surface, because it‚Äôs this deflection in the z-axis (orthogonal to the plane) which will control the deformation of our image. Because our images will be deformed in both the x, and y directions, we will need to solve two instances of the TPS equations.</p><p>To begin, let <span class=katex><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">{</mo><msub><mi>s</mi><mi>j</mi></msub><mo stretchy="false">}</mo><mo separator="true">,</mo><mo stretchy="false">{</mo><msub><mi>t</mi><mi>j</mi></msub><mo stretchy="false">}</mo><mo separator="true">,</mo><mtext>‚ÄÖ‚Ää</mtext><mi>j</mi><mo>=</mo><mn>1</mn><mo separator="true">,</mo><mi mathvariant="normal">.</mi><mi mathvariant="normal">.</mi><mi mathvariant="normal">.</mi><mo separator="true">,</mo><mi>n</mi></mrow><annotation encoding="application/x-tex"> \{s_j\},\{t_j\}, \; j=1,...,n </annotation></semantics></math></span> represent the landmarks (x,y coordinate pairs) from the source (<span class=katex><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>s</mi><mi>j</mi></msub></mrow><annotation encoding="application/x-tex"> s_j </annotation></semantics></math></span>) and target (<span class=katex><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>t</mi><mi>j</mi></msub></mrow><annotation encoding="application/x-tex"> t_j </annotation></semantics></math></span>) images. Below is an example of the process. Note that only five coordinate pairs are displayed for visualization purposes. In reality, most maps require at least ~50 coordinate pairs while others require over 300 coordinate pairs.</p><img src=initial-compare.jpg alt="georeferencing problem specification"><center class=figcaption>Figure 1: Source (left) and target (right)</center><p>The end goal is to find a smooth function such that: <span class=katex><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>f</mi><mo>:</mo><mi mathvariant="normal">Œ©</mi><mo>‚äÇ</mo><msup><mi mathvariant="double-struck">R</mi><mi>d</mi></msup><mo>‚Üí</mo><msup><mi mathvariant="double-struck">R</mi><mi>d</mi></msup></mrow><annotation encoding="application/x-tex"> f : \Omega \subset \mathbb{R}^d \to \mathbb{R}^d </annotation></semantics></math></span> that satisfies the interpolation conditions:</p><div class=math-block><span class=katex><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mtable width="100%"><mtr><mtd width="50%"></mtd><mtd><mrow><mi>f</mi><mrow><mo fence="true">(</mo><msub><mi>s</mi><mi>j</mi></msub><mo fence="true">)</mo></mrow><mo>=</mo><msub><mi>t</mi><mi>j</mi></msub><mspace width="2em"/><mtext>for</mtext><mtext>‚ÄÖ‚Ää</mtext><mi>j</mi><mo>=</mo><mn>1</mn><mo separator="true">,</mo><mi mathvariant="normal">.</mi><mi mathvariant="normal">.</mi><mi mathvariant="normal">.</mi><mo separator="true">,</mo><mi>n</mi></mrow></mtd><mtd width="50%"></mtd><mtd><mtext>(1)</mtext></mtd></mtr></mtable><annotation encoding="application/x-tex"> f \left( s_j \right) = t_j \qquad \text{for} \; j=1,...,n \tag{1} </annotation></semantics></math></span></div><p>Once these conditions have been met, the situation becomes one of minimization.</p><div class=math-block><span class=katex><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mi mathvariant="script">T</mi><mrow><mo fence="true">‚à•</mo><mi>f</mi><mo fence="true">‚à•</mo></mrow><mo>=</mo><munderover><mo>‚àë</mo><mrow><mi>j</mi><mo>=</mo><mn>1</mn></mrow><mi>n</mi></munderover><mo stretchy="false">‚à•</mo><mi>f</mi><mrow><mo fence="true">(</mo><msub><mi>s</mi><mi>j</mi></msub><mo fence="true">)</mo></mrow><mo>‚àí</mo><msub><mi>t</mi><mi>j</mi></msub><mo stretchy="false">‚à•</mo></mrow><annotation encoding="application/x-tex"> \mathcal{T} \left\| f \right\| = \sum_{j=1}^n \lVert f \left( s_j \right) - t_j \rVert </annotation></semantics></math></span></div><p>Where <span class=katex><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">‚à•</mo><mo>‚ãÖ</mo><mo stretchy="false">‚à•</mo></mrow><annotation encoding="application/x-tex"> \lVert \cdot \rVert </annotation></semantics></math></span>
represents the <a target=_blank href=https://en.wikipedia.org/wiki/Norm_(mathematics)#Euclidean_norm>Euclidean norm</a>. Depending on the spatial distribution of the landmark coordinate pairs, the smoothness of the interpolated surface can vary drastically. To help improve the smoothness of the surface, a gradient based regularization term can be added at the expense of losing the initial interpolating conditions from Equation [<a href=#eq-1>1</a>]. The addition of this regularization term produces the following objective function:</p><div class=math-block><span class=katex><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mtable width="100%"><mtr><mtd width="50%"></mtd><mtd><mrow><mi mathvariant="script">T</mi><mrow><mo fence="true">‚à•</mo><mi>f</mi><mo fence="true">‚à•</mo></mrow><mo>=</mo><munderover><mo>‚àë</mo><mrow><mi>j</mi><mo>=</mo><mn>1</mn></mrow><mi>n</mi></munderover><mo stretchy="false">‚à•</mo><mi>f</mi><mrow><mo fence="true">(</mo><msub><mi>s</mi><mi>j</mi></msub><mo fence="true">)</mo></mrow><mo>‚àí</mo><msub><mi>t</mi><mi>j</mi></msub><mo stretchy="false">‚à•</mo><mo>+</mo><mi>Œª</mi><msub><mo>‚à´</mo><mi mathvariant="normal">Œ©</mi></msub><mo stretchy="false">‚à£</mo><msup><mi mathvariant="normal">‚àá</mi><mi>m</mi></msup><mi>f</mi><msup><mo stretchy="false">‚à£</mo><mn>2</mn></msup><mi>d</mi><mi mathvariant="normal">Œ©</mi></mrow></mtd><mtd width="50%"></mtd><mtd><mtext>(2)</mtext></mtd></mtr></mtable><annotation encoding="application/x-tex"> \mathcal{T} \left\| f \right\| = \sum_{j=1}^n \lVert f \left( s_j \right) - t_j \rVert + \lambda  \int_\Omega \lvert \nabla^m f \rvert^2 d\Omega \tag{2} </annotation></semantics></math></span></div><p>Where <span class=katex><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi mathvariant="normal">Œ©</mi></mrow><annotation encoding="application/x-tex"> \Omega </annotation></semantics></math></span> represents the domain of the image. This objective function <span class=katex><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>f</mi></mrow><annotation encoding="application/x-tex"> f </annotation></semantics></math></span> is what‚Äôs known as a polyharmonic spline, which when <span class=katex><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>m</mi><mo>=</mo><mn>2</mn></mrow><annotation encoding="application/x-tex"> m=2 </annotation></semantics></math></span>, becomes a special case known as the thin plate spline. The weight of the regularization parameter is controlled using <span class=katex><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>Œª</mi><mo>‚â•</mo><mn>0</mn></mrow><annotation encoding="application/x-tex"> \lambda \geq 0 </annotation></semantics></math></span> (higher values of lambda result in a smoother surface). In two dimensions, the thin plate spline minimizes the following objective function:</p><div class=math-block><span class=katex><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mtable width="100%"><mtr><mtd width="50%"></mtd><mtd><mrow><mi mathvariant="script">T</mi><mrow><mo fence="true">‚à•</mo><mi>f</mi><mo fence="true">‚à•</mo></mrow><mo>=</mo><munderover><mo>‚àë</mo><mrow><mi>j</mi><mo>=</mo><mn>1</mn></mrow><mi>n</mi></munderover><mo stretchy="false">‚à•</mo><mi>f</mi><mrow><mo fence="true">(</mo><msub><mi>s</mi><mi>j</mi></msub><mo fence="true">)</mo></mrow><mo>‚àí</mo><msub><mi>t</mi><mi>j</mi></msub><mo stretchy="false">‚à•</mo><mo>+</mo><mi>Œª</mi><mo>‚à¨</mo><mrow><mo fence="true">[</mo><msup><mrow><mo fence="true">(</mo><mfrac><mrow><msup><mi mathvariant="normal">‚àÇ</mi><mn>2</mn></msup><mi>f</mi></mrow><mrow><mi mathvariant="normal">‚àÇ</mi><msup><mi>y</mi><mn>2</mn></msup></mrow></mfrac><mo fence="true">)</mo></mrow><mn>2</mn></msup><mo>+</mo><mn>2</mn><msup><mrow><mo fence="true">(</mo><mfrac><mrow><msup><mi mathvariant="normal">‚àÇ</mi><mn>2</mn></msup><mi>f</mi></mrow><mrow><mi mathvariant="normal">‚àÇ</mi><mi>y</mi><mi mathvariant="normal">‚àÇ</mi><mi>x</mi></mrow></mfrac><mo fence="true">)</mo></mrow><mn>2</mn></msup><mo>+</mo><msup><mrow><mo fence="true">(</mo><mfrac><mrow><msup><mi mathvariant="normal">‚àÇ</mi><mn>2</mn></msup><mi>f</mi></mrow><mrow><mi mathvariant="normal">‚àÇ</mi><msup><mi>x</mi><mn>2</mn></msup></mrow></mfrac><mo fence="true">)</mo></mrow><mn>2</mn></msup><mo fence="true">]</mo></mrow><mi>d</mi><mi>x</mi><mi>d</mi><mi>y</mi></mrow></mtd><mtd width="50%"></mtd><mtd><mtext>(3)</mtext></mtd></mtr></mtable><annotation encoding="application/x-tex"> \mathcal{T} \left\| f \right\| = \sum_{j=1}^n \lVert f \left( s_j \right) - t_j \rVert + \lambda  \iint \left[ \left( \frac{\partial^2 f}{\partial y^2} \right)^2 + 2 \left( \frac{\partial^2 f}{\partial y \partial x} \right)^2  + \left( \frac{\partial^2 f}{\partial x^2} \right)^2 \right] dx dy \tag{3} </annotation></semantics></math></span></div><p>Equtation [3] represents the closed form solution to the thin plate spline interpolation which was originally developed by Dunchon<sup id=fnref:1><a href=#fn:1 class=footnote-ref role=doc-noteref>1</a></sup> in 1977. It wasn‚Äôt until 1990 when Whaba<sup id=fnref:2><a href=#fn:2 class=footnote-ref role=doc-noteref>2</a></sup> proved the existance of a unique minimizer as seen below<sup id=fnref:3><a href=#fn:3 class=footnote-ref role=doc-noteref>3</a></sup>:</p><div class=math-block><span class=katex><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mtable width="100%"><mtr><mtd width="50%"></mtd><mtd><mrow><mi>f</mi><mrow><mo fence="true">(</mo><mi>x</mi><mo separator="true">,</mo><mi>y</mi><mo fence="true">)</mo></mrow><mo>=</mo><msub><mi>a</mi><mn>1</mn></msub><mo>+</mo><msub><mi>a</mi><mn>2</mn></msub><mi>x</mi><mo>+</mo><msub><mi>a</mi><mn>3</mn></msub><mi>y</mi><mo>+</mo><munderover><mo>‚àë</mo><mrow><mi>j</mi><mo>=</mo><mn>1</mn></mrow><mi>n</mi></munderover><msub><mi>w</mi><mi>i</mi></msub><mi>U</mi><mrow><mo fence="true">(</mo><mo stretchy="false">‚à•</mo><msub><mi>P</mi><mi>i</mi></msub><mo>‚àí</mo><mo stretchy="false">(</mo><mi>x</mi><mo separator="true">,</mo><mi>y</mi><mo stretchy="false">)</mo><mo stretchy="false">‚à•</mo><mo fence="true">)</mo></mrow></mrow></mtd><mtd width="50%"></mtd><mtd><mtext>(4)</mtext></mtd></mtr></mtable><annotation encoding="application/x-tex"> f \left(x,y \right) = a_1 + a_2 x + a_3 y + \sum_{j=1}^n w_i U \left( \lVert P_i - (x,y) \rVert \right) \tag{4} </annotation></semantics></math></span></div><p>Equation [4] represents the combination of an <a target=_blank href=https://en.wikipedia.org/wiki/Affine_transformation>affine</a> and non-affine transformation. In most texts, the non-affine portion: <span class=katex><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext>¬†</mtext><mi>U</mi><mo stretchy="false">(</mo><mi>r</mi><mo stretchy="false">)</mo><mo>=</mo><mfrac><mn>1</mn><mrow><mn>8</mn><mi>œÄ</mi></mrow></mfrac><msup><mi>r</mi><mn>2</mn></msup><mi>log</mi><mo>‚Å°</mo><msup><mi>r</mi><mn>2</mn></msup></mrow><annotation encoding="application/x-tex"> \ U (r) = \frac{1}{8 \pi} r^2 \log r^2 </annotation></semantics></math></span>, is often simplified into Equation [5] because the coefficient <span class=katex><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mfrac><mn>1</mn><mrow><mn>8</mn><mi>œÄ</mi></mrow></mfrac></mrow><annotation encoding="application/x-tex"> \frac{1}{8 \pi} </annotation></semantics></math></span> is dissolved into the weight variable <span class=katex><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>w</mi><mi>i</mi></msub></mrow><annotation encoding="application/x-tex"> w_i </annotation></semantics></math></span>.</p><div class=math-block><span class=katex><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mtable width="100%"><mtr><mtd width="50%"></mtd><mtd><mrow><mi>U</mi><mo>=</mo><msup><mi>r</mi><mn>2</mn></msup><mi>log</mi><mo>‚Å°</mo><msup><mi>r</mi><mn>2</mn></msup></mrow></mtd><mtd width="50%"></mtd><mtd><mtext>(5)</mtext></mtd></mtr></mtable><annotation encoding="application/x-tex"> U = r^2 \log r^2 \tag{5} </annotation></semantics></math></span></div><p>Since the non-affine portion of Equation [4] is a function of radius, it represents the dominate influence of deformation while in close proximity of the control points. Further away from the landmark locations, the strength of the non-affine portion (Equation [5]) diminishes towards zero. This results in the affine portion of Equation [4] exerting more influence at the extremities of the image.</p><p>Now that the transformation between the source and target can be computed, the next step is to resample the pixels. Because the images we will be dealing with come from a scanner or other digital source, each pixel represents a discrete RGB tuple point in gridded two-dimensional space. unfortunately after the TPS transformation has been applied, the pixel locations become stretched and skewed into an unstructured mess. The task at hand is to now interploate these scattered RGB tuples back onto a structured grid so they can be used like a normal image. More specifically, we want to interpolate the RGB values from the displaced source image pixels onto the exact (x, y) pixel grid of the target image.</p><img alt="georeferencing pixel resampling" src=resampling.png><center class=figcaption>Figure 2: Pixel resampling</center><p>Unlike the TPS transformation which I had to code from scratch, resampling is a faily common exercise so I was able to use the built in function <code class=highlighter-rouge>griddata</code> found in <a target=_blank href=https://docs.scipy.org/doc/scipy/reference/generated/scipy.interpolate.griddata.html>SciPy</a>. The <code class=highlighter-rouge>griddata</code> function first generates the <a target=_blank href=https://en.wikipedia.org/wiki/Delaunay_triangulation>delaunay triangulation</a> across all of the displaced source pixels using <a target=_blank href=http://www.qhull.org/>Qhull</a></p>.
<img alt="georeferencing delaunay triangulation" src=resampling_with_delaunay.png><center class=figcaption>Figure 3: Delaunay triangulation</center><p>Once the triangulation has been generated, a piecewise cubic Bezier polynomial is fitted to each triangle using a Clough-Tocher scheme.<sup id=fnref:4><a href=#fn:4 class=footnote-ref role=doc-noteref>4</a></sup><sup>, </sup><sup id=fnref:5><a href=#fn:5 class=footnote-ref role=doc-noteref>5</a></sup> Since the interpolant is guaranteed to be continuously differentiable, the gradient can be chosen so as to minimize the interpolating surface curvature. The gradient is minimized using a global scheme.<sup id=fnref:6><a href=#fn:6 class=footnote-ref role=doc-noteref>6</a></sup><sup>, </sup><sup id=fnref:7><a href=#fn:7 class=footnote-ref role=doc-noteref>7</a></sup> After the resampling has been applied, an example of the final map can be seen below.</p><img alt="georeferencing final output" src=final-compare.jpg><center class=figcaption>Figure 4: Final transformation</center><p>If you‚Äôre interested in georeferencing images for yourself and don‚Äôt want to start from scratch like I did, <a target=_blank href=https://qgis.org>QGIS</a> has a very nice georeferencing plugin.</p><style>#map{width:100%;height:600px}#date_slider_container{position:absolute;top:124px;left:8px;z-index:1000}#date_slider{margin:13px;height:200px}#selected_year{font-size:20px;color:grey;background-color:#fff;font-weight:700;position:absolute;bottom:200px;left:34px;border-radius:10px;padding-right:.4em;padding-left:.4em}</style><div class=footnotes role=doc-endnotes><hr><ol><li id=fn:1><p>Jean Duchon. Splines minimizing rotation-invariant semi-norms in sobolev spaces. In Constructive Theory of Functions of Several Variables, pages 85‚Äì100. Springer, 1977.&#160;<a href=#fnref:1 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li><li id=fn:2><p>Grace Wahba. Spline Models for Observational Data. Society for Industrial and Applied Mathematics, 1990.&#160;<a href=#fnref:2 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li><li id=fn:3><p>Eric Ng. <a target=_blank href=http://www.imaginglab.ca/data/undergrad_thesis_eric.pdf><i>Thin Plate Spline Image Registration in the Presence of Localized Landmark Errors</i></a>. (University of Ontario Institute of Technology, 2017)&#160;<a href=#fnref:3 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li><li id=fn:4><p>Peter Alfeld. <a target=_blank href=https://www.sciencedirect.com/science/article/abs/pii/0167839684900293><i>A trivariate clough-tocher scheme for tetrahedral data</i></a>. (Computer Aided Geometric Design, November 1984, Pages 169-181)&#160;<a href=#fnref:4 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li><li id=fn:5><p>Gerald Farin. <a target=_blank href=https://www.sciencedirect.com/science/article/abs/pii/0167839686900166><i>Triangular Bernstein-B√©zier patches</i></a>. (Computer Aided Geometric Design, August 1986, Pages 83-127)&#160;<a href=#fnref:5 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li><li id=fn:6><p>Gregory Nielson. <a target=_blank href=https://www.ams.org/journals/mcom/1983-40-161/S0025-5718-1983-0679444-7/S0025-5718-1983-0679444-7.pdf><i>A method for interpolating scattered data based upon a minimum norm network</i></a>. (Mathematics of Computation Volume 40, Number 161. January 1983 Pages 245-271)&#160;<a href=#fnref:6 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li><li id=fn:7><p>R.J. Renka and A. K. Cline. <a target=_blank href=https://projecteuclid.org/download/pdf_1/euclid.rmjm/1250127673><i>A triangle-based c<sup>1</sup> interpolation method</i></a>. (Rockey Mountain Journal of Mathematics. Volume 14, November 1, Winter 1984&#160;<a href=#fnref:7 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li></ol></div></div></div></body></html>