<html lang=en><head><meta charset=utf-8><title>Nathan Rooy</title><meta content="Nathan Rooy" name=author><meta content=en name=language><meta content="width=device-width,minimum-scale=1" name=viewport><meta content=nathan.fun property=og:site_name><meta content=nathan.fun property=twitter:domain><meta content=article property=og:type><meta content=https://nathan.fun/posts/2019-03-05/blenderfoam-aerodynamic-shape-optimization/ property=og:url><meta content=https://nathan.fun/posts/2019-03-05/blenderfoam-aerodynamic-shape-optimization/ name=twitter:url><meta content="Nathan A. Rooy" name=copyright><meta content=summary_large_image name=twitter:card><meta content="OpenFOAM,Blender,shape optimization,aerodynamics" name=keywords><meta content="BlenderFOAM: Open-source Fluid Based Shape Optimization" name=twitter:title><meta content="BlenderFOAM: Open-source Fluid Based Shape Optimization" property=og:title><meta content="aerodynamic shape optimization for the masses" name=description><meta content="aerodynamic shape optimization for the masses" name=twitter:description><meta content="aerodynamic shape optimization for the masses" property=og:description><meta content=https://nathan.fun/posts/2019-03-05/blenderfoam-aerodynamic-shape-optimization/imgs-web/Benchmark_4_P_NEWUOA.jpg name=twitter:image><meta content=https://nathan.fun/posts/2019-03-05/blenderfoam-aerodynamic-shape-optimization/imgs-web/Benchmark_4_P_NEWUOA.jpg property=og:image><meta content=https://nathan.fun/posts/2019-03-05/blenderfoam-aerodynamic-shape-optimization/imgs-web/Benchmark_4_P_NEWUOA.jpg name=thumbnail><link title="Nathan Rooy" href=https://nathan.fun/index.xml rel=alternate type=application/rss+xml><link href=/favicon/favicon.png rel=icon type=image/png><link as=font crossorigin href=/fonts/figtree-v1-latin-regular.woff2 rel=preload type=font/woff2><link href=https://nathan.fun/posts/2019-03-05/blenderfoam-aerodynamic-shape-optimization/ rel=canonical><link href=https://raw.githubusercontent.com/nathanrooy/feedly-opml-archiver/refs/heads/main/feedly.opml rel=blogroll type=text/xml><script data-domain=nathan.fun defer src=https://plausible.io/js/script.tagged-events.js></script><style>:root{--main-text-color:#222;--main-text-weight:400;--text-bold:600;--font-family:"Figtree",sans-serif;--background-light:#f5f5f5;--link-text-color:#0955b5;--dark-text-color:#999}html{font-size:16px}body{-webkit-font-smoothing:antialiased;font-family:var(--font-family);color:var(--main-text-color);font-weight:var(--main-text-weight)}.wrapper{max-width:660px;margin:6rem auto 0;padding:1rem}@media only screen and (width<=750px){.wrapper{margin-top:2.5rem;margin-left:0}}a{color:var(--link-text-color);text-decoration:none}::selection{text-shadow:none;background:#fff9c4}img{max-width:100%;margin:1.5em auto;display:block}@font-face{font-family:Figtree;font-style:normal;font-weight:400;font-display:swap;src:url(/fonts/figtree-v1-latin-regular.eot);src:local(""),url(/fonts/figtree-v1-latin-regular.eot?#iefix)format("embedded-opentype"),url(/fonts/figtree-v1-latin-regular.woff2)format("woff2"),url(/fonts/figtree-v1-latin-regular.woff)format("woff"),url(/fonts/figtree-v1-latin-regular.ttf)format("truetype"),url(/fonts/figtree-v1-latin-regular.svg#Figtree)format("svg")}@font-face{font-family:Figtree;font-style:normal;font-weight:600;font-display:swap;src:url(/fonts/figtree-v1-latin-600.eot);src:local(""),url(/fonts/figtree-v1-latin-600.eot?#iefix)format("embedded-opentype"),url(/fonts/figtree-v1-latin-600.woff2)format("woff2"),url(/fonts/figtree-v1-latin-600.woff)format("woff"),url(/fonts/figtree-v1-latin-600.ttf)format("truetype"),url(/fonts/figtree-v1-latin-600.svg#Figtree)format("svg")}.wrapper{padding-bottom:8rem}.markdown ol li{padding-bottom:.75em}p{letter-spacing:.01rem;word-spacing:.025rem;margin:0 0 1rem;font-size:1rem;line-height:1.7rem}h1{font-weight:var(--main-text-weight);color:var(--main-text-color);font-size:2.3rem;line-height:2.64rem}h2{font-size:1.2rem;font-weight:var(--text-bold);margin-bottom:.3em}*+h2{padding-top:2rem}hr{height:1px;color:var(--main-text-color);background-color:var(--main-text-color);border:none;margin:4rem 0}@media only screen and (width>=751px){#burger{padding-top:2rem;padding-left:2rem}}@media only screen and (width<=750px){#burger{padding-top:1rem;padding-left:1rem}}#burger{font-family:var(--font-family);color:#a9a9a9;font-size:1.5rem;font-weight:400}#burger a{padding-right:.8rem;display:inline-block}#burger label{cursor:pointer}#nav-icons{padding-left:.8rem}#nav-icons svg{max-height:20px;color:var(--main-text-color);margin-bottom:-.05rem}#l1-val{position:relative;top:-.12rem}#l2-val{padding-left:.1rem;padding-right:.1rem;position:relative;top:-.2rem}#burger-cbox{display:none}#label-1{display:inline-block}#label-2,#burger-cbox:not(:checked)~#nav-icons{display:none}.TLDR{font-size:1.1rem}.figcaption{padding-bottom:1rem;font-size:.8rem}.post .post-header{margin-bottom:2.5rem}.post .post-header .title{margin:0}.inline-svg-equation{text-align:center;max-width:100%;margin:1.5em auto;display:block}.markdown .footnotes ol{counter-reset:item;width:fit-content;color:var(--dark-text-color);padding-left:0;padding-right:0}.markdown .footnotes li{padding-bottom:0;display:block}.markdown .footnotes li:before{content:counter(item)". ";counter-increment:item;width:2em;display:inline-block;position:absolute}.markdown .footnotes li p{padding-left:2rem;line-height:1.25rem}.markdown .footnotes li a{color:var(--dark-text-color)}</style></head><body><div class=header><nav><div id=burger><input id=burger-cbox type=checkbox><label for=burger-cbox id=label-1><span>[</span><span id=l1-val>+</span><span>]</span></label><label for=burger-cbox id=label-2><span>[</span><span id=l2-val>x</span><span>]</span></label><div id=nav-icons><a class="plausible-event-name=burger+home" aria-label=Home href=/ style=padding-right:.7rem><svg class="feather feather-home" viewbox="0 0 24 24" fill=none height=24 id=home-icon stroke=currentcolor stroke-linecap=round stroke-linejoin=round stroke-width=1 width=24><path d="M3 9l9-7 9 7v11a2 2 0 01-2 2H5a2 2 0 01-2-2z"></path><polyline points="9 22 9 12 15 12 15 22"></polyline></svg></a><a class="plausible-event-name=burger+reading" aria-label=Reading href=/reading><svg viewbox="0 0 23.809855 18.892912" height=24 id=svg5 width=24><defs id=defs2></defs><g id=layer1 transform=translate(-6.352941,-30.26865)><g id=g39 transform=matrix(0.26458333,0,0,0.26458333,5.0300244,26.48677)><path d="m92.22 22.9v59C74.24 76.35 61.26 78.85 54.73 81.04 59.2 76.64 68.54 70.55 84.16 74.14l1.69.39V21.42c2.17.29 4.3.77 6.37 1.48z" class=st0 id=path11></path><path d="M45.24 81.04C38.73 78.85 25.74 76.35 7.77 81.9v-59c2.06-.71 4.2-1.19 6.37-1.48v53.11l1.68-.39c15.61-3.58 24.96 2.5 29.42 6.9z" class=st0 id=path13></path><polygon points="48.86,85.63 48.82,85.58 48.91,85.63" id=polygon15></polygon><polygon points="51.17,85.58 51.13,85.63 50,85.63 51.09,85.62" id=polygon17></polygon><path d="m94.09 20.63c-2.68-1-5.45-1.65-8.24-2.02v-2.94l-1.08-.24c-17.8-4.09-28.32 3.81-32.9 8.68-.81.87-1.44 1.63-1.88 2.22C49.54 25.74 48.91 24.98 48.1 24.11c-4.58-4.87-15.11-12.76-32.9-8.68l-1.07.24v2.94c-2.8.38-5.57 1.02-8.24 2.02L5 20.97V85.7l1.81-.61c13.49-4.49 24.13-4.16 30.68-3.08 7.09 1.15 11.05 3.4 11.09 3.42l.23.14.09.06H50l1.09-.01.08-.05.23-.14c.05-.02 4-2.27 11.09-3.42 6.55-1.08 17.19-1.41 30.68 3.08l1.82.61V20.97zM7.78 81.89v-59c2.06-.71 4.2-1.19 6.37-1.48v53.11l1.68-.39c15.61-3.58 24.95 2.5 29.42 6.9-6.52-2.18-19.5-4.68-37.47.86zm40.76-1.3c-4.19-4.66-14.29-12.83-31.63-9.5v-53.2c11.11-2.28 18.93.38 24.02 3.66 2.6 1.68 4.48 3.52 5.71 4.95 1.14 1.32 1.73 2.28 1.82 2.43l.08.15zm2.76.17V29.34l.24-.4c.09-.16.68-1.12 1.82-2.44 1.23-1.43 3.11-3.27 5.71-4.94 5.08-3.29 12.91-5.95 24.02-3.67v53.2C65.54 67.72 55.4 76.13 51.3 80.76zm40.92 1.13C74.24 76.34 61.26 78.84 54.73 81.03 59.2 76.63 68.54 70.54 84.16 74.13l1.69.39v-53.1c2.16.29 4.3.77 6.37 1.48z" id=path19></path></g></g><style id=style9>.st0{fill:none}</style></svg> </a><a aria-label="NYC Bike Exploring" class="plausible-event-name=burger+nycbike" href=/bike-exploring/nyc style=margin-left:.4rem><svg viewbox="0 0 91.5 52.5" height=24 width=32><g transform=matrix(-1,0,0,1,95.8,-23.9)><path d="m78 40.6c-3.8.0-7.3 1.2-10.2 3.2l-7.4-9.4 2.9-8.5H67c.6.0 1-.4 1-1s-.4-1-1-1H54.8c-.6.0-1 .4-1 1s.4 1 1 1h6.3l-2.3 6.7c-.2-.2-.4-.3-.7-.3H32l2.2-6.4h5.7c.6.0 1-.4 1-1s-.4-1-1-1h-6.4c-.4.0-.8.3-.9.7l-5.7 16.8c-1.5-.4-3.1-.7-4.8-.7-9.8.0-17.8 8-17.8 17.8s8 17.8 17.8 17.8 17.8-8 17.8-17.8c0-7.5-4.6-13.9-11.2-16.5l2.6-7.6 19 24.4c.1.3.3.6.6.7.1.0.2.1.3.1h.1 8.9c.5 9.4 8.3 16.8 17.8 16.8 9.8.0 17.8-8 17.8-17.8s-8-18-17.8-18zM37.8 58.4c0 8.7-7.1 15.8-15.8 15.8S6.2 67.1 6.2 58.4 13.3 42.6 22 42.6c1.4.0 2.8.2 4.1.6L21 58.1c-.2.5.1 1.1.6 1.3.1.0.2.1.3.1.4.0.8-.3.9-.7l5.1-14.9c5.9 2.2 9.9 7.9 9.9 14.5zm29.7-11.8L76 57.4H62.2c.3-4.3 2.2-8.1 5.3-10.8zm-16.7 9.6-17.1-22h24l.4.5zm1.8 1.2 7.1-20.8 6.6 8.4c-3.5 3.1-5.7 7.4-6 12.4zM78 74.2c-8.4.0-15.2-6.6-15.8-14.8H78c.4.0.7-.2.9-.6.2-.3.1-.8-.1-1.1L69 45.4c2.5-1.8 5.6-2.8 8.9-2.8 8.7.0 15.8 7.1 15.8 15.8s-7 15.8-15.7 15.8z"></path></g></svg></a><a class="plausible-event-name=burger+about" aria-label=About href=/about><svg class="feather feather-user" viewbox="0 0 24 24" fill=none height=24 id=about-icon stroke=currentcolor stroke-linecap=round stroke-linejoin=round stroke-width=1 width=24><path d="M20 21v-2a4 4 0 00-4-4H8a4 4 0 00-4 4v2"></path><circle cx=12 cy=7 r=4></circle></svg> </a><a class="plausible-event-name=burger+rss" aria-label=RSS href=/index.xml><svg class="feather feather-rss" viewbox="0 0 30 24" fill=none height=24 id=rss-icon stroke=#444 stroke-linecap=round stroke-linejoin=round stroke-width=1.5 width=24><path d="M4 11a9 9 0 019 9"></path><path d="M4 4a16 16 0 0116 16"></path><circle cx=5 cy=19 r=1></circle></svg></a></div></div></nav></div><div class="wrapper post"><div class=post-header><h1 class=title>BlenderFOAM: Open-source Fluid Based Shape Optimization</h1></div><p class=TLDR><strong>TL;DR</strong> - Aerodynamic shape optimization for the masses.</p><hr><div class=markdown><h2>Introduction</h2><p>I was recently cleaning out my closet and came across an old hard drive labeled “grad school”. After plugging it in and exploring it for a few minutes, I came across all my old thesis stuff. Seeing how this was before I started using GitHub, I figured I would post it in hopes that someone else could get some use from it. Even though it uses older versions of both Blender and OpenFOAM, the results should still be perfectly acceptable given that the equations of fluid dynamics haven’t changed much in the last hundred years.</p><h2>Background</h2><p>Given the ubiquity of cheap computing power both locally and in the cloud, the number of industries that deal with <a rel="noopener noreferrer" href=https://en.wikipedia.org/wiki/Computational_fluid_dynamics target=_blank>computational fluid dynamics</a> (CFD) based <a rel="noopener noreferrer" href=https://en.wikipedia.org/wiki/Shape_optimization target=_blank>shape optimization</a> continues to grow. What started out as a niche skill set for aerospace applications expanded out into high high-end motorsport and naval applications. Now, CFD based aerodynamic shape optimization is a key step in the design process for every major automotive company. And if the adoption of electric vehicles continues, aerodynamic shape optimization will only become more important. The simplest, cheapest way to increase electic vehicle range is through aerodynamic drag reduction. Same thing applies to ground based shipping. A small reduction in drag across an entire fleet of trucks means massive savings overall. BlenderFOAM was my thesis project and solution to this problem. It’s based entirely on open-source software, more specifically: <a rel="noopener noreferrer" href=https://www.blender.org/ target=_blank>Blender</a>, <a rel="noopener noreferrer" href=https://openfoam.org/ target=_blank>OpenFOAM</a>, and <a rel="noopener noreferrer" href=https://www.python.org/ target=_blank>Python</a>.</p><p>OpenFOAM or Open Field Operation and Manipulation is an open-source toolbox that facilitates numerical solving and pre-/post-processing of <a rel="noopener noreferrer" href=https://en.wikipedia.org/wiki/Continuum_mechanics target=_blank>continuum mechanics</a> problems. Written in C++, OpenFOAM specializes in solving CFD simulations in massively parallel environments. Development of the original OpenFOAM started in the late 1980’s at Imperial College, London. Its development was initiated because of a need for more a powerful and flexible simulation platform. At the time, Fortran was the defacto standard for writing simulation code, however C++ was chosen as the programming language due to its higher modularity and object-oriented features. A distinct advantage of OpenFOAM over other black box commercial CFD codes is its complete transparency which makes it easy to modify or integrate custom written modules such as experimental turbulence models. This ease of custom development stems from OpenFOAM’s syntax which closely resembles the tensor operations and partial differential equations being solved. If anyone tells you they’re a CFD expert and doesn’t use OpenFOAM, turn around and walk away. Every solver that isn’t OpenFOAM (Ansys, STAR-CCM+, Exa, etc…) are for children.</p><p>Blender on the other hand is an open source design tool produced by the Blender Foundation and used primarily for graphics and animation. Its origin can be traced back to an in-house design tool used by the Dutch commercial animation company NeoGeo and Not a Number (NaN). When NaN went bankrupt in 2002, Blender source code was released and the Blender Foundation was formed to continue software development. Blender is primarily used for animated films and highly detailed static renderings. In addition, Blender is capable of producing interactive 3D applications and video games. Within Blender, a rich diversity of mesh creation and deformation tools are available and all accessible from the built-in python API. This enables complete automation via the terminal using batch scripts or Python. Users can also use Python to develop custom tools that can be easily implemented into the GUI. A distinct advantage of Blender is its very low hardware requirements which allows for rapid mesh deformation of high-resolution models to occur very quickly on a standard desktop computer. This lends itself very well to the task of aerodynamic shape optimization.</p><h2>Geometry Parameterization</h2><p>Before any shape optimization can take place, the geometry must be <a rel="noopener noreferrer" href=https://en.wikipedia.org/wiki/Parametrization_(geometry) target=_blank>parameterized</a>. Since Blender lacks support for parametric geometry, CAD files must be converted into a triangulated surface mesh and imported as an <a rel="noopener noreferrer" href=https://en.wikipedia.org/wiki/STL_(file_format) target=_blank>stl</a>. Once the geometry is in Blender though, it can be parameterized using one or several different methods.</p><p>The most common mesh deformation method I find myself using is the <a rel="noopener noreferrer" href=https://docs.blender.org/manual/en/latest/rigging/lattice.html target=_blank>lattice</a>. It’s simple, easy to use, and gets the job done. The lattice mesh deformation tool (figure [1]) is Blenders implementation of a free-form deformation method. It is initiated by the creation of a 3D bounding box which is then filled with a user specified number of evenly spaced control points along each principal axis. These control points can then be maneuvered, manipulating the geometry accordingly using a <a rel="noopener noreferrer" href=https://en.wikipedia.org/wiki/B-spline target=_blank>volumetric B-spline</a> function. This B-spline approach allows the lattice to have a localized impact on the geometry which spans no more than two control points in distance.</p><img alt="blender lattice mesh deformation" title="blender lattice mesh deformation" src=imgs-web/Mesh_Deformation_LATTICE.png width=400><center class=figcaption>Figure 1: Lattice</center><p>Sometimes, one lattice just doesn’t deliver enough deformation fidelity and you need to use several. No Problem! Blender is a beast, and will gladly support any number of additional lattices. This enables users to create a finely tuned parametric mesh, ready for optimization. This permits optimization on different length scales which for most real world applications is a must. Seen below in figure [2], additional lattices have been implemented to increase shape control.</p><img alt="blender lattice mesh deformation" title="blender lattice mesh deformation" src=imgs-web/Mesh_Deformation_LATTICE_3.png width=400><center class=figcaption>Figure 2: Multiple lattices</center><p>If one or more lattices fail to deliver, the next option is a cage. From the users perspective, the cage deformation tool (figure [3]) is very similar to the lattice tool. Control points are manually created and formed into a cage encompassing the geometry. This cage is free to take any shape the designer requires so long as it forms a closed surface. The control points forming this cage can then be adjusted, manipulating the geometry within. This enables a potentially large reduction in the number of control points, thus reducing the design space through intuitive placement of control points. The Blender cage system is based on work done at Pixar.<sup id=fnref:1><a class=footnote-ref href=#fn:1 role=doc-noteref>1</a></sup> The cage method operates by first embedding itself to the geometry volume by solving Laplace’s equation. From this solution, the influence of each control point on the geometry is now known. Because of the global nature of elliptic PDEs, each control point has a theoretical influence on all parts of the geometry. In practice however, the influence of a control point on the geometry surface decays rapidly. An advantage of the cage method is that once it has been embedded to the geometry surface, deformations are extremely rapid, requiring only matrix-vector products.</p><img alt="blender cage deformation" title="blender cage deformation" src=imgs-web/Mesh_Deformation_CAGE.png width=400><center class=figcaption>Figure 3: Cage</center><p>The last form of geometry manipulation comes from actual point manipulation of the geometry (figure [4]). This method is basic and primitive, however in some circumstances it may prove to be the most useful.</p><img alt="blender direct deformation" title="blender direct deformation" src=imgs-web/Mesh_Deformation_DIRECT.png width=400><center class=figcaption>Figure 4: Direct</center><p>Overall, Blender supports a rich environment for mesh deformation. The covered techniques can not only run in series together on a single feature, they are only a small sample of whats available to designers. And thanks to Blender’s built-in Python API, custom techniques are a simple addition.</p><h2>Optimizer Performance</h2><p>A simple way to measure both optimizer performance and geometry parameterization is through an inverse design challenge. Starting off with the Tyrrell 26 airfoil which used on the front wing of the 1998 Tyrrell Formula 1 car seen below in figure [5], the geometry will be subjected to a random perturbation using a lattice resulting in a completely new airfoil shape.</p><img alt="blender direct deformation" title="blender direct deformation" src=imgs-web/tyrrell1998.jpg><center class=figcaption>Figure 5: Tyrrell from 1998</center><p>The goal of this exercise will then be to recover the deformed shape back to the original airfoil in as few iterations as possible. To get a better understanding of performance, two tests will be carried using lattices of different resolutions.</p><img alt="inverse design results (4 control points)" title="inverse design results (4)" src=imgs-web/Benchmark_0_Lattice4_initial.png style=display:inline-block width=49%><img alt="inverse design results (4 control points)" title="inverse design results (4)" src=imgs-web/Benchmark_0_lattice4_deformed.png style=display:inline-block width=49%><center class=figcaption>Figure 6: Target (left) and deformed (right) - 4 control points</center><img alt="inverse design results (10 control points)" title="inverse design results (10)" src=imgs-web/Benchmark_0_lattice10_initial.png style=display:inline-block width=49%><img alt="inverse design results (10 control points)" title="inverse design results (10)" src=imgs-web/Benchmark_0_lattice10_deformed.png style=display:inline-block width=49%><center class=figcaption>Figure 7: Target (left) and deformed (right) - 10 control points</center><p>To quantify the difference between the initially perturbed airfoil and the target airfoil, a purely geometric cost function has been created. It can be seen from equation [1] below that it’s simply the squared sum of the distance between the actual and target vertices.</p><div style=text-align:center><div class=inline-svg-equation style=vertical-align:middle;display:inline-block><svg viewbox="0 -1692.6 7851.6 2938.6" height=53.184 width=142.112 xmlns:xlink=http://www.w3.org/1999/xlink><defs><path d="M195 609q0 47 32 77t75 31q17-1 49-8t56-12 26-7q18-8 18-28 0-18-13-34t-35-16q-21 0-55 29t-60 30-39-14-14-29q0-44 99-165 67-84 67-171 0-123-61-212T205-10h-7Q127-10 83 36T36 153q0 133 115 229 40 31 101 52 0 1-7 15t-15 32-16 40-13 45-6 43zM112 130q0-47 24-75t68-28q29 0 52 24t35 60 18 67 7 54q0 35-7 66t-14 46-26 56l-10-4q-44-15-76-54t-46-86-19-77-6-49z" id=MJX-6-TEX-I-3B4></path><path d="M56 347q0 13 14 20H707q15-8 15-20 0-11-14-19l-318-1H72q-16 5-16 20zm0-194q0 15 16 20H708q14-10 14-20 0-13-15-20H70q-14 7-14 20z" id=MJX-6-TEX-N-3D></path><path d="M60 948q3 2 605 2h602l58-135q59-138 63-146h-40l-7 14q-21 41-56 78-50 48-111 77t-141 43-151 17-183 4H574 543 251l8-11Q722 258 724 252q1-2 0-6-3-3-264-302L196-356q0-1 211-1 52 0 141 0t128-1q136 0 220 5t167 21 141 49 103 87q21 26 41 72h40q0-1-7-21t-25-65-31-84l-58-155-601-1q-602 0-605 2-6 2-6 9 0 2 2 6L590 177q0 1-33 45T452 366 322 544L56 909l-1 15q0 21 5 24z" id=MJX-6-TEX-LO-2211></path><path d="M184 6e2q0 24 19 42t44 19q18 0 30-12t13-30q0-23-20-42t-44-20q-15 0-28 10t-14 33zM21 287q0 8 9 31t24 51 44 51 60 22q39 0 65-23t27-62q0-17-14-56T196 196 154 83q-5-22-5-32 0-25 17-25 9 0 19 3t23 14 27 35 25 59q3 12 5 14t17 2q20 0 20-10 0-8-9-31T268 61 223 11 161-11q-32 0-59 21T74 74q0 17 5 32t43 114q38 101 44 121t7 39q0 24-17 24h-2q-30 0-55-33T61 287q-1-1-2-3t-1-3-2-2-3-1-4 0-8 0H27q-6 6-6 9z" id=MJX-6-TEX-I-69></path><path d="M213 578l-13-5q-14-5-40-10t-58-7H83v46h19q47 2 87 15t56 24 28 22q2 3 12 3 9 0 17-6V361l1-3e2q7-7 12-9t24-4 62-2h26V0H416Q395 3 257 3 121 3 1e2.0H88V46h26q22 0 38 0t25 1 16 3 8 2 6 5 6 4V578z" id=MJX-6-TEX-N-31></path><path d="M21 287q1 6 3 16t12 38 20 47 33 37 46 17q36 0 60-18t30-34 6-21q0-2 1-2l11 11q61 64 139 64 54 0 87-27t34-79-38-157T427 52q0-26 17-26 6 0 9 1 29 5 52 38t35 80q2 8 20 8 20 0 20-8 0-1-4-15-8-29-22-57T508 17 439-10q-47 0-68 27T350 73q0 19 36 120t37 152q0 59-44 59h-5q-86 0-145-101l-7-12-33-134Q156 26 151 16q-13-27-43-27-13 0-21 6T76 7 74 17q0 13 38 163t40 163q1 5 1 23 0 39-24 39-38 0-63-1e2-6-20-6-21-2-6-19-6H27q-6 6-6 9z" id=MJX-6-TEX-I-6E></path><path d="M173 380q0 25-19 25-24 0-50-29T61 287q-1-1-2-3t-1-3-2-2-3-1-4 0-8 0H27q-6 6-6 9 0 7 8 29t24 52 44 51 63 22q42 0 65-24t24-56q0-17-3-26 0-6-15-44t-31-89-18-89q0-27 5-44 13-43 63-43 37 0 69 34t50 79 29 83 11 55q0 23-8 40t-18 26-18 18-8 22q0 22 19 41t41 19q19 0 34-18t16-58q0-27-12-83T418 159 347 40 241-11q-64 0-102 33-37 32-37 95 0 31 8 64t41 117q22 64 22 82z" id=MJX-6-TEX-I-76></path><path d="M39 168q0 57 19 104t49 78 67 52 70 31 63 9h3q45 0 78-22t33-65q0-90-111-118-49-13-134-14-37 0-38-2 0-2-6-35t-7-58q0-47 21-74t63-28 93 19 92 66q9 10 12 10 4 0 13-9t10-14-9-16-30-27-46-31T281-1 205-11Q126-11 83 42T39 168zM373 353q-6 52-68 52-33 0-61-14t-45-34-29-41-16-36-5-19q0-1 20-1 113 0 158 24t46 69z" id=MJX-6-TEX-I-65></path><path d="M21 287q1 3 2 8t5 22 10 31 15 33 20 30 26 22 33 9q29 0 51-12t31-22 11-20q2-6 3-6t8 7q48 52 111 52h3q48 0 72-41 8-19 8-37 0-30-13-48t-26-23-25-4q-20 0-32 11t-12 29q0 48 56 64-22 13-36 13-56 0-103-74-10-16-15-33T190 165Q156 25 151 16q-13-27-43-27-13 0-21 6T76 7 74 17q0 13 40 172t40 177q0 39-26 39-21 0-36-28T68 316 57 280q-2-2-16-2H27q-6 6-6 9z" id=MJX-6-TEX-I-72></path><path d="M26 385q-7 7-7 10 0 4 3 16t5 14q2 5 9 5t51 1h53l19 80q3 11 7 29t7 26 6 20 8 17 10 12 14 9 18 2q18-1 25-11t7-19q0-7-9-47t-20-79l-10-37q0-2 50-2h51q7-7 7-11 0-22-13-35H210L174 240Q135 80 135 68q0-42 27-42 35 0 68 34t53 84q2 6 5 7t15 2h4q15 0 15-8 0-3-3-12-5-16-18-38T267 48 216 6 155-11Q125-11 98 4T59 56q-2 8-2 27v18L92 241q35 141 36 142 0 2-51 2H26z" id=MJX-6-TEX-I-74></path><path d="M131 289q0 32 16 65t56 61 97 27q62 0 90-27t29-60q0-32-17-47t-38-16q-13 0-24 8t-12 26q0 16 9 28t17 18 13 6q1 0 1 1 0 3-7 9t-25 11-39 6q-48 0-70-26t-23-53q0-25 19-35t55-17 52-15q66-29 66-96 0-28-11-56T352 51 289 7 195-10Q118-10 86 19T53 87q0 39 21 56t44 17q15 0 28-9t14-31q0-26-18-44T111 58q-2-1-3-1t-1-2q1-3 8-8t31-13 55-7q36 0 62 11t38 28 17 31 5 25q0 28-21 42t-48 17-59 15-47 35q-17 25-17 58z" id=MJX-6-TEX-I-73></path><path d="M94 250q0 69 10 131t23 107 37 88 38 67 42 52 33 34 25 21h13 4q14 0 14-9 0-3-17-21t-41-53-49-86-42-138-17-193T184 58 225-81t49-86 42-53 17-21q0-9-15-9h-3-13l-28 24Q180-141 137-14T94 250z" id=MJX-6-TEX-N-28></path><path d="M84 237t0 13 14 20H679q15-8 15-20t-15-20H98q-14 7-14 20z" id=MJX-6-TEX-N-2212></path><path d="M229 286q-13 134-13 150 0 18 24 28 1 0 5 0t6 1q12-1 22-9t10-20q0-17-6-80t-7-70l58 42q56 41 61 44t10 3q13 0 24-10t12-27q0-13-10-23-5-3-68-33t-68-32l66-31 70-35q9-9 9-23 0-15-9-25t-24-11q-8 0-18 6t-55 40l-58 42Q283 79 283 63q0-10-7-19t-26-9-26 9-8 19q0 17 6 80t7 70l-58-42q-56-41-61-44-4-3-10-3-13 0-24 10T64 161q0 5 0 8t3 6 5 6 9 7 13 7 19 9 25 11 32 15 40 20L74 315q-9 9-9 23 0 15 9 25t24 11q8 0 18-6t55-40l58-42z" id=MJX-6-TEX-N-2217></path><path d="M60 749l4 1q5 0 10 0H86l28-24q94-85 137-212t43-264q0-68-10-131T261 12 224-76t-38-67-41-51-32-33-23-19q-3-3-4-4H74q-8 0-11 0t-5 3-3 9q1 1 11 13Q221-64 221 250T66 725q-10 12-11 13 0 8 5 11z" id=MJX-6-TEX-N-29></path><path d="M109 429q-27 0-43 18T50 491q0 71 53 123t132 52q91 0 152-56t62-145q0-43-20-82t-48-68-80-74q-36-31-1e2-92L142 93l76-1q157 0 167 5 7 2 24 89v3h40v-3q-1-3-13-91T421 3V0H50V19 31q0 7 6 15T86 81q29 32 50 56 9 10 34 37t34 37 29 33 28 34 23 30 21 32 15 29 13 32 7 30 3 33q0 63-34 109t-97 46q-33 0-58-17t-35-33-10-19q0-1 5-1 18 0 37-14t19-46q0-25-16-42t-45-18z" id=MJX-6-TEX-N-32></path></defs><g transform="matrix(1 0 0 -1 0 0)" fill=currentcolor stroke=currentcolor stroke-width=0><g data-mml-node=math><g data-mml-node=mi><use xlink:href=#MJX-6-TEX-I-3B4></use></g><g transform="translate(721.8, 0)" data-mml-node=mo><use xlink:href=#MJX-6-TEX-N-3D></use></g><g transform="translate(1777.6, 0)" data-mml-node=munderover><g transform="translate(279.3, 0)" data-mml-node=mo><use xlink:href=#MJX-6-TEX-LO-2211></use></g><g transform="translate(427.4, -1087.9) scale(0.707)" data-mml-node=TeXAtom><g data-mml-node=mi><use xlink:href=#MJX-6-TEX-I-69></use></g><g transform="translate(345, 0)" data-mml-node=mo><use xlink:href=#MJX-6-TEX-N-3D></use></g><g transform="translate(1123, 0)" data-mml-node=mn><use xlink:href=#MJX-6-TEX-N-31></use></g></g><g transform="translate(0, 1150) scale(0.707)" data-mml-node=TeXAtom><g data-mml-node=mi><use xlink:href=#MJX-6-TEX-I-6E></use></g><g transform="translate(600, 0)" data-mml-node=mi><use xlink:href=#MJX-6-TEX-I-76></use></g><g transform="translate(1085, 0)" data-mml-node=mi><use xlink:href=#MJX-6-TEX-I-65></use></g><g transform="translate(1551, 0)" data-mml-node=mi><use xlink:href=#MJX-6-TEX-I-72></use></g><g transform="translate(2002, 0)" data-mml-node=mi><use xlink:href=#MJX-6-TEX-I-74></use></g><g transform="translate(2363, 0)" data-mml-node=mi><use xlink:href=#MJX-6-TEX-I-73></use></g></g></g><g transform="translate(3780.1, 0)" data-mml-node=msup><g data-mml-node=mrow><g data-mml-node=mo><use xlink:href=#MJX-6-TEX-N-28></use></g><g transform="translate(389, 0)" data-mml-node=msub><g data-mml-node=mi><use xlink:href=#MJX-6-TEX-I-76></use></g><g transform="translate(485, -150) scale(0.707)" data-mml-node=mi><use xlink:href=#MJX-6-TEX-I-69></use></g></g><g transform="translate(1390.2, 0)" data-mml-node=mo><use xlink:href=#MJX-6-TEX-N-2212></use></g><g transform="translate(2390.4, 0)" data-mml-node=msubsup><g data-mml-node=mi><use xlink:href=#MJX-6-TEX-I-76></use></g><g transform="translate(485, 413) scale(0.707)" data-mml-node=mo><use xlink:href=#MJX-6-TEX-N-2217></use></g><g transform="translate(485, -247) scale(0.707)" data-mml-node=mi><use xlink:href=#MJX-6-TEX-I-69></use></g></g><g transform="translate(3278.9, 0)" data-mml-node=mo><use xlink:href=#MJX-6-TEX-N-29></use></g></g><g transform="translate(3667.9, 477.1) scale(0.707)" data-mml-node=mn><use xlink:href=#MJX-6-TEX-N-32></use></g></g></g></g></svg></div><div style=vertical-align:middle;float:right;padding-top:2.5rem;display:inline-block><p>(1)</p></div></div><p>From equation [1], <i>v<sub>i</sub></i> are the current airfoil vertex coordinates and <i>v<sub>i</sub><sup>*</sup></i>, are the corresponding target vertex coordinates. The optimizers for this exercise have been assigned a maximum function evaluation limit of 1500 and a convergence tolerance criteria of 1e-03.</p><img alt="inverse design results (4 control points)" title="inverse design results (4 control points)" src=imgs-web/BENCHMARK_0_lattice_04.png width=500><img alt="inverse design results (10 control points)" title="inverse design results (10 control points)" src=imgs-web/BENCHMARK_0_lattice_10.png width=500><center class=figcaption>Figure 8: Shape matching results, 4 control points (top), 10 control points (bottom)</center><p>From figure 8 above, it can be seen that Blender and the associated optimizers are able to fully recover the airfoil geometry within a respectable number of iterations. Of note is the relative ease in which <a rel="noopener noreferrer" href=https://en.wikipedia.org/wiki/BOBYQA target=_blank>BOBYQA</a> and <a rel="noopener noreferrer" href=https://en.wikipedia.org/wiki/NEWUOA target=_blank>NEWUOA</a> were able to converge quickest in both a 4 and 10 dimensional space. This hints at the fact that this scenario is likely a fairly smooth, unimodal problem.</p><h2>Multi-objective Airbox Design</h2><p>For this test, BlenderFOAM will be challenged to optimize the performance of a <a rel="noopener noreferrer" href=https://en.wikipedia.org/wiki/Formula_Ford target=_blank>Formula Ford</a> airbox as seen below in figure [9]. This geometry was chosen because it represents one of the most common parts in the world of motorsport. Almost every vehicle features an airbox of some sort, making it a highly engineered component.</p><img alt="formula ford airbox" src=imgs-web/Airbox3View.jpg><center class=figcaption>Figure 9: Formula Ford airbox</center><p>The purpose of an <a rel="noopener noreferrer" href=https://en.wikipedia.org/wiki/Airbox target=_blank>airbox</a> is to deliver large amounts of air to the engine as painlessly as possible. Therefore the objective is to make the airbox as efficient as possible by minimizing the pressure loss between the inlet and outlet. The more efficient an airbox is, the easier the engine can breathe resulting in better performance.</p><p>A multi-objective approach has been used here because when optimized for purely a pressure loss improvement, the pressure distribution at the outlet can become highly uneven with a large amount of high pressure developing along the edges. For this reason, the pressure loss will be minimized while also minimizing the standard deviation of the velocity magnitude at the outlet.</p><img alt="formula ford airbox parameterization" src=imgs-web/Benchmark_4_lattice2.jpg style=display:inline-block width=49%><img alt="formula ford airbox parameterization" src=imgs-web/Benchmark_4_latticeClose.jpg style=display:inline-block width=49%><center class=figcaption>Figure 10: Airbox parameterization</center><p>The airbox geometry was parameterized using two lattices, one for macro scale structural deformations and a smaller one was located near the neck to reduce the chances of initial flow separation. Using the simpleFOAM solver along with the <a rel="noopener noreferrer" href=https://en.wikipedia.org/wiki/SST_(Menter%E2%80%99s_Shear_Stress_Transport) target=_blank>SST K-ω turbulence model</a>, the inlet has been assigned a velocity of 30 m/s (67.1081 mph) normal to the inlet plain with an outlet pressure of 0.0 Pa. Note that this setup has been heavily simplified relative to what is normally considered ideal. A setup more aligned with motorsport best practices would include optimizing across a range of inlet velocities (Reynolds sweep), inlet velocity directions, initial turbulence levels, and varying outlet pressure levels as well as external geometric constraints. In addition, simpleFOAM which is a <a rel="noopener noreferrer" href=https://en.wikipedia.org/wiki/Reynolds-averaged_Navier%E2%80%93Stokes_equations target=_blank>RANS</a> based solver should be swapped for a <a rel="noopener noreferrer" href=https://en.wikipedia.org/wiki/Detached_eddy_simulation target=_blank>DES</a> or <a rel="noopener noreferrer" href=https://en.wikipedia.org/wiki/Large_eddy_simulation target=_blank>LES</a> based approach to better resolve small-scale, time-dependent turbulence structures. Lastly, because this was ran on my laptop and thus computationally limited, cell count was kept low at 323,480.</p><img alt="initial velocity magnitude" src=imgs-web/Benchmark_4_P_INITIAL.jpg style=display:inline-block width=49%><img alt="optimized velocity magnitude" src=imgs-web/Benchmark_4_P_NEWUOA.jpg style=display:inline-block width=49%><center class=figcaption>Figure 11: Initial velocity magnitude (left) and final (right)</center><img alt="initial turbulent kinetic energy" src=imgs-web/Benchmark_4_K_INITIAL.jpg style=display:inline-block width=49%><img alt="optimized turbulent kinetic energy" src=imgs-web/Benchmark_4_K_NEWUOA.jpg style=display:inline-block width=49%><center class=figcaption>Figure 12: Initial turbulent kinetic energy (left) and final (right)</center><p>From figures [11] and [12] above, a direct comparison between the initial and optimal solution can be seen. Of interest is the improvement in flow distribution as seen by the velocity magnitude. To further improve flow uniformity, additional fidelity is needed. This could be accomplished by adding more control points however the solution would become increasingly more expensive. A cage parameterization would be ideal.</p><p>Below the solution convergence can be seen from both the velocity distribution and pressure loss perspectives.</p><img alt="optimization solution convergence" src=imgs-web/BENCHMARK_4_CONVERGENCE_P.png style=display:inline-block width=49%><img alt="optimization solution convergence" src=imgs-web/BENCHMARK_4_CONVERGENCE_SD.png style=display:inline-block width=49%><center class=figcaption>Figure 13: Solution convergence for pressure loss (left) and flow uniformity (right)</center><p>Lastly, the distribution of solutions can be seen below in figure [14]. A wide variety of responses were created from the optimizers with the majority succeeding in improving the performance of the airbox. Of interest is the diverse range that NEWUOA creates in its search for the optimum. This is a positive attribute in that, the search space is completely and evenly filled except near the optimum where there is a concentration of designs.</p><img alt="airbox design candidates" title="airbox design candidates" src=imgs-web/BENCHMARK_4_NEWUOA_PARETO.png><center class=figcaption>Figure 14: Airbox design canidates</center><p>The initial airbox and the NEWUOA optimized design can be seen below in figure [15]. One can easily see the differences between the initial and optimized designs.</p><img alt="airbox shape optimization - initial" title="airbox shape optimization - initial" src=imgs-web/initial.jpg style=display:inline-block width=49%><img alt="airbox shape optimization - final" title="airbox shape optimization - final" src=imgs-web/NEWUOA.jpg style=display:inline-block width=49%><center class=figcaption>Figure 15: Optimization results - initial (left), final NEWUOA solution (right)</center><p>Although this platform found substantial performance improvements for this Formula Ford airbox, one has to remember that this is a single wall structure and any geometric adjustments will impact both internal and external flow properties. The current optimized design may provide better internal flow conditions but it might also adversely impact the external drag of the vehicle rendering it useless.</p><h2>Conclusion</h2><p>Overall open-source based aerodynamic shape optimization if used correctly can be an extremely powerful design tool. Its performance has been proven, and its application has been demonstrated. Instead of paying tens of thousands of dollars for a single seat of commercial black box mystery, one could simply clone [<a rel="noopener noreferrer" href=https://github.com/nathanrooy/BlenderFOAM target=_blank>this repo</a>] and begin optimizing!</p><h2>Acknowledgements</h2><p>Special thanks once again to Paolo, and Eugene at <a rel="noopener noreferrer" href=https://engys.com/ target=_blank>Engys</a> for helping me while I completed my thesis.</p><div class=footnotes role=doc-endnotes><hr><ol><li id=fn:1><p>Joshi, P., Meyer, M., and DeRose, T., <a rel="noopener noreferrer" href=https://graphics.pixar.com/library/HarmonicCoordinatesB/paper.pdf target=_blank><i>Harmonic Coordinates for Character Articulation</i></a> (Pixar Technical Memo, 2007) <a class=footnote-backref href=#fnref:1 role=doc-backlink>↩︎</a></p></li></ol></div></div></div></body></html>