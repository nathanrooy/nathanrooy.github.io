<!doctype html><html lang=en><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge,chrome=1"><meta name=author content="Nathan Rooy"><meta name=copyright content="Nathan A. Rooy"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=language content="en"><meta http-equiv=content-language content="en-gb"><link rel=icon type=image/png href=/favicon/favicon.png><meta name=google-site-verification content="vQ6uvoBDOPVq7u67m2fO8RWaxcqsoLrLzmR7CzEo-0k"><meta name=msvalidate.01 content="4903EB9C7ABD70347352DCFAEE0751F5"><meta name=yandex-verification content="d0b7b29586e133fc"><script async defer data-domain=nathanrooy.github.io src=https://plausible.io/js/plausible.js></script><title>The Quantified Bike Explore</title><link rel=canonical href=https://nathanrooy.github.io/posts/2021-06-17/the-quantified-bike-explore/ itemprop=url><base href=https://nathanrooy.github.io/posts/2021-06-17/the-quantified-bike-explore/><meta itemprop=name content="The Quantified Bike Explore | Nathan Rooy"><meta itemprop=description content="Exploring New York City via GitHub Actions, OpenStreetMap, and Strava."><meta name=description content="Exploring New York City via GitHub Actions, OpenStreetMap, and Strava."><meta name=application-name content="The Quantified Bike Explore | Nathan Rooy"><meta name=keywords content="biking,maps,github actions,strava,openstreetmap"><meta name=twitter:card content="nathanrooy.github.io"><meta name=twitter:url content="https://nathanrooy.github.io/posts/2021-06-17/the-quantified-bike-explore/"><meta name=twitter:title content="The Quantified Bike Explore | Nathan Rooy"><meta name=twitter:description content="Exploring New York City via GitHub Actions, OpenStreetMap, and Strava."><meta property="og:title" content="The Quantified Bike Explore"><meta property="og:description" content="Exploring New York City via GitHub Actions, OpenStreetMap, and Strava."><meta property="og:locale" content="en_US"><meta property="og:type" content="article"><meta property="og:url" content="https://nathanrooy.github.io/posts/2021-06-17/the-quantified-bike-explore/"><meta property="og:site_name" content="nathanrooy.github.io"><meta itemprop=image content="https://nathanrooy.github.io/posts/2021-06-17/the-quantified-bike-explore/IMG_0375_1000.jpg"><meta property="og:image" content="https://nathanrooy.github.io/posts/2021-06-17/the-quantified-bike-explore/IMG_0375_1000.jpg"><meta name=twitter:image content="https://nathanrooy.github.io/posts/2021-06-17/the-quantified-bike-explore/IMG_0375_1000.jpg"><meta name=twitter:image:src content="https://nathanrooy.github.io/posts/2021-06-17/the-quantified-bike-explore/IMG_0375_1000.jpg"><link rel=alternate type=application/rss+xml href=https://nathanrooy.github.io/index.xml title="Nathan Rooy"><link rel=stylesheet type=text/css media=screen href=https://nathanrooy.github.io/css/normalize.min.02d927c3d7aee93f4557abffff0169f2c90a749e49700a80350d5b3f2911e20a.css><link rel=stylesheet type=text/css media=screen href=https://nathanrooy.github.io/css/main.min.ec615ee4144ef6c8e9c93fdd021d3c3afb41dc9789df64e5a8fac888451e31bd.css></head><body><div class="container wrapper post"><div class=header><div style=width:100%;display:inline class=site-title><a style=display:inline href=https://nathanrooy.github.io/>Nathan Rooy</a>
<a style=float:right;padding-left:10px;display:inline target=_blank href=/index.xml title=rss><img style=display:inline;margin:0;vertical-align:bottom src=/icons/rss_feather.svg width=20 height=20 alt="rss icon"></a>
<a style=float:right;padding-left:10px;display:inline target=_blank rel="noopener noreferrer" href=https://github.com/nathanrooy/ title=github><img style=display:inline;margin:0;vertical-align:bottom src=/icons/github_feather.svg width=20 height=20 alt="github page icon"></a></div><hr style=width:100%;display:inline-block><nav class=nav><ul class=flat><li style=text-align:center;vertical-align:top><a href=/><img style=margin:0;padding:0;width:20px;height:20px src=/icons/home_feather.svg alt="home page icon"></a></li><li style=text-align:center;vertical-align:top><a href=/about><img style=margin:0;padding:0;width:20px;height:20px src=/icons/user_feather.svg alt="about page icon"></a></li><li style=text-align:center;vertical-align:top><a href=/nyc_biking><img style=margin:0;padding:0;width:35px;height:20px src=/icons/bicycle.svg alt="biking page icon"></a></li><li><a href=/favorites><img style=margin:0;padding:0;width:20px;height:20px src=/icons/trending-up_feather.svg alt="personal favorites icon"></a></li></ul></nav></div><div class=post-header><h1 class=title>The Quantified Bike Explore</h1><div class=meta>Posted: June 17, 2021</div></div><div class=markdown><p class=TLDR><strong>TL;DR</strong> - Exploring New York City via GitHub Actions, OpenStreetMap, and Strava.</p><p>There are few things I find consistently more enjoyable than exploring my surroundings from the perspective of a bicycle. Whether it&rsquo;s big cities or narrow country roads, there are details which can only be experienced from this perspective. Whenever I&rsquo;m biking around and come across something I know most people don&rsquo;t get to experience, I&rsquo;m often reminded of the following:</p><blockquote>The world reveals itself to those who travel on foot. &mdash; Werner Herzog</blockquote><p>Traversing the world by bike, silently under your own power, unencumbered by traffic, parking, or roads in general is a freedom second to none. Just yourself and your willingness to see what&rsquo;s around the next corner. I&rsquo;ve been living in Manhattan for roughly three years now and over that time period have encountered some pretty incredible sights.</p><style>.nyc-grid{width:100%;display:grid;grid-template-columns:repeat(6,1fr);grid-template-rows:repeat(12,auto-fit);grid-gap:.5rem;padding-bottom:1rem;margin-top:1.3rem}.nyc-grid>div{display:flex}.nyc-grid img{margin:0;width:100%;height:100%;object-fit:cover;display:block}.gallery__item--1{grid-column-start:1;grid-column-end:4;grid-row-start:1;grid-row-end:3}.gallery__item--3{grid-column-start:4;grid-column-end:7;grid-row-start:1;grid-row-end:5}.gallery__item--4{grid-column-start:1;grid-column-end:4;grid-row-start:3;grid-row-end:5}.gallery__item--5{grid-column-start:1;grid-column-end:7;grid-row-start:5;grid-row-end:7}.gallery__item--6{grid-column-start:1;grid-column-end:3;grid-row-start:7;grid-row-end:9}.gallery__item--7{grid-column-start:3;grid-column-end:5;grid-row-start:7;grid-row-end:9}.gallery__item--8{grid-column-start:5;grid-column-end:7;grid-row-start:7;grid-row-end:9}.gallery__item--9{grid-column-start:4;grid-column-end:7;grid-row-start:9;grid-row-end:11}.gallery__item--11{grid-column-start:1;grid-column-end:4;grid-row-start:9;grid-row-end:11}</style><div class=nyc-grid><div class=gallery__item--1><img src=File_017_400x300.jpeg alt="brooklyn bridge as seen from the manhattan bridge"></div><div class=gallery__item--3><img src=File_024_340x600.jpeg alt="midtown skyscrapers in fog"></div><div class=gallery__item--4><img src=IMG_0375_400x300.jpg alt="strange car in brooklyn"></div><div class=gallery__item--5><img src=File_000_1000.jpeg alt="manhattan bridge as seen during the evening golden hour"></div><div class=gallery__item--6><img src=IMG_0351_300x400.jpg alt="plant store in midtown manhattan"></div><div class=gallery__item--7><img src=IMG_0213_300x400.jpg alt="one world trade center as seen from battery park"></div><div class=gallery__item--8><img src=IMG_0334_300x400.jpg alt="upper west side manhattan building covered in vines"></div><div class=gallery__item--9><img src=Untitled-8_400x300.jpg alt="brooklyn park bench during fall"></div><div class=gallery__item--11><img src=DSCF1906_400x300.jpg alt="brooklyn bridge during fog and rain"></div></div><p>Anyway, I&rsquo;ve been a fan of GitHub Actions ever since they rolled out the service and have been looking for use cases other than the typical CI/CD scenario. I&rsquo;ve had a weekly Goodreads cron job running for a while which scrapes <a target=_blank rel="noopener noreferrer" href=https://www.goodreads.com/user/show/59168723-nathan-rooy>my reading history</a> and <a target=_blank rel="noopener noreferrer" href=/reading>populates a table</a> but that&rsquo;s not actually very interesting. It finally dawned on me that I should build out some kind of service to track my bike exploration progress.</p><p>I started out with a simple Python script which scrapes the latitude/longitude pairs from each new Strava activity and persists them as downsampled SVGs via the <a target=_blank rel="noopener noreferrer" href=https://hull-repository.worktribe.com/output/459275>Visvalingamâ€“Whyatt</a> algorithm. I then created a new <a target=_blank rel="noopener noreferrer" href=/nyc_biking>"nyc biking page"</a>, set up a cron job running daily at midnight, and quickly got hooked on seeing my progress.</p><style>.img-path{display:block;margin:auto}@media only screen and (min-width:501px){.img-path img{margin:auto;max-width:100%;max-height:110px}.strava-grid{display:grid;grid-template-columns:repeat(10,1fr);grid-auto-rows:1fr;row-gap:.5em;column-gap:.5em;margin-top:1.5rem;margin-bottom:1rem}}@media only screen and (max-width:500px){.img-path img{margin:auto;max-width:100%;max-height:90px}.strava-grid{display:grid;grid-template-columns:repeat(6,1fr);grid-auto-rows:1fr;row-gap:.5em;column-gap:0;padding-bottom:1rem;padding-top:.5rem}}</style><div class=strava-grid><div class=img-path><img src=5104958920.svg alt="simplified strava biking path"></div><div class=img-path><img src=2728848601.svg alt="simplified strava biking path"></div><div class=img-path><img src=4980784202.svg alt="simplified strava biking path"></div><div class=img-path><img src=4931386297.svg alt="simplified strava biking path"></div><div class=img-path><img src=2588164376.svg alt="simplified strava biking path"></div><div class=img-path><img src=1941193560.svg alt="simplified strava biking path"></div><div class=img-path><img src=2627923953.svg alt="simplified strava biking path"></div><div class=img-path><img src=4070593219.svg alt="simplified strava biking path"></div><div class=img-path><img src=5292575222.svg alt="simplified strava biking path"></div><div class=img-path><img src=3129282560.svg alt="simplified strava biking path"></div><div class=img-path><img src=4060572322.svg alt="simplified strava biking path"></div><div class=img-path><img src=2616991782.svg alt="simplified strava biking path"></div><div class=img-path><img src=5373622788.svg alt="simplified strava biking path"></div><div class=img-path><img src=4310486936.svg alt="simplified strava biking path"></div><div class=img-path><img src=4098986655.svg alt="simplified strava biking path"></div><div class=img-path><img src=4156245226.svg alt="simplified strava biking path"></div><div class=img-path><img src=5180202095.svg alt="simplified strava biking path"></div><div class=img-path><img src=5314603774.svg alt="simplified strava biking path"></div><div class=img-path><img src=5198613186.svg alt="simplified strava biking path"></div><div class=img-path><img src=4031986014.svg alt="simplified strava biking path"></div><div class=img-path><img src=4199448043.svg alt="simplified strava biking path"></div><div class=img-path><img src=5243238723.svg alt="simplified strava biking path"></div><div class=img-path><img src=4844542858.svg alt="simplified strava biking path"></div><div class=img-path><img src=4557017491.svg alt="simplified strava biking path"></div><div class=img-path><img src=2510095581.svg alt="simplified strava biking path"></div><div class=img-path><img src=4697144641.svg alt="simplified strava biking path"></div><div class=img-path><img src=2260982655.svg alt="simplified strava biking path"></div><div class=img-path><img src=4103558225.svg alt="simplified strava biking path"></div><div class=img-path><img src=4531334634.svg alt="simplified strava biking path"></div><div class=img-path><img src=5163232575.svg alt="simplified strava biking path"></div></div><p>Next step was actually quantifying my exploration progress. I started out by downloading the OpenStreetMap (OSM) road network graph for New York City (minus Statin Island) via <a target=_blank rel="noopener noreferrer" href=https://github.com/gboeing/osmnx>OSMnx</a>. As a first pass, I thought I might be able to get away with simply checking off the roads which came within some radius (say 10m) of the gps path scraped from Strava, but this yielded predictably terrible results. Turns out the process of matching gps points to a standardized graph is called <a target=_blank rel="noopener noreferrer" href=https://en.wikipedia.org/wiki/Map_matching>map matching</a> and there exists a whole body of research around it. After a quick literature review I decided on implementing the paper: <a href=_blank href=https://www.researchgate.net/publication/308856380_Fast_Hidden_Markov_Model_Map-Matching_for_Sparse_and_Noisy_Trajectories><i>Fast Hidden Markov Model Map-Matching for Sparse and Noisy Trajectories</i></a> which is an improvement of the earlier paper: <a target=_blank rel="noopener noreferrer" href=https://www.microsoft.com/en-us/research/publication/hidden-markov-map-matching-noise-sparseness/><i>Hidden Markov map matching through noise and sparseness</i></a>. The implementation was fairly straight forward with the hidden markov model (HMM) represented as a <a target=_blank rel="noopener noreferrer" href=https://en.wikipedia.org/wiki/Trellis_(graph)>trellis style graph</a> using <a target=_blank rel="noopener noreferrer" href=https://github.com/networkx/networkx>NetworkX</a>. I was able to then simply call the bidirectional dijkstra method which produces the shortest path through the HMM trellis. It works pretty well and I was able to leverage my <a target=_blank rel="noopener noreferrer" href=https://github.com/nathanrooy/taxicab>Taxicab</a> routing module which was satisfying. Performance is decent too, because I indexed the New York City OSM network graph as a <a target=_blank rel="noopener noreferrer" href=https://en.wikipedia.org/wiki/Ball_tree>ball tree</a> I can process ~500 gps paths (several thousand points each) in roughly ~2min. Below is a fairly typical example of the map matching process across a small portion of a much larger path. The gps path (slightly downsampled) is pretty bad due to the urban canyon nature of midtown Manhattan, but the algorithm was able to resolve the correct path pretty well.</p><p><img width=100%; src=map-matching-clip-minified.svg alt="map matching with python"></p><p>With the map matching process dialed in, I can now track which roads I&rsquo;ve covered, the date when I did so, as well as the total number of times I&rsquo;ve been on that particular road segment. All of these details are persisted as <a target=_blank rel="noopener noreferrer" href=https://networkx.org/documentation/stable/reference/generated/networkx.classes.function.set_edge_attributes.html>edge attributes</a> allowing for a bunch of interesting analysis possibilities. The only remaining issue was dealing with storage. The NYC OSM graph in xml format takes up ~79MB which is a little too big for a GitHub repo. Luckily, a gzipped pickle version only takes up ~16MB!</p><p>The last step was deciding on what progress metrics I wanted to display. I&rsquo;ve been experimenting with a few options, but have found the following to be the most useful/motivating.</p><p><img width=100%; src=combined.svg alt="biking exploration progress in nyc bar chart"></p><p>Where, &ldquo;Explored&rdquo; represents the number of road miles covered divided by the total number of road miles in that borough. And &ldquo;Efficiency&rdquo; is the number of new road miles covered divided by the total number of road miles for that individual activity. Here the 40 most recent activities are displayed with a 10 activity moving average. These graphs are still very much a work in progress though, and the art of gamifying them has been fun. So far I&rsquo;ve learn that metrics involving time (progress/week, etc..) forced me into biking around when I wasn&rsquo;t in the mood simply because I didn&rsquo;t want a low score which is basically the exact opposite of what I&rsquo;m going for. Anyway, I&rsquo;m thinking the next addition will include some kind of heat map which I can then reference while I&rsquo;m out riding. Something to highlight the small unexplored pockets in between the major destinations.</p><p>Thanks for reading!</p><p>- Nathan</p></div><div class=post-hr><hr></div></div><div class=footer><center>&copy; <a href=/about>Nathan A. Rooy</a>.<br>Built with <a target=_blank rel="noopener noreferrer" href=https://gohugo.io/>Hugo</a>.
Powered by <a target=_blank rel="noopener noreferrer" href=http://www.github.com>GitHub</a></center></div></body></html>