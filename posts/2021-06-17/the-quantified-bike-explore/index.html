<html lang=en><head><meta charset=utf-8><title>Nathan Rooy</title><meta content="Nathan Rooy" name=author><meta content=en name=language><meta content="width=device-width,minimum-scale=1" name=viewport><meta content=nathan.fun property=og:site_name><meta content=nathan.fun property=twitter:domain><meta content=article property=og:type><meta content=https://nathan.fun/posts/2021-06-17/the-quantified-bike-explore/ property=og:url><meta content=https://nathan.fun/posts/2021-06-17/the-quantified-bike-explore/ name=twitter:url><meta content="Nathan A. Rooy" name=copyright><meta content=summary_large_image name=twitter:card><meta content="biking,maps,github actions,strava,openstreetmap" name=keywords><meta content="The Quantified Bike Explore" name=twitter:title><meta content="The Quantified Bike Explore" property=og:title><meta content="Exploring New York City via GitHub Actions, OpenStreetMap, and Strava" name=description><meta content="Exploring New York City via GitHub Actions, OpenStreetMap, and Strava" name=twitter:description><meta content="Exploring New York City via GitHub Actions, OpenStreetMap, and Strava" property=og:description><meta content=https://nathan.fun/posts/2021-06-17/the-quantified-bike-explore/IMG_0375_400x300.jpg name=twitter:image><meta content=https://nathan.fun/posts/2021-06-17/the-quantified-bike-explore/IMG_0375_400x300.jpg property=og:image><meta content=https://nathan.fun/posts/2021-06-17/the-quantified-bike-explore/IMG_0375_400x300.jpg name=thumbnail><link title="Nathan Rooy" href=https://nathan.fun/index.xml rel=alternate type=application/rss+xml><link href=/favicon/favicon.png rel=icon type=image/png><link as=font crossorigin href=/fonts/figtree-v1-latin-regular.woff2 rel=preload type=font/woff2><link href=https://nathan.fun/posts/2021-06-17/the-quantified-bike-explore/ rel=canonical><link href=https://raw.githubusercontent.com/nathanrooy/feedly-opml-archiver/refs/heads/main/feedly.opml rel=blogroll type=text/xml><script data-domain=nathan.fun defer src=https://plausible.io/js/script.tagged-events.js></script><style>:root{--main-text-color:#222;--main-text-weight:400;--text-bold:600;--font-family:"Figtree", sans-serif;--background-light:#F5F5F5;--link-text-color:#0955b5;--dark-text-color:#999}html{font-size:16px}body{-webkit-font-smoothing:antialiased;font-family:var(--font-family);color:var(--main-text-color);font-weight:var(--main-text-weight)}.wrapper{max-width:660px;margin:6rem auto 0;padding:1rem}@media only screen and (max-width:750px){.wrapper{margin-top:2.5rem;margin-left:0}}a{text-decoration:none;color:var(--link-text-color)}::selection{background:#fff9c4;text-shadow:none}img{margin:1.5em auto;max-width:100%;display:block}@font-face{font-family:Figtree;font-style:normal;font-weight:400;font-display:swap;src:url(/fonts/figtree-v1-latin-regular.eot);src:local(""),url(/fonts/figtree-v1-latin-regular.eot?#iefix)format("embedded-opentype"),url(/fonts/figtree-v1-latin-regular.woff2)format("woff2"),url(/fonts/figtree-v1-latin-regular.woff)format("woff"),url(/fonts/figtree-v1-latin-regular.ttf)format("truetype"),url(/fonts/figtree-v1-latin-regular.svg#Figtree)format("svg")}@font-face{font-family:Figtree;font-style:normal;font-weight:600;font-display:swap;src:url(/fonts/figtree-v1-latin-600.eot);src:local(""),url(/fonts/figtree-v1-latin-600.eot?#iefix)format("embedded-opentype"),url(/fonts/figtree-v1-latin-600.woff2)format("woff2"),url(/fonts/figtree-v1-latin-600.woff)format("woff"),url(/fonts/figtree-v1-latin-600.ttf)format("truetype"),url(/fonts/figtree-v1-latin-600.svg#Figtree)format("svg")}.wrapper{padding-bottom:8rem}p{font-size:1rem;margin:0 0 1rem;line-height:1.7rem;letter-spacing:.01rem;word-spacing:.025rem}h1{font-weight:var(--main-text-weight);font-size:2.3rem;color:var(--main-text-color);line-height:2.64rem}hr{margin:4rem 0;height:1px;border:none;color:var(--main-text-color);background-color:var(--main-text-color)}@media only screen and (min-width:751px){#burger{padding-left:2rem;padding-top:2rem}}@media only screen and (max-width:750px){#burger{padding-left:1rem;padding-top:1rem}}#burger{font-family:var(--font-family);font-weight:400;color:#a9a9a9;font-size:1.5rem}#burger a{display:inline-block;padding-right:.8rem}#burger label{cursor:pointer}#nav-icons{padding-left:.8rem}#nav-icons svg{max-height:20px;margin-bottom:-.05rem;color:var(--main-text-color)}#l1-val{position:relative;top:-.12rem}#l2-val{position:relative;top:-.2rem;padding-left:.1rem;padding-right:.1rem}#burger-cbox{display:none}#label-1{display:inline-block}#label-2{display:none}#burger-cbox:not(:checked)~#nav-icons{display:none}.TLDR{font-size:1.1rem}.post .post-header{margin-bottom:2.5rem}.post .post-header .title{margin:0}.post blockquote{background-color:var(--background-light);border-left:10px solid;border-color:#2dad60;padding:1.5rem;margin:0 0 1rem;line-height:1.5rem;font-size:15px}</style></head><body><div class=header><nav><div id=burger><input id=burger-cbox type=checkbox><label for=burger-cbox id=label-1><span>[</span><span id=l1-val>+</span><span>]</span></label><label for=burger-cbox id=label-2><span>[</span><span id=l2-val>x</span><span>]</span></label><div id=nav-icons><a class="plausible-event-name=burger+home" aria-label=Home href=/ style=padding-right:.7rem><svg class="feather feather-home" viewbox="0 0 24 24" fill=none height=24 id=home-icon stroke=currentcolor stroke-linecap=round stroke-linejoin=round stroke-width=1 width=24><path d="M3 9l9-7 9 7v11a2 2 0 01-2 2H5a2 2 0 01-2-2z"></path><polyline points="9 22 9 12 15 12 15 22"></polyline></svg></a><a class="plausible-event-name=burger+reading" aria-label=Reading href=/reading><svg viewbox="0 0 23.809855 18.892912" height=24 id=svg5 width=24><defs id=defs2></defs><g id=layer1 transform=translate(-6.352941,-30.26865)><g id=g39 transform=matrix(0.26458333,0,0,0.26458333,5.0300244,26.48677)><path d="m92.22 22.9v59C74.24 76.35 61.26 78.85 54.73 81.04 59.2 76.64 68.54 70.55 84.16 74.14l1.69.39V21.42c2.17.29 4.3.77 6.37 1.48z" class=st0 id=path11></path><path d="M45.24 81.04C38.73 78.85 25.74 76.35 7.77 81.9v-59c2.06-.71 4.2-1.19 6.37-1.48v53.11l1.68-.39c15.61-3.58 24.96 2.5 29.42 6.9z" class=st0 id=path13></path><polygon points="48.86,85.63 48.82,85.58 48.91,85.63" id=polygon15></polygon><polygon points="51.17,85.58 51.13,85.63 50,85.63 51.09,85.62" id=polygon17></polygon><path d="m94.09 20.63c-2.68-1-5.45-1.65-8.24-2.02v-2.94l-1.08-.24c-17.8-4.09-28.32 3.81-32.9 8.68-.81.87-1.44 1.63-1.88 2.22C49.54 25.74 48.91 24.98 48.1 24.11c-4.58-4.87-15.11-12.76-32.9-8.68l-1.07.24v2.94c-2.8.38-5.57 1.02-8.24 2.02L5 20.97V85.7l1.81-.61c13.49-4.49 24.13-4.16 30.68-3.08 7.09 1.15 11.05 3.4 11.09 3.42l.23.14.09.06H50l1.09-.01.08-.05.23-.14c.05-.02 4-2.27 11.09-3.42 6.55-1.08 17.19-1.41 30.68 3.08l1.82.61V20.97zM7.78 81.89v-59c2.06-.71 4.2-1.19 6.37-1.48v53.11l1.68-.39c15.61-3.58 24.95 2.5 29.42 6.9-6.52-2.18-19.5-4.68-37.47.86zm40.76-1.3c-4.19-4.66-14.29-12.83-31.63-9.5v-53.2c11.11-2.28 18.93.38 24.02 3.66 2.6 1.68 4.48 3.52 5.71 4.95 1.14 1.32 1.73 2.28 1.82 2.43l.08.15zm2.76.17V29.34l.24-.4c.09-.16.68-1.12 1.82-2.44 1.23-1.43 3.11-3.27 5.71-4.94 5.08-3.29 12.91-5.95 24.02-3.67v53.2C65.54 67.72 55.4 76.13 51.3 80.76zm40.92 1.13C74.24 76.34 61.26 78.84 54.73 81.03 59.2 76.63 68.54 70.54 84.16 74.13l1.69.39v-53.1c2.16.29 4.3.77 6.37 1.48z" id=path19></path></g></g><style id=style9>.st0{fill:none}</style></svg> </a><a aria-label="NYC Bike Exploring" class="plausible-event-name=burger+nycbike" href=/bike-exploring/nyc style=margin-left:.4rem><svg viewbox="0 0 91.5 52.5" height=24 width=32><g transform=matrix(-1,0,0,1,95.8,-23.9)><path d="m78 40.6c-3.8.0-7.3 1.2-10.2 3.2l-7.4-9.4 2.9-8.5H67c.6.0 1-.4 1-1s-.4-1-1-1H54.8c-.6.0-1 .4-1 1s.4 1 1 1h6.3l-2.3 6.7c-.2-.2-.4-.3-.7-.3H32l2.2-6.4h5.7c.6.0 1-.4 1-1s-.4-1-1-1h-6.4c-.4.0-.8.3-.9.7l-5.7 16.8c-1.5-.4-3.1-.7-4.8-.7-9.8.0-17.8 8-17.8 17.8s8 17.8 17.8 17.8 17.8-8 17.8-17.8c0-7.5-4.6-13.9-11.2-16.5l2.6-7.6 19 24.4c.1.3.3.6.6.7.1.0.2.1.3.1h.1 8.9c.5 9.4 8.3 16.8 17.8 16.8 9.8.0 17.8-8 17.8-17.8s-8-18-17.8-18zM37.8 58.4c0 8.7-7.1 15.8-15.8 15.8S6.2 67.1 6.2 58.4 13.3 42.6 22 42.6c1.4.0 2.8.2 4.1.6L21 58.1c-.2.5.1 1.1.6 1.3.1.0.2.1.3.1.4.0.8-.3.9-.7l5.1-14.9c5.9 2.2 9.9 7.9 9.9 14.5zm29.7-11.8L76 57.4H62.2c.3-4.3 2.2-8.1 5.3-10.8zm-16.7 9.6-17.1-22h24l.4.5zm1.8 1.2 7.1-20.8 6.6 8.4c-3.5 3.1-5.7 7.4-6 12.4zM78 74.2c-8.4.0-15.2-6.6-15.8-14.8H78c.4.0.7-.2.9-.6.2-.3.1-.8-.1-1.1L69 45.4c2.5-1.8 5.6-2.8 8.9-2.8 8.7.0 15.8 7.1 15.8 15.8s-7 15.8-15.7 15.8z"></path></g></svg></a><a class="plausible-event-name=burger+about" aria-label=About href=/about><svg class="feather feather-user" viewbox="0 0 24 24" fill=none height=24 id=about-icon stroke=currentcolor stroke-linecap=round stroke-linejoin=round stroke-width=1 width=24><path d="M20 21v-2a4 4 0 00-4-4H8a4 4 0 00-4 4v2"></path><circle cx=12 cy=7 r=4></circle></svg> </a><a class="plausible-event-name=burger+rss" aria-label=RSS href=/index.xml><svg class="feather feather-rss" viewbox="0 0 30 24" fill=none height=24 id=rss-icon stroke=#444 stroke-linecap=round stroke-linejoin=round stroke-width=1.5 width=24><path d="M4 11a9 9 0 019 9"></path><path d="M4 4a16 16 0 0116 16"></path><circle cx=5 cy=19 r=1></circle></svg></a></div></div></nav></div><div class="wrapper post"><div class=post-header><h1 class=title>The Quantified Bike Explore</h1></div><p class=TLDR><strong>TL;DR</strong> - Exploring New York City via GitHub Actions, OpenStreetMap, and Strava.</p><hr><div class=markdown><p>There are few things I find consistently more enjoyable than exploring my surroundings from the perspective of a bicycle. Whether it’s big cities or narrow country roads, there are details which can only be experienced from this perspective. Whenever I’m biking around and come across something I know most people don’t get to experience, I’m often reminded of the following:</p><blockquote>The world reveals itself to those who travel on foot. — Werner Herzog</blockquote><p>Traversing the world by bike, silently under your own power, unencumbered by traffic, parking, or roads in general is a freedom second to none. Just yourself and your willingness to see what’s around the next corner. I’ve been living in Manhattan for roughly three years now and over that time period have encountered some pretty incredible sights.</p><style>.nyc-grid{grid-template-columns:repeat(6,1fr);grid-template-rows:repeat(12,auto-fit);grid-gap:.5rem;width:100%;margin-top:1.3rem;padding-bottom:1rem;display:grid}.nyc-grid>div{display:flex}.nyc-grid img{object-fit:cover;width:100%;height:100%;margin:0;display:block}.gallery__item--1{grid-area:1/1/3/4}.gallery__item--3{grid-area:1/4/5/7}.gallery__item--4{grid-area:3/1/5/4}.gallery__item--5{grid-area:5/1/7/7}.gallery__item--6{grid-area:7/1/9/3}.gallery__item--7{grid-area:7/3/9/5}.gallery__item--8{grid-area:7/5/9/7}.gallery__item--9{grid-area:9/4/11/7}.gallery__item--11{grid-area:9/1/11/4}</style><div class=nyc-grid><div class=gallery__item--1><img alt="brooklyn bridge as seen from the manhattan bridge" src=File_017_400x300.jpeg></div><div class=gallery__item--3><img alt="midtown skyscrapers in fog" src=File_024_340x600.jpeg></div><div class=gallery__item--4><img alt="strange car in brooklyn" src=IMG_0375_400x300.jpg></div><div class=gallery__item--5><img alt="manhattan bridge as seen during the evening golden hour" src=File_000_1000.jpeg></div><div class=gallery__item--6><img alt="plant store in midtown manhattan" src=IMG_0351_300x400.jpg></div><div class=gallery__item--7><img alt="one world trade center as seen from battery park" src=IMG_0213_300x400.jpg></div><div class=gallery__item--8><img alt="upper west side manhattan building covered in vines" src=IMG_0334_300x400.jpg></div><div class=gallery__item--9><img alt="brooklyn park bench during fall" src=Untitled-8_400x300.jpg></div><div class=gallery__item--11><img alt="brooklyn bridge during fog and rain" src=DSCF1906_400x300.jpg></div></div><p>Anyway, I’ve been a fan of GitHub Actions ever since they rolled out the service and have been looking for use cases other than the typical CI/CD scenario. I’ve had a weekly Goodreads cron job running for a while which scrapes <a rel="noopener noreferrer" href=https://www.goodreads.com/user/show/59168723-nathan-rooy target=_blank>my reading history</a> and <a rel="noopener noreferrer" href=/reading target=_blank>populates a table</a> but that’s not actually very interesting. It finally dawned on me that I should build out some kind of service to track my bike exploration progress.</p><p>I started out with a simple Python script which scrapes the latitude/longitude pairs from each new Strava activity and persists them as downsampled SVGs via the <a rel="noopener noreferrer" href=https://hull-repository.worktribe.com/output/459275 target=_blank>Visvalingam–Whyatt</a> algorithm. I then created a new <a rel="noopener noreferrer" href=/bike-exploring/nyc/ target=_blank>"nyc biking page"</a>, set up a cron job running daily at midnight, and quickly got hooked on seeing my progress.</p><style>.img-path{margin:auto;display:block}@media only screen and (width>=501px){.img-path img{max-width:100%;max-height:110px;margin:auto}.strava-grid-svg{grid-template-columns:repeat(10,1fr);grid-auto-rows:1fr;gap:.5em;margin-top:1.5rem;margin-bottom:1.5rem;display:grid}}@media only screen and (width<=500px){.img-path img{max-width:100%;max-height:90px;margin:auto}.strava-grid-svg{grid-template-columns:repeat(6,1fr);grid-auto-rows:1fr;gap:.5em 0;padding-top:.5rem;padding-bottom:1rem;display:grid}}</style><div class=strava-grid-svg><div class=img-path><img alt="simplified strava biking path" src=5104958920.svg></div><div class=img-path><img alt="simplified strava biking path" src=2728848601.svg></div><div class=img-path><img alt="simplified strava biking path" src=4980784202.svg></div><div class=img-path><img alt="simplified strava biking path" src=4931386297.svg></div><div class=img-path><img alt="simplified strava biking path" src=2588164376.svg></div><div class=img-path><img alt="simplified strava biking path" src=1941193560.svg></div><div class=img-path><img alt="simplified strava biking path" src=2627923953.svg></div><div class=img-path><img alt="simplified strava biking path" src=4070593219.svg></div><div class=img-path><img alt="simplified strava biking path" src=5292575222.svg></div><div class=img-path><img alt="simplified strava biking path" src=3129282560.svg></div><div class=img-path><img alt="simplified strava biking path" src=4060572322.svg></div><div class=img-path><img alt="simplified strava biking path" src=2616991782.svg></div><div class=img-path><img alt="simplified strava biking path" src=5373622788.svg></div><div class=img-path><img alt="simplified strava biking path" src=4310486936.svg></div><div class=img-path><img alt="simplified strava biking path" src=4098986655.svg></div><div class=img-path><img alt="simplified strava biking path" src=4156245226.svg></div><div class=img-path><img alt="simplified strava biking path" src=5180202095.svg></div><div class=img-path><img alt="simplified strava biking path" src=5314603774.svg></div><div class=img-path><img alt="simplified strava biking path" src=5198613186.svg></div><div class=img-path><img alt="simplified strava biking path" src=4031986014.svg></div><div class=img-path><img alt="simplified strava biking path" src=4199448043.svg></div><div class=img-path><img alt="simplified strava biking path" src=5243238723.svg></div><div class=img-path><img alt="simplified strava biking path" src=4844542858.svg></div><div class=img-path><img alt="simplified strava biking path" src=4557017491.svg></div><div class=img-path><img alt="simplified strava biking path" src=2510095581.svg></div><div class=img-path><img alt="simplified strava biking path" src=4697144641.svg></div><div class=img-path><img alt="simplified strava biking path" src=2260982655.svg></div><div class=img-path><img alt="simplified strava biking path" src=4103558225.svg></div><div class=img-path><img alt="simplified strava biking path" src=4531334634.svg></div><div class=img-path><img alt="simplified strava biking path" src=5163232575.svg></div></div><p>Next step was actually quantifying my exploration progress. I started out by downloading the OpenStreetMap (OSM) road network graph for New York City (minus Statin Island) via <a rel="noopener noreferrer" href=https://github.com/gboeing/osmnx target=_blank>OSMnx</a>. As a first pass, I thought I might be able to get away with simply checking off the roads which came within some radius (say 10m) of the gps path scraped from Strava, but this yielded predictably terrible results. Turns out the process of matching gps points to a standardized graph is called <a rel="noopener noreferrer" href=https://en.wikipedia.org/wiki/Map_matching target=_blank>map matching</a> and there exists a whole body of research around it. After a quick literature review I decided on implementing the paper: <a rel="noopener noreferrer" href=https://www.researchgate.net/publication/308856380_Fast_Hidden_Markov_Model_Map-Matching_for_Sparse_and_Noisy_Trajectories target=_blank><i>Fast Hidden Markov Model Map-Matching for Sparse and Noisy Trajectories</i></a> which is an improvement of the earlier paper: <a rel="noopener noreferrer" href=https://www.microsoft.com/en-us/research/publication/hidden-markov-map-matching-noise-sparseness/ target=_blank><i>Hidden Markov map matching through noise and sparseness</i></a>. The implementation was fairly straight forward with the hidden markov model (HMM) represented as a <a rel="noopener noreferrer" href=https://en.wikipedia.org/wiki/Trellis_(graph) target=_blank>trellis style graph</a> using <a rel="noopener noreferrer" href=https://github.com/networkx/networkx target=_blank>NetworkX</a>. I was able to then simply call the bidirectional dijkstra method which produces the shortest path through the HMM trellis. It works pretty well and I was able to leverage my <a rel="noopener noreferrer" href=https://github.com/nathanrooy/taxicab target=_blank>Taxicab</a> routing module which was satisfying. Performance is decent too, because I indexed the New York City OSM network graph as a <a rel="noopener noreferrer" href=https://en.wikipedia.org/wiki/Ball_tree target=_blank>ball tree</a> I can process ~500 gps paths (several thousand points each) in roughly ~2min. Below is a fairly typical example of the map matching process across a small portion of a much larger path. The gps path (slightly downsampled) is pretty bad due to the urban canyon nature of midtown Manhattan, but the algorithm was able to resolve the correct path pretty well.</p><img alt="map matching with python" src=map-matching-clip-minified.svg width=100%;><p>With the map matching process dialed in, I can now track which roads I’ve covered, the date when I did so, as well as the total number of times I’ve been on that particular road segment. All of these details are persisted as <a rel="noopener noreferrer" href=https://networkx.org/documentation/stable/reference/generated/networkx.classes.function.set_edge_attributes.html target=_blank>edge attributes</a> allowing for a bunch of interesting analysis possibilities. The only remaining issue was dealing with storage. The NYC OSM graph in xml format takes up ~79MB which is a little too big for a GitHub repo. Luckily, a gzipped pickle version only takes up ~16MB!</p><p>The last step was deciding on what progress metrics I wanted to display. I’ve been experimenting with a few options, but have found the following to be the most useful/motivating.</p><img alt="biking exploration progress in nyc bar chart" src=combined.svg width=100%;><p>Where, “Explored” represents the number of road miles covered divided by the total number of road miles in that borough. And “Efficiency” is the number of new road miles covered divided by the total number of road miles for that individual activity. Here the 40 most recent activities are displayed with a 10 activity moving average. These graphs are still very much a work in progress though, and the art of gamifying them has been fun. So far I’ve learned that metrics involving time (progress/week, etc..) forced me into biking when I wasn’t in the mood simply because I didn’t want a low score which is basically the exact opposite of what I’m going for. Anyway, I’m thinking the next addition will include some kind of heat map which I can then reference while I’m out riding. Something to highlight the small unexplored pockets in between the major destinations.</p><p>Thanks for reading!</p><p>- Nathan</p></div></div></body></html>