<!doctype html><html lang=en><head><meta charset=utf-8><title>Nathan Rooy</title>
<meta content="Nathan Rooy" name=author><meta content="en" name=language><meta content="width=device-width,minimum-scale=1" name=viewport><meta content="nathan.fun" property="og:site_name"><meta content="nathan.fun" property="twitter:domain"><meta content="article" property="og:type"><meta content="https://nathan.fun/posts/2024-12-19/ptpx-2024/" property="og:url"><meta content="https://nathan.fun/posts/2024-12-19/ptpx-2024/" name=twitter:url><meta content="Nathan A. Rooy" name=copyright><meta content="summary_large_image" name=twitter:card><meta content="PTPX,pen plotting,lattice boltzmann method,cfd" name=keywords><meta content="PTPX 2024" name=twitter:title><meta content="PTPX 2024" property="og:title"><meta content="Pen plotter postcard exchange 2024!" name=description><meta content="Pen plotter postcard exchange 2024!" name=twitter:description><meta content="Pen plotter postcard exchange 2024!" property="og:description"><meta content="https://nathan.fun/posts/2024-12-19/ptpx-2024/og.jpg" name=twitter:image><meta content="https://nathan.fun/posts/2024-12-19/ptpx-2024/og.jpg" property="og:image"><meta content="https://nathan.fun/posts/2024-12-19/ptpx-2024/og.jpg" name=thumbnail><link href=https://nathan.fun/index.xml rel=alternate type=application/rss+xml title="Nathan Rooy"><link href=/favicon/favicon.png rel=icon type=image/png><link href=/fonts/figtree-v1-latin-regular.woff2 rel=preload as=font type=font/woff2 crossorigin><link href=https://nathan.fun/posts/2024-12-19/ptpx-2024/ rel=canonical><link rel=blogroll type=text/xml href=https://raw.githubusercontent.com/nathanrooy/feedly-opml-archiver/refs/heads/main/feedly.opml><script defer data-domain=nathan.fun src=https://plausible.io/js/script.tagged-events.js></script><style>:root{--main-text-color:#222;--main-text-weight:400;--text-bold:600;--font-family:"Figtree", sans-serif;--background-light:#F5F5F5;--link-text-color:#0955b5;--dark-text-color:#999}html{font-size:16px}body{-webkit-font-smoothing:antialiased;font-family:var(--font-family);color:var(--main-text-color);font-weight:var(--main-text-weight)}.wrapper{max-width:660px;margin:6rem auto 0;padding:1rem}@media only screen and (max-width:750px){.wrapper{margin-top:2.5rem;margin-left:0}}a{text-decoration:none;color:var(--link-text-color)}a:hover{text-decoration:underline}a:visited{color:var(--link-text-color)}::selection{background:#fff9c4;text-shadow:none}img{margin:1.5em auto;max-width:100%;display:block}a img{border:none}@font-face{font-family:Figtree;font-style:normal;font-weight:400;font-display:swap;src:url(/fonts/figtree-v1-latin-regular.eot);src:local(''),url(/fonts/figtree-v1-latin-regular.eot?#iefix)format('embedded-opentype'),url(/fonts/figtree-v1-latin-regular.woff2)format('woff2'),url(/fonts/figtree-v1-latin-regular.woff)format('woff'),url(/fonts/figtree-v1-latin-regular.ttf)format('truetype'),url(/fonts/figtree-v1-latin-regular.svg#Figtree)format('svg')}@font-face{font-family:Figtree;font-style:normal;font-weight:600;font-display:swap;src:url(/fonts/figtree-v1-latin-600.eot);src:local(''),url(/fonts/figtree-v1-latin-600.eot?#iefix)format('embedded-opentype'),url(/fonts/figtree-v1-latin-600.woff2)format('woff2'),url(/fonts/figtree-v1-latin-600.woff)format('woff'),url(/fonts/figtree-v1-latin-600.ttf)format('truetype'),url(/fonts/figtree-v1-latin-600.svg#Figtree)format('svg')}.wrapper{padding-bottom:8rem}.markdown ol li{padding-bottom:.75em}p{font-size:1rem;margin:0 0 1rem;line-height:1.7rem;letter-spacing:.01rem;word-spacing:.025rem}h1{font-weight:var(--main-text-weight);font-size:2.3rem;color:var(--main-text-color);line-height:2.64rem}h2{font-size:1.2rem;font-weight:var(--text-bold);margin-bottom:.3em}*+h2{padding-top:2rem}table{width:100%;font-size:14px;letter-spacing:-.01em;border-collapse:collapse;margin-bottom:2em;margin-top:2em;line-height:1.2rem}table th{text-align:left}table thead{border-bottom:1px solid var(--main-text-color);line-height:1.4em}ul{padding-left:15px;list-style:disc inside}ul li{margin-bottom:.5rem}ul li p{display:inline}hr{margin:4rem 0;height:1px;border:none;color:var(--main-text-color);background-color:var(--main-text-color)}@media only screen and (min-width:751px){#burger{padding-left:2rem;padding-top:2rem}}@media only screen and (max-width:750px){#burger{padding-left:1rem;padding-top:1rem}}#burger{font-family:var(--font-family);font-weight:400;color:#a9a9a9;font-size:1.5rem}#burger a{display:inline-block;padding-right:.8rem}#burger label{cursor:pointer}#burger label:hover{color:var(--main-text-color)}#nav-icons{padding-left:.8rem}#nav-icons svg{max-height:20px;margin-bottom:-.05rem;color:var(--main-text-color)}#l1-val{position:relative;top:-.12rem}#l2-val{position:relative;top:-.2rem;padding-left:.1rem;padding-right:.1rem}#burger-cbox{display:none}#label-1{display:inline-block}#label-2{display:none}#burger-cbox:not(:checked)~#nav-icons{display:none}#burger-cbox:checked~#nav-icons{display:inline-block}#burger-cbox:checked~#label-1{display:none}#burger-cbox:checked~#label-2{display:inline-block;color:var(--main-text-color)}.TLDR{font-size:1.1rem}figure{margin:0;text-align:center}.figcaption{font-size:.8rem;padding-bottom:1rem}.post .post-header{margin-bottom:2.5rem}.post .post-header .title{margin:0}.post blockquote{background-color:var(--background-light);border-left:10px solid;border-color:#2dad60;padding:1.5rem;margin:0 0 1rem;line-height:1.5rem;font-size:15px}.highlighter-rouge{position:relative;font-size:.75rem;color:var(--main-text-color);border:1px solid;border-color:#e6e6e6;border-radius:3px;background-color:var(--background-light);padding:.1rem .2rem}.math-block{margin-top:2rem;margin-bottom:2rem}mtext{position:absolute;right:0}.inline-svg-equation{text-align:center;margin:1.5em auto;max-width:100%;display:block}.highlight pre{padding:20px;background-color:transparent!important;overflow:auto;word-wrap:normal;white-space:pre}.highlight{background:0 0;background-color:var(--background-light)}</style></head><body><div class=header><nav><div id=burger><input type=checkbox id=burger-cbox>
<label id=label-1 for=burger-cbox><span>[</span><span id=l1-val>+</span><span>]</span>
</label><label id=label-2 for=burger-cbox><span>[</span><span id=l2-val>x</span><span>]</span></label><div id=nav-icons><a class="plausible-event-name=burger+home" aria-label=Home style=padding-right:.7rem href=/><svg id="home-icon" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="feather feather-home"><path d="M3 9l9-7 9 7v11a2 2 0 01-2 2H5a2 2 0 01-2-2z"/><polyline points="9 22 9 12 15 12 15 22"/></svg></a>
<a class="plausible-event-name=burger+reading" aria-label=Reading href=/reading><svg width="24" height="24" viewBox="0 0 23.809855 18.892912" id="svg5"><defs id="defs2"/><g id="layer1" transform="translate(-6.352941,-30.26865)"><g id="g39" transform="matrix(0.26458333,0,0,0.26458333,5.0300244,26.48677)"><path class="st0" d="m92.22 22.9v59C74.24 76.35 61.26 78.85 54.73 81.04 59.2 76.64 68.54 70.55 84.16 74.14l1.69.39V21.42c2.17.29 4.3.77 6.37 1.48z" id="path11"/><path class="st0" d="M45.24 81.04C38.73 78.85 25.74 76.35 7.77 81.9v-59c2.06-.71 4.2-1.19 6.37-1.48v53.11l1.68-.39c15.61-3.58 24.96 2.5 29.42 6.9z" id="path13"/><polygon points="48.86,85.63 48.82,85.58 48.91,85.63" id="polygon15"/><polygon points="51.17,85.58 51.13,85.63 50,85.63 51.09,85.62" id="polygon17"/><path d="m94.09 20.63c-2.68-1-5.45-1.65-8.24-2.02v-2.94l-1.08-.24c-17.8-4.09-28.32 3.81-32.9 8.68-.81.87-1.44 1.63-1.88 2.22C49.54 25.74 48.91 24.98 48.1 24.11c-4.58-4.87-15.11-12.76-32.9-8.68l-1.07.24v2.94c-2.8.38-5.57 1.02-8.24 2.02L5 20.97V85.7l1.81-.61c13.49-4.49 24.13-4.16 30.68-3.08 7.09 1.15 11.05 3.4 11.09 3.42l.23.14.09.06H50l1.09-.01.08-.05.23-.14c.05-.02 4-2.27 11.09-3.42 6.55-1.08 17.19-1.41 30.68 3.08l1.82.61V20.97zM7.78 81.89v-59c2.06-.71 4.2-1.19 6.37-1.48v53.11l1.68-.39c15.61-3.58 24.95 2.5 29.42 6.9-6.52-2.18-19.5-4.68-37.47.86zm40.76-1.3c-4.19-4.66-14.29-12.83-31.63-9.5v-53.2c11.11-2.28 18.93.38 24.02 3.66 2.6 1.68 4.48 3.52 5.71 4.95 1.14 1.32 1.73 2.28 1.82 2.43l.08.15zm2.76.17V29.34l.24-.4c.09-.16.68-1.12 1.82-2.44 1.23-1.43 3.11-3.27 5.71-4.94 5.08-3.29 12.91-5.95 24.02-3.67v53.2C65.54 67.72 55.4 76.13 51.3 80.76zm40.92 1.13C74.24 76.34 61.26 78.84 54.73 81.03 59.2 76.63 68.54 70.54 84.16 74.13l1.69.39v-53.1c2.16.29 4.3.77 6.37 1.48z" id="path19"/></g></g><style id="style9">.st0{fill:none}</style></svg>
</a><a class="plausible-event-name=burger+nycbike" aria-label="NYC Bike Exploring" style=margin-left:.4rem href=/bike-exploring/nyc><svg viewBox="0 0 91.5 52.5" width="32" height="24"><g transform="matrix(-1,0,0,1,95.8,-23.9)"><path d="m78 40.6c-3.8.0-7.3 1.2-10.2 3.2l-7.4-9.4 2.9-8.5H67c.6.0 1-.4 1-1s-.4-1-1-1H54.8c-.6.0-1 .4-1 1s.4 1 1 1h6.3l-2.3 6.7c-.2-.2-.4-.3-.7-.3H32l2.2-6.4h5.7c.6.0 1-.4 1-1s-.4-1-1-1h-6.4c-.4.0-.8.3-.9.7l-5.7 16.8c-1.5-.4-3.1-.7-4.8-.7-9.8.0-17.8 8-17.8 17.8s8 17.8 17.8 17.8 17.8-8 17.8-17.8c0-7.5-4.6-13.9-11.2-16.5l2.6-7.6 19 24.4c.1.3.3.6.6.7.1.0.2.1.3.1h.1 8.9c.5 9.4 8.3 16.8 17.8 16.8 9.8.0 17.8-8 17.8-17.8s-8-18-17.8-18zM37.8 58.4c0 8.7-7.1 15.8-15.8 15.8S6.2 67.1 6.2 58.4 13.3 42.6 22 42.6c1.4.0 2.8.2 4.1.6L21 58.1c-.2.5.1 1.1.6 1.3.1.0.2.1.3.1.4.0.8-.3.9-.7l5.1-14.9c5.9 2.2 9.9 7.9 9.9 14.5zm29.7-11.8L76 57.4H62.2c.3-4.3 2.2-8.1 5.3-10.8zm-16.7 9.6-17.1-22h24l.4.5zm1.8 1.2 7.1-20.8 6.6 8.4c-3.5 3.1-5.7 7.4-6 12.4zM78 74.2c-8.4.0-15.2-6.6-15.8-14.8H78c.4.0.7-.2.9-.6.2-.3.1-.8-.1-1.1L69 45.4c2.5-1.8 5.6-2.8 8.9-2.8 8.7.0 15.8 7.1 15.8 15.8s-7 15.8-15.7 15.8z"/></g></svg></a>
<a class="plausible-event-name=burger+about" aria-label=About href=/about><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="feather feather-user" id="about-icon"><path d="M20 21v-2a4 4 0 00-4-4H8a4 4 0 00-4 4v2"/><circle cx="12" cy="7" r="4"/></svg>
</a><a class="plausible-event-name=burger+rss" aria-label=RSS href=/index.xml><svg width="24" height="24" viewBox="0 0 30 24" fill="none" stroke="#444" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="feather feather-rss" id="rss-icon"><path d="M4 11a9 9 0 019 9"/><path d="M4 4a16 16 0 0116 16"/><circle cx="5" cy="19" r="1"/></svg></a></div></div></nav></div><div class="wrapper post"><div class=post-header><h1 class=title>PTPX 2024</h1></div><p class=TLDR><strong>TL;DR</strong> - Lattice Boltzmann Methods are still witchcraft</p><hr><div class=markdown><style>video{margin:3rem auto}.highlight{margin:3rem auto}.img-pad-big{margin:3rem auto}</style><p>Well, I&rsquo;ve had my <a href=/posts/2024-02-25/3d-printer-pen-plotter-conversion/>converted 3D printer / pen plotter</a> up and running for most of the year now. It&rsquo;s been working great, and so for one last challenge before the end of the year, I decided to participate in the annual pen plotter postcard exchange (<a href=https://buttondown.com/ptpx>PTPX</a>). Started by <a href=https://paulbutler.org/>Paul Butler</a> and currently in its fifth season, PTPX is a &ldquo;<a href=https://paulbutler.org/2022/generalizing-secret-santa-with-integer-programming-in-julia/>generalized secret santa</a>&rdquo; for plotter enthusiasts. The only challenge now is to figure out what to plot!</p><p>I knew that given my artistic inability, coming up with something &ldquo;original&rdquo; would be a fool&rsquo;s errand. Instead I decided to pull inspiration from something I find consistently beautiful; aerodynamics. Whether it&rsquo;s the underlying mathematics, the fluid motion itself, or the <a href=https://en.wikipedia.org/wiki/Le_Mans_Prototype>optimal forms</a> created through optimization, aerodynamics is beautiful.</p><figure style=margin-top:4rem;margin-bottom:3rem><img style=margin-bottom:1rem src=shedding.jpg alt="An Album of Fluid Motion by Milton Van Dyke"><p>An Album of Fluid Motion by Milton Van Dyke</p></figure><p>I was originally thinking I would just run something in <a href=https://github.com/OpenFOAM/OpenFOAM-dev>OpenFOAM</a> and be done with it, but that would have been a little too easy. To make it a little harder, I contemplated writing my own 2D solver, but I&rsquo;ve written enough <a href=https://www.grc.nasa.gov/www/k-12/airplane/nseqs.html>Navier-Stokes</a> based solvers over the years that it&rsquo;s no longer something I want to spend my free time doing. After pondering on this for a bit more, I remembered an area of CFD that&rsquo;s basically witchcraft: <a href=https://en.wikipedia.org/wiki/Lattice_Boltzmann_methods>Lattice Boltzmann Methods</a>&mldr;</p><p>LBM is strange because instead of resolving the usual bulk properties of a fluid using the continuum assumption it operates at a smaller mesoscopic scale. Down here, physics is described using <a href=https://en.wikipedia.org/wiki/Statistical_mechanics>probability distributions</a>. Back when I was an <i>actual</i> engineer doing <i>actual</i> work I couldn&rsquo;t have been bothered with a petty subject like &ldquo;statistics&rdquo;&mldr; Well, jokes on me! I&rsquo;ve been doing nothing but statistics for the last 10 years now ðŸ˜­</p><p>Anyway, LBM doesn&rsquo;t require any real understanding of aerodynamics or numerical methods so implementing it was shockingly simple. In fact, it&rsquo;s just a first-order PDE and the important bits are less than 30 lines of Python:</p><div class=highlight><pre tabindex=0 style=background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-Python data-lang=Python><span style=display:flex><span><span style=color:#069;font-weight:700>while</span> err <span style=color:#555>&gt;</span> <span style=color:#f60>1E-6</span>:
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#09f;font-style:italic># Bhatnagar-Gross-Krook (BKG) collision</span>
</span></span><span style=display:flex><span>    feq <span style=color:#555>=</span> equilibrium_distribution()
</span></span><span style=display:flex><span>    f_post <span style=color:#555>=</span> f <span style=color:#555>-</span> ((f <span style=color:#555>-</span> feq) <span style=color:#555>/</span> tau)
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#09f;font-style:italic># streaming</span>
</span></span><span style=display:flex><span>    <span style=color:#069;font-weight:700>for</span> k <span style=color:#000;font-weight:700>in</span> <span style=color:#366>range</span>(<span style=color:#f60>0</span>, q):
</span></span><span style=display:flex><span>        f[:,:,k] <span style=color:#555>=</span> np<span style=color:#555>.</span>roll(f_post[:,:,k], c[k], axis<span style=color:#555>=</span>(<span style=color:#f60>1</span>, <span style=color:#f60>0</span>))
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>    <span style=color:#09f;font-style:italic># bounce-back: top plate</span>
</span></span><span style=display:flex><span>    f[<span style=color:#555>-</span><span style=color:#f60>1</span>, :, <span style=color:#f60>4</span>] <span style=color:#555>=</span> f_post[<span style=color:#555>-</span><span style=color:#f60>1</span>, :, <span style=color:#f60>2</span>]
</span></span><span style=display:flex><span>    f[<span style=color:#555>-</span><span style=color:#f60>1</span>, :, <span style=color:#f60>7</span>] <span style=color:#555>=</span> f_post[<span style=color:#555>-</span><span style=color:#f60>1</span>, :, <span style=color:#f60>5</span>] <span style=color:#555>+</span> <span style=color:#f60>6</span> <span style=color:#555>*</span> rho[<span style=color:#555>-</span><span style=color:#f60>1</span>, :] <span style=color:#555>*</span> w[<span style=color:#f60>7</span>] <span style=color:#555>*</span> cx[<span style=color:#f60>7</span>] <span style=color:#555>*</span> uw
</span></span><span style=display:flex><span>    f[<span style=color:#555>-</span><span style=color:#f60>1</span>, :, <span style=color:#f60>8</span>] <span style=color:#555>=</span> f_post[<span style=color:#555>-</span><span style=color:#f60>1</span>, :, <span style=color:#f60>6</span>] <span style=color:#555>+</span> <span style=color:#f60>6</span> <span style=color:#555>*</span> rho[<span style=color:#555>-</span><span style=color:#f60>1</span>, :] <span style=color:#555>*</span> w[<span style=color:#f60>8</span>] <span style=color:#555>*</span> cx[<span style=color:#f60>8</span>] <span style=color:#555>*</span> uw
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#09f;font-style:italic># bounce-back: bottom plate</span>
</span></span><span style=display:flex><span>    f[<span style=color:#f60>0</span>, :, <span style=color:#f60>2</span>] <span style=color:#555>=</span> f_post[<span style=color:#f60>0</span>, :, <span style=color:#f60>4</span>]
</span></span><span style=display:flex><span>    f[<span style=color:#f60>0</span>, :, <span style=color:#f60>5</span>] <span style=color:#555>=</span> f_post[<span style=color:#f60>0</span>, :, <span style=color:#f60>7</span>]
</span></span><span style=display:flex><span>    f[<span style=color:#f60>0</span>, :, <span style=color:#f60>6</span>] <span style=color:#555>=</span> f_post[<span style=color:#f60>0</span>, :, <span style=color:#f60>8</span>]
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>    <span style=color:#09f;font-style:italic># bounce-back: left wall</span>
</span></span><span style=display:flex><span>    f[:, <span style=color:#f60>0</span>, <span style=color:#f60>1</span>] <span style=color:#555>=</span> f_post[:, <span style=color:#f60>0</span>, <span style=color:#f60>3</span>]
</span></span><span style=display:flex><span>    f[:, <span style=color:#f60>0</span>, <span style=color:#f60>5</span>] <span style=color:#555>=</span> f_post[:, <span style=color:#f60>0</span>, <span style=color:#f60>7</span>]
</span></span><span style=display:flex><span>    f[:, <span style=color:#f60>0</span>, <span style=color:#f60>8</span>] <span style=color:#555>=</span> f_post[:, <span style=color:#f60>0</span>, <span style=color:#f60>6</span>]
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#09f;font-style:italic># bounce-back: right wall</span>
</span></span><span style=display:flex><span>    f[:, <span style=color:#555>-</span><span style=color:#f60>1</span>, <span style=color:#f60>3</span>] <span style=color:#555>=</span> f_post[:, <span style=color:#555>-</span><span style=color:#f60>1</span>, <span style=color:#f60>1</span>]
</span></span><span style=display:flex><span>    f[:, <span style=color:#555>-</span><span style=color:#f60>1</span>, <span style=color:#f60>7</span>] <span style=color:#555>=</span> f_post[:, <span style=color:#555>-</span><span style=color:#f60>1</span>, <span style=color:#f60>5</span>]
</span></span><span style=display:flex><span>    f[:, <span style=color:#555>-</span><span style=color:#f60>1</span>, <span style=color:#f60>6</span>] <span style=color:#555>=</span> f_post[:, <span style=color:#555>-</span><span style=color:#f60>1</span>, <span style=color:#f60>8</span>]
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#09f;font-style:italic># compute density</span>
</span></span><span style=display:flex><span>    rho <span style=color:#555>=</span> np<span style=color:#555>.</span>sum(f, <span style=color:#f60>2</span>)
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#09f;font-style:italic># compute macroscopic velocity</span>
</span></span><span style=display:flex><span>    ux <span style=color:#555>=</span> np<span style=color:#555>.</span>sum(f <span style=color:#555>*</span> cx, <span style=color:#f60>2</span>) <span style=color:#555>/</span> rho
</span></span><span style=display:flex><span>    uy <span style=color:#555>=</span> np<span style=color:#555>.</span>sum(f <span style=color:#555>*</span> cy, <span style=color:#f60>2</span>) <span style=color:#555>/</span> rho
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#09f;font-style:italic># compute error</span>
</span></span><span style=display:flex><span>    <span style=color:#069;font-weight:700>if</span> time_step <span style=color:#555>%</span> <span style=color:#f60>1_000</span> <span style=color:#555>==</span> <span style=color:#f60>0</span>:
</span></span><span style=display:flex><span>        err <span style=color:#555>=</span> residual()
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>    time_step <span style=color:#555>+=</span> <span style=color:#f60>1</span>
</span></span></code></pre></div><p>At its core, LBM is just a series of streaming and collision steps. It&rsquo;s a slightly more advanced form of <a href=https://en.wikipedia.org/wiki/Cellular_automaton>cellular automaton</a> for fluids. Before getting too wild though, I wanted to validate my LBM solver against the &ldquo;hello world&rdquo; of CFD problems: the <a href=https://www.cfd-online.com/Wiki/Lid-driven_cavity_problem>lid driven cavity flow</a>.</p><div style=display:flex;margin-top:2rem;margin-bottom:1rem><img style=margin-right:7% class=graph width=100% src=ldcf-validation.svg></div><p>Not too shabby. It took about 100k time steps to converge and looks good against <a href=https://doi.org/10.1016/0021-9991(82)90058-4>Ghia1982</a>. I know it only takes a couple assumptions to recover the Navier-Stokes from LBM but it&rsquo;s still weird.</p><p>With the lid driven cavity flow sanity check out of the way, I swapped some boundary conditions, added an obstacle, and resized the domain to match my 4x6 postcard blanks. The result was another canonical CFD benchmark case:</p><center><video id=shedding-vid width=100% autoplay loop muted playsinline>
<source src=lbm-cylinder.webm type=video/webm><source src=lbm-cylinder.mp4 type=video/mp4></video></center><p>For the actual postcard design, I wasn&rsquo;t sure if I wanted to go with <a href=https://en.wikipedia.org/wiki/Vorticity>vorticity</a> or pull something from the <a href=https://en.wikipedia.org/wiki/Streamlines,_streaklines,_and_pathlines>velocity field</a>. There are <a href=https://cats2d.com/topics/vortexstreet.html>so many great ways</a> to visualize this! After a little experimenting, I decided on streamlines pulled from several different time steps. Because the output of the streamline integration is just a series of (x, y) coordinate pairs, I could go from simulation results to <a href=https://en.wikipedia.org/wiki/G-code>G-code</a> in a single step.</p><div class=highlight><pre tabindex=0 style=background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-Python data-lang=Python><span style=display:flex><span><span style=color:#069;font-weight:700>for</span> i, timestep <span style=color:#000;font-weight:700>in</span> <span style=color:#366>enumerate</span>(timesteps, <span style=color:#f60>1</span>):
</span></span><span style=display:flex><span>    <span style=color:#069;font-weight:700>with</span> <span style=color:#366>open</span>(<span style=color:#c30>f</span><span style=color:#c30>&#34;lbm_layer-</span><span style=color:#a00>{</span>i<span style=color:#a00>}</span><span style=color:#c30>.gcode&#34;</span>, <span style=color:#c30>&#34;w&#34;</span>) <span style=color:#069;font-weight:700>as</span> f:
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>        <span style=color:#09f;font-style:italic># set some initial constraints</span>
</span></span><span style=display:flex><span>        f<span style=color:#555>.</span>write(<span style=color:#c30>f</span><span style=color:#c30>&#39;;PTPX2024 - LBM - LAYER #</span><span style=color:#a00>{</span>i<span style=color:#a00>}</span><span style=color:#c30;font-weight:700>\n\n</span><span style=color:#c30>&#39;</span>)
</span></span><span style=display:flex><span>        f<span style=color:#555>.</span>write(<span style=color:#c30>&#39;M203 X50.00 Y50.00 Z10.00     ;set max feedrate (mm/sec)</span><span style=color:#c30;font-weight:700>\n</span><span style=color:#c30>&#39;</span>)
</span></span><span style=display:flex><span>        f<span style=color:#555>.</span>write(<span style=color:#c30>&#39;M201 X100.00 Y100.00 Z100.00  ;set max acceleration (mm/sec/sec)</span><span style=color:#c30;font-weight:700>\n</span><span style=color:#c30>&#39;</span>)
</span></span><span style=display:flex><span>        f<span style=color:#555>.</span>write(<span style=color:#c30>&#39;M205 X8.00 Y8.00 Z0.40        ;set max jerk (mm/sec)</span><span style=color:#c30;font-weight:700>\n\n</span><span style=color:#c30>&#39;</span>)
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>        <span style=color:#09f;font-style:italic># starting point for current plot</span>
</span></span><span style=display:flex><span>        f<span style=color:#555>.</span>write(<span style=color:#c30>f</span><span style=color:#c30>&#39;G0 x200 Y200 Z</span><span style=color:#a00>{</span>Z_START<span style=color:#a00>}</span><span style=color:#c30;font-weight:700>\n</span><span style=color:#c30>&#39;</span>)
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>        <span style=color:#09f;font-style:italic># cycle through each streamline</span>
</span></span><span style=display:flex><span>        <span style=color:#069;font-weight:700>for</span> _path <span style=color:#000;font-weight:700>in</span> [[v[<span style=color:#f60>0</span>], v[<span style=color:#f60>1</span>]] <span style=color:#069;font-weight:700>for</span> v <span style=color:#000;font-weight:700>in</span> paths_final <span style=color:#069;font-weight:700>if</span> v[<span style=color:#f60>2</span>]<span style=color:#555>==</span>timestep]:
</span></span><span style=display:flex><span>            
</span></span><span style=display:flex><span>            <span style=color:#09f;font-style:italic># iterate through each point in current streamline</span>
</span></span><span style=display:flex><span>            <span style=color:#069;font-weight:700>for</span> j, [x, y] <span style=color:#000;font-weight:700>in</span> <span style=color:#366>enumerate</span>(<span style=color:#366>zip</span>(<span style=color:#555>*</span>_path)):
</span></span><span style=display:flex><span>                <span style=color:#069;font-weight:700>if</span> j <span style=color:#555>==</span> <span style=color:#f60>0</span>:
</span></span><span style=display:flex><span>                    
</span></span><span style=display:flex><span>                    <span style=color:#09f;font-style:italic># move pen above first point</span>
</span></span><span style=display:flex><span>                    f<span style=color:#555>.</span>write(<span style=color:#c30>f</span><span style=color:#c30>&#39;G0 X</span><span style=color:#a00>{</span>x<span style=color:#a00>:</span><span style=color:#c30>0.3f</span><span style=color:#a00>}</span><span style=color:#c30> Y</span><span style=color:#a00>{</span>y<span style=color:#a00>:</span><span style=color:#c30>0.3f</span><span style=color:#a00>}</span><span style=color:#c30> Z</span><span style=color:#a00>{</span>Z_TRAVEL<span style=color:#a00>}</span><span style=color:#c30;font-weight:700>\n</span><span style=color:#c30>&#39;</span>)
</span></span><span style=display:flex><span>                    
</span></span><span style=display:flex><span>                    <span style=color:#09f;font-style:italic># move pen down</span>
</span></span><span style=display:flex><span>                    f<span style=color:#555>.</span>write(<span style=color:#c30>f</span><span style=color:#c30>&#39;G0 X</span><span style=color:#a00>{</span>x<span style=color:#a00>:</span><span style=color:#c30>0.3f</span><span style=color:#a00>}</span><span style=color:#c30> Y</span><span style=color:#a00>{</span>y<span style=color:#a00>:</span><span style=color:#c30>0.3f</span><span style=color:#a00>}</span><span style=color:#c30> Z</span><span style=color:#a00>{</span>Z_DRAW<span style=color:#a00>}</span><span style=color:#c30;font-weight:700>\n</span><span style=color:#c30>&#39;</span>)
</span></span><span style=display:flex><span>                    
</span></span><span style=display:flex><span>                <span style=color:#069;font-weight:700>else</span>:
</span></span><span style=display:flex><span>                    f<span style=color:#555>.</span>write(<span style=color:#c30>f</span><span style=color:#c30>&#39;G0 X</span><span style=color:#a00>{</span>x<span style=color:#a00>:</span><span style=color:#c30>0.3f</span><span style=color:#a00>}</span><span style=color:#c30> Y</span><span style=color:#a00>{</span>y<span style=color:#a00>:</span><span style=color:#c30>0.3f</span><span style=color:#a00>}</span><span style=color:#c30> Z</span><span style=color:#a00>{</span>Z_DRAW<span style=color:#a00>}</span><span style=color:#c30;font-weight:700>\n</span><span style=color:#c30>&#39;</span>)
</span></span><span style=display:flex><span>            
</span></span><span style=display:flex><span>            <span style=color:#09f;font-style:italic># move pen back up</span>
</span></span><span style=display:flex><span>            f<span style=color:#555>.</span>write(<span style=color:#c30>f</span><span style=color:#c30>&#39;G0 X</span><span style=color:#a00>{</span>x<span style=color:#a00>:</span><span style=color:#c30>0.3f</span><span style=color:#a00>}</span><span style=color:#c30> Y</span><span style=color:#a00>{</span>y<span style=color:#a00>:</span><span style=color:#c30>0.3f</span><span style=color:#a00>}</span><span style=color:#c30> Z</span><span style=color:#a00>{</span>Z_TRAVEL<span style=color:#a00>}</span><span style=color:#c30;font-weight:700>\n</span><span style=color:#c30>&#39;</span>)
</span></span><span style=display:flex><span>            
</span></span><span style=display:flex><span>        <span style=color:#09f;font-style:italic># move pen up and back to start point</span>
</span></span><span style=display:flex><span>        f<span style=color:#555>.</span>write(<span style=color:#c30>f</span><span style=color:#c30>&#39;G0 X</span><span style=color:#a00>{</span>x<span style=color:#a00>:</span><span style=color:#c30>0.3f</span><span style=color:#a00>}</span><span style=color:#c30> Y</span><span style=color:#a00>{</span>y<span style=color:#a00>:</span><span style=color:#c30>0.3f</span><span style=color:#a00>}</span><span style=color:#c30> Z</span><span style=color:#a00>{</span>Z_START<span style=color:#a00>}</span><span style=color:#c30;font-weight:700>\n</span><span style=color:#c30>&#39;</span>)
</span></span><span style=display:flex><span>        f<span style=color:#555>.</span>write(<span style=color:#c30>f</span><span style=color:#c30>&#39;G0 X200 Y200 Z</span><span style=color:#a00>{</span>Z_START<span style=color:#a00>}</span><span style=color:#c30;font-weight:700>\n</span><span style=color:#c30>&#39;</span>)
</span></span></code></pre></div><p>One thing I&rsquo;m particularly happy with was the quick release mounting system I built. I swapped the 1/8" glass print bed for a sheet of aluminum of equivalent thickness to which I TIG welded two toggle clamps. Actually, I <i>tried</i> TIG welding them, but the difference in melting temperatures between the aluminum plate and whatever the latches are made of was too much for my beginner welding skills. After a few botched attempts, I cut my losses and used some of the J-B Weld I had left over from my <a href=/posts/2023-03-12/3d-printed-kayak/>kayak</a>. I&rsquo;m starting to become a bit of a fan boy for this stuff. I&rsquo;m by no means an expert in epoxy or adhesives, but it&rsquo;s nice when something actually delivers relative to expectations. This shouldn&rsquo;t really be a noteworthy event, but with the enshittification of seemingly everything nowadays (I&rsquo;m looking at you Shimano) it&rsquo;s becoming quite an achievement.</p><img class=img-pad-big src=plotting.jpg alt="3D printer working as a pen plotter with new quickmount system"><p>Throughout the course of printing the postcards, I iterated on a few different designs. These two were my favorites.</p><img class=img-pad-big src=ptpx2024-designs.jpg alt="3D printer working as a pen plotter"><p>Since this was my first year participating in PTPX, I only signed up to supply 12 postcards. Playing it safe was fine I guess, but next year I&rsquo;ll definitely be signing up for more!</p></div></div></body></html>